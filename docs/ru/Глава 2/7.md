# **–ì–ª–∞–≤–∞ 2.7: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
**–í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è:** 50 –º–∏–Ω—É—Ç
**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É "–∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ —Å–ø–∞—Å–µ–Ω–∏—è" –¥–ª—è –≤–∞—à–µ–≥–æ API

---

#### **1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –°–ø–∞—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞–ø—Å—É–ª—ã –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–∏**
–î–∞–∂–µ —Å–∞–º—ã–µ –Ω–∞–¥–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –¥–∞—é—Ç —Å–±–æ–∏. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ:
- üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏ –Ω–µ "—É–Ω–∏—á—Ç–æ–∂–∞—Ç" –≤–∞—à–µ API
- üì° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- üîß –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–º–æ–≥—É—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É

> üí° **–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∞–Ω–∞–ª–æ–≥–∏—è:**
> –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ = –°–∏—Å—Ç–µ–º–∞ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –ø–æ–∫–∏–¥–∞–Ω–∏—è –∫–æ—Ä–∞–±–ª—è:
> - –ü—Ä–∏ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏ –∫–∞–ø—Å—É–ª–∞ (–æ—Ç–≤–µ—Ç) –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
> - –¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –∞–≤–∞—Ä–∏–∏ (–ª–æ–≥–∏)
> - –≠–∫–∏–ø–∞–∂ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏) –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–µ—Ç

---

#### **2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTTP-—Å—Ç–∞—Ç—É—Å—ã –æ—à–∏–±–æ–∫**
| –°—Ç–∞—Ç—É—Å       | –°–∏—Ç—É–∞—Ü–∏—è                                        | –ü—Ä–∏–º–µ—Ä –∏–∑ –∫–æ—Å–º–æ—Å–∞                   |
|--------------|-------------------------------------------------|-------------------------------------|
| `400 Bad Request` | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å                         | –ù–µ–≤–µ—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä—ã–∂–∫–∞          |
| `401 Unauthorized` | –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è                   | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–¥–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —à–ª—é–∑—É     |
| `403 Forbidden`    | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω                             | –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Å–µ–∫—Ç–æ—Ä "–¢–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞" |
| `404 Not Found`    | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω                            | –ü–ª–∞–Ω–µ—Ç–∞ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞                  |
| `422 Unprocessable Entity` | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏            | –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ç–æ–ø–ª–∏–≤–æ               |
| `500 Internal Server Error` | –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞                   | –°–±–æ–π –¥–≤–∏–≥–∞—Ç–µ–ª—è                      |

---

#### **3. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π**
–õ–∞—Ä–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª–∞—Å—Å `App\Exceptions\Handler` –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –æ—à–∏–±–æ–∫.

**–®–∞–≥ 1: –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `app/Exceptions/Handler.php`**
```php
use Illuminate\Database\Eloquent\ModelNotFoundException;
use Illuminate\Validation\ValidationException;
use Symfony\Component\HttpKernel\Exception\NotFoundHttpException;

public function register()
{
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ 404 –æ—à–∏–±–æ–∫
    $this->renderable(function (NotFoundHttpException $e, $request) {
        if ($request->is('api/*')) {
            return response()->json([
                'error' => '–†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω',
                'message' => '–¢–∞–∫–æ–π –ø–ª–∞–Ω–µ—Ç—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –Ω–∞—à–µ–π –≥–∞–ª–∞–∫—Ç–∏–∫–µ'
            ], 404);
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    $this->renderable(function (ValidationException $e, $request) {
        return response()->json([
            'error' => '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏',
            'errors' => $e->errors()
        ], 422);
    });

    // –û–±—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 500 –æ—à–∏–±–æ–∫
    $this->renderable(function (Throwable $e, $request) {
        if ($request->is('api/*')) {
            $code = method_exists($e, 'getStatusCode')
                ? $e->getStatusCode()
                : 500;

            return response()->json([
                'error' => '–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∞–≤–∞—Ä–∏—è',
                'message' => '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ò–Ω–∂–µ–Ω–µ—Ä—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥ —Ä–µ—à–µ–Ω–∏–µ–º'
            ], $code);
        }
    });
}
```

---

#### **4. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è**
–°–æ–∑–¥–∞–¥–∏–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —Å–∏—Ç—É–∞—Ü–∏–∏ "–ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞":

**–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è**
```bash
php artisan make:exception PlanetNotFoundException
```

**–®–∞–≥ 2: –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `app/Exceptions/PlanetNotFoundException.php`**
```php
namespace App\Exceptions;

use Exception;

class PlanetNotFoundException extends Exception
{
    public function render($request)
    {
        return response()->json([
            'error' => '–ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞',
            'message' => $this->getMessage() ?: '–ü–ª–∞–Ω–µ—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'
        ], 404);
    }
}
```

**–®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ**
```php
use App\Exceptions\PlanetNotFoundException;

public function show($id)
{
    $planet = Planet::find($id);
    if (!$planet) {
        throw new PlanetNotFoundException();
    }
    return response()->json($planet);
}
```

---

#### **5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫**
–ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
```json
{
    "success": false,
    "error": {
        "code": "PLANET_NOT_FOUND",
        "message": "–ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
        "details": {
            "id": 999
        }
    },
    "timestamp": "2025-08-04T12:34:56Z"
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ Handler.php:**
```php
$this->renderable(function (PlanetNotFoundException $e, $request) {
    return response()->json([
        'success' => false,
        'error' => [
            'code' => 'PLANET_NOT_FOUND',
            'message' => $e->getMessage(),
            'details' => ['id' => $request->id]
        ],
        'timestamp' => now()->toIso8601String()
    ], 404);
});
```

---

#### **6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫: –ß–µ—Ä–Ω—ã–π —è—â–∏–∫ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ—Ä–∞–±–ª—è**
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `config/logging.php`:
```php
'channels' => [
    'space_api' => [
        'driver' => 'daily',
        'path' => storage_path('logs/space_api.log'),
        'level' => 'error',
        'days' => 14,
    ],
],
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥:**
```php
try {
    // –ö–æ–¥ —Å —Ä–∏—Å–∫–æ–º –æ—à–∏–±–∫–∏
} catch (Exception $e) {
    Log::channel('space_api')->error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–ª–∞–Ω–µ—Ç–∞–º', [
        'exception' => $e,
        'request' => request()->all(),
        'user_id' => auth()->id()
    ]);
    throw $e;
}
```

---

#### **7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**
**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞**
```bash
# –ó–∞–ø—Ä–æ—Å
GET /api/planets/999

# –û—Ç–≤–µ—Ç
{
    "success": false,
    "error": {
        "code": "PLANET_NOT_FOUND",
        "message": "–ü–ª–∞–Ω–µ—Ç–∞ —Å ID 999 –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç",
        "details": {"id": 999}
    },
    "timestamp": "2025-08-04T12:34:56Z"
}
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞**
```php
// –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–∏–º –æ—à–∏–±–∫—É –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
public function index()
{
    throw new Exception("–¢–µ—Å—Ç–æ–≤–∞—è –∞–≤–∞—Ä–∏—è –¥–≤–∏–≥–∞—Ç–µ–ª—è");
}
```
```json
{
    "success": false,
    "error": {
        "code": "INTERNAL_SERVER_ERROR",
        "message": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞"
    },
    "timestamp": "2025-08-04T12:35:01Z"
}
```

---

#### **8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫: –°–∏—Å—Ç–µ–º–∞ —Å–ª–µ–∂–µ–Ω–∏—è –¶–£–ü**
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
- **Sentry** (sentry.io) - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Telegram-–±–æ—Ç—ã** - –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **ELK Stack** - –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

**–ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram:**
```php
// –í App\Exceptions\Handler
public function report(Exception $exception)
{
    if ($this->shouldReport($exception)) {
        Telegram::sendMessage([
            'chat_id' => env('TELEGRAM_ADMIN_ID'),
            'text' => "üö® API ERROR:\n" . $exception->getMessage()
        ]);
    }
    parent::report($exception);
}
```

---

#### **–ö–≤–∏–∑ –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è**
1. **HTTP-—Å—Ç–∞—Ç—É—Å –¥–ª—è "–ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞":**
   a) `400`
   b) `404`
   c) `500`

2. **–ö–ª–∞—Å—Å –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:**
   a) `Handler.php`
   b) `ErrorController.php`
   c) `Middleware/Error.php`

3. **–ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**
   a) `php artisan make:exception`
   b) `php artisan exception:create`
   c) `php artisan generate:exception`

4. **–ö–∞–Ω–∞–ª –¥–ª—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ API:**
   a) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `config/logging.php`
   b) –ü–∞—Ä–∞–º–µ—Ç—Ä –≤ `.env`
   c) –£–∫–∞–∑–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ

5. **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π:**
   a) –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤
   b) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   c) –û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞

<details>
  <summary>üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç—ã</summary>

  **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
  1. b)
  2. a)
  3. a)
  4. a)
  5. c)
</details>

---

**üöÄ –ò—Ç–æ–≥ –≥–ª–∞–≤—ã:**
–í—ã –æ—Å–Ω–∞—Å—Ç–∏–ª–∏ —Å–≤–æ–µ API –Ω–∞–¥–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Å–ø–∞—Å–µ–Ω–∏—è:
- üõü –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
- ü™ê –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏
- üìù –ï–¥–∏–Ω—ã–π JSON-—Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
- üì° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å –≥–æ—Ç–æ–≤ –∫ –∞–≤–∞—Ä–∏–π–Ω—ã–º —Å–∏—Ç—É–∞—Ü–∏—è–º!** –í —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≥–ª–∞–≤–µ —Ä–∞–∑–¥–µ–ª–∞ –º—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ —Å–∏—Å—Ç–µ–º—ã.

> **üìå –ü—Ä–æ–≤–µ—Ä–∫–∞:**
> 1. –°–æ–∑–¥–∞–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `PlanetNotFoundException`
> 2. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É 404 –æ—à–∏–±–æ–∫ –≤ `Handler.php`
> 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–ª–∞–Ω–µ—Ç–µ
> **‚ö†Ô∏è –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è:**
> - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `is('api/*')` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—à–∏–º —Ä–æ—É—Ç–∞–º
> - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ `register()`
> - –î–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `throw new`

**–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞:** [2.8 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ API](testing)
