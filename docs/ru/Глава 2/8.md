# **–ì–ª–∞–≤–∞ 2.8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ API**
**–í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è:** 1 —á–∞—Å
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø—Ä–µ–¥–ø–æ–ª–µ—Ç–Ω—ã–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –≤–∞—à–µ–≥–æ "–∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ—Ä–∞–±–ª—è" - API

---

#### **1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ü—Ä–µ–¥—Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º**
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API** - —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å –ø—Ä–æ–≤–µ—Ä–æ–∫, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏—Ö —á—Ç–æ:
- ‚úÖ –í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- üõ∞Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç —Å–±–æ–µ–≤
- üì° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

> üí° **–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∞–Ω–∞–ª–æ–≥–∏—è:**
> –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ = –ü—Ä–µ–¥–ø–æ–ª–µ—Ç–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–∫–µ—Ç—ã:
> - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π (—Ä–æ—É—Ç—ã)
> - –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–ª–æ–≥–∏–∫–∞)
> - –ò—Å–ø—ã—Ç–∞–Ω–∏—è –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)

---

#### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã**
Laravel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PHPUnit + —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–º–æ—â–Ω–∏–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
1. –§–∞–π–ª `phpunit.xml` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤
2. `.env.testing` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
3. `database.sqlite` - –ª–µ–≥–∫–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞

**–®–∞–≥ 1: –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –ë–î**
```bash
touch database/database.sqlite
```

**–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º `.env.testing`**
```env
APP_ENV=testing
DB_CONNECTION=sqlite
DB_DATABASE=database/database.sqlite
```

**–®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∞—Å—Å**
```bash
php artisan make:test PlanetApiTest
```
–§–∞–π–ª: `tests/Feature/PlanetApiTest.php`

---

#### **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞**
**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
```php
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class PlanetApiTest extends TestCase
{
    use RefreshDatabase; // –û—á–∏—Å—Ç–∫–∞ –ë–î –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞

    public function test_index_returns_planets_list()
    {
        // 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        Planet::factory()->count(3)->create();

        // 2. –î–µ–π—Å—Ç–≤–∏–µ: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        $response = $this->getJson('/api/planets');

        // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        $response->assertStatus(200)
                 ->assertJsonCount(3, 'data')
                 ->assertJsonStructure([
                     'data' => [
                         '*' => ['id', 'name', 'size_km']
                     ]
                 ]);
    }
}
```

---

#### **4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π**

**A. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã (POST)**
```php
public function test_store_creates_new_planet()
{
    $data = [
        'name' => 'Kepler-22b',
        'description' => '–≠–∫–∑–æ–ø–ª–∞–Ω–µ—Ç–∞ –≤ –æ–±–∏—Ç–∞–µ–º–æ–π –∑–æ–Ω–µ',
        'size_km' => 30000,
        'solar_system' => '–õ–µ–±–µ–¥—å'
    ];

    $response = $this->postJson('/api/planets', $data);

    $response->assertStatus(201)
             ->assertJsonPath('data.name', 'Kepler-22b');

    $this->assertDatabaseHas('planets', ['name' => 'Kepler-22b']);
}
```

**B. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã (PUT)**
```php
public function test_updates_planet()
{
    $planet = Planet::factory()->create();

    $updateData = ['size_km' => 7000];

    $response = $this->putJson("/api/planets/{$planet->id}", $updateData);

    $response->assertStatus(200)
             ->assertJsonPath('data.size_km', 7000);
}
```

**C. –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã (DELETE)**
```php
public function test_deletes_planet()
{
    $planet = Planet::factory()->create();

    $response = $this->deleteJson("/api/planets/{$planet->id}");

    $response->assertStatus(204);
    $this->assertDatabaseMissing('planets', ['id' => $planet->id]);
}
```

---

#### **5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫**

**A. –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
```php
public function test_store_validation_errors()
{
    $response = $this->postJson('/api/planets', [
        'name' => 'A', // –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ
        'size_km' => 'abc' // –ù–µ —á–∏—Å–ª–æ
    ]);

    $response->assertStatus(422)
             ->assertJsonValidationErrors(['name', 'size_km']);
}
```

**B. –ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞**
```php
public function test_show_404_for_nonexistent_planet()
{
    $response = $this->getJson('/api/planets/99999');
    $response->assertStatus(404)
             ->assertJson(['error' => '–ü–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞']);
}
```

---

#### **6. –§–∞–±—Ä–∏–∫–∏: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
–°–æ–∑–¥–∞–µ–º —Ñ–∞–±—Ä–∏–∫—É –¥–ª—è –ø–ª–∞–Ω–µ—Ç:
```bash
php artisan make:factory PlanetFactory
```

**–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `database/factories/PlanetFactory.php`:**
```php
public function definition()
{
    return [
		// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Å–ª–æ–≤, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ. –£ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Faker'–∞ –Ω–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π –ø–ª–∞–Ω–µ—Ç.
        'name' => $this->faker->unique()->city . ' ' . $this->faker->randomLetter . '-' . $this->faker->randomNumber(2),
        'description' => $this->faker->sentence,
        'size_km' => $this->faker->numberBetween(1000, 300000),
        'solar_system' => $this->faker->randomElement([
            '–°–æ–ª–Ω–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞',
            '–¢—Ä–∞–ø–ø–∏—Å—Ç-1',
            '–ö–µ–ø–ª–µ—Ä-90'
        ]),
        'is_habitable' => $this->faker->boolean(30)
    ];
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```php
// –°–æ–∑–¥–∞—Ç—å –æ–¥–Ω—É –ø–ª–∞–Ω–µ—Ç—É
$planet = Planet::factory()->create();

// –°–æ–∑–¥–∞—Ç—å 5 –ø–ª–∞–Ω–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ "–ö–µ–ø–ª–µ—Ä-186"
Planet::factory()->count(5)->create([
    'solar_system' => '–ö–µ–ø–ª–µ—Ä-186'
]);
```

---

#### **7. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤**
**–í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞:**
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
php artisan test

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã PlanetApi
php artisan test --filter PlanetApiTest

# –° –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
php artisan test --verbose
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
PASS  Tests\Feature\PlanetApiTest
‚úì index returns planets list
‚úì store creates new planet
‚úì updates planet
‚úì deletes planet
‚úì store validation errors
‚úì show 404 for nonexistent planet

Time: 1.12s
Memory: 22.00MB
OK (6 tests, 15 assertions)
```

---

#### **8. –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (Code Coverage)**
**–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Xdebug**
–î–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –∫–æ–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PHP ‚Äî [Xdebug](https://xdebug.org/wizard).
>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ wizard –≤–∞—à `php -i` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.

**–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `phpunit.xml`**
```xml
<phpunit ... >
    <coverage processUncoveredFiles="true">
        <include>
            <directory suffix=".php">./app</directory>
        </include>
    </coverage>
</phpunit>
```

**–®–∞–≥ 3: –ó–∞–ø—É—Å–∫ —Å –æ—Ç—á–µ—Ç–æ–º**
```bash
php artisan test --coverage-html=coverage
```
–û—Ç—á–µ—Ç: –û—Ç–∫—Ä–æ–π—Ç–µ `coverage/index.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

#### **9. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Postman**
**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Newman:**
1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é Postman –≤ `tests/Postman/SpaceApi.postman_collection.json`
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Newman:
```bash
npm install -g newman
```
3. –î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ `composer.json`:
```json
"scripts": {
    "test:postman": "newman run tests/Postman/SpaceApi.postman_collection.json"
}
```
4. –ó–∞–ø—É—Å–∫:
```bash
composer test:postman
```

---

#### **–ö–≤–∏–∑ –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è**
1. **–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞:**
   a) `php artisan make:test`
   b) `php artisan generate:test`
   c) `php artisan test:create`

2. **–¢—Ä–µ–π—Ç `RefreshDatabase` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
   a) –û—á–∏—Å—Ç–∫–∏ –ë–î –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤
   b) –ù–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   c) –°–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

3. **–ú–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
   a) `assertJsonFormat()`
   b) `assertJsonStructure()`
   c) `assertJsonSchema()`

4. **–§–∞–±—Ä–∏–∫–∏ –≤ Laravel –Ω—É–∂–Ω—ã –¥–ª—è:**
   a) –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   b) –°–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
   c) –û–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

5. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Postman-–∫–æ–ª–ª–µ–∫—Ü–∏–π –∏–∑ CLI:**
   a) Newman
   b) Postman CLI
   c) Artisan

<details>
  <summary>üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç—ã</summary>

  **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
  1. a)
  2. a)
  3. b)
  4. a)
  5. a)
</details>

---

**üöÄ –ò—Ç–æ–≥ –≥–ª–∞–≤—ã:**
–í—ã –ø—Ä–æ–≤–µ–ª–∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–µ–¥–ø–æ–ª–µ—Ç–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π! –¢–µ–ø–µ—Ä—å –≤–∞—à API:
- ‚úÖ –ü—Ä–æ—à–µ–ª –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π
- üõ°Ô∏è –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- üìä –ò–º–µ–µ—Ç –æ—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –∫–æ–¥–∞
- üîÅ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Postman —á–µ—Ä–µ–∑ Newman

**–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å –∫ –∑–∞–ø—É—Å–∫—É –≥–æ—Ç–æ–≤!** –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ä–∞–∑–¥–µ–ª –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é API –Ω–∞ Laravel.

> **üìå –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
> 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `php artisan test`
> 2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (–∑–µ–ª–µ–Ω—ã–π —Å–≤–µ—Ç!)
> 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
> **‚ö†Ô∏è –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç:**
> - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É API —á–µ—Ä–µ–∑ Postman
> - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –ë–î –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
> - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `dd($response->content())` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ì–ª–∞–≤—ã 2!** –í—ã —Å–æ–∑–¥–∞–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–µ API —Å –Ω—É–ª—è. –í —Å–ª–µ–¥—É—é—â–∏—Ö –≥–ª–∞–≤–∞—Ö –º—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –µ–≥–æ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ–º –Ω–∞ "–æ—Ä–±–∏—Ç–µ" (–ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–µ).

> **üåå –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏:**
> 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Sanctum)
> 2. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —Å –ø–æ–º–æ—â—å—é Swagger
> 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Forge, VPS)
> 4. –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ Vue/React

**–£—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤–∞—à–µ–π –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π –º–∏—Å—Å–∏–∏!** üöÄ
