# **–ì–ª–∞–≤–∞ 2.6: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
**–í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è:** 50 –º–∏–Ω—É—Ç
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∏—Ç—å –≤—Å–µ–ª–µ–Ω–Ω—É—é –æ—Ç "–∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –º—É—Å–æ—Ä–∞" - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

#### **1. –í–∞–ª–∏–¥–∞—Ü–∏—è: –©–∏—Ç –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞**
**–í–∞–ª–∏–¥–∞—Ü–∏—è** - —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º. –ë–µ–∑ –Ω–µ–µ:
- üöÄ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç "—Ä–∞–∑—Ä—É—à–∏—Ç—å" –≤–∞—à—É –±–∞–∑—É
- üåå –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∏ –º–æ–≥—É—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥
- ü™ê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏

> üí° **–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∞–Ω–∞–ª–æ–≥–∏—è:**
> –í–∞–ª–∏–¥–∞—Ü–∏—è = –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–∏:
> - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç "–≥—Ä—É–∑" (–¥–∞–Ω–Ω—ã–µ) –ø–µ—Ä–µ–¥ —Å—Ç—ã–∫–æ–≤–∫–æ–π
> - –û—Ç–∫–ª–æ–Ω—è–µ—Ç –æ–ø–∞—Å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
> - –§–∏–ª—å—Ç—Ä—É–µ—Ç –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –º—É—Å–æ—Ä

---

#### **2. –ì–¥–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤ Laravel API**
–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:
1. **–í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ** (–±—ã—Å—Ç—Ä–æ, –Ω–æ –∑–∞–≥—Ä–æ–º–æ–∂–¥–∞–µ—Ç –∫–æ–¥)
2. **Form Request** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

---

#### **3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ**
–ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ `validate()` –æ–±—ä–µ–∫—Ç–∞ Request:
```php
public function store(Request $request)
{
    $validated = $request->validate([
        'name' => 'required|string|max:255|unique:planets',
        'description' => 'required|string',
        'size_km' => 'required|integer|min:100|max:500000',
        'solar_system' => 'required|string|max:100',
        'image_url' => 'nullable|url|max:2048',
        'is_habitable' => 'boolean'
    ]);

    // ... —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã
}
```

**–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
| –ü—Ä–∞–≤–∏–ª–æ              | –û–ø–∏—Å–∞–Ω–∏–µ                          | –ü—Ä–∏–º–µ—Ä                     |
|----------------------|-----------------------------------|----------------------------|
| `required`           | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ                 | `'name' => 'required'`     |
| `string`             | –°—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ                | `'description' => 'string'`|
| `integer`            | –¶–µ–ª–æ–µ —á–∏—Å–ª–æ                       | `'size_km' => 'integer'`   |
| `min:value`          | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ/–¥–ª–∏–Ω–∞        | `'size_km' => 'min:100'`   |
| `max:value`          | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ/–¥–ª–∏–Ω–∞       | `'name' => 'max:255'`      |
| `unique:table,column`| –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ            | `'name' => 'unique:planets'` |
| `url`                | –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL                    | `'image_url' => 'url'`     |
| `boolean`            | true/false/1/0                    | `'is_habitable' => 'boolean'` |

---

#### **4. –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**
–ú–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –æ—à–∏–±–æ–∫:
```php
$validated = $request->validate(
    [
        'name' => 'required|unique:planets',
        'size_km' => 'min:1000'
    ],
    [
        'name.required' => '–ò–º—è –ø–ª–∞–Ω–µ—Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!',
        'name.unique' => '–¢–∞–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞ —É–∂–µ –µ—Å—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ',
        'size_km.min' => '–î–∏–∞–º–µ—Ç—Ä –ø–ª–∞–Ω–µ—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 1000 –∫–º'
    ]
);
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 422 Unprocessable Entity):**
```json
{
    "message": "The given data was invalid.",
    "errors": {
        "name": ["–¢–∞–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞ —É–∂–µ –µ—Å—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ"],
        "size_km": ["–î–∏–∞–º–µ—Ç—Ä –ø–ª–∞–Ω–µ—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 1000 –∫–º"]
    }
}
```

---

#### **5. –°–æ–∑–¥–∞–Ω–∏–µ Form Request**
–î–ª—è —Å–ª–æ–∂–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å:

**–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è**
```bash
php artisan make:request StorePlanetRequest
```

**–®–∞–≥ 2: –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `app/Http/Requests/StorePlanetRequest.php`**
```php
public function authorize()
{
    return true; // –î–ª—è API –æ–±—ã—á–Ω–æ true
}

public function rules()
{
    return [
        'name' => 'required|string|max:255|unique:planets',
        'description' => 'required|string',
        'size_km' => 'required|integer|min:100|max:500000',
        'solar_system' => 'required|string|max:100',
        'image_url' => 'nullable|url|max:2048',
        'is_habitable' => 'boolean'
    ];
}

public function messages()
{
    return [
        'name.unique' => '–ü–ª–∞–Ω–µ—Ç–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!',
        'size_km.min' => '–î–∏–∞–º–µ—Ç—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 100 –∫–º'
    ];
}
```

**–®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ**
```php
use App\Http\Requests\StorePlanetRequest;

public function store(StorePlanetRequest $request)
{
    // –î–∞–Ω–Ω—ã–µ —É–∂–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã!
    $validated = $request->validated();
    $planet = Planet::create($validated);
    return response()->json($planet, 201);
}
```

---

#### **6. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ "—Ä–∞–∑—É–º–Ω–æ—Å—Ç–∏" –Ω–∞–∑–≤–∞–Ω–∏—è –ø–ª–∞–Ω–µ—Ç—ã:

**–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª–∞**
```bash
php artisan make:rule ValidPlanetName
```

**–®–∞–≥ 2: –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `app/Rules/ValidPlanetName.php`**
```php
public function passes($attribute, $value)
{
    // –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    $forbidden = ['–ó–µ–º–ª—è 2.0', '–ù–∏–±–∏—Ä—É', '–ü–ª–∞–Ω–µ—Ç–∞ X'];
    return !in_array($value, $forbidden);
}

public function message()
{
    return '–≠—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!';
}
```

**–®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ Form Request**
```php
use App\Rules\ValidPlanetName;

public function rules()
{
    return [
        'name' => ['required', 'string', 'max:255', new ValidPlanetName],
        // ...
    ];
}
```

---

#### **7. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (Update)**
–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:

```php
// –í StorePlanetRequest
public function rules()
{
    return [
        'name' => [
            'required',
            Rule::unique('planets')->ignore($this->planet->id)
        ],
        // ...
    ];
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Form Request:**
```bash
php artisan make:request UpdatePlanetRequest
```

```php
use Illuminate\Validation\Rule;

public function rules()
{
    return [
        'name' => [
            'sometimes',
            'string',
            'max:255',
            Rule::unique('planets')->ignore($this->planet->id)
        ],
        'size_km' => 'sometimes|integer|min:100',
        // ...
    ];
}
```

---

#### **8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ Postman**
**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—à–∏–±–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–∏**
```json
POST /api/planets
{
    "name": "–ú–∞—Ä—Å", // –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    "size_km": 6779
}
```
**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
    "message": "The given data was invalid.",
    "errors": {
        "name": ["–ü–ª–∞–Ω–µ—Ç–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"]
    }
}
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä**
```json
{
    "name": "–ü–ª–∞–Ω–µ—Ç–∞-–ì–æ—Ä–æ—à–∏–Ω–∞",
    "size_km": 50 // < min:100
}
```
**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
"errors": {
    "size_km": ["–î–∏–∞–º–µ—Ç—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 100 –∫–º"]
}
```

---

#### **–ö–≤–∏–∑ –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è**
1. **HTTP-—Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
   a) `400 Bad Request`
   b) `422 Unprocessable Entity`
   c) `500 Internal Server Error`

2. **–ü—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏:**
   a) `unique:table`
   b) `distinct`
   c) `only:table`

3. **–ì–¥–µ –ª—É—á—à–µ —Ä–∞–∑–º–µ—â–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏?**
   a) –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
   b) –í –º–æ–¥–µ–ª–∏
   c) –í Form Request

4. **–ú–µ—Ç–æ–¥ `authorize()` –≤ Form Request –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:**
   a) `false`
   b) `true`
   c) `null`

5. **–ü—Ä–∞–≤–∏–ª–æ `sometimes` –æ–∑–Ω–∞—á–∞–µ—Ç:**
   a) –ü–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
   b) –ü–æ–ª–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
   c) –ü–æ–ª–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

<details>
  <summary>üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç—ã</summary>

  **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
  1. b)
  2. a)
  3. c)
  4. b)
  5. b)
</details>

---

**üöÄ –ò—Ç–æ–≥ –≥–ª–∞–≤—ã:**
–í—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –º–æ—â–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∑–∞—â–∏—Ç—ã –¥–ª—è —Å–≤–æ–µ–≥–æ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ API:
- üõ°Ô∏è –ë–∞–∑–æ–≤—ã–µ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- üìù –ß–∏—Ç–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- üß© Form Request –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚öôÔ∏è –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–í–∞—à–∞ –≤—Å–µ–ª–µ–Ω–Ω–∞—è —Ç–µ–ø–µ—Ä—å –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π!** –î–∞–ª–µ–µ –º—ã –Ω–∞—É—á–∏–º—Å—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å "–∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ –∞–≤–∞—Ä–∏–∏" - –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.

> **üìå –ü—Ä–æ–≤–µ—Ä–∫–∞:**
> 1. –°–æ–∑–¥–∞–π—Ç–µ Form Request –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–∞–Ω–µ—Ç
> 2. –î–æ–±–∞–≤—å—Ç–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–∑–≤–∞–Ω–∏—è
> 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ Postman
> **‚ö†Ô∏è –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
> - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Form Request –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
> - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `authorize()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true
> - –î–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Rule::unique`

**–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞:** [2.7 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](error-handling)
