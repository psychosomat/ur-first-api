# **–ì–ª–∞–≤–∞ 2.4: API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä PlanetController**
**–í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è:** 1 —á–∞—Å

---

#### **1. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: –¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏**
–í MVC-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** - —ç—Ç–æ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏:

- üì° –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã (GET, POST, PUT, DELETE)
- üîç –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª–∏
- üì¶ –§–æ—Ä–º–∏—Ä—É–µ—Ç JSON-–æ—Ç–≤–µ—Ç—ã –¥–ª—è API

> üí° **–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∞–Ω–∞–ª–æ–≥–∏—è:**
> `PlanetController` = –¶–£–ü –º–∏—Å—Å–∏–∏:

> - –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –ó–µ–º–ª–∏ (`GET /planets`)
> - –û—Ç–¥–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã "–∑–æ–Ω–¥–∞–º" (–º–æ–¥–µ–ª—è–º)
> - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é –≤ JSON-—Ñ–æ—Ä–º–∞—Ç–µ

---

#### **2. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞**
–†–µ—Å—É—Ä—Å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π.

**–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞**
```bash
php artisan make:controller PlanetController --api --model=Planet
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—Å—Ç—Å—è –≤ `app/Http/Controllers/PlanetController.php`:**
```php
<?php

namespace App\Http\Controllers;

use App\Models\Planet;
use Illuminate\Http\Request;

class PlanetController extends Controller
{
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–µ—Ç
    public function index() {}

    // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–ª–∞–Ω–µ—Ç—É
    public function store(Request $request) {}

    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–ª–∞–Ω–µ—Ç—É
    public function show(Planet $planet) {}

    // –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω–µ—Ç—É
    public function update(Request $request, Planet $planet) {}

    // –£–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω–µ—Ç—É
    public function destroy(Planet $planet) {}
}
```

---

#### **3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ API**

**A. `index()` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–ª–∞–Ω–µ—Ç**
```php
<?php
public function index()
{
    // –ü–æ–ª—É—á–∞–µ–º –ø–ª–∞–Ω–µ—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –ø–æ 15 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    $planets = Planet::paginate($request->get('per_page', 15));
    return response()->json($planets); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 200 OK
}
```

**B. `store()` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–ª–∞–Ω–µ—Ç—ã**
```php
<?php
public function store(Request $request)
{
    $data = $request->validate([
        'name' => 'required|string|max:255|unique:planets',
        'description' => 'required|string',
        'size_km' => 'required|integer|min:100',
        'solar_system' => 'required|string|max:100',
        'image_url' => 'nullable|url',
        'is_habitable' => 'boolean'
    ]);

    $planet = Planet::create($data);
    return response()->json($planet, 201); // 201 Created
}
```

**C. `show()` - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–¥–Ω–æ–π –ø–ª–∞–Ω–µ—Ç—ã**
```php
<?php
public function show(Planet $planet)
{
    return response()->json($planet); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π 200 OK
}
```

**D. `update()` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã**
```php
<?php
public function update(Request $request, Planet $planet)
{
    $data = $request->validate([
        'name' => [
            'string',
            'max:255',
            Rule::unique('planets')->ignore($planet->id),
        ],
        'description' => 'sometimes|string', // 'sometimes' - –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª–µ –ø—Ä–∏—à–ª–æ
        'size_km' => 'sometimes|integer|min:100',
        'solar_system' => 'sometimes|string|max:100',
        'image_url' => 'sometimes|nullable|url',
        'is_habitable' => 'sometimes|boolean'
    ]);

    $planet->update($data);
    return response()->json($planet); // 200 OK
}
```

**E. `destroy()` - –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã**
```php
<?php
public function destroy(Planet $planet)
{
    $planet->delete();
    return response()->json(null, 204); // 204 No Content
}
```

---

#### **4. –ü—Ä–∏–≤—è–∑–∫–∞ –º–æ–¥–µ–ª–∏ (Route Model Binding)**
Laravel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç –ø–ª–∞–Ω–µ—Ç—ã –ø–æ ID:
```php
// –í —Ä–æ—É—Ç–µ: GET /planets/{planet}
// –í –º–µ—Ç–æ–¥–µ: show(Planet $planet)
```

- –ï—Å–ª–∏ –ø–ª–∞–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 404
- –ù–µ—Ç –Ω—É–∂–¥—ã –≤ —Ä—É—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö `findOrFail()`

---

#### **5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤**
**–ü—Ä–∏–º–µ—Ä —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è `index()`:**
```php
<?php
public function index()
{
    return response()->json([
        'success' => true,
        'data' => Planet::all(),
        'message' => '–ü–ª–∞–Ω–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã'
    ]);
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ 404 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**
```json
{
    "message": "No query results for model [App\\Models\\Planet] 123",
    "exception": "Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException"
}
```

---

#### **–ö–≤–∏–∑ –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. –§–ª–∞–≥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è API-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:</p>
      <label><input type="radio" name="q1" value="a"> a) --api</label>
      <label><input type="radio" name="q1" value="b"> b) --resource</label>
      <label><input type="radio" name="q1" value="c"> c) --model</label>
    </div>
    <div class="question">
      <p>2. –ö–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏?</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 201 Created</label>
      <label><input type="radio" name="q2" value="c"> c) 204 No Content</label>
    </div>
    <div class="question">
      <p>3. Route Model Binding –ø–æ–∑–≤–æ–ª—è–µ—Ç:</p>
      <label><input type="radio" name="q3" value="a"> a) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å –æ–±—ä–µ–∫—Ç –ø–æ ID</label>
      <label><input type="radio" name="q3" value="b"> b) –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å HTML-—Ñ–æ—Ä–º—ã</label>
      <label><input type="radio" name="q3" value="c"> c) –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã</label>
    </div>
    <div class="question">
      <p>4. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–ª–∞–Ω–µ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º:</p>
      <label><input type="radio" name="q4" value="a"> a) JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–ª–∞–Ω–µ—Ç—ã</label>
      <label><input type="radio" name="q4" value="b"> b) null —Å –∫–æ–¥–æ–º 204</label>
      <label><input type="radio" name="q4" value="c"> c) –ü—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É</label>
    </div>
    <div class="question">
      <p>5. $request->validate() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:</p>
      <label><input type="radio" name="q5" value="a"> a) –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
      <label><input type="radio" name="q5" value="b"> b) –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</label>
      <label><input type="radio" name="q5" value="c"> c) –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'b', q3: 'a', q4: 'b', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>–í–æ–ø—Ä–æ—Å ${question.slice(1)}: <span style="color:green;">–í–µ—Ä–Ω–æ!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>–í–æ–ø—Ä–æ—Å ${question.slice(1)}: <span style="color:red;">–ù–µ–≤–µ—Ä–Ω–æ.</span> –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>–í–æ–ø—Ä–æ—Å ${question.slice(1)}: <span style="color:orange;">–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${score} –∏–∑ ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ –ò—Ç–æ–≥ –≥–ª–∞–≤—ã:**

–í—ã —Å–æ–∑–¥–∞–ª–∏ "–ø—É–ª—å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è" –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π! –¢–µ–ø–µ—Ä—å –≤–∞—à –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —É–º–µ–µ—Ç:

- üåå –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–µ—Ç (`index`)
- ü™ê –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–∏—Ä—ã (`store`)
- üî≠ –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–µ—Ç—ã (`show`)
- üõ†Ô∏è –û–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–µ–¥–µ–Ω–∏—è (`update`)
- üí• –£–Ω–∏—á—Ç–æ–∂–∞—Ç—å –ø–ª–∞–Ω–µ—Ç—ã (`destroy`)

**–û—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–ª–æ–∂–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã!** –í —Å–ª–µ–¥—É—é—â–µ–π –≥–ª–∞–≤–µ –º—ã –ø–æ–¥–∫–ª—é—á–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∫ API-—Ä–æ—É—Ç–∞–º.

> **üìå –ü—Ä–æ–≤–µ—Ä–∫–∞:**

> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `app/Http/Controllers` –µ—Å—Ç—å `PlanetController.php` —Å 5 –º–µ—Ç–æ–¥–∞–º–∏.

> **‚ö†Ô∏è –ï—Å–ª–∏ –æ—à–∏–±–∫–∏:**

> - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏: `use App\Models\Planet;`
> - –î–ª—è PostgreSQL: —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `Planet::all()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
> - –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å Tinker: –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `composer dump-autoload`

**–ì–æ—Ç–æ–≤—ã –∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏?** –°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞: [2.5 –ú–∞—Ä—à—Ä—É—Ç—ã API (routes/api.php)](routes)
