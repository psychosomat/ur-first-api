# **Cap√≠tulo 5.2: Criando Vis√µes Simples para API**
**Tempo de estudo:** 45 minutos

---

### **1. Tarefa: Visualizar dados**

Nossa API no Cap√≠tulo 2 √© capaz de fornecer dados no formato JSON. Isso √© excelente para m√°quinas, mas as pessoas preferem ver as informa√ß√µes em p√°ginas web bem projetadas. Nosso objetivo √© criar duas dessas p√°ginas:

1.  **Lista de todos os planetas** (`/planets`)
2.  **P√°gina de um √∫nico planeta** (`/planets/{id}`)

Para isso, usaremos a combina√ß√£o "Rota ‚Üí Controlador ‚Üí Vis√£o".

> üí° **Analogia espacial:**

> Imagine que o JSON da API s√£o dados brutos de telemetria, apenas um fluxo de n√∫meros. Nossa tarefa hoje √© criar dois monitores (duas "vis√µes") no Centro de Controle de Miss√£o:

> - **Tela geral:** mostra o status de todos os objetos no sistema (lista de planetas).
> - **Tela detalhada:** ao clicar em um objeto, exibe todas as informa√ß√µes sobre ele (p√°gina de um planeta).

---

### **2. Passo 1: Criando um controlador para p√°ginas web**
Para a pureza da arquitetura, n√£o se deve misturar a l√≥gica da API e a l√≥gica das p√°ginas web em um √∫nico controlador. Criaremos um novo controlador especificamente para exibir nossas views Blade.

Execute no terminal:
```bash
php artisan make:controller Web/PlanetPageController
```
*Estamos criando-o na subpasta `Web` para separ√°-lo dos controladores de API.*

Abra o arquivo criado `app/Http/Controllers/Web/PlanetPageController.php`.

---

### **Passo 2: P√°gina com a lista de todos os planetas**
**1. Criando um m√©todo no controlador:**
Em `PlanetPageController`, adicione o m√©todo `index`, que obter√° todos os planetas do banco de dados e os passar√° para a view.
```php
<?php

namespace App\Http\Controllers\Web;

use App\Http\Controllers\Controller;
use App\Models\Planet; // N√£o se esque√ßa de importar o modelo

class PlanetPageController extends Controller
{
    /**
     * Mostra a p√°gina com a lista de todos os planetas.
     */
    public function index()
    {
        // 1. Obt√©m todos os planetas do BD
        $planets = Planet::all();

        // 2. Retorna a view e passa os dados para ela
        return view('planets.index', ['planets' => $planets]);
    }
}
```

**2. Criando uma view Blade:**
Crie o arquivo `resources/views/planets/index.blade.php`. Usaremos o layout criado no cap√≠tulo anterior.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planets</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 2em;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
        }
        h2 {
            color: #1a202c;
        }
        hr {
            border: none;
            border-top: 1px solid #e2e8f0;
            margin: 1.5em 0;
        }
        .planet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5em;
        }
        .planet-card {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5em;
            padding: 1.5em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        .planet-card:hover {
            transform: translateY(-5px);
        }
        .planet-card h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .planet-card p {
            margin-bottom: 0.5em;
            color: #4a5568;
        }
        .planet-card a {
            color: #4299e1;
            text-decoration: none;
            font-weight: bold;
        }
        .planet-card a:hover {
            text-decoration: underline;
        }
        .no-planets {
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Lista de todos os planetas conhecidos</h2>
        <hr>
        <div class="planet-list">
            @forelse($planets as $planet)
                <div class="planet-card">
                    <h3>{{ $planet->name }}</h3>
                    <p>Sistema Solar: {{ $planet->solar_system }}</p>
                    <p>Di√¢metro: {{ number_format($planet->size_km, 0, '.', ' ') }} km</p>
                    <a href="/planets/{{ $planet->id }}">Saber mais &rarr;</a>
                </div>
            @empty
                <p class="no-planets">N√£o h√° nenhum planeta no banco de dados. Por favor, execute os seeders.</p>
            @endforelse
        </div>
    </div>
</body>
</html>
```

-   `number_format(...)` ‚Äî √© uma fun√ß√£o PHP comum para formatar n√∫meros de forma elegante. Pode ser usada diretamente no Blade.

**3. Criando uma rota em `routes/web.php`:**
```php
use App\Http\Controllers\Web\PlanetPageController;

// ...

Route::get('/planets', [PlanetPageController::class, 'index']);
```
Agora, se voc√™ navegar para `/planets` no navegador, voc√™ ver√° a p√°gina com a lista de planetas!

---

### **4. Passo 3: P√°gina de um √∫nico planeta**
**1. Criando um m√©todo no controlador:**

Em `PlanetPageController`, adicionaremos o m√©todo `show`. Gra√ßas ao Route Model Binding, Laravel encontrar√° automaticamente o planeta pelo ID e o passar√° para o m√©todo.

```php
<?php
// Dentro da classe PlanetPageController
/**
 * Mostra a p√°gina de um planeta espec√≠fico.
 */
public function show(Planet $planet)
{
    // O Laravel j√° encontrou o planeta para n√≥s.
    // Se n√£o for encontrado, ele retornar√° automaticamente um erro 404.

    return view('planets.show', ['planet' => $planet]);
}
```

**2. Criando uma view Blade:**

Crie o arquivo `resources/views/planets/show.blade.php`.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ $planet->name }}</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            width: 100%;
        }
        .planet-detail {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5em;
            padding: 2em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .planet-detail h1 {
            margin-top: 0;
            color: #2d3748;
        }
        .planet-detail p {
            margin-bottom: 1em;
            color: #4a5568;
            font-size: 1.1em;
        }
        .back-link {
            display: inline-block;
            margin-top: 1.5em;
            color: #4299e1;
            text-decoration: none;
            font-weight: bold;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="planet-detail">
            @if($planet->image_url)
                <img src="{{ $planet->image_url }}" alt="Image of {{ $planet->name }}" style="max-width: 100%; height: auto; border-radius: 0.5em; margin-bottom: 1em;">
            @endif
            <h1>{{ $planet->name }}</h1>
            @if($planet->description)
                <p>{{ $planet->description }}</p>
            @endif
            <p><strong>Sistema Solar:</strong> {{ $planet->solar_system }}</p>
            <p><strong>Di√¢metro:</strong> {{ number_format($planet->size_km, 0, '.', ' ') }} km</p>
            <a href="/planets" class="back-link">&larr; Voltar para a lista de planetas</a>
        </div>
    </div>
</body>
</html>
```

**3. Criando uma rota em `routes/web.php`:**
```php
// Adicione esta rota ap√≥s a rota para /planets
Route::get('/planets/{planet}', [PlanetPageController::class, 'show']);
```
-   O nome do par√¢metro `{planet}` deve corresponder ao nome da vari√°vel no m√©todo do controlador (`show(Planet $planet)`) para que o Route Model Binding funcione corretamente.

Agora, ao clicar no link "Saber mais" na p√°gina da lista, voc√™ ser√° direcionado para a p√°gina detalhada de um planeta espec√≠fico.

---

### **Quiz para consolida√ß√£o**


<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>
<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Qual abordagem √© a melhor pr√°tica para separar a l√≥gica da API e das p√°ginas web?</p>
      <label><input type="radio" name="q1" value="a"> a) Usar um √∫nico controlador para tudo</label>
      <label><input type="radio" name="q1" value="b"> b) Criar controladores separados (por exemplo, nas pastas `Web` e `Api`)</label>
      <label><input type="radio" name="q1" value="c"> c) Colocar toda a l√≥gica no arquivo de rotas</label>
    </div>
    <div class="question">
      <p>2. O que faz return view('planets.index', ['planets' => $planets]);?</p>
      <label><input type="radio" name="q2" value="a"> a) Retorna um array JSON com dados sobre os planetas</label>
      <label><input type="radio" name="q2" value="b"> b) Renderiza o arquivo resources/views/planets/index.blade.php e passa a vari√°vel `$planets` para ele</label>
      <label><input type="radio" name="q2" value="c"> c) Redireciona para a URL /planets/index</label>
    </div>
    <div class="question">
      <p>3. O que √© Route Model Binding no contexto de `show(Planet $planet)`?</p>
      <label><input type="radio" name="q3" value="a"> a) Laravel liga manualmente a rota ao modelo na configura√ß√£o</label>
      <label><input type="radio" name="q3" value="b"> b) Laravel encontra automaticamente um registro `Planet` no BD pelo par√¢metro da URL (`{planet}`)</label>
      <label><input type="radio" name="q3" value="c"> c) Laravel cria um novo planeta se ele n√£o for encontrado</label>
    </div>
    <div class="question">
      <p>4. Como √© poss√≠vel formatar a data do campo `created_at` no Blade?</p>
      <label><input type="radio" name="q4" value="a"> a) {{ $planet->created_at->format('Y-m-d') }}</label>
      <label><input type="radio" name="q4" value="b"> b) {{ format_date($planet->created_at) }}</label>
      <label><input type="radio" name="q4" value="c"> c) Isso s√≥ pode ser feito no controlador</label>
    </div>
    <div class="question">
      <p>5. Se a rota especifica `/posts/{post}`, como deve ser a assinatura do m√©todo no controlador para que o Route Model Binding funcione?</p>
      <label><input type="radio" name="q5" value="a"> a) public function show(Post $post)</label>
      <label><input type="radio" name="q5" value="b"> b) public function show(Post $p)</label>
      <label><input type="radio" name="q5" value="c"> c) public function show($post)</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'a', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:green;">Correto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:red;">Incorreto.</span> Resposta correta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:orange;">Sem resposta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Seu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumo do Cap√≠tulo:**

Voc√™ criou com sucesso uma "vitrine" para sua API, usando a arquitetura Laravel MVC. Agora voc√™ tem:

-   Um controlador separado para a l√≥gica das p√°ginas web.
-   Uma p√°gina din√¢mica com uma lista de todos os planetas, obtendo dados do BD.
-   Uma p√°gina de detalhes para cada planeta usando Route Model Binding.
-   Duas rotas web em `routes/web.php` para acessar essas p√°ginas.

**Voc√™ transformou dados brutos em informa√ß√µes compreens√≠veis e √∫teis para o usu√°rio.** No pr√≥ximo cap√≠tulo, adicionaremos interatividade, incorporando JavaScript em nossas views Blade para interagir com a API sem recarregar a p√°gina.