# **Cap√≠tulo 2.2: Criando o Modelo Planet**
**Tempo de estudo:** 45 minutos

---

#### **1. O Modelo no Laravel: Planta de um Objeto Espacial**
Na arquitetura MVC (Model-View-Controller), o **modelo** √©:

- üì¶ Um cont√™iner para dados (par√¢metros de planetas)
- üîå Uma interface para interagir com o banco de dados
- üõ°Ô∏è O centro da l√≥gica de neg√≥cios da aplica√ß√£o

> üí° **Analogia Espacial:**
> O modelo `Planet` = A planta de um planeta no computador do Centro de Controle da Miss√£o (CCM). Com ele, voc√™ pode:

> - Criar um novo planeta no cat√°logo (`INSERT`)
> - Obter dados sobre Marte (`SELECT`)
> - Atualizar informa√ß√µes sobre a atmosfera (`UPDATE`)

---

#### **2. Criando o Modelo e a Migra√ß√£o**
Laravel usa o Artisan CLI ‚Äî seu "painel de controle" do projeto.

**Passo 1: Gerando o modelo com a migra√ß√£o**
```bash
php artisan make:model Planet -m
```

**O que foi criado:**
```
app/
  ‚îî‚îÄ‚îÄ Models/
      ‚îî‚îÄ‚îÄ Planet.php    ‚Üê Modelo
database/
  ‚îî‚îÄ‚îÄ migrations/
      ‚îî‚îÄ‚îÄ 2025_08_04_000000_create_planets_table.php  ‚Üê Migra√ß√£o
```

**Flags do Artisan:**

- `-m` ‚Üí Criar uma migra√ß√£o
- `-c` ‚Üí Criar um controller
- `-r` ‚Üí Um controller de recursos

> üí° **Dica Profissional:** Essas flags podem ser combinadas para m√°xima efici√™ncia. O comando `php artisan make:model Planet -mcr` criar√° imediatamente o modelo, a migra√ß√£o e um controller de recursos para gerenciar esse modelo. Isso economiza muito tempo.

---

#### **3. Configurando o Modelo Planet**
Abra `app/Models/Planet.php`:
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Planet extends Model
{
    // Nome da tabela (por padr√£o: 'planets')
	// O Laravel assume automaticamente que o nome da tabela √© o plural do nome do modelo em snake_case (Planet -> planets).
     // Portanto, esta propriedade n√£o √© obrigat√≥ria aqui, mas √© √∫til para clareza.
    protected $table = 'planets';

    // Campos permitidos para preenchimento em massa
    protected $fillable = [
        'name',
        'description',
        'size_km',
        'solar_system',
        'image_url'
    ];

    // Tipos de dados para convers√£o autom√°tica
    protected $casts = [
        'size_km' => 'integer'
    ];
}
```

**Explica√ß√£o das Propriedades:**

| Propriedade         | Valor                               | Exemplo de Dados              |
|---------------------|-------------------------------------|-------------------------------|
| `$table`            | Nome da tabela no BD                | `planets`                     |
| `$fillable`         | Campos para preenchimento em massa  | `name`, `size_km`             |
| `$casts`            | Convers√£o autom√°tica de tipos       | `size_km: integer`            |

---

#### **4. Design da Tabela de Planetas**
Antes de editar a migra√ß√£o, vamos definir a estrutura de um "planeta":

| Campo          | Tipo de Dados    | Descri√ß√£o                     | Exemplo de Valor      |
|----------------|------------------|-------------------------------|-----------------------|
| `id`           | BIGINT (PK)      | ID √önico                      | 1                     |
| `name`         | VARCHAR(255)     | Nome do planeta               | "Marte"               |
| `description`  | TEXT             | Descri√ß√£o                     | "Planeta vermelho..." |
| `size_km`      | INTEGER          | Di√¢metro em km                | 6779                  |
| `solar_system` | VARCHAR(100)     | Sistema Solar                 | "Sistema Solar"       |
| `image_url`    | VARCHAR(2048)    | URL da foto (pode ser nulo)   | "https://..."         |
| `created_at`   | TIMESTAMP        | Data de cria√ß√£o               | 2025-08-04 12:00:00   |
| `updated_at`   | TIMESTAMP        | Data de atualiza√ß√£o           | 2025-08-05 09:30:00   |

---

#### **5. Editando a Migra√ß√£o**
Abra o arquivo de migra√ß√£o em `database/migrations/..._create_planets_table.php`:

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreatePlanetsTable extends Migration
{
    public function up()
    {
        Schema::create('planets', function (Blueprint $table) {
            $table->id(); // BIGINT auto-incremento

            $table->string('name')->unique();
            $table->text('description');
            $table->integer('size_km');
            $table->string('solar_system', 100);
            $table->string('image_url', 2048)->nullable();

            $table->timestamps(); // created_at + updated_at
        });
    }

    public function down()
    {
        Schema::dropIfExists('planets');
    }
}
```

**Pontos Chave:**

- `->unique()` ‚Üí Garante a unicidade dos nomes
- `->nullable()` ‚Üí O campo pode ser nulo
- `timestamps()` ‚Üí Gerenciamento autom√°tico de datas

---

#### **6. Executando a Migra√ß√£o (Pr√©via)**
Embora a execu√ß√£o ser√° no Cap√≠tulo 2.3, vamos ver como ser√°:
```bash
php artisan migrate
```

**Sa√≠da Esperada:**
```
Migrating: 2025_08_04_000000_create_planets_table
Migrated:  2025_08_04_000000_create_planets_table (32.15ms)
```

**Verifica√ß√£o no pgAdmin 4:**

1. Abra o banco de dados `space_api` ‚Üí Schemas ‚Üí Tables
2. A tabela `planets` deve aparecer com seus campos

---

#### **7. Abordagem Alternativa: Geradores de C√≥digo**
Para acelerar o desenvolvimento, voc√™ pode usar pacotes:

- **Laravel Blueprint** - cria modelos/migra√ß√µes a partir de uma descri√ß√£o YAML
- **InfyOm Laravel Generator** - gerador baseado em um esquema de BD

**Exemplo de Blueprint:**
```yaml
models:
  Planet:
    name: string:255
    description: text
    size_km: integer
    solar_system: string:100
    image_url: string:2048? # O caractere '?' significa que o campo pode ser nulo
```

---

#### **Quiz para Consolida√ß√£o**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Comando Artisan para criar um modelo e sua migra√ß√£o associada:</p>
      <label><input type="radio" name="q1" value="a"> a) php artisan make:model Planet -m</label>
      <label><input type="radio" name="q1" value="b"> b) php artisan create:model Planet</label>
      <label><input type="radio" name="q1" value="c"> c) php artisan model:new Planet --m</label>
    </div>
    <div class="question">
      <p>2. A propriedade `$fillable` no modelo √© usada para</p>
      <label><input type="radio" name="q2" value="a"> a) Prote√ß√£o contra atribui√ß√£o em massa</label>
      <label><input type="radio" name="q2" value="b"> b) Criptografia autom√°tica de dados</label>
      <label><input type="radio" name="q2" value="c"> c) Descri√ß√£o de chaves estrangeiras</label>
    </div>
    <div class="question">
      <p>3. `nullable()` na migra√ß√£o significa:</p>
      <label><input type="radio" name="q3" value="a"> a) O campo √© obrigat√≥rio</label>
      <label><input type="radio" name="q3" value="b"> b) O campo pode ser nulo</label>
      <label><input type="radio" name="q3" value="c"> c) O campo ser√° exclu√≠do</label>
    </div>
    <div class="question">
      <p>4. Tipo de campo para uma longa descri√ß√£o do planeta:</p>
      <label><input type="radio" name="q4" value="a"> a) string</label>
      <label><input type="radio" name="q4" value="b"> b) text</label>
      <label><input type="radio" name="q4" value="c"> c) varchar</label>
    </div>
    <div class="question">
      <p>5. O m√©todo `timestamps()` cria:</p>
      <label><input type="radio" name="q5" value="a"> a) Apenas created_at</label>
      <label><input type="radio" name="q5" value="b"> b) created_at e updated_at</label>
      <label><input type="radio" name="q5" value="c"> c) id, created_at, updated_at</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'a', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:green;">Correto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:red;">Incorreto.</span> Resposta correta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:orange;">Sem resposta.</span></li>`;
      }
    }
</script>
resultsHTML += `</ul><p><b>Seu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumo do Cap√≠tulo:**
Voc√™ criou um "g√™meo digital" do planeta! Agora seu projeto tem:

- ü™ê Modelo `Planet` com l√≥gica de neg√≥cios
- üìä Migra√ß√£o para a tabela `planets` no PostgreSQL
- üõ†Ô∏è Propriedades do modelo configuradas (`fillable`, `casts`)

**Prepare o banco de dados!** No pr√≥ximo cap√≠tulo, executaremos a migra√ß√£o e preencheremos o universo com os primeiros planetas.

> **üìå Verifica√ß√£o:**

> Certifique-se de que os arquivos `Planet.php` e `..._create_planets_table.php` foram criados nos diret√≥rios corretos.

> **‚ö†Ô∏è Se o Artisan reclamar:**

> - Verifique se voc√™ est√° na pasta do projeto
> - Certifique-se de que as depend√™ncias est√£o instaladas (`composer install`)
> - Para Windows: adicione PHP e Composer ao PATH