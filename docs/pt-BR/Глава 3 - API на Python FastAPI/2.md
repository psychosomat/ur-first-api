# **Cap√≠tulo 3.2: Criando seu primeiro endpoint de API**
**Tempo de estudo:** 30 minutos

---

#### **1. Endpoint: Porta de Acoplagem para Dados**
Imagine que nossa API √© uma esta√ß√£o espacial. Um **Endpoint** (ponto final) √© uma **porta de acoplagem** espec√≠fica, projetada para um determinado tipo de nave.

- Porta n¬∫1 ‚Äî para naves de carga (dados sobre planetas).
- Porta n¬∫2 ‚Äî para sondas de explora√ß√£o (dados sobre miss√µes).
- Porta n¬∫3 ‚Äî para √¥nibus espaciais de passageiros (dados sobre astronautas).

Cada endpoint √© uma URL √∫nica, respons√°vel por uma opera√ß√£o espec√≠fica com um recurso espec√≠fico.

> üí° **Analogia Espacial:**
> `GET /spaceships` ‚Äî √© o comando "Centro de Controle ‚Üí Esta√ß√£o: Relate a lista de todas as naves acopladas". Este endpoint retorna uma cole√ß√£o de recursos.

---

#### **2. Criando a "Frota Espacial"**
Enquanto n√£o temos um banco de dados, criaremos uma "simula√ß√£o" ‚Äî uma lista simples de naves espaciais na forma de um dicion√°rio Python.

**Abra `main.py` e adicione este c√≥digo antes da defini√ß√£o de `app`:**
```python
# main.py

# Passo 1: Criamos uma simula√ß√£o de banco de dados
db_spaceships = {
    1: {
        "name": "Voyager-1",
        "type": "Sonda",
        "launch_year": 1977,
        "status": "Ativo"
    },
    2: {
        "name": "Hubble Space Telescope",
        "type": "Telesc√≥pio",
        "launch_year": 1990,
        "status": "Ativo"
    },
    3: {
        "name": "ISS",
        "type": "Esta√ß√£o",
        "launch_year": 1998,
        "status": "Em √ìrbita"
    }
}

# ... aqui o c√≥digo app = FastAPI()
```
Este √© o nosso "registro de naves espaciais", com o qual trabalharemos.

---

#### **3. Primeiro endpoint: Lista de Naves**
Agora, vamos criar um endpoint que retornar√° toda a nossa frota.

**Adicione este c√≥digo em `main.py` ap√≥s `@app.get("/")`:**
```python
# main.py

# ... c√≥digo com db_spaceships, FastAPI, app e read_root() ...

@app.get("/spaceships")
def get_spaceships():
    """
    Retorna uma lista de todas as naves espaciais no registro.
    """
    return db_spaceships
```

- `@app.get("/spaceships")`: Criamos uma nova rota. Agora, as requisi√ß√µes `GET` para a URL `/spaceships` ser√£o processadas pela fun√ß√£o `get_spaceships`.
- `return db_spaceships`: O FastAPI converter√° automaticamente o dicion√°rio Python em uma resposta JSON v√°lida.

---

#### **4. Testando a Nova Porta de Acoplagem**
Se o seu servidor `uvicorn` ainda estiver em execu√ß√£o com a flag `--reload`, ele j√° recarregou e est√° pronto para uso. Caso contr√°rio ‚Äî inicie-o novamente:
```bash
uvicorn main:app --reload
```

**Passo 1: Verifica√ß√£o no navegador**

Abra o endere√ßo `http://127.0.0.1:8000/spaceships` no seu navegador.
Voc√™ deve ver a lista completa de suas naves em formato JSON:
```json
{
  "1": {
    "name": "Voyager-1",
    "type": "Sonda",
    "launch_year": 1977,
    "status": "Ativo"
  },
  "2": {
    "name": "Hubble Space Telescope",
    "type": "Telesc√≥pio",
    "launch_year": 1990,
    "status": "Ativo"
  },
  "3": {
    "name": "ISS",
    "type": "Esta√ß√£o",
    "launch_year": 1998,
    "status": "Em √ìrbita"
  }
}
```

**Passo 2: Verifica√ß√£o na documenta√ß√£o autom√°tica**

V√° para `http://127.0.0.1:8000/docs`. Voc√™ ver√° que uma nova se√ß√£o para o endpoint `GET /spaceships` apareceu na documenta√ß√£o. Voc√™ pode clicar em "Try it out" e "Execute" para test√°-lo diretamente de l√°!

---

#### **5. Endpoint com Par√¢metro: Dados sobre uma Nave Espec√≠fica**
E se precisarmos dos dados apenas do "Voyager-1"? Para isso, criaremos um endpoint com um **par√¢metro de caminho (path parameter)**.

**Adicione este c√≥digo em `main.py`:**
```python
# main.py

# ... o resto do c√≥digo ...

@app.get("/spaceships/{ship_id}")
def get_spaceship(ship_id: int):
    """
    Retorna dados sobre uma nave espacial espec√≠fica pelo seu ID.
    """
    return db_spaceships.get(ship_id)
```

- `"/spaceships/{ship_id}"`: As chaves `{}` dizem ao FastAPI que `ship_id` √© uma vari√°vel que ser√° passada da URL.
- `ship_id: int`: Esta √© uma **sugest√£o de tipo (type hint)**. O FastAPI verificar√° automaticamente se o ID passado √© um n√∫mero inteiro. Se algu√©m solicitar `/spaceships/voyager`, o FastAPI retornar√° um erro de valida√ß√£o `422 Unprocessable Entity`. Isso √© magia!

**Verifica√ß√£o:**

Abra `http://127.0.0.1:8000/spaceships/2`. Voc√™ deve receber dados apenas sobre o telesc√≥pio "Hubble". E se abrir `http://127.0.0.1:8000/spaceships/99` ‚Äî receber√° `null`, pois n√£o existe tal nave.

---

#### **Quiz para fixa√ß√£o**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Um endpoint em uma API √©...</p>
      <label><input type="radio" name="q1" value="a"> a) O ponto final do Universo</label>
      <label><input type="radio" name="q1" value="b"> b) Uma URL √∫nica para uma opera√ß√£o espec√≠fica com um recurso</label>
      <label><input type="radio" name="q1" value="c"> c) O nome do banco de dados</label>
    </div>
    <div class="question">
      <p>2. O que o decorator `@app.get("/users")` faz?</p>
      <label><input type="radio" name="q2" value="a"> a) Cria um novo usu√°rio</label>
      <label><input type="radio" name="q2" value="b"> b) Associa uma fun√ß√£o a uma requisi√ß√£o GET para `/users`</label>
      <label><input type="radio" name="q2" value="c"> c) Obt√©m uma lista de todos os decorators</label>
    </div>
    <div class="question">
      <p>3. O que significa a entrada `"/items/{item_id}"` no caminho?</p>
      <label><input type="radio" name="q3" value="a"> a) Que voc√™ deve procurar uma pasta com o nome `{item_id}`</label>
      <label><input type="radio" name="q3" value="b"> b) Que `item_id` √© um par√¢metro que ser√° obtido da URL</label>
      <label><input type="radio" name="q3" value="c"> c) √â um coment√°rio que ser√° ignorado</label>
    </div>
    <div class="question">
      <p>4. Por que a sugest√£o de tipo `ship_id: int` √© necess√°ria na fun√ß√£o?</p>
      <label><input type="radio" name="q4" value="a"> a) Para que o Python funcione mais r√°pido</label>
      <label><input type="radio" name="q4" value="b"> b) Para que o FastAPI valide automaticamente que o ID √© um n√∫mero</label>
      <label><input type="radio" name="q4" value="c"> c) Para que a vari√°vel seja vis√≠vel fora da fun√ß√£o</label>
    </div>
    <div class="question">
      <p>5. Se voc√™ solicitar `/spaceships/abc`, mas o FastAPI espera `int`, o que acontecer√°?</p>
      <label><input type="radio" name="q5" value="a"> a) O servidor "cair√°" com um erro 500</label>
      <label><input type="radio" name="q5" value="b"> b) O FastAPI retornar√° um erro 422</label>
      <label><input type="radio" name="q5" value="c"> c) O FastAPI tentar√° converter "abc" em um n√∫mero</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Quest√£o ${question.slice(1)}: <span style="color:green;">Correto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Quest√£o ${question.slice(1)}: <span style="color:red;">Incorreto.</span> Resposta correta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Quest√£o ${question.slice(1)}: <span style="color:orange;">Sem resposta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Seu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**üöÄ Resumo do Cap√≠tulo:**

Voc√™ criou com sucesso duas "portas de acoplagem" em sua esta√ß√£o espacial API:

- üõ∞Ô∏è Uma para obter a lista de todas as naves (`/spaceships`)
- üî≠ Uma segunda para obter dados sobre uma nave espec√≠fica (`/spaceships/{ship_id}`)

Voc√™ tamb√©m viu o poder da valida√ß√£o autom√°tica de tipos do FastAPI, que protege sua API contra requisi√ß√µes incorretas.

**O sistema de navega√ß√£o est√° configurado!** No pr√≥ximo cap√≠tulo, criaremos "plantas" para nossas naves espaciais usando Pydantic, para tornar nossa API ainda mais inteligente e robusta.

> **üìå Verifica√ß√£o:**
> - O servidor `uvicorn` est√° a funcionar.
> - O URL `http://127.0.0.1:8000/spaceships` retorna JSON com uma lista de naves espaciais.
> - O URL `http://127.0.0.1:8000/spaceships/1` retorna dados sobre a "Voyager-1".
> - O URL `http://127.0.0.1:8000/docs` mostra dois novos endpoints.

> **‚ö†Ô∏è Em caso de erros:**

> - **404 Not Found:** Verifique se o URL foi digitado corretamente no navegador e no decorador `@app.get(...)`.
> - **Erro no c√≥digo:** Verifique cuidadosamente a sintaxe, especialmente a indenta√ß√£o em Python e as v√≠rgulas no dicion√°rio.