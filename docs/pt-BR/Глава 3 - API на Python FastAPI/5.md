# **Cap√≠tulo 3.5: Documenta√ß√£o Autom√°tica Swagger**
**Tempo de Estudo:** 30 minutos

---

#### **1. Documenta√ß√£o da API: Manual de Opera√ß√µes de uma Esta√ß√£o Espacial**
Imagine que voc√™ √© um novo astronauta chegando √† ISS. Como voc√™ saberia qual bot√£o faz o qu√™ e como operar o bra√ßo rob√≥tico? Voc√™ precisaria de um **manual detalhado e atualizado**.

**A documenta√ß√£o da API** √© o mesmo tipo de manual para desenvolvedores. Ela explica:

- Quais "portas de acoplamento" (endpoints) est√£o dispon√≠veis.
- Quais "comandos" (m√©todos HTTP) podem ser enviados.
- Qual "carga" (dados) precisa ser transmitida.
- Qual "telemetria" (respostas) esperar.

O problema √© que escrever a documenta√ß√£o manualmente √© demorado, tedioso e quase sempre se torna desatualizado.

> üí° **Analogia espacial:**

> A documenta√ß√£o manual s√£o projetos em papel que ficam no arquivo e n√£o s√£o atualizados ap√≥s a moderniza√ß√£o da esta√ß√£o.
> **A documenta√ß√£o autom√°tica do FastAPI** √© um **monitor interativo no Centro de Controle de Miss√µes**, que √© atualizado em tempo real ap√≥s cada mudan√ßa na esta√ß√£o.

---

#### **2. A Magia do FastAPI: Como Funciona?**
O FastAPI faz todo o "trabalho sujo" para voc√™, com base no seu pr√≥prio c√≥digo. Ele escaneia:

1.  **Rotas:** Todos os decoradores `@app.get`, `@app.post`, etc.
2.  **Par√¢metros:** Par√¢metros de caminho (`ship_id: int`) e de consulta.
3.  **Modelos Pydantic:** Seus "projetos" (`Spaceship`, `SpaceshipCreate`).
4.  **Docstrings:** Descri√ß√µes que voc√™ escreve entre aspas triplas.

Com base nesses dados, o FastAPI gera um esquema de acordo com o padr√£o **OpenAPI** (anteriormente conhecido como Swagger) e depois o exibe atrav√©s de duas interfaces bonitas.

---

#### **3. Explorando o "Monitor do CCM": Swagger UI**
**Swagger UI** √© uma interface interativa que permite n√£o apenas ler a documenta√ß√£o, mas tamb√©m **testar a API diretamente do navegador**.

**Abra `http://127.0.0.1:8000/docs`**

Voc√™ ver√°:

- **Lista de endpoints:** Agrupados por tags (por padr√£o, pelo nome do recurso) e coloridos com as cores dos m√©todos HTTP.
- **Descri√ß√µes:** Textos das suas docstrings (`"""..."""`) s√£o exibidos como descri√ß√µes dos endpoints.
- **Par√¢metros:** Mostra quais par√¢metros (como `ship_id`) o endpoint espera, seu tipo e obrigatoriedade.
- **Corpo da Requisi√ß√£o (Request Body):** Para `POST` e `PUT`, mostra o esquema JSON gerado a partir do seu modelo Pydantic (`SpaceshipCreate`).
- **Respostas (Responses):** Mostra os poss√≠veis c√≥digos de status e esquemas de resposta, baseados em `response_model`.
- **Bot√£o "Try it out":** Permite preencher os par√¢metros e enviar uma requisi√ß√£o real para o seu servidor.

---

#### **4. Melhorando a Documenta√ß√£o: Tags e Descri√ß√µes**
Vamos tornar nossa documenta√ß√£o ainda mais profissional.

**Passo 1: Adicionar metadados ao `FastAPI`**
Ao criar `app`, voc√™ pode passar informa√ß√µes gerais sobre sua API.

**Altere a linha `app = FastAPI()` em `main.py`:**
```python
# main.py

app = FastAPI(
    title="Fleet Management API",
    description="API para gerenciamento de frota de naves espaciais.",
    version="1.0.0",
)
```
Agora, o t√≠tulo e a descri√ß√£o aparecer√£o no topo da sua documenta√ß√£o.

**Passo 2: Agrupar endpoints usando tags**
Voc√™ pode adicionar tags a cada endpoint para agrup√°-los por significado.

**Adicione o par√¢metro `tags` aos decoradores:**
```python
# GET /spaceships
@app.get("/spaceships", response_model=List[Spaceship], tags=["Naves Espaciais"])
# ...

# GET /spaceships/{ship_id}
@app.get("/spaceships/{ship_id}", response_model=Spaceship, tags=["Naves Espaciais"])
# ...

# POST /spaceships
@app.post("/spaceships", response_model=Spaceship, status_code=201, tags=["Naves Espaciais"])
# ...

# e assim por diante para PUT e DELETE
```
Agora, todas as suas opera√ß√µes CRUD ser√£o agrupadas ordenadamente sob o t√≠tulo "Naves Espaciais".

---

#### **5. Vis√£o Alternativa: ReDoc**
O FastAPI fornece outra interface para documenta√ß√£o "pronta para uso" ‚Äî **ReDoc**. Ela √© menos interativa, mas √© frequentemente considerada mais leg√≠vel e excelente para documenta√ß√£o est√°tica.

**Abra `http://127.0.0.1:8000/redoc`**

Voc√™ ver√° um layout de tr√™s colunas com navega√ß√£o, descri√ß√µes de endpoints e esquemas de dados. Esta √© uma √≥tima maneira de fornecer documenta√ß√£o aos seus "clientes" (por exemplo, a equipe de frontend).

---

#### **Quiz para Fixa√ß√£o**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>


<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. O FastAPI gera documenta√ß√£o com base em...</p>
      <label><input type="radio" name="q1" value="a"> a) Arquivos `.html` separados que precisam ser criados manualmente</label>
      <label><input type="radio" name="q1" value="b"> b) Seu c√≥digo Python: rotas, modelos Pydantic e docstrings</label>
      <label><input type="radio" name="q1" value="c"> c) Coment√°rios que come√ßam com `#`</label>
    </div>
    <div class="question">
      <p>2. Qual padr√£o est√° na base da autodocumenta√ß√£o do FastAPI?</p>
      <label><input type="radio" name="q2" value="a"> a) GraphQL</label>
      <label><input type="radio" name="q2" value="b"> b) XML-RPC</label>
      <label><input type="radio" name="q2" value="c"> c) OpenAPI (Swagger)</label>
    </div>
    <div class="question">
      <p>3. Qual √© o URL padr√£o para acessar a documenta√ß√£o interativa Swagger UI?</p>
      <label><input type="radio" name="q3" value="a"> a) `/admin`</label>
      <label><input type="radio" name="q3" value="b"> b) `/docs`</label>
      <label><input type="radio" name="q3" value="c"> c) `/api/help`</label>
    </div>
    <div class="question">
      <p>4. O par√¢metro `tags` no decorador `@app.get` √© usado para:</p>
      <label><input type="radio" name="q4" value="a"> a) Adicionar meta-tags ao HTML</label>
      <label><input type="radio" name="q4" value="b"> b) Agrupar endpoints na documenta√ß√£o</label>
      <label><input type="radio" name="q4" value="c"> c) Marcar um endpoint como obsoleto</label>
    </div>
    <div class="question">
      <p>5. ReDoc √©...</p>
      <label><input type="radio" name="q5" value="a"> a) Uma ferramenta para editar c√≥digo no navegador</label>
      <label><input type="radio" name="q5" value="b"> b) Uma interface alternativa, mais est√°tica, para a documenta√ß√£o da API</label>
      <label><input type="radio" name="q5" value="c"> c) Um sistema para detec√ß√£o de c√≥digo "vermelho" (n√£o funcional)</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:green;">Correto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:red;">Incorreto.</span> Resposta correta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:orange;">Sem resposta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Seu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**üöÄ Resumo do Cap√≠tulo:**

Voc√™ viu uma das "superpot√™ncias" mais poderosas do FastAPI ‚Äî a cria√ß√£o de documenta√ß√£o sem nenhum esfor√ßo.

- üìñ Sua API agora tem dois tipos de documenta√ß√£o atualizada: **Swagger UI** e **ReDoc**.
- üî¨ A documenta√ß√£o √© interativa e permite testar a API em tempo real.
- üè∑Ô∏è Voc√™ aprendeu a aprimor√°-la com metadados e tags.

**O manual de opera√ß√µes est√° pronto e sempre atualizado!** No cap√≠tulo final desta se√ß√£o, aprenderemos a lidar com "anomalias espaciais" ‚Äî erros e dados incorretos.

> **üìå Verifica√ß√£o:**

> - Certifique-se de que o t√≠tulo, a descri√ß√£o e os endpoints agrupados por tags s√£o exibidos em `http://127.0.0.1:8000/docs`.
> - Verifique se seu modelo `Spaceship` est√° vis√≠vel na se√ß√£o "Schemas".
> - Abra `http://127.0.0.1:8000/redoc` e avalie a vis√£o alternativa.

> **‚ö†Ô∏è Se as altera√ß√µes n√£o aparecerem:**


---
> - Certifique-se de que salvou o arquivo `main.py`.
> - Verifique que o servidor `uvicorn` est√° executando com a flag `--reload` e recarregou com sucesso.