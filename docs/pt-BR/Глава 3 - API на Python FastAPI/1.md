# **Cap√≠tulo 3.1: Instala√ß√£o do FastAPI e Configura√ß√£o do Ambiente**
**Tempo de estudo:** 45 minutos

---

#### **1. O que √© FastAPI? O Hipermotor para APIs**
Se Flask √© uma sonda de reconhecimento manobr√°vel e Django √© uma enorme nave-m√£e, ent√£o **FastAPI** √© um **ca√ßa supers√¥nico**.

**FastAPI** √© um framework web moderno e de alto desempenho para a cria√ß√£o de APIs em Python 3.7+. Suas principais vantagens s√£o:

- **Velocidade:** Um dos frameworks Python mais r√°pidos, compar√°vel a NodeJS e Go.
- **Simplicidade:** Sintaxe minimalista e intuitiva.
- **Auto-documenta√ß√£o:** Gera automaticamente documenta√ß√£o interativa para sua API.
- **Tipagem:** Utiliza dicas de tipo padr√£o do Python para valida√ß√£o, autocompletar e documenta√ß√£o.

> üí° **Analogia Espacial:**

> FastAPI √© como o "hipermotor" para sua nave-API. Ele √© baseado em duas tecnologias:

> - **Starlette** (chassi do ca√ßa) ‚Äî oferece assincronicidade e alt√≠ssimo desempenho.
> - **Pydantic** (computador de bordo) ‚Äî respons√°vel pela valida√ß√£o de dados e configura√ß√µes.

---

#### **2. Preparando a Plataforma de Lan√ßamento: Ambiente Virtual**
Antes de construir nosso ca√ßa, precisamos criar um **laborat√≥rio de montagem est√©ril**. Em Python, isso √© feito usando **ambientes virtuais**.

**Por que isso √© necess√°rio?** Para que as depend√™ncias do nosso projeto (motores, sistemas de navega√ß√£o) n√£o entrem em conflito com outros projetos no seu computador.

**Passo 1: Criando o ambiente virtual**
Abra o terminal na pasta do seu projeto (por exemplo, `C:\Projects\FastAPI_Fleet`) e execute:

```bash
python -m venv venv
```
Este comando criar√° uma pasta `venv` com uma vers√£o isolada do Python.

**Passo 2: Ativando o "campo de for√ßa" do laborat√≥rio**

- **Windows (PowerShell):**

  ```powershell
  .\venv\Scripts\Activate.ps1
  ```
  *(Se ocorrer um erro, talvez seja necess√°rio permitir a execu√ß√£o de scripts: `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process`)*

- **Windows (CMD):**

  ```cmd
  .\venv\Scripts\activate.bat
  ```

- **macOS / Linux:**

  ```bash
  source venv/bin/activate
  ```
Ap√≥s a ativa√ß√£o, `(venv)` aparecer√° no in√≠cio da linha do terminal. Isso significa que voc√™ est√° dentro do seu laborat√≥rio!

---

#### **3. Instala√ß√£o do Motor: FastAPI e Uvicorn**
Agora vamos instalar dois componentes chave:

- **fastapi:** O pr√≥prio framework.
- **uvicorn:** Um servidor ASGI ultrarr√°pido que ir√° "ligar" nosso motor.

Execute no ambiente ativado:
```bash
pip install "fastapi[all]"
```
> üí° **Por que `[all]`?**
> Isso instalar√° `fastapi`, `uvicorn` e outros pacotes √∫teis (por exemplo, para suporte a websockets e Jinja2), que ser√£o √∫teis em miss√µes futuras.

**Verifica√ß√£o da instala√ß√£o:**
```bash
pip freeze
```
Voc√™ dever√° ver `fastapi`, `pydantic`, `starlette`, `uvicorn` e outros pacotes na lista.

---

#### **4. Primeiro Contato: O Arquivo `main.py`**
Crie um arquivo `main.py` na raiz do projeto ‚Äî este ser√° o **painel de controle central** da nossa API.

**Adicione o seguinte c√≥digo a `main.py`:**
```python
from fastapi import FastAPI

# Criamos uma inst√¢ncia da nossa "nave espacial" API
app = FastAPI()

# Definimos o primeiro "n√≥ de acoplagem" (endpoint)
# Este √© o URL raiz: /
@app.get("/")
def read_root():
    """
    Esta √© a mensagem do Centro de Comando, vis√≠vel para todos
    que se conectam √† porta principal.
    """
    return {"message": "Bem-vindo ao Centro de Comando da Frota Espacial!"}
```
- `@app.get("/")`: Este √© um **decorador** que informa ao FastAPI que a fun√ß√£o `read_root` deve lidar com requisi√ß√µes `GET` para o URL raiz (`/`).

---

#### **5. Igni√ß√£o! Iniciando o Servidor**
Chegou a hora de ligar nosso hipermotor! No terminal (com o `venv` ativo), execute:
```bash
uvicorn main:app --reload
```
**Decodifica√ß√£o do comando:**

- `uvicorn`: Iniciamos o servidor Uvicorn.
- `main`: O arquivo `main.py` (sem o `.py`).
- `app`: O objeto `app = FastAPI()`, criado dentro de `main.py`.
- `--reload`: "Piloto autom√°tico". O servidor ser√° reiniciado automaticamente a cada altera√ß√£o no c√≥digo.

**Sa√≠da esperada no terminal:**
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345]
INFO:     Started server process [12346]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

---

#### **6. Verifica√ß√£o de Conex√£o com o Centro de Comando**
Sua API est√° agora online e escutando na porta `8000`!

**Passo 1: Verifica√ß√£o no navegador**

Abra o endere√ßo `http://127.0.0.1:8000` no navegador. Voc√™ dever√° ver:
```json
{
  "message": "Bem-vindo ao Centro de Comando da Frota Espacial!"
}
```

**Passo 2: Olhando para o futuro (auto-documenta√ß√£o)**

FastAPI j√° criou dois presentes para voc√™. Abra estes URLs:

- `http://127.0.0.1:8000/docs`: Documenta√ß√£o interativa Swagger UI.
- `http://127.0.0.1:8000/redoc`: Documenta√ß√£o alternativa ReDoc.

Voc√™ ver√° seu primeiro endpoint, que pode ser testado diretamente do navegador!

---

#### **Quiz para Fixa√ß√£o**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI √© conhecido por sua...</p>
      <label><input type="radio" name="q1" value="a"> a) Opera√ß√£o lenta, mas confi√°vel</label>
      <label><input type="radio" name="q1" value="b"> b) Alta performance e velocidade</label>
      <label><input type="radio" name="q1" value="c"> c) Integra√ß√£o apenas com bancos de dados Microsoft</label>
    </div>
    <div class="question">
      <p>2. Para que serve um ambiente virtual (`venv`)?</p>
      <label><input type="radio" name="q2" value="a"> a) Para acelerar o trabalho do Python</label>
      <label><input type="radio" name="q2" value="b"> b) Para isolar as depend√™ncias do projeto</label>
      <label><input type="radio" name="q2" value="c"> c) Para escrever testes automaticamente</label>
    </div>
    <div class="question">
      <p>3. Qual servidor √© usado para iniciar o FastAPI nesta li√ß√£o?</p>
      <label><input type="radio" name="q3" value="a"> a) Apache</label>
      <label><input type="radio" name="q3" value="b"> b) Gunicorn</label>
      <label><input type="radio" name="q3" value="c"> c) Uvicorn</label>
    </div>
    <div class="question">
      <p>4. O comando `uvicorn main:app --reload` significa:</p>
      <label><input type="radio" name="q4" value="a"> a) Iniciar o arquivo `app.py` com o objeto `main`</label>
      <label><input type="radio" name="q4" value="b"> b) Iniciar o objeto `app` no arquivo `main.py` e reiniciar a cada altera√ß√£o</label>
      <label><input type="radio" name="q4" value="c"> c) Reiniciar o computador e iniciar a aplica√ß√£o</label>
    </div>
    <div class="question">
      <p>5. O que o decorador `@app.get("/")` faz no FastAPI?</p>
      <label><input type="radio" name="q5" value="a"> a) Obt√©m dados do arquivo `app.py`</label>
      <label><input type="radio" name="q5" value="b"> b) Envia uma requisi√ß√£o GET para um servidor externo</label>
      <label><input type="radio" name="q5" value="c"> c) Associa a fun√ß√£o a uma requisi√ß√£o GET para o URL raiz</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'c', q4: 'b', q5: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Quest√£o ${question.slice(1)}: <span style="color:green;">Correto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Quest√£o ${question.slice(1)}: <span style="color:red;">Incorreto.</span> Resposta correta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Quest√£o ${question.slice(1)}: <span style="color:orange;">Sem resposta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Seu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumo do Cap√≠tulo:**

Voc√™ montou e iniciou com sucesso o "hipermotor" da sua nova API! Agora voc√™ tem:
- üõ†Ô∏è Ambiente de desenvolvimento isolado (`venv`)
- üöÄ FastAPI e servidor Uvicorn instalados
- üõ∞Ô∏è API em funcionamento com um endpoint
- üìä Documenta√ß√£o gerada automaticamente

**Todos os sistemas em ordem!** No pr√≥ximo cap√≠tulo, criaremos nosso primeiro endpoint completo, que retornar√° uma lista de naves espaciais.

> **üìå Verifica√ß√£o:**

> - No terminal, o ambiente `(venv)` est√° ativo
> - O servidor `uvicorn` est√° rodando sem erros
> - O endere√ßo `http://127.0.0.1:8000/docs` abre no navegador

> **‚ö†Ô∏è Em caso de erros:**

> - `command not found`: Certifique-se de que ativou o ambiente virtual.
> - `Port ... is already in use`: Outro programa est√° usando a porta 8000. Pare-o ou inicie o uvicorn em outra porta: `uvicorn main:app --reload --port 8001`.
> - Erros ao ativar `venv` no PowerShell: Verifique a pol√≠tica de execu√ß√£o de scripts.