# **Cap√≠tulo 6.4: Documenta√ß√£o da API**
**Tempo de estudo:** 30 minutos

---

#### **1. Por que a documenta√ß√£o da API √© necess√°ria?**
Imagine que lhe deram um controle remoto de uma nave espacial complexa sem uma √∫nica etiqueta nos bot√µes. Voc√™ os pressionaria aleatoriamente, arriscando lan√ßar a catapulta em vez de ligar a luz. A documenta√ß√£o da API s√£o essas mesmas etiquetas e instru√ß√µes.

**Boa documenta√ß√£o:**

- **Economiza tempo:** Os desenvolvedores n√£o precisam adivinhar quais endpoints existem, quais par√¢metros eles aceitam e o que retornam.
- **Reduz erros:** Uma descri√ß√£o clara dos formatos de dados e c√≥digos de erro ajuda a evitar o uso incorreto da API.
- **Simplifica a integra√ß√£o:** A equipe de frontend pode trabalhar em paralelo com a equipe de backend, baseando-se na documenta√ß√£o como um contrato.
- **√â o seu legado:** Daqui a seis meses, voc√™ mesmo se agradecer√° quando voltar ao projeto.

> üí° **Analogia espacial:**

> - **API** = Sistema complexo de controle de uma esta√ß√£o espacial.
> - **Documenta√ß√£o da API** = Manual para astronautas. Descreve:
>   - Qual comando (`endpoint`) enviar para abrir a eclusa.
>   - Quais par√¢metros (`corpo da requisi√ß√£o`) passar para configurar o sistema de suporte √† vida.
>   - Quais sinais (`respostas da API`) esperar em resposta.

---

#### **2. Documenta√ß√£o no FastAPI: Magia Autom√°tica**
FastAPI torna a documenta√ß√£o incrivelmente simples. Ele **gera automaticamente documenta√ß√£o interativa** com base no seu c√≥digo, usando os padr√µes **OpenAPI** e **Swagger UI**.

**Passo 1: Adicione metadados √† sua aplica√ß√£o**

Em `main.py`, voc√™ pode adicionar descri√ß√µes que aparecer√£o na documenta√ß√£o.

```python
# main.py
from fastapi import FastAPI
from pydantic import BaseModel, Field

# ... (c√≥digo FastAPI)

app = FastAPI(
    title="SpaceAPI",
    description="""
API para explora√ß√£o da gal√°xia. üöÄ

Voc√™ poder√°:
* **Visualizar planetas**.
* **Adicionar novos mundos** (autentica√ß√£o necess√°ria).
    """,
    version="1.0.0",
    contact={
        "name": "Engenheiro Chefe do Centro de Controle da Miss√£o",
        "url": "https://example.com/contact",
        "email": "engineer@example.com",
    },
)
```

**Passo 2: Descreva seus modelos e endpoints**

Quanto mais detalhadamente voc√™ descrever os modelos Pydantic e os par√¢metros dos endpoints, melhor ser√° a documenta√ß√£o.

```python
# No arquivo de modelos Pydantic ou em main.py

class PlanetBase(BaseModel):
    name: str = Field(..., example="Terra", description="Nome do planeta")
    description: str = Field(..., example="Planeta azul com vida diversa", description="Breve descri√ß√£o")
    # ...

class Planet(PlanetBase):
    id: int
    is_habitable: bool

    class Config:
        orm_mode = True # ou from_attributes = True no Pydantic v2

# No arquivo de rotas
@router.get(
    "/planets",
    response_model=list[Planet],
    summary="Obter lista de todos os planetas",
    description="Retorna uma lista de todos os planetas conhecidos com pagina√ß√£o (futuramente)."
)
def get_planets():
    # ...

@router.post(
    "/planets",
    # ...
    summary="Criar novo planeta",
    responses={
        401: {"description": "Usu√°rio n√£o autorizado"},
        422: {"description": "Erro de valida√ß√£o de dados"}
    }
)
def create_planet(planet: PlanetCreate, ...):
    # ...
```

- `Field(..., example="...")`: Adiciona exemplos √† documenta√ß√£o.
- `summary`: Breve descri√ß√£o do endpoint.
- `description`: Descri√ß√£o detalhada.
- `responses`: Descri√ß√£o de poss√≠veis c√≥digos de resposta, al√©m do sucesso.

**Passo 3: Abra a documenta√ß√£o no navegador**

Inicie seu servidor FastAPI e abra duas URLs m√°gicas:

1.  **`http://127.0.0.1:8000/docs`** ‚Äî abrir√° a documenta√ß√£o interativa **Swagger UI**. Aqui voc√™ pode n√£o apenas ler, mas tamb√©m **testar** seus endpoints diretamente do navegador!
2.  **`http://127.0.0.1:8000/redoc`** ‚Äî abrir√° uma vis√£o alternativa da documenta√ß√£o **ReDoc**. √â menos interativa, mas frequentemente mais leg√≠vel.



---

#### **3. Documenta√ß√£o no Laravel: Usando pacotes de terceiros**

Ao contr√°rio do FastAPI, Laravel n√£o gera documenta√ß√£o "out-of-the-box". No entanto, existem excelentes pacotes que fazem isso, analisando seu c√≥digo. O mais popular √© o **Scribe**.

**Passo 1: Instala√ß√£o do Scribe**
```bash
composer require --dev "knuckleswtf/scribe"
```
```bash
php artisan vendor:publish --tag=scribe-config
php artisan scribe:generate
```

**Passo 2: Descrevendo endpoints usando DocBlocks**

Scribe l√™ os PHP DocBlocks (coment√°rios do tipo `/** ... */`) acima dos m√©todos do seu controlador.

Abra `app/Http/Controllers/PlanetController.php`:

```php
// app/Http/Controllers/PlanetController.php

/**
 * @group Planetas
 * API para gerenciamento de planetas
 */
class PlanetController extends Controller
{
    /**
     * Obter lista de planetas
     *
     * Retorna uma lista paginada de todos os planetas na gal√°xia.
     *
     * @unauthenticated
     */
    public function index()
    {
        // ...
    }

    /**
     * Criar um novo planeta
     *
     * @authenticated
     *
     * @bodyParam name string required Nome do planeta. Example: Kepler-186f
     * @bodyParam description string required Descri√ß√£o do planeta.
     * @bodyParam size_km integer required Di√¢metro em quil√¥metros. Example: 14000
     * @bodyParam is_habitable boolean Se o planeta √© habit√°vel. Example: true
     *
     * @response 201 {
     *  "id": 4,
     *  "name": "Kepler-186f",
     *  "description": "Primeiro planeta confirmado do tamanho da Terra na zona habit√°vel de outra estrela.",
     *  "size_km": 14000,
     *  "is_habitable": true,
     *  "created_at": "2023-10-27T12:00:00.000000Z",
     *  "updated_at": "2023-10-27T12:00:00.000000Z"
     * }
     */
    public function store(Request $request)
    {
        // ...
    }
    // ... e assim por diante para outros m√©todos
}
```

**Tags chave do Scribe:**

- `@group`: Agrupa endpoints.
- `@unauthenticated` / `@authenticated`: Indica se um token √© necess√°rio.
- `@bodyParam`: Descreve um par√¢metro no corpo da requisi√ß√£o.
- `@response`: Exemplo de resposta de sucesso.

**Passo 3: Gera√ß√£o e visualiza√ß√£o da documenta√ß√£o**

Cada vez que fizer altera√ß√µes nos DocBlocks, execute o comando:

```bash
php artisan scribe:generate
```
Scribe criar√° uma p√°gina HTML est√°tica com sua documenta√ß√£o. Abra-a no endere√ßo: **`http://your-app-url/docs`**.



---

#### **Quiz para fixa√ß√£o**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI gera documenta√ß√£o com base no padr√£o:</p>
      <label><input type="radio" name="q1" value="a"> a) GraphQL</label>
      <label><input type="radio" name="q1" value="b"> b) OpenAPI (Swagger)</label>
      <label><input type="radio" name="q1" value="c"> c) WSDL</label>
    </div>
    <div class="question">
      <p>2. Qual URL abre o Swagger UI no FastAPI por padr√£o?</p>
      <label><input type="radio" name="q2" value="a"> a) /api/docs</label>
      <label><input type="radio" name="q2" value="b"> b) /swagger</label>
      <label><input type="radio" name="q2" value="c"> c) /docs</label>
    </div>
    <div class="question">
      <p>3. Pacote popular para gera√ß√£o de documenta√ß√£o no Laravel:</p>
      <label><input type="radio" name="q3" value="a"> a) Telescope</label>
      <label><input type="radio" name="q3" value="b"> b) Scribe</label>
      <label><input type="radio" name="q3" value="c"> c) Horizon</label>
    </div>
    <div class="question">
      <p>4. No Scribe, a tag usada para descrever par√¢metros do corpo da requisi√ß√£o √©:</p>
      <label><input type="radio" name="q4" value="a"> a) @param</label>
      <label><input type="radio" name="q4" value="b"> b) @bodyParam</label>
      <label><input type="radio" name="q4" value="c"> c) @request</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;
```
if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:green;">Correto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:red;">Incorreto.</span> Resposta correta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:orange;">Sem resposta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Seu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Conclus√£o do cap√≠tulo:**

Voc√™ criou documenta√ß√£o profissional, transformando suas APIs de "caixas-pretas" em ferramentas compreens√≠veis e f√°ceis de usar.

- ‚úÖ Entendeu a import√¢ncia cr√≠tica de documentar APIs.
- ü™Ñ Aprendeu a usar a gera√ß√£o autom√°tica de documenta√ß√£o no FastAPI.
- ‚öôÔ∏è Dominou os fundamentos do pacote Scribe para documentar APIs no Laravel.
- üõ∞Ô∏è Confirmou que uma boa documenta√ß√£o √© o melhor auxiliar para qualquer desenvolvedor.

**Suas APIs agora n√£o s√≥ funcionam e est√£o protegidas, mas tamb√©m est√£o totalmente prontas para serem usadas por outros membros da equipe.** Resta o √∫ltimo, mas mais importante passo ‚Äî a verifica√ß√£o de seguran√ßa final.

> **üìå Verifica√ß√£o:**

> - Para FastAPI: abra `/docs` no navegador e tente executar uma requisi√ß√£o `GET` para a lista de planetas diretamente da interface Swagger UI.
> - Para Laravel: execute `php artisan scribe:generate` e abra `/docs`. Certifique-se de que os endpoints est√£o agrupados e que o m√©todo `store` tem uma descri√ß√£o de par√¢metros.