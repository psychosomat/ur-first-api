# **ç¬¬4.4ç« ï¼šé”™è¯¯å¤„ç†**
**å­¦ä¹ æ—¶é—´ï¼š** 45åˆ†é’Ÿ

---

#### **1. é”™è¯¯å¤„ç†ï¼šä»»åŠ¡æ§åˆ¶ä¸­å¿ƒçš„ç´§æ€¥åè®®**
åœ¨å¤ªç©ºä¸­ï¼Œä¸€åˆ‡éƒ½å¯èƒ½ä¸å¦‚é¢„æœŸï¼šå¤ªé˜³è€€æ–‘å¯èƒ½ä¸­æ–­é€šä¿¡ï¼Œé£èˆ¹çš„æœºè½½è®¡ç®—æœºå¯èƒ½å‘ç”Ÿæ•…éšœï¼Œæ¥è‡ªåœ°çƒçš„æŒ‡ä»¤å¯èƒ½åŒ…å«é”™è¯¯çš„åæ ‡ã€‚

**å‰ç«¯é”™è¯¯å¤„ç†**æ˜¯æ‚¨ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒçš„**ç´§æ€¥åè®®**ã€‚å®ƒä»¬åº”è¯¥ï¼š

- ğŸš¨ é¿å…æ•´ä¸ªç•Œé¢å› ä¸€ä¸ªå¤±è´¥çš„å‘½ä»¤è€Œâ€œå´©æºƒâ€ã€‚
- ğŸ“¡ æ¸…æ™°åœ°å‘ŠçŸ¥æ“ä½œå‘˜ï¼ˆç”¨æˆ·ï¼‰å…·ä½“å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚
- ğŸ”§ å»ºè®®å¯èƒ½çš„åç»­æ“ä½œã€‚

> ğŸ’¡ **å¤ªç©ºç±»æ¯”ï¼š**

> å¦‚æœé£èˆ¹å‘å›ä¸€ä¸ª `500 Internal Server Error` ä¿¡å·ï¼Œä»»åŠ¡æ§åˆ¶ä¸­å¿ƒçš„æ˜¾ç¤ºå±ä¸Šä¸åº”è¯¥å‡ºç°â€œJavaScript åœ¨ç¬¬57è¡Œå‘ç”Ÿä¸¥é‡é”™è¯¯â€ã€‚ç›¸åï¼Œåº”è¯¥æ˜¾ç¤ºï¼šâ€œğŸš¨ **é£èˆ¹æœºè½½ç³»ç»Ÿæ•…éšœï¼** å·¥ç¨‹å¸ˆå·²è¢«é€šçŸ¥ã€‚è¯·ç¨åå†è¯•ä¸€æ¬¡å‘½ä»¤ã€‚â€

---

#### **2. â€œå¤ªç©ºå¼‚å¸¸â€ç±»å‹**
åœ¨å‰ç«¯ï¼Œæˆ‘ä»¬å¤„ç†APIæ—¶ä¼šé‡åˆ°ä¸‰ç§ä¸»è¦çš„é”™è¯¯ç±»å‹ï¼š

1.  **ç½‘ç»œé”™è¯¯ï¼š** æœªèƒ½ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚å¤©çº¿ä¸å·¥ä½œï¼Œç”µç¼†è¢«åˆ‡æ–­ã€‚`fetch` å°†â€œè½å…¥â€`.catch()` å—ã€‚
2.  **å®¢æˆ·ç«¯é”™è¯¯ (4xx)ï¼š** æ¥è‡ªåœ°çƒçš„å‘½ä»¤ä¸æ­£ç¡®ã€‚IDé”™è¯¯ï¼ŒéªŒè¯å¤±è´¥ã€‚æœåŠ¡å™¨å“åº”ï¼Œä½†çŠ¶æ€ç ä¸º `4xx`ã€‚
3.  **æœåŠ¡å™¨é”™è¯¯ (5xx)ï¼š** é£èˆ¹æœ¬èº«å‘ç”Ÿæ•…éšœã€‚APIä»£ç å­˜åœ¨é—®é¢˜ã€‚æœåŠ¡å™¨å“åº”ï¼Œä½†çŠ¶æ€ç ä¸º `500+`ã€‚

æˆ‘ä»¬å·²ç»å¼€å§‹ä½¿ç”¨ `try...catch` å’Œ `response.ok` æ£€æŸ¥æ¥å¤„ç†å®ƒä»¬ã€‚ç°åœ¨è®©æˆ‘ä»¬é›†ä¸­å¤„ç†ã€‚

---

#### **3. é›†ä¸­å¼å¤„ç†å‡½æ•°**
åœ¨æ¯ä¸ªå‡½æ•°ä¸­é‡å¤ç›¸åŒçš„ `try...catch` ä»£ç æ˜¯ä¸€ç§ä¸å¥½çš„åšæ³•ã€‚è®©æˆ‘ä»¬ä¸º `fetch` è¯·æ±‚åˆ›å»ºä¸€ä¸ªé€šç”¨çš„â€œåŒ…è£…å™¨â€ã€‚

**æ­¥éª¤1ï¼šåˆ›å»º `api.js`**
åœ¨ `app.js` æ—è¾¹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `api.js`ã€‚æˆ‘ä»¬å°†æŠŠæ‰€æœ‰ä¸APIäº¤äº’çš„é€»è¾‘ç§»åˆ°è¿™é‡Œã€‚
```javascript
// api.js

const API_BASE_URL = 'http://127.0.0.1:8000';

/**
 * ç”¨äºæ‰§è¡ŒAPIè¯·æ±‚çš„é€šç”¨å‡½æ•°ã€‚
 * å¤„ç†é”™è¯¯å¹¶è¿”å›JSONã€‚
 * @param {string} endpoint - APIç«¯ç‚¹ï¼Œä¾‹å¦‚ '/spaceships'
 * @param {object} options - fetchçš„å‚æ•° (method, headers, body)
 */
async function apiRequest(endpoint, options = {}) {
    const url = `${API_BASE_URL}${endpoint}`;

    try {
        const response = await fetch(url, options);

        // å¦‚æœå“åº”æ ¹æœ¬ä¸æ˜¯JSONï¼Œåˆ™ç«‹å³æŠ›å‡ºé”™è¯¯
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            // å¯¹äºæ²¡æœ‰å“åº”ä½“çš„æˆåŠŸDELETEè¯·æ±‚çš„ç‰¹æ®Šå¤„ç†
            if (response.status === 204) return null;

            throw new TypeError(`ä»æœåŠ¡å™¨æ”¶åˆ°éJSONå“åº”ï¼š${response.statusText}`);
        }

        const data = await response.json();

        if (!response.ok) {
            // å¦‚æœæœåŠ¡å™¨è¿”å›äº†åŒ…å«é”™è¯¯çš„JSONï¼ˆä¾‹å¦‚ï¼ŒFastAPIçš„detailå­—æ®µï¼‰
            const errorMessage = data.detail || `HTTPé”™è¯¯ï¼çŠ¶æ€ï¼š${response.status}`;
            throw new Error(errorMessage);
        }

        return data;

    } catch (error) {
        console.error(`APIè¯·æ±‚åˆ° ${endpoint} å¤±è´¥ï¼š`, error);
        // å°†é”™è¯¯â€œé‡æ–°æŠ›å‡ºâ€ï¼Œä»¥ä¾¿UIå¯ä»¥æ•è·å®ƒ
        throw error;
    }
}
```

**æ­¥éª¤2ï¼šåœ¨ `index.html` ä¸­å¼•å…¥ `api.js`**
é‡è¦çš„æ˜¯è¦åœ¨ `app.js` **ä¹‹å‰**å¼•å…¥å®ƒï¼Œå› ä¸º `app.js` å°†ä½¿ç”¨å…¶å‡½æ•°ã€‚
```html
<!-- index.html -->
<body>
    <!-- ... -->
    <script src="api.js"></script>
    <script src="app.js"></script>
</body>
```

**æ­¥éª¤3ï¼šé‡æ„ `app.js`**
ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ–°çš„ `apiRequest` é‡å†™æˆ‘ä»¬çš„å‡½æ•°ã€‚
```javascript
// app.js

// const API_BASE_URL = ...; // è¿™è¡Œå¯ä»¥åˆ é™¤ï¼Œå®ƒç°åœ¨åœ¨ api.js ä¸­

// ...

async function fetchAndDisplayFleet() {
    try {
        fleetList.innerHTML = '<li>æ­£åœ¨åŠ è½½é¥æµ‹æ•°æ®...</li>';
        const ships = await apiRequest('/spaceships'); // <-- ä½¿ç”¨æˆ‘ä»¬çš„åŒ…è£…å™¨ï¼

        fleetList.innerHTML = '';
        if (ships.length === 0) {
            fleetList.innerHTML = '<li>æ³¨å†Œè¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°ä»»ä½•è®¾å¤‡ã€‚</li>';
            return;
        }

        ships.forEach(ship => { /* ... å…¶ä»–æ˜¾ç¤ºä»£ç  ... */ });
    } catch (error) {
        fleetList.innerHTML = `<li>ğŸ”´ èˆ°é˜ŸåŠ è½½é”™è¯¯ï¼š${error.message}</li>`;
    }
}

async function createShip(event) {
    event.preventDefault();
    const shipData = { /* ... ä»è¡¨å•æ”¶é›†æ•°æ® ... */ };

    try {
        createStatusMessage.textContent = 'æ­£åœ¨å‘é€å¯åŠ¨å‘½ä»¤...';
        const options = {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(shipData)
        };
        const newShip = await apiRequest('/spaceships', options); // <-- ä½¿ç”¨æˆ‘ä»¬çš„åŒ…è£…å™¨ï¼

        createStatusMessage.textContent = `ğŸš€ å¯åŠ¨æˆåŠŸï¼è®¾å¤‡IDï¼š${newShip.id}`;
        createShipForm.reset();
        fetchAndDisplayFleet();
    } catch (error) {
        createStatusMessage.textContent = `ğŸ”´ é”™è¯¯ï¼š${error.message}`;
    }
}

// å‚ç…§æ­¤ä¾‹é‡å†™å…¶ä»–å‡½æ•° (fetchShipById, deleteShip)ï¼
```
ç°åœ¨ï¼Œæ‰€æœ‰ç½‘ç»œé”™è¯¯å¤„ç†ã€`response.ok` æ£€æŸ¥å’ŒJSONè§£æçš„é€»è¾‘éƒ½é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œ`app.js` ä¸­çš„ä»£ç å˜å¾—æ›´åŠ ç®€æ´å’Œå¯è¯»ã€‚

---

#### **4. å‘ç”¨æˆ·æ˜¾ç¤ºé”™è¯¯**
ä¸€ä¸ªå¥½çš„ç•Œé¢ä¸åº”è¯¥ä»…ä»…å°†é”™è¯¯å†™å…¥æ§åˆ¶å°ï¼Œè€Œåº”è¯¥ä»¥ç”¨æˆ·å¯ç†è§£çš„æ–¹å¼æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚

**ç¤ºä¾‹ï¼šæ”¹è¿› `createShip`**
æˆ‘ä»¬çš„ä»£ç å·²ç»åšåˆ°äº†è¿™ä¸€ç‚¹ï¼š`createStatusMessage.textContent = ...`ã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªé€šç”¨çš„é€šçŸ¥æ˜¾ç¤ºå‡½æ•°åšå¾—æ›´å¥½ã€‚

**æ·»åŠ åˆ° `app.js`ï¼š**
```javascript
// app.js
function showNotification(message, isError = false) {
    const notificationArea = document.getElementById('create-status-message'); // æˆ–å…¶ä»–å…ƒç´ 
    notificationArea.textContent = message;
    notificationArea.style.color = isError ? 'red' : 'green';
}

// åœ¨ createShip ä¸­ä½¿ç”¨ï¼š
async function createShip(event) {
    // ...
    try {
        // ...
        const newShip = await apiRequest('/spaceships', options);
        showNotification(`ğŸš€ å¯åŠ¨æˆåŠŸï¼IDï¼š${newShip.id}`);
        // ...
    } catch (error) {
        showNotification(`ğŸ”´ é”™è¯¯ï¼š${error.message}`, true);
    }
}
```
ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„æœºåˆ¶æ¥æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å’Œé”™è¯¯ã€‚

---

#### **å·©å›ºæµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. `fetch` Promise ä¸­çš„ `.catch()` å—ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è§¦å‘...</p>
      <label><input type="radio" name="q1" value="a"> a) æœåŠ¡å™¨è¿”å›äº† 404 Not Found é”™è¯¯</label>
      <label><input type="radio" name="q1" value="b"> b) å‘ç”Ÿç½‘ç»œé”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œæ²¡æœ‰äº’è”ç½‘è¿æ¥ï¼‰</label>
      <label><input type="radio" name="q1" value="c"> c) æœåŠ¡å™¨è¿”å›äº† 500 Internal Server Error é”™è¯¯</label>
    </div>
    <div class="question">
      <p>2. ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªé›†ä¸­å¼å‡½æ•°æ¥å¤„ç†APIè¯·æ±‚ï¼Ÿ</p>
      <label><input type="radio" name="q2" value="a"> a) ä¸ºäº†é¿å…é‡å¤çš„é”™è¯¯å¤„ç†ä»£ç å¹¶ä½¿UIé€»è¾‘æ›´æ¸…æ™°</label>
      <label><input type="radio" name="q2" value="b"> b) ä¸ºäº†åŒæ—¶å‘é€æ‰€æœ‰è¯·æ±‚</label>
      <label><input type="radio" name="q2" value="c"> c) è¿™æ˜¯Fetch APIæ ‡å‡†çš„è¦æ±‚</label>
    </div>
    <div class="question">
      <p>3. `response.headers.get('content-type')` ç”¨äº...</p>
      <label><input type="radio" name="q3" value="a"> a) åœ¨ä¼ å‡ºè¯·æ±‚ä¸­è®¾ç½®æ ‡å¤´</label>
      <label><input type="radio" name="q3" value="b"> b) æ£€æŸ¥ä»æœåŠ¡å™¨æ”¶åˆ°çš„å“åº”ä¸­çš„å†…å®¹ç±»å‹</label>
      <label><input type="radio" name="q3" value="c"> c) è·å–æ‰€æœ‰å¯ç”¨çš„å†…å®¹ç±»å‹</label>
    </div>
    <div class="question">
      <p>4. `try...catch` æˆ– `.then()` å†…éƒ¨çš„ `throw new Error(...)` ç”¨äº...</p>
      <label><input type="radio" name="q4" value="a"> a) åœæ­¢é¡µé¢ä¸Šæ‰€æœ‰JavaScriptçš„æ‰§è¡Œ</label>
      <label><input type="radio" name="q4" value="b"> b) â€œæ‹’ç»â€Promise å¹¶å°†æ§åˆ¶æƒä¼ é€’ç»™æœ€è¿‘çš„ `.catch()` å—</label>
      <label><input type="radio" name="q4" value="c"> c) åœ¨ `alert` ä¸­æ˜¾ç¤ºæ¶ˆæ¯</label>
    </div>
    <div class="question">
      <p>5. ä¸ºä»€ä¹ˆå°†é”™è¯¯æ˜¾ç¤ºç»™ç”¨æˆ·è€Œä¸ä»…ä»…æ˜¯æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­å¾ˆé‡è¦ï¼Ÿ</p>
      <label><input type="radio" name="q5" value="a"> a) å› ä¸ºå¤§å¤šæ•°ç”¨æˆ·ä¸æŸ¥çœ‹æ§åˆ¶å°</label>
      <label><input type="radio" name="q5" value="b"> b) ä¸ºäº†ä½¿ç•Œé¢æ˜“äºç†è§£å’Œå¯é¢„æµ‹</label>
      <label><input type="radio" name="q5" value="c"> c) ä»¥ä¸Šä¸¤ä¸ªé€‰é¡¹éƒ½æ­£ç¡®</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'a', q3: 'b', q4: 'b', q5: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

æ‚¨é€šè¿‡åˆ›å»ºå¯é çš„ç´§æ€¥åè®®ï¼ŒåŠ å¼ºäº†æ‚¨çš„ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒã€‚

- ğŸ›¡ï¸ æ‚¨äº†è§£ç½‘ç»œé”™è¯¯ã€å®¢æˆ·ç«¯é”™è¯¯å’ŒæœåŠ¡å™¨é”™è¯¯ä¹‹é—´çš„åŒºåˆ«ã€‚
- âš™ï¸ æ‚¨åˆ›å»ºäº†ä¸€ä¸ªé›†ä¸­å¼å‡½æ•° `apiRequest` æ¥å¤„ç†æ‰€æœ‰è¯·æ±‚ï¼Œé¿å…äº†ä»£ç é‡å¤ã€‚
- ğŸ“¡ æ‚¨çš„ç•Œé¢ç°åœ¨èƒ½å¤Ÿæ­£ç¡®åœ°å‘ç”¨æˆ·æŠ¥å‘Šé”™è¯¯ï¼Œä½¿å…¶æ›´åŠ ç”¨æˆ·å‹å¥½å’Œå¯é ã€‚
**ç´§æ€¥æŠ¤ç›¾å·²å‡èµ·ï¼** ä½†æ˜¯å“ªä¸ªæ›´å¥½ï¼š`.then()` é“¾è¿˜æ˜¯ç°ä»£çš„ `async/await`ï¼Ÿåœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†æè¿™ä¸¤ç§æ–¹æ³•ï¼Œå¹¶äº†è§£ä½•æ—¶ä½¿ç”¨å“ªç§ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> - æ£€æŸ¥æ‚¨çš„ `app.js` ä¸­çš„ä»£ç æ˜¯å¦å·²æˆåŠŸé‡æ„å¹¶ä½¿ç”¨äº†æ–°çš„ `apiRequest` å‡½æ•°ã€‚
> - å°è¯•åœæ­¢ FastAPI æœåŠ¡å™¨å¹¶ç‚¹å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ã€‚æ‚¨åº”è¯¥ä¼šåœ¨é¡µé¢ä¸Šçœ‹åˆ°è¿æ¥é”™è¯¯ã€‚
> - å°è¯•ä½¿ç”¨æ— æ•ˆæ•°æ®åˆ›å»ºä¸€è‰˜é£èˆ¹ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ¥è‡ª FastAPI çš„éªŒè¯é”™è¯¯æ¶ˆæ¯ã€‚

> **âš ï¸ å¦‚æœå‡ºç°é”™è¯¯ï¼š**

> - `apiRequest is not defined`ï¼šè¯·ç¡®ä¿æ‚¨åœ¨ `index.html` ä¸­å¼•å…¥ `api.js` **åœ¨** `app.js` **ä¹‹å‰**ã€‚
> - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦å­˜åœ¨å…¶ä»– JavaScript è¯­æ³•é”™è¯¯ã€‚