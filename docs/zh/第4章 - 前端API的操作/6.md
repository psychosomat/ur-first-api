# **ç¬¬ 4.6 ç« ï¼šåˆ›å»ºç®€å•çš„ API æ¥å£**
**å­¦ä¹ æ—¶é—´ï¼š** 1 å°æ—¶ 15 åˆ†é’Ÿ

---

#### **1. æœ€ç»ˆç»„è£…ï¼šâ€œé£è¡Œæ§åˆ¶ä¸­å¿ƒâ€å¯åŠ¨**
æˆ‘ä»¬å·²ç»å•ç‹¬ç ”ç©¶äº†æ‰€æœ‰ç³»ç»Ÿï¼šè®¾ç½®äº†â€œå¤©çº¿â€ï¼ˆ`Fetch`ï¼‰ï¼Œå­¦ä¼šäº†å‘é€â€œå‘½ä»¤â€ï¼ˆ`GET`ã€`POST`ã€`DELETE`ï¼‰ï¼Œå¹¶å¼€å‘äº†â€œç´§æ€¥åè®®â€ï¼ˆé”™è¯¯å¤„ç†ï¼‰ã€‚

ç°åœ¨æ˜¯æ—¶å€™**å°†æ‰€æœ‰ç»„ä»¶æ•´åˆåœ¨ä¸€èµ·**å¹¶å¯åŠ¨æˆ‘ä»¬çš„é£æ§ä¸­å¿ƒâ€”â€”ä¸€ä¸ªåŠŸèƒ½é½å…¨ã€äº¤äº’å¼çš„å®‡å®™é£èˆ¹é˜Ÿç®¡ç†ç•Œé¢ã€‚

**æˆ‘ä»¬çš„ç›®æ ‡ï¼š**

- åˆ›å»ºä¸€ä¸ªç»Ÿä¸€ã€æ•´æ´ã€æ˜“äºç†è§£çš„ç•Œé¢ã€‚
- å®ç°å®Œæ•´çš„ CRUD å‘¨æœŸï¼šåˆ›å»ºã€æ˜¾ç¤ºã€æ›´æ–°å’Œåˆ é™¤é£èˆ¹ã€‚
- ä¸ºç”¨æˆ·æ·»åŠ è§†è§‰åé¦ˆï¼ˆåŠ è½½ä¸­ã€æˆåŠŸã€é”™è¯¯ï¼‰ã€‚

> ğŸ’¡ **å¤ªç©ºç±»æ¯”ï¼š**

> æˆ‘ä»¬å°†ä»ç‹¬ç«‹çš„æµ‹è¯•æ§åˆ¶å°è½¬å‘**é£æ§ä¸­å¿ƒçš„ä¸»å±å¹•**ã€‚ä¸»å±å¹•ä¸Šåº”æœ‰æ‰€æœ‰å¿…è¦çš„æŒ‰é’®å’ŒæŒ‡ç¤ºå™¨ï¼Œä»¥ä¾¿ä¸€åæ“ä½œå‘˜æ— éœ€åœ¨æ•°åä¸ªä¸åŒç³»ç»Ÿä¹‹é—´åˆ‡æ¢å³å¯ç®¡ç†æ•´ä¸ªèˆ°é˜Ÿã€‚

---

#### **2. ç•Œé¢è®¾è®¡ï¼šâ€œä»ªè¡¨ç›˜â€**
æˆ‘ä»¬éœ€è¦æ›´ç»“æ„åŒ–çš„ HTMLã€‚æˆ‘ä»¬å°†ä½¿ç”¨â€œå¡ç‰‡â€æ¥æ˜¾ç¤ºé£èˆ¹ï¼Œå¹¶ä½¿ç”¨æ¨¡æ€çª—å£è¿›è¡Œç¼–è¾‘ã€‚

**æ›´æ–° `index.html`ï¼š**
```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Ğ¦Ğ£ĞŸ v2.0 - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¤Ğ»Ğ¾Ñ‚Ğ¾Ğ¼</title>
    <link rel="stylesheet" href="style.css"> <!-- å¼•å…¥æ ·å¼ -->
</head>
<body>
    <header>
        <h1>å®‡å®™é£èˆ¹é˜Ÿæ§åˆ¶é¢æ¿</h1>
    </header>

    <main>
        <section id="fleet-controls">
            <button id="load-fleet-btn">åˆ·æ–°èˆ°é˜Ÿåˆ—è¡¨</button>
            <button id="show-create-form-btn">å‘å°„æ–°é£è¡Œå™¨</button>
        </section>

        <section id="fleet-display">
            <h2>å½“å‰èˆ°é˜Ÿç»„æˆ</h2>
            <div id="fleet-list" class="cards-container">
                <!-- é£èˆ¹å¡ç‰‡å°†åœ¨æ­¤å¤„ -->
            </div>
        </section>
    </main>

    <!-- ç”¨äºåˆ›å»º/ç¼–è¾‘çš„æ¨¡æ€çª—å£ï¼ˆæœ€åˆéšè—ï¼‰ -->
    <div id="modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="modal-title">å‘å°„æ–°é£è¡Œå™¨</h2>
            <form id="ship-form">
                <input type="hidden" id="ship-id">
                <input type="text" id="ship-name" placeholder="åç§°" required>
                <input type="text" id="ship-type" placeholder="ç±»å‹" required>
                <input type="number" id="ship-year" placeholder="å‘å°„å¹´ä»½" required>
                <input type="text" id="ship-status" placeholder="çŠ¶æ€" required>
                <div class="modal-actions">
                    <button type="submit" id="save-btn">ä¿å­˜</button>
                    <button type="button" id="cancel-btn">å–æ¶ˆ</button>
                </div>
            </form>
            <div id="notification-area"></div>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="app.js"></script>
</body>
</html>
```

---

#### **3. æ·»åŠ â€œå¤ªç©ºâ€è®¾è®¡ï¼š`style.css`**
åˆ›å»º `style.css` æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬çš„é£æ§ä¸­å¿ƒçœ‹èµ·æ¥æ›´ä½“é¢ã€‚
```css
/* style.css */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1a1a2e;
    color: #e0e0e0;
    margin: 0;
    padding: 20px;
}
header { text-align: center; margin-bottom: 20px; }
button {
    background-color: #4a4e69;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}
button:hover { background-color: #6a6e94; }
.cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}
.card {
    background-color: #2a2a4e;
    border: 1px solid #4a4e69;
    border-radius: 8px;
    padding: 15px;
}
.card h3 { margin-top: 0; color: #9394a5; }
.card-actions { margin-top: 15px; }

/* Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºĞ½Ğ° */
.modal-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: #1a1a2e;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #4a4e69;
    width: 90%;
    max-width: 500px;
}
#ship-form input {
    width: calc(100% - 20px);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #4a4e69;
    background-color: #2a2a4e;
    color: white;
}
.modal-actions { text-align: right; }
```

---

#### **4. é€»è¾‘çš„å®Œæ•´é‡æ„ï¼š`app.js`**
ç°åœ¨æˆ‘ä»¬å°†ç¼–å†™ `app.js` çš„æœ€ç»ˆç‰ˆæœ¬ï¼Œæ•´åˆæˆ‘ä»¬æ‰€æœ‰çš„çŸ¥è¯†ã€‚

```javascript
// app.js

// --- DOM å…ƒç´  ---
const loadFleetBtn = document.getElementById('load-fleet-btn');
const fleetListContainer = document.getElementById('fleet-list');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modal-title');
const shipForm = document.getElementById('ship-form');
const saveBtn = document.getElementById('save-btn');
const cancelBtn = document.getElementById('cancel-btn');
const showCreateFormBtn = document.getElementById('show-create-form-btn');
const notificationArea = document.getElementById('notification-area');

// --- UI åŠŸèƒ½ ---

function showNotification(message, isError = false) {
    notificationArea.textContent = message;
    notificationArea.style.color = isError ? '#ff6b6b' : '#6bff6b';
}

function openModalForCreate() {
    shipForm.reset();
    document.getElementById('ship-id').value = '';
    modalTitle.textContent = 'å‘å°„æ–°é£è¡Œå™¨';
    modal.style.display = 'flex';
}

function openModalForEdit(ship) {
    shipForm.reset();
    document.getElementById('ship-id').value = ship.id;
    document.getElementById('ship-name').value = ship.name;
    document.getElementById('ship-type').value = ship.type;
    document.getElementById('ship-year').value = ship.launch_year;
    document.getElementById('ship-status').value = ship.status;
    modalTitle.textContent = `ç¼–è¾‘ï¼š${ship.name}`;
    modal.style.display = 'flex';
}

function closeModal() {
    modal.style.display = 'none';
    notificationArea.textContent = '';
}

function createShipCard(ship) {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
        <h3>${ship.name} (IDï¼š${ship.id})</h3>
        <p>ç±»å‹ï¼š${ship.type}</p>
        <p>å‘å°„å¹´ä»½ï¼š${ship.launch_year}</p>
        <p>çŠ¶æ€ï¼š${ship.status}</p>
        <div class="card-actions">
            <button class="edit-btn" data-ship-id="${ship.id}">ä¿®æ”¹</button>
            <button class="delete-btn" data-ship-id="${ship.id}">æŠ¥åºŸ</button>
        </div>
    `;
    return card;
}

// --- API å’Œæ˜¾ç¤ºé€»è¾‘ ---

async function fetchAndDisplayFleet() {
    try {
        fleetListContainer.innerHTML = '<p>æ­£åœ¨åŠ è½½é¥æµ‹æ•°æ®...</p>';
        const ships = await apiRequest('/spaceships');

        fleetListContainer.innerHTML = '';
        if (ships.length === 0) {
            fleetListContainer.innerHTML = '<p>æ³¨å†Œè¡¨ä¸­æ²¡æœ‰é£è¡Œå™¨ã€‚</p>';
            return;
        }
        ships.forEach(ship => {
            const card = createShipCard(ship);
            fleetListContainer.appendChild(card);
        });
    } catch (error) {
        fleetListContainer.innerHTML = `<p style="color: #ff6b6b;">èˆ°é˜ŸåŠ è½½é”™è¯¯ï¼š${error.message}</p>`;
    }
}

async function handleSaveShip(event) {
    event.preventDefault();
    const shipId = document.getElementById('ship-id').value;
    const shipData = {
        name: document.getElementById('ship-name').value,
        type: document.getElementById('ship-type').value,
        launch_year: parseInt(document.getElementById('ship-year').value),
        status: document.getElementById('ship-status').value
    };

    try {
        let response;
        if (shipId) {
            // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ (PUT)
            response = await apiRequest(`/spaceships/${shipId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(shipData)
            });
            showNotification(`é£è¡Œå™¨â€œ${response.name}â€æ›´æ–°æˆåŠŸï¼`);
        } else {
            // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ (POST)
            response = await apiRequest('/spaceships', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(shipData)
            });
            showNotification(`é£è¡Œå™¨â€œ${response.name}â€å‘å°„æˆåŠŸï¼IDï¼š${response.id}`);
        }

        setTimeout(() => {
            closeModal();
            fetchAndDisplayFleet();
        }, 1500);

    } catch (error) {
        showNotification(error.message, true);
    }
}

async function handleDeleteShip(shipId) {
    if (!confirm(`æ‚¨ç¡®å®šè¦æŠ¥åºŸ ID ä¸º ${shipId} çš„é£è¡Œå™¨å—ï¼Ÿ`)) return;

    try {
        await apiRequest(`/spaceships/${shipId}`, { method: 'DELETE' });
        alert('é£è¡Œå™¨æŠ¥åºŸæˆåŠŸã€‚');
        fetchAndDisplayFleet();
    } catch (error) {
        alert(`æŠ¥åºŸé”™è¯¯ï¼š${error.message}`);
    }
}

// --- äº‹ä»¶å¤„ç†ç¨‹åº ---

document.addEventListener('DOMContentLoaded', fetchAndDisplayFleet);
loadFleetBtn.addEventListener('click', fetchAndDisplayFleet);
showCreateFormBtn.addEventListener('click', openModalForCreate);
cancelBtn.addEventListener('click', closeModal);
shipForm.addEventListener('submit', handleSaveShip);

fleetListContainer.addEventListener('click', async (event) => {
    const target = event.target;
    if (target.classList.contains('delete-btn')) {
        handleDeleteShip(target.dataset.shipId);
    }
    if (target.classList.contains('edit-btn')) {
        try {
            const ship = await apiRequest(`/spaceships/${target.dataset.shipId}`);
            openModalForEdit(ship);
        } catch (error) {
            alert(`æ— æ³•åŠ è½½ç¼–è¾‘æ•°æ®ï¼š${error.message}`);
        }
    }
});
```

---

#### **5. æœ€ç»ˆæµ‹è¯•**

1.  **å¯åŠ¨ FastAPI æœåŠ¡å™¨ï¼š** `uvicorn main:app --reload`
2.  **åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `index.html`** (é€šè¿‡ Live Server)ã€‚
3.  **æ£€æŸ¥å®Œæ•´å‘¨æœŸï¼š**
    - é£èˆ¹åˆ—è¡¨åº”è‡ªåŠ¨åŠ è½½ã€‚
    - ç‚¹å‡»â€œå‘å°„æ–°é£è¡Œå™¨â€ï¼Œå¡«å†™è¡¨å•å¹¶ä¿å­˜ã€‚ç¡®è®¤æ–°é£èˆ¹å‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚
    - åœ¨ä»»æ„é£èˆ¹ä¸Šç‚¹å‡»â€œä¿®æ”¹â€ï¼Œæ›´æ”¹æ•°æ®å¹¶ä¿å­˜ã€‚ç¡®è®¤ä¿¡æ¯å·²æ›´æ–°ã€‚
    - åœ¨ä»»æ„é£èˆ¹ä¸Šç‚¹å‡»â€œæŠ¥åºŸâ€ï¼Œç¡®è®¤æ“ä½œã€‚ç¡®è®¤å®ƒä»åˆ—è¡¨ä¸­æ¶ˆå¤±ã€‚
    - æ£€æŸ¥æ‰€æœ‰é”™è¯¯åœºæ™¯ï¼ˆæ•°æ®ä¸æ­£ç¡®ï¼ŒæœåŠ¡å™¨åœæ­¢ï¼‰ã€‚

---

#### **å·©å›ºç»ƒä¹ å°æµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>
<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Web ç•Œé¢ä¸­çš„æ¨¡æ€çª—å£æ˜¯...</p>
      <label><input type="radio" name="q1" value="a"> a) HTML6 ä¸­çš„æ–°æ ‡ç­¾</label>
      <label><input type="radio" name="q1" value="b"> b) å¼¹å‡ºå¼å¯¹è¯æ¡†ï¼Œå®ƒä¼šé˜»å¡ç•Œé¢çš„å…¶ä»–éƒ¨åˆ†</label>
      <label><input type="radio" name="q1" value="c"> c) ç”¨äºæ˜¾ç¤ºæ§åˆ¶å°é”™è¯¯ä¿¡æ¯çš„çª—å£</label>
    </div>
    <div class="question">
      <p>2. `DOMContentLoaded` äº‹ä»¶åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘ç”Ÿ...</p>
      <label><input type="radio" name="q2" value="a"> a) æ‰€æœ‰å›¾ç‰‡å’Œæ ·å¼éƒ½å·²å®Œå…¨åŠ è½½</label>
      <label><input type="radio" name="q2" value="b"> b) æµè§ˆå™¨å·²ä» HTML æ„å»ºäº† DOM æ ‘ï¼Œä½†èµ„æºå¯èƒ½ä»åœ¨åŠ è½½ä¸­</label>
      <label><input type="radio" name="q2" value="c"> c) é¡µé¢åŠ è½½å‘ç”Ÿé”™è¯¯</label>
    </div>
    <div class="question">
      <p>3. ä¸ºä»€ä¹ˆåœ¨æœ€ç»ˆç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºå’Œç¼–è¾‘éƒ½ä½¿ç”¨åŒä¸€ä¸ªè¡¨å•ï¼Ÿ</p>
      <label><input type="radio" name="q3" value="a"> a) ä¸ºäº†é¿å… HTML ä»£ç é‡å¤å¹¶ç®€åŒ–é€»è¾‘</label>
      <label><input type="radio" name="q3" value="b"> b) å› ä¸ºæµè§ˆå™¨ä¸å…è®¸é¡µé¢ä¸Šæœ‰å¤šä¸ªè¡¨å•</label>
      <label><input type="radio" name="q3" value="c"> c) è¿™æ˜¯ FastAPI çš„è¦æ±‚</label>
    </div>
    <div class="question">
      <p>4. `data-ship-id="${ship.id}"` æ˜¯ä¸€ä¸ª...çš„ä¾‹å­</p>
      <label><input type="radio" name="q4" value="a"> a) CSS ç±»</label>
      <label><input type="radio" name="q4" value="b"> b) JavaScript å˜é‡</label>
      <label><input type="radio" name="q4" value="c"> c) ç”¨äºåœ¨ HTML ä¸­å­˜å‚¨æ•°æ®çš„è‡ªå®šä¹‰ data å±æ€§</label>
    </div>
    <div class="question">
      <p>5. ä»£ç é‡æ„ï¼ˆä¾‹å¦‚ï¼Œå°†é€»è¾‘ç§»è‡³ `api.js`ï¼‰æ˜¯ä¸ºäº†...</p>
      <label><input type="radio" name="q5" value="a"> a) ä½¿ä»£ç å¤æ‚åŒ–ä»¥é˜²æ­¢å¤åˆ¶</label>
      <label><input type="radio" name="q5" value="b"> b) æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§</label>
      <label><input type="radio" name="q5" value="c"> c) å‡å°æœ€ç»ˆæ–‡ä»¶çš„å¤§å°</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'a', q4: 'c', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœ:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆ: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„åˆ†æ•°: ${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ æœ¬ç« æ€»ç»“**

æ‚¨å·²æˆåŠŸæ„å»ºå¹¶å¯åŠ¨æ‚¨çš„â€œé£è¡Œæ§åˆ¶ä¸­å¿ƒâ€ã€‚

- ğŸ–¥ï¸ æ‚¨åˆ›å»ºäº†ä¸€ä¸ªç»“æ„åŒ–ä¸”æ ·å¼åŒ–çš„ HTML/CSS ç•Œé¢ã€‚
- âš™ï¸ æ‚¨ç¼–å†™äº†æ¸…æ™°ã€æ¨¡å—åŒ–çš„ JavaScript ä»£ç ï¼Œå®ç°äº†å®Œæ•´çš„ CRUD å¾ªç¯ã€‚
- ğŸ›°ï¸ æ‚¨çš„å‰ç«¯ç°åœ¨å¯ä»¥å®Œå…¨ç®¡ç†ä½¿ç”¨ FastAPI æ„å»ºçš„åç«¯ã€‚

**æ­å–œæ‚¨æˆåŠŸå®Œæˆç¬¬ 4 ç« ï¼** æ‚¨å·²å®Œæˆäº†ä»å‘é€ç®€å• `fetch` è¯·æ±‚åˆ°åˆ›å»ºä¸æ‚¨è‡ªå·±çš„ API äº¤äº’çš„å®Œæ•´ Web åº”ç”¨ç¨‹åºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚