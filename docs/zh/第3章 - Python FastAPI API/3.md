# **ç¬¬ 3.3 ç« ï¼šä½¿ç”¨ Pydantic çš„æ•°æ®æ¨¡å‹**
**å­¦ä¹ æ—¶é—´ï¼š** 50 åˆ†é’Ÿ

---

#### **1. Pydanticï¼šâ€œå®‡å®™é£èˆ¹çš„æ•°å­—è“å›¾â€**
æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å»ºé€ ä¸€è‰˜å®‡å®™é£èˆ¹ã€‚ä½ ä¸èƒ½éšæ„ç„Šæ¥é‡‘å±ç¢ç‰‡ã€‚ä½ éœ€è¦ä¸€ä»½**è¯¦ç»†çš„è“å›¾**ï¼Œå®ƒå®šä¹‰ï¼š

- é£èˆ¹åç§° (ç±»å‹: `å­—ç¬¦ä¸²`, æœ€å¤§é•¿åº¦: 50 å­—ç¬¦)
- å‘å°„å¹´ä»½ (ç±»å‹: `æ•´æ•°`)
- æ˜¯å¦æœ‰è¶…å…‰é€Ÿå¼•æ“ (ç±»å‹: `æ˜¯/å¦`)

**Pydantic** æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒå…è®¸ä½ ä¸º Python ä¸­çš„æ•°æ®åˆ›å»ºè¿™æ ·çš„â€œæ•°å­—è“å›¾â€ã€‚åœ¨ FastAPI ä¸­ï¼Œå®ƒæ‰§è¡Œä¸‰ä¸ªå…³é”®åŠŸèƒ½ï¼š

1.  **ç»“æ„å£°æ˜ï¼š** æ¸…æ¥šåœ°æè¿°ä½ çš„æ•°æ®ç”±å“ªäº›å­—æ®µç»„æˆã€‚
2.  **æ•°æ®éªŒè¯ï¼š** è‡ªåŠ¨æ£€æŸ¥ä¼ å…¥æ•°æ®æ˜¯å¦ç¬¦åˆè“å›¾ã€‚
3.  **æ–‡æ¡£ï¼š** FastAPI ä½¿ç”¨è¿™äº›è“å›¾æ¥ç”Ÿæˆè¯¦ç»†ä¸”äº¤äº’å¼çš„æ–‡æ¡£ã€‚

> ğŸ’¡ **å®‡å®™ç±»æ¯”ï¼š**
> Pydantic æ¨¡å‹æ˜¯å¯¹è±¡çš„**æŠ€æœ¯æŠ¤ç…§**ã€‚ä»»ä½•æŠµè¾¾ç©ºé—´ç«™çš„â€œè´§ç‰©â€ï¼ˆæ•°æ®ï¼‰éƒ½å¿…é¡»ç¬¦åˆæŠ¤ç…§ä¸­çš„è§„èŒƒã€‚å¦‚æœä¸ç¬¦åˆâ€”â€”æœºè½½è®¡ç®—æœº (Pydantic) å°†æ‹’ç»å®ƒã€‚

---

#### **2. åˆ›å»ºç¬¬ä¸€ä¸ªè“å›¾ï¼š`Spaceship` æ¨¡å‹**
è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ¥æè¿°æˆ‘ä»¬çš„å®‡å®™é£èˆ¹ã€‚

**æ­¥éª¤ 1ï¼šä» Pydantic å¯¼å…¥ `BaseModel`**
Pydantic å·²ç»éš `fastapi[all]` ä¸€èµ·å®‰è£…ã€‚æˆ‘ä»¬åªéœ€è¦ä¸ºæˆ‘ä»¬çš„æ¨¡å‹å¯¼å…¥åŸºç±»ã€‚

**åœ¨ `main.py` æ–‡ä»¶é¡¶éƒ¨ï¼Œä¸å…¶ä»–å¯¼å…¥ä¸€èµ·æ·»åŠ ï¼š**
```python
# main.py
from fastapi import FastAPI
from pydantic import BaseModel
```

**æ­¥éª¤ 2ï¼šæè¿° `Spaceship` æ¨¡å‹**
åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `BaseModel` çš„ç±»ã€‚åœ¨ç±»å†…éƒ¨ï¼Œä½¿ç”¨æ ‡å‡†çš„ Python ç±»å‹æç¤ºå®šä¹‰å­—æ®µåŠå…¶ç±»å‹ã€‚

**å°†æ­¤ä»£ç æ·»åŠ åˆ° `main.py` (å¯ä»¥åœ¨å¯¼å…¥ä¹‹å):**
```python
class Spaceship(BaseModel):
    """
    å®‡å®™é£èˆ¹çš„æŠ€æœ¯æŠ¤ç…§ï¼ˆæ¨¡å‹ï¼‰ã€‚
    """
    name: str
    type: str
    launch_year: int
    status: str
```
å°±æ˜¯è¿™æ ·ï¼ä½ åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ªâ€œè“å›¾â€ã€‚Pydantic ç°åœ¨çŸ¥é“ï¼Œä»»ä½• `Spaceship` ç±»å‹çš„å¯¹è±¡éƒ½å¿…é¡»æœ‰å››ä¸ªæŒ‡å®šç±»å‹çš„å­—æ®µã€‚

---

#### **3. åº”ç”¨æ¨¡å‹ï¼šæ”¹è¿›æˆ‘ä»¬çš„ç«¯ç‚¹**
ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨æ–°æ¨¡å‹æ¥ä½¿ API æ›´â€œæ™ºèƒ½â€ã€‚

**A. ä½œä¸ºå“åº”çš„æ¨¡å‹ (Response Model)**
æˆ‘ä»¬å¯ä»¥å‘Šè¯‰ FastAPIï¼Œæˆ‘ä»¬çš„ç«¯ç‚¹åº”è¯¥è¿”å›ç¬¦åˆ `Spaceship` æ¨¡å‹çš„æ•°æ®ã€‚è¿™ç¡®ä¿äº†å“åº”æ€»æ˜¯å…·æœ‰æ­£ç¡®çš„ç»“æ„ã€‚

**æŒ‰ä»¥ä¸‹æ–¹å¼ä¿®æ”¹ `/spaceships/{ship_id}` ç«¯ç‚¹ï¼š**
```python
# main.py

# ... db_spaceships å’Œ Spaceship æ¨¡å‹çš„ä»£ç  ...

# ä½¿ç”¨ `response_model` æŒ‡å®šå“åº”çš„â€œè“å›¾â€
@app.get("/spaceships/{ship_id}", response_model=Spaceship)
def get_spaceship(ship_id: int):
    """
    è¿”å›ä¸ Spaceship æ¨¡å‹åŒ¹é…çš„é£èˆ¹æ•°æ®ã€‚
    """
    ship = db_spaceships.get(ship_id)
    return ship
```
- `response_model=Spaceship`: æˆ‘ä»¬å‘Šè¯‰ FastAPIï¼šâ€œæ­¤å‡½æ•°çš„å“åº”åº”ç¬¦åˆ `Spaceship` ç»“æ„ã€‚è¿‡æ»¤æ‰æ‰€æœ‰å¤šä½™çš„å­—æ®µï¼Œå¹¶ç¡®ä¿ç±»å‹æ­£ç¡®ã€‚â€

**è¿™å¸¦æ¥äº†ä»€ä¹ˆï¼Ÿ**

- **æ•°æ®è¿‡æ»¤ï¼š** å¦‚æœ `db_spaceships` ä¸­æœ‰å¤šä½™çš„å­—æ®µï¼ˆä¾‹å¦‚ï¼Œ`"secret_code"`ï¼‰ï¼Œå®ƒä»¬å°†ä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆçš„ JSON ä¸­ã€‚
- **ç»“æ„ä¿è¯ï¼š** API å®¢æˆ·ç«¯å¯ä»¥ç¡®ä¿¡å§‹ç»ˆä¼šæ”¶åˆ°é¢„æœŸæ ¼å¼çš„å“åº”ã€‚
- **æ–‡æ¡£ï¼š** åœ¨ `/docs` ä¸­ï¼Œç°åœ¨å°†æ˜¾ç¤ºç²¾ç¡®çš„å“åº”ç¤ºä¾‹ (Example Value)ã€‚

**B. é›†åˆçš„æ¨¡å‹**
é‚£ä¹ˆ `/spaceships` ç«¯ç‚¹å‘¢ï¼Œå®ƒè¿”å›çš„æ˜¯é£èˆ¹çš„*åˆ—è¡¨*ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `typing` æ¨¡å—ä¸­çš„ `list`ã€‚

**ä¿®æ”¹å¯¼å…¥å’Œ `/spaceships` ç«¯ç‚¹ï¼š**
```python
# main.py åœ¨é¡¶éƒ¨
from fastapi import FastAPI
from pydantic import BaseModel
from typing import List  # <-- å¯¼å…¥ List

# ... ä»£ç  ...

# æŒ‡å®šå“åº”æ˜¯ Spaceship ç±»å‹å¯¹è±¡çš„åˆ—è¡¨ (List)
@app.get("/spaceships", response_model=List[Spaceship])
def get_spaceships():
    """
    è¿”å›é£èˆ¹åˆ—è¡¨ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ 
    éƒ½ä¼šæ ¹æ® Spaceship æ¨¡å‹è¿›è¡ŒéªŒè¯ã€‚
    """
    # Pydantic æ— æ³•å¤„ç†ä»¥ ID ä¸ºé”®çš„å­—å…¸ã€‚
    # æˆ‘ä»¬å°†å­—å…¸è½¬æ¢ä¸ºä¸€ä¸ªç®€å•çš„åˆ—è¡¨ã€‚
    return list(db_spaceships.values())
```

- `response_model=List[Spaceship]`: æˆ‘ä»¬æŒ‡å®šå“åº”å°†æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªç¬¦åˆ `Spaceship` æ¨¡å‹çš„å¯¹è±¡ã€‚
- `return list(db_spaceships.values())`: é‡è¦çš„æ›´æ”¹ï¼Pydantic æœŸæœ›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä»¥ ID ä¸ºé”®çš„å­—å…¸ã€‚æˆ‘ä»¬å°†â€œæ•°æ®åº“æ¨¡æ‹Ÿå™¨â€çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªåˆ—è¡¨ã€‚

---

#### **4. éªŒè¯æ”¹è¿›åçš„ API**
ç¡®ä¿ `uvicorn` æœåŠ¡å™¨å·²ä½¿ç”¨ `--reload` è¿è¡Œã€‚

1.  **æ£€æŸ¥ `http://127.0.0.1:8000/spaceships`ï¼š** ç°åœ¨å“åº”æ˜¯ä¸€ä¸ª JSON **æ•°ç»„**ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™å¯¹äºé›†åˆæ¥è¯´æ˜¯ä¸€ä¸ªæ›´æ­£ç¡®å’Œæ ‡å‡†çš„ç»“æ„ã€‚
    ```json
    [
      { "name": "Voyager-1", "type": "æ¢æµ‹å™¨", ... },
      { "name": "Hubble Space Telescope", ... }
    ]
    ```
2.  **æ£€æŸ¥ `http://127.0.0.1:8000/spaceships/1`ï¼š** å“åº”æ²¡æœ‰æ”¹å˜ï¼Œä½†ç°åœ¨å®ƒä¿è¯ç¬¦åˆæ¨¡å‹ã€‚
3.  **æŸ¥çœ‹ `/docs`ï¼š** é¡µé¢åº•éƒ¨çš„â€œSchemasâ€éƒ¨åˆ†å‡ºç°äº†ä½ çš„ `Spaceship` æ¨¡å‹ã€‚å¹¶ä¸”ç«¯ç‚¹çš„å“åº”ç¤ºä¾‹ç°åœ¨æ˜¾ç¤ºäº†ç¾è§‚ã€ç»“æ„åŒ–çš„æ•°æ®æ¨¡å¼ã€‚

---

#### **5. é«˜çº§éªŒè¯ï¼šâ€œæœºè½½è®¡ç®—æœºâ€åœ¨è¡ŒåŠ¨**
Pydantic ä¸ä»…ä»…èƒ½æ£€æŸ¥ç±»å‹ï¼Œå®ƒè¿˜èƒ½åšæ›´å¤šäº‹æƒ…ã€‚

**åœ¨æˆ‘ä»¬çš„ `Spaceship` æ¨¡å‹ä¸­æ·»åŠ éªŒè¯ï¼š**
```python
from pydantic import BaseModel, Field

class Spaceship(BaseModel):
    name: str = Field(..., min_length=3, max_length=50, description="é£èˆ¹åç§°")
    type: str
    launch_year: int = Field(..., gt=1950, description="å‘å°„å¹´ä»½å¿…é¡»åœ¨ 1950 å¹´ä¹‹å")
    status: str
```

- `Field(...)`: ç”¨äºæ·»åŠ é¢å¤–çš„éªŒè¯è§„åˆ™ã€‚
- `...` (çœç•¥å·): è¡¨ç¤ºè¯¥å­—æ®µæ˜¯å¿…å¡«çš„ã€‚
- `min_length`, `max_length`: å­—ç¬¦ä¸²çš„é™åˆ¶ã€‚
- `gt`: â€œå¤§äºâ€ã€‚

å°½ç®¡æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»ºæ–°çš„é£èˆ¹ï¼ˆè¿™å°†åœ¨ä¸‹ä¸€ç« è¿›è¡Œï¼‰ï¼Œä½†è¿™äº›è§„åˆ™å°†å·²ç»åæ˜ åœ¨æ–‡æ¡£ä¸­ï¼Œå¹¶åœ¨æˆ‘ä»¬å®ç° `POST` è¯·æ±‚æ—¶ç”Ÿæ•ˆã€‚

---

#### **å·©å›ºçŸ¥è¯†å°æµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Pydantic åœ¨ FastAPI ä¸­ç”¨äº...</p>
      <label><input type="radio" name="q1" value="a"> a) å‘é€ç”µå­é‚®ä»¶</label>
      <label><input type="radio" name="q1" value="b"> b) å£°æ˜ã€éªŒè¯å’Œæ–‡æ¡£åŒ–æ•°æ®æ¨¡å‹</label>
      <label><input type="radio" name="q1" value="c"> c) ç›´æ¥è¿æ¥æ•°æ®åº“</label>
    </div>
    <div class="question">
      <p>2. è¦åˆ›å»ºä¸€ä¸ªæ•°æ®æ¨¡å‹ï¼Œéœ€è¦ä»ä»¥ä¸‹å“ªä¸ªç±»ç»§æ‰¿ï¼Ÿ</p>
      <label><input type="radio" name="q2" value="a"> a) `FastAPI`</label>
      <label><input type="radio" name="q2" value="b"> b) `pydantic.Field`</label>
      <label><input type="radio" name="q2" value="c"> c) `pydantic.BaseModel`</label>
    </div>
    <div class="question">
      <p>3. `@app.get` è£…é¥°å™¨ä¸­çš„ `response_model` å‚æ•°ç”¨äº...</p>
      <label><input type="radio" name="q3" value="a"> a) ä¸ºä¼ å…¥è¯·æ±‚è®¾ç½®æ¨¡å‹</label>
      <label><input type="radio" name="q3" value="b"> b) æŒ‡å®š API å“åº”åº”ç¬¦åˆçš„ç»“æ„</label>
      <label><input type="radio" name="q3" value="c"> c) åŠ é€ŸæœåŠ¡å™¨å“åº”</label>
    </div>
    <div class="question">
      <p>4. å¦‚ä½•æŒ‡å®šç«¯ç‚¹è¿”å› `Item` ç±»å‹å¯¹è±¡çš„*åˆ—è¡¨*ï¼Ÿ</p>
      <label><input type="radio" name="q4" value="a"> a) `response_model=Item[]`</label>
      <label><input type="radio" name="q4" value="b"> b) `response_model=List[Item]` (ä» `typing` å¯¼å…¥ `List`)</label>
      <label><input type="radio" name="q4" value="c"> c) `response_model=(Item)`</label>
    </div>
    <div class="question">
      <p>5. Pydantic æ¨¡å‹ä¸­çš„ `Field(..., gt=0)` æ„å‘³ç€è¯¥å­—æ®µ...</p>
      <label><input type="radio" name="q5" value="a"> a) å¯é€‰ä¸”å¿…é¡»ç­‰äº 0</label>
      <label><input type="radio" name="q5" value="b"> b) å¿…å¡«ä¸”å¿…é¡»å¤§äº 0</label>
      <label><input type="radio" name="q5" value="c"> c) å¯é€‰ä¸”ç±»å‹ä¸º `float`</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>ä½ çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

ä½ ä¸º API çš„æ•°æ®è®¾è®¡äº†â€œæ•°å­—è“å›¾â€ã€‚ç°åœ¨å®ƒä¸ä»…å¯ä»¥å·¥ä½œï¼Œè€Œä¸”å·¥ä½œèµ·æ¥**å¯é¢„æµ‹ä¸”å¯é **ã€‚

- ğŸ“ ä½¿ç”¨ Pydantic åˆ›å»ºäº† `Spaceship` æ¨¡å‹ã€‚
- ğŸ›¡ï¸ API ç°åœ¨ä½¿ç”¨ `response_model` éªŒè¯å’Œè¿‡æ»¤å‡ºç«™æ•°æ®ã€‚
- ğŸ“Š æ–‡æ¡£å˜å¾—æ›´åŠ ä¿¡æ¯ä¸°å¯Œï¼Œæ˜¾ç¤ºäº†ç²¾ç¡®çš„æ•°æ®æ¨¡å¼ã€‚

**è“å›¾å·²å‡†å¤‡å¥½å¹¶è·æ‰¹å‡†ï¼** åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»è¯»å–æ•°æ®è½¬å‘åˆ›å»ºæ•°æ®â€”â€”ä¸ºæˆ‘ä»¬çš„èˆ°é˜Ÿå®ç°å®Œæ•´çš„ CRUD æ“ä½œã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> - ç¡®ä¿ `/docs` ä¸­å‡ºç°äº† `Spaceship` æ¨¡å‹çš„æ¶æ„ã€‚
> - æ£€æŸ¥ `/spaceships` ç«¯ç‚¹ç°åœ¨è¿”å› JSON æ•°ç»„ (`[...]`)ï¼Œè€Œä¸æ˜¯å¯¹è±¡ (`{...}`)ã€‚
> - ç¡®ä¿åœ¨æ·»åŠ æ¨¡å‹åä»£ç ä¸­æ²¡æœ‰è¯­æ³•é”™è¯¯ã€‚

> **âš ï¸ å¦‚æœæœ‰é”™è¯¯ï¼š**
> - `NameError: name 'BaseModel' is not defined`: è¯·æ£€æŸ¥æ‚¨æ˜¯å¦ä» `pydantic` å¯¼å…¥äº† `BaseModel`ã€‚
> - `NameError: name 'List' is not defined`: è¯·æ£€æŸ¥æ‚¨æ˜¯å¦ä» `typing` å¯¼å…¥äº† `List`ã€‚
> - å¯¹ `/spaceships` çš„å“åº”ä¸ºç©º (`[]`): è¯·ç¡®ä¿æ‚¨å·²å°† `return db_spaceships` æ›´æ”¹ä¸º `return list(db_spaceships.values())`ã€‚