# **ç¬¬3.4ç« ï¼šèˆªå¤©å™¨çš„CRUDæ“ä½œ**
**å­¦ä¹ æ—¶é—´ï¼š** 1å°æ—¶

---

#### **1. CRUDï¼šèˆªå¤©ä»»åŠ¡çš„å®Œæ•´ç®¡ç†å‘¨æœŸ**
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè¯»å–äº†æ•°æ®ï¼ˆ`Read`ï¼‰ã€‚ä½†çœŸæ­£çš„é£è¡Œæ§åˆ¶ä¸­å¿ƒå¿…é¡»èƒ½å¤Ÿåšåˆ°ä¸€åˆ‡ï¼š

- **C**reateï¼ˆåˆ›å»ºï¼‰ï¼šå°†æ–°å«æ˜Ÿé€å…¥è½¨é“ã€‚
- **R**eadï¼ˆè¯»å–ï¼‰ï¼šæŸ¥è¯¢ç°æœ‰èˆªå¤©å™¨çš„çŠ¶æ€ã€‚
- **U**pdateï¼ˆæ›´æ–°ï¼‰ï¼šè°ƒæ•´è½¨é“æˆ–æ›´æ–°è½¯ä»¶ã€‚
- **D**eleteï¼ˆåˆ é™¤ï¼‰ï¼šè®©æ—§å«æ˜Ÿè„±ç¦»è½¨é“ã€‚

è¿™å››é¡¹æ“ä½œâ€”â€”**CRUD**â€”â€”æ„æˆäº†å¤§å¤šæ•°APIçš„åŸºç¡€ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°ç®¡ç†æˆ‘ä»¬èˆ°é˜Ÿçš„å®Œæ•´å‘¨æœŸã€‚

---

#### **2. åˆ›å»ºï¼šå‘å°„æ–°é£èˆ¹ (POST)**
ä¸ºäº†åˆ›å»ºæ–°çš„èˆªå¤©å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `POST` æ–¹æ³•ã€‚æ–°é£èˆ¹çš„æ•°æ®å°†ä»¥ JSON æ ¼å¼åœ¨è¯·æ±‚ä½“ä¸­ä¼ è¾“ã€‚

**æ­¥éª¤1ï¼šä¸ºä¼ å…¥æ•°æ®åˆ›å»ºæ–°çš„ Pydantic æ¨¡å‹**
ä¸ºä»€ä¹ˆéœ€è¦æ–°æ¨¡å‹ï¼Ÿå› ä¸ºåœ¨åˆ›å»ºé£èˆ¹æ—¶ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å®ƒçš„ `id`â€”â€”å®ƒåº”è¯¥ç”±æœåŠ¡å™¨åˆ†é…ã€‚

**å°†æ­¤æ¨¡å‹æ·»åŠ åˆ° `main.py`ï¼š**
```python
# main.py
from pydantic import BaseModel, Field

class SpaceshipCreate(BaseModel):
    """ç”¨äºåˆ›å»ºæ–°é£èˆ¹çš„æ¨¡å‹ï¼ˆä¸å¸¦IDï¼‰ã€‚"""
    name: str = Field(..., min_length=3, max_length=50)
    type: str
    launch_year: int = Field(..., gt=1950)
    status: str
```
æ­¤æ¨¡å‹ä¸ `Spaceship` å‡ ä¹ç›¸åŒï¼Œä½†å®ƒå°†ç”¨äº**ä¼ å…¥æ•°æ®éªŒè¯**ã€‚

**æ­¥éª¤2ï¼šå®ç° `POST /spaceships` ç«¯ç‚¹**
```python
# main.py
import random # åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ æ­¤å¯¼å…¥

# ... å…¶ä»–ä»£ç  ...

@app.post("/spaceships", response_model=Spaceship, status_code=201)
def create_spaceship(ship: SpaceshipCreate):
    """
    å°†æ–°çš„èˆªå¤©å™¨æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­ã€‚
    """
    # ä¸ºé£èˆ¹ç”Ÿæˆæ–°çš„å”¯ä¸€ID
    new_id = max(db_spaceships.keys() or [0]) + 1

    # åˆ›å»ºä¸å®Œæ•´ Spaceship æ¨¡å‹å¯¹åº”çš„é£èˆ¹å¯¹è±¡
    new_ship = Spaceship(id=new_id, **ship.dict())

    # ä¿å­˜åˆ°æˆ‘ä»¬çš„â€œæ•°æ®åº“â€ä¸­
    db_spaceships[new_id] = new_ship.dict()

    return new_ship
```
**è§£è¯»ï¼š**

- `@app.post(...)`ï¼šç”¨äº `POST` è¯·æ±‚çš„è£…é¥°å™¨ã€‚
- `status_code=201`ï¼šæŒ‡ç¤ºæˆåŠŸåˆ›å»ºæ—¶åº”è¿”å› `201 Created` çŠ¶æ€ç ã€‚
- `ship: SpaceshipCreate`ï¼šè¿™å°±æ˜¯é­”æ³•ï¼FastAPI å°†è‡ªåŠ¨è·å–è¯·æ±‚ä½“ (JSON)ï¼Œæ ¹æ® `SpaceshipCreate` æ¨¡å‹å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œå¹¶å°†å…¶ä½œä¸º `ship` å¯¹è±¡ä¼ é€’ç»™å‡½æ•°ã€‚
- `new_id = ...`ï¼šç”Ÿæˆæ–°IDçš„ç®€å•é€»è¾‘ã€‚
- `**ship.dict()`ï¼šæˆ‘ä»¬â€œè§£åŒ…â€ä»æ¥å—çš„ `ship` æ¨¡å‹ä¸­è·å–çš„æ•°æ®åˆ°æˆ‘ä»¬çš„å®Œæ•´æ¨¡å‹ä¸­ã€‚
- `response_model=Spaceship`ï¼šå“åº”å°†ç¬¦åˆå®Œæ•´æ¨¡å‹ï¼ŒåŒ…æ‹¬ `id`ã€‚

---

#### **3. æ›´æ–°ï¼šèˆªå‘ä¿®æ­£ (PUT)**
ä¸ºäº†å®Œæ•´æ›´æ–°ç°æœ‰èµ„æºï¼Œä½¿ç”¨ `PUT` æ–¹æ³•ã€‚

**å®ç° `PUT /spaceships/{ship_id}` ç«¯ç‚¹ï¼š**
```python
# main.py
from fastapi import FastAPI, HTTPException # æ›´æ–°å¯¼å…¥

# ... å…¶ä»–ä»£ç  ...

@app.put("/spaceships/{ship_id}", response_model=Spaceship)
def update_spaceship(ship_id: int, ship_update: SpaceshipCreate):
    """
    å®Œæ•´æ›´æ–°èˆªå¤©å™¨æ•°æ®ã€‚
    """
    if ship_id not in db_spaceships:
        raise HTTPException(status_code=404, detail="èˆªå¤©å™¨æœªæ‰¾åˆ°")

    updated_ship = Spaceship(id=ship_id, **ship_update.dict())
    db_spaceships[ship_id] = updated_ship.dict()

    return updated_ship
```

- `ship_update: SpaceshipCreate`ï¼šæˆ‘ä»¬å†æ¬¡ä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å‹æ¥éªŒè¯ä¼ å…¥æ•°æ®ã€‚
- `HTTPException`ï¼šå¦‚æœæ‰¾ä¸åˆ°å…·æœ‰è¯¥ `id` çš„é£èˆ¹ï¼Œæˆ‘ä»¬â€œæŠ›å‡ºâ€æ ‡å‡†çš„ FastAPI å¼‚å¸¸ï¼Œå®ƒå°†è½¬æ¢ä¸ºå¸¦æœ‰ `404` ä»£ç çš„æ¼‚äº® JSON å“åº”ã€‚

---

#### **4. åˆ é™¤ï¼šè„±ç¦»è½¨é“ (DELETE)**
ä¸ºäº†åˆ é™¤èµ„æºï¼Œä½¿ç”¨ `DELETE` æ–¹æ³•ã€‚é€šå¸¸æ­¤ç±»ç«¯ç‚¹ä¸è¿”å›å“åº”ä½“ã€‚

**å®ç° `DELETE /spaceships/{ship_id}` ç«¯ç‚¹ï¼š**
```python
# main.py
from fastapi import FastAPI, HTTPException, Response, status # æ›´æ–°å¯¼å…¥

# ... å…¶ä»–ä»£ç  ...

@app.delete("/spaceships/{ship_id}", status_code=status.HTTP_204_NO_CONTENT)
def delete_spaceship(ship_id: int):
    """
    ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤èˆªå¤©å™¨ã€‚
    """
    if ship_id not in db_spaceships:
        raise HTTPException(status_code=404, detail="èˆªå¤©å™¨æœªæ‰¾åˆ°")

    del db_spaceships[ship_id]

    # è¿”å›çŠ¶æ€ç ä¸º 204 çš„ç©ºå“åº”
    return Response(status_code=status.HTTP_204_NO_CONTENT)
```

- `status_code=status.HTTP_204_NO_CONTENT`ï¼šæˆ‘ä»¬æ˜ç¡®æŒ‡å®šçŠ¶æ€ `204 No Content`ã€‚
- `del db_spaceships[ship_id]`ï¼šä»æˆ‘ä»¬çš„å­—å…¸ä¸­åˆ é™¤è®°å½•ã€‚
- `return Response(...)`ï¼šè¿”å›ç©ºå“åº”ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦å…³äºå·²åˆ é™¤å¯¹è±¡çš„æ•°æ®ã€‚

---

#### **5. åœ¨ `/docs` ä¸­æµ‹è¯•å®Œæ•´å‘¨æœŸ**
æ‚¨çš„ `uvicorn` åº”è¯¥å·²ç»é‡æ–°åŠ è½½ã€‚

1.  **æ‰“å¼€ `http://127.0.0.1:8000/docs`**ã€‚ç°åœ¨æ‚¨æ‹¥æœ‰äº†ä¸€æ•´å¥— CRUD æ“ä½œï¼
2.  **POSTï¼š** å±•å¼€ `POST /spaceships` ç«¯ç‚¹ï¼Œç‚¹å‡»â€œTry it outâ€ï¼Œå¡«å†™ JSON ä½“ï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªâ€œè©¹å§†æ–¯Â·éŸ¦ä¼¯æœ›è¿œé•œâ€ï¼‰ï¼Œç„¶åç‚¹å‡»â€œExecuteâ€ã€‚æ‚¨åº”è¯¥ä¼šæ”¶åˆ° `201` å“åº”ï¼Œå…¶ä¸­åŒ…å«æ–°æœ›è¿œé•œçš„æ•°æ®ã€‚
3.  **GETï¼š** ç°åœ¨æ‰§è¡Œ `GET /spaceships`ã€‚æ‚¨çš„æ–°æœ›è¿œé•œåº”è¯¥ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚
4.  **PUTï¼š** ä½¿ç”¨æ–°æœ›è¿œé•œçš„ IDï¼Œé€šè¿‡ `PUT /spaceships/{ship_id}` æ›´æ–°å…¶æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ›´æ”¹å…¶çŠ¶æ€ã€‚
5.  **DELETEï¼š** ä½¿ç”¨ç›¸åŒçš„ IDï¼Œé€šè¿‡ `DELETE /spaceships/{ship_id}` åˆ é™¤æœ›è¿œé•œã€‚æ‚¨åº”è¯¥ä¼šæ”¶åˆ°çŠ¶æ€ä¸º `204` çš„ç©ºå“åº”ã€‚
6.  **æ£€æŸ¥ï¼š** å†æ¬¡æ‰§è¡Œ `GET /spaceships`ï¼Œä»¥ç¡®è®¤æœ›è¿œé•œå·²ä»åˆ—è¡¨ä¸­åˆ é™¤ã€‚

---

#### **å·©å›ºæµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. åˆ›å»ºæ–°èµ„æºä½¿ç”¨å“ªä¸ª HTTP æ–¹æ³•ï¼Ÿ</p>
      <label><input type="radio" name="q1" value="a"> a) GET</label>
      <label><input type="radio" name="q1" value="b"> b) PUT</label>
      <label><input type="radio" name="q1" value="c"> c) POST</label>
    </div>
    <div class="question">
      <p>2. `DELETE` æ“ä½œçš„æ ‡å‡†æˆåŠŸçŠ¶æ€ç æ˜¯ï¼š</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 204 No Content</label>
      <label><input type="radio" name="q2" value="c"> c) 404 Not Found</label>
    </div>
    <div class="question">
      <p>3. FastAPI å¦‚ä½•ä» POST è¯·æ±‚ä½“ä¸­è·å–æ•°æ®ï¼Ÿ</p>
      <label><input type="radio" name="q3" value="a"> a) é€šè¿‡å…¨å±€å˜é‡ `$_POST`</label>
      <label><input type="radio" name="q3" value="b"> b) å¦‚æœå‡½æ•°å‚æ•°ä¸­æŒ‡å®šäº† Pydantic æ¨¡å‹ï¼Œåˆ™è‡ªåŠ¨è·å–</label>
      <label><input type="radio" name="q3" value="c"> c) éœ€è¦æ‰‹åŠ¨è¯»å– `request.body` æµ</label>
    </div>
    <div class="question">
      <p>4. `raise HTTPException(status_code=404)` ç”¨äºï¼š</p>
      <label><input type="radio" name="q4" value="a"> a) ç”Ÿæˆè‡´å‘½çš„æœåŠ¡å™¨é”™è¯¯ (500)</label>
      <label><input type="radio" name="q4" value="b"> b) å‘å®¢æˆ·ç«¯è¿”å›å¸¦æœ‰é”™è¯¯çš„æ­£ç¡® HTTP å“åº”</label>
      <label><input type="radio" name="q4" value="c"> c) å°†é”™è¯¯è®°å½•åˆ°æ–‡ä»¶</label>
    </div>
    <div class="question">
      <p>5. ä¸ºä»€ä¹ˆä¸ºåˆ›å»ºèµ„æºï¼ˆ`POST`ï¼‰åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„ `SpaceshipCreate` æ¨¡å‹ï¼Ÿ</p>
      <label><input type="radio" name="q5" value="a"> a) å› ä¸ºæ­£åœ¨åˆ›å»ºçš„å¯¹è±¡è¿˜æ²¡æœ‰ `id`</label>
      <label><input type="radio" name="q5" value="b"> b) å› ä¸º FastAPI è¦æ±‚æ¯ä¸ªç«¯ç‚¹æœ‰ä¸åŒçš„æ¨¡å‹åç§°</label>
      <label><input type="radio" name="q5" value="c"> c) ä¸ºäº†åŠ å¿«éªŒè¯é€Ÿåº¦</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'c', q2: 'b', q3: 'b', q4: 'b', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„åˆ†æ•°ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

æ‚¨å·²ç»å®ç°äº†å®Œæ•´çš„ **CRUD å‘¨æœŸ**ï¼Œå¹¶å°†æ‚¨çš„ API ä»ç®€å•çš„â€œä¿¡æ¯æ˜¾ç¤ºæ¿â€è½¬å˜ä¸ºä¸€ä¸ªæˆç†Ÿçš„ **èˆ°é˜Ÿæ§åˆ¶ä¸­å¿ƒ**ï¼

- âœ… **C**reateï¼š`POST /spaceships` ç”¨äºå‘å°„æ–°èˆªå¤©å™¨ã€‚
- âœ… **R**eadï¼š`GET /spaceships` å’Œ `GET /spaceships/{id}` ç”¨äºè·å–æ•°æ®ã€‚
- âœ… **U**pdateï¼š`PUT /spaceships/{id}` ç”¨äºæ›´æ–°ä»»åŠ¡ã€‚
- âœ… **D**eleteï¼š`DELETE /spaceships/{id}` ç”¨äºæŠ¥åºŸèˆªå¤©å™¨ã€‚

**æ‚¨çš„èˆ°é˜Ÿå°½åœ¨æŒæ¡ï¼** åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° FastAPI å¦‚ä½•è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºäº†è¯¦ç»†çš„â€œæ“ä½œæ‰‹å†Œâ€â€”â€”äº¤äº’å¼ Swagger æ–‡æ¡£ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> - æ‰€æœ‰ 5 ä¸ªç«¯ç‚¹ï¼ˆ`GET` (2)ã€`POST`ã€`PUT`ã€`DELETE`ï¼‰åœ¨ `/docs` ä¸­å¯è§å¹¶æ­£å¸¸å·¥ä½œã€‚
> - æ‚¨å¯ä»¥æˆåŠŸåˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤èµ„æºã€‚
> - è¯·æ±‚ä¸å­˜åœ¨çš„ ID æ—¶è¿”å› `404` é”™è¯¯ã€‚

> **âš ï¸ å¦‚æœå‡ºç°é”™è¯¯ï¼š**

> - `NameError`ï¼šæ£€æŸ¥æ‚¨æ˜¯å¦å¯¼å…¥äº† `HTTPException`ã€`Response`ã€`status`ã€‚
> - `KeyError`ï¼šæ‚¨å¯èƒ½æ­£åœ¨å°è¯•è®¿é—®å·²åˆ é™¤çš„ IDã€‚
> - `PUT` æˆ– `POST` æ“ä½œä¸æ­£ç¡®ï¼šè¯·ç¡®ä¿åœ¨å‡½æ•°å‚æ•°ä¸­ä½¿ç”¨äº†æ­£ç¡®çš„ Pydantic æ¨¡å‹ï¼ˆ`SpaceshipCreate`ï¼‰ã€‚