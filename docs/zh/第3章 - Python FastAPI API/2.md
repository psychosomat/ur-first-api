# **ç¬¬ 3.2 ç« ï¼šåˆ›å»ºç¬¬ä¸€ä¸ª API ç«¯ç‚¹**
**å­¦ä¹ æ—¶é—´ï¼š** 30 åˆ†é’Ÿ

---

#### **1. ç«¯ç‚¹ï¼šæ•°æ®å¯¹æ¥ç«¯å£**
æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ API æ˜¯ä¸€ä¸ªç©ºé—´ç«™ã€‚**ç«¯ç‚¹**ï¼ˆEndpointï¼Œä¹Ÿç§°ä½œâ€œç»ˆç‚¹â€ï¼‰æ˜¯ä¸€ä¸ªç‰¹å®šçš„**å¯¹æ¥ç«¯å£**ï¼Œä¸“ä¸ºç‰¹å®šç±»å‹çš„é£èˆ¹è®¾è®¡ã€‚

- ç«¯å£ `1 å·` â€”â€” ç”¨äºè´§è¿é£èˆ¹ï¼ˆè¡Œæ˜Ÿæ•°æ®ï¼‰ã€‚
- ç«¯å£ `2 å·` â€”â€” ç”¨äºæ¢æµ‹å™¨ï¼ˆä»»åŠ¡æ•°æ®ï¼‰ã€‚
- ç«¯å£ `3 å·` â€”â€” ç”¨äºè½½å®¢èˆªå¤©é£æœºï¼ˆå®‡èˆªå‘˜æ•°æ®ï¼‰ã€‚

æ¯ä¸ªç«¯ç‚¹éƒ½æ˜¯ä¸€ä¸ªå”¯ä¸€çš„ URLï¼Œè´Ÿè´£å¯¹ç‰¹å®šèµ„æºæ‰§è¡Œç‰¹å®šæ“ä½œã€‚

> ğŸ’¡ **å¤ªç©ºç±»æ¯”ï¼š**
> `GET /spaceships` è¿™æ¡å‘½ä»¤æ˜¯â€œä»»åŠ¡æ§åˆ¶ä¸­å¿ƒ â†’ ç©ºé—´ç«™ï¼šæŠ¥å‘Šæ‰€æœ‰å·²åœé é£èˆ¹çš„åˆ—è¡¨â€ã€‚è¿™ä¸ªç«¯ç‚¹è¿”å›ä¸€ä¸ªèµ„æºé›†åˆã€‚

---

#### **2. åˆ›å»ºâ€œå¤ªç©ºèˆ°é˜Ÿâ€**
ç›®å‰æˆ‘ä»¬è¿˜æ²¡æœ‰æ•°æ®åº“ï¼Œæ‰€ä»¥å…ˆåˆ›å»ºä¸€ä¸ªâ€œæ¨¡æ‹Ÿâ€â€”â€”ä¸€ä¸ªç®€å•çš„ Python å­—å…¸å½¢å¼çš„èˆªå¤©å™¨åˆ—è¡¨ã€‚

**æ‰“å¼€ `main.py` å¹¶åœ¨å®šä¹‰ `app` ä¹‹å‰æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š**
```python
# main.py

# æ­¥éª¤ 1ï¼šåˆ›å»ºæ¨¡æ‹Ÿæ•°æ®åº“
db_spaceships = {
    1: {
        "name": "Voyager-1",
        "type": "æ¢æµ‹å™¨",
        "launch_year": 1977,
        "status": "æ´»è·ƒ"
    },
    2: {
        "name": "Hubble Space Telescope",
        "type": "æœ›è¿œé•œ",
        "launch_year": 1990,
        "status": "æ´»è·ƒ"
    },
    3: {
        "name": "ISS",
        "type": "ç©ºé—´ç«™",
        "launch_year": 1998,
        "status": "åœ¨è½¨"
    }
}

// ... è¿™é‡Œæ˜¯ app = FastAPI() çš„ä»£ç 
```
è¿™æ˜¯æˆ‘ä»¬çš„â€œèˆªå¤©å™¨æ³¨å†Œè¡¨â€ï¼Œæˆ‘ä»¬å°†ç”¨å®ƒæ¥å·¥ä½œã€‚

---

#### **3. ç¬¬ä¸€ä¸ªç«¯ç‚¹ï¼šé£èˆ¹åˆ—è¡¨**
ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç«¯ç‚¹ï¼Œå®ƒå°†è¿”å›æˆ‘ä»¬æ•´ä¸ªèˆ°é˜Ÿçš„åˆ—è¡¨ã€‚

**åœ¨ `main.py` ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° `@app.get("/")` ä¹‹åï¼š**
```python
# main.py

# ... åŒ…å« db_spaceships, FastAPI, app å’Œ read_root() çš„ä»£ç  ...

@app.get("/spaceships")
def get_spaceships():
    """
    è¿”å›æ³¨å†Œè¡¨ä¸­æ‰€æœ‰èˆªå¤©å™¨çš„åˆ—è¡¨ã€‚
    """
    return db_spaceships
```

- `@app.get("/spaceships")`ï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°è·¯ç”±ã€‚ç°åœ¨ï¼Œå¯¹ URL `/spaceships` çš„ `GET` è¯·æ±‚å°†ç”± `get_spaceships` å‡½æ•°å¤„ç†ã€‚
- `return db_spaceships`ï¼šFastAPI ä¼šè‡ªåŠ¨å°† Python å­—å…¸è½¬æ¢ä¸ºæ­£ç¡®çš„ JSON å“åº”ã€‚

---

#### **4. æµ‹è¯•æ–°å¯¹æ¥ç«¯å£çš„åŠŸèƒ½**
å¦‚æœæ‚¨çš„ `uvicorn` æœåŠ¡å™¨ä»åœ¨ä½¿ç”¨ `--reload` æ ‡å¿—è¿è¡Œï¼Œå®ƒåº”è¯¥å·²ç»é‡æ–°åŠ è½½å¹¶å‡†å¤‡å¥½å·¥ä½œã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·é‡æ–°å¯åŠ¨å®ƒï¼š
```bash
uvicorn main:app --reload
```

**æ­¥éª¤ 1ï¼šåœ¨æµè§ˆå™¨ä¸­æµ‹è¯•**

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åœ°å€ `http://127.0.0.1:8000/spaceships`ã€‚
æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å®Œæ•´çš„é£èˆ¹åˆ—è¡¨ï¼Œæ ¼å¼ä¸º JSONï¼š
```json
{
  "1": {
    "name": "Voyager-1",
    "type": "æ¢æµ‹å™¨",
    "launch_year": 1977,
    "status": "æ´»è·ƒ"
  },
  "2": {
    "name": "Hubble Space Telescope",
    "type": "æœ›è¿œé•œ",
    "launch_year": 1990,
    "status": "æ´»è·ƒ"
  },
  "3": {
    "name": "ISS",
    "type": "ç©ºé—´ç«™",
    "launch_year": 1998,
    "status": "åœ¨è½¨"
  }
}
```

**æ­¥éª¤ 2ï¼šåœ¨è‡ªåŠ¨æ–‡æ¡£ä¸­æµ‹è¯•**

è®¿é—® `http://127.0.0.1:8000/docs`ã€‚æ‚¨ä¼šçœ‹åˆ°æ–‡æ¡£ä¸­ä¸º `GET /spaceships` ç«¯ç‚¹æ–°å¢äº†ä¸€ä¸ªéƒ¨åˆ†ã€‚æ‚¨å¯ä»¥ç‚¹å‡»â€œTry it outâ€å’Œâ€œExecuteâ€ç›´æ¥åœ¨é‚£é‡Œè¿›è¡Œæµ‹è¯•ï¼

---

#### **5. å¸¦å‚æ•°çš„ç«¯ç‚¹ï¼šç‰¹å®šé£èˆ¹çš„æ•°æ®**
å¦‚æœæˆ‘ä»¬éœ€è¦â€œæ—…è¡Œè€… 1 å·â€çš„ç‰¹å®šæ•°æ®æ€ä¹ˆåŠï¼Ÿä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰**è·¯å¾„å‚æ•°ï¼ˆpath parameterï¼‰**çš„ç«¯ç‚¹ã€‚

**å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° `main.py`ï¼š**
```python
# main.py

# ... å…¶ä»–ä»£ç  ...

@app.get("/spaceships/{ship_id}")
def get_spaceship(ship_id: int):
    """
    æ ¹æ® ID è¿”å›ç‰¹å®šèˆªå¤©å™¨çš„æ•°æ®ã€‚
    """
    return db_spaceships.get(ship_id)
```

- `"/spaceships/{ship_id}"`ï¼šèŠ±æ‹¬å· `{}` å‘Šè¯‰ FastAPIï¼Œ`ship_id` æ˜¯ä¸€ä¸ªå°†ä» URL ä¼ é€’è¿‡æ¥çš„å˜é‡ã€‚
- `ship_id: int`ï¼šè¿™æ˜¯ä¸€ä¸ª**ç±»å‹æç¤ºï¼ˆtype hintï¼‰**ã€‚FastAPI ä¼šè‡ªåŠ¨æ£€æŸ¥ä¼ å…¥çš„ ID æ˜¯å¦ä¸ºæ•´æ•°ã€‚å¦‚æœæœ‰äººè¯·æ±‚ `/spaceships/voyager`ï¼ŒFastAPI å°†è¿”å› `422 Unprocessable Entity` éªŒè¯é”™è¯¯ã€‚è¿™çœŸæ˜¯å¤ªæ£’äº†ï¼

**æµ‹è¯•ï¼š**

æ‰“å¼€ `http://127.0.0.1:8000/spaceships/2`ã€‚æ‚¨åº”è¯¥åªä¼šæ”¶åˆ°å…³äºâ€œå“ˆå‹ƒâ€æœ›è¿œé•œçš„æ•°æ®ã€‚å¦‚æœæ‚¨æ‰“å¼€ `http://127.0.0.1:8000/spaceships/99`ï¼Œæ‚¨å°†æ”¶åˆ° `null`ï¼Œå› ä¸ºæ²¡æœ‰è¿™æ ·çš„é£èˆ¹ã€‚

---

#### **å·©å›ºçŸ¥è¯†å°æµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. API ä¸­çš„ç«¯ç‚¹æ˜¯...</p>
      <label><input type="radio" name="q1" value="a"> a) å®‡å®™çš„ç»ˆç‚¹</label>
      <label><input type="radio" name="q1" value="b"> b) ç”¨äºå¯¹èµ„æºæ‰§è¡Œç‰¹å®šæ“ä½œçš„å”¯ä¸€ URL</label>
      <label><input type="radio" name="q1" value="c"> c) æ•°æ®åº“çš„åç§°</label>
    </div>
    <div class="question">
      <p>2. è£…é¥°å™¨ `@app.get("/users")` çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
      <label><input type="radio" name="q2" value="a"> a) åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·</label>
      <label><input type="radio" name="q2" value="b"> b) å°†å‡½æ•°ä¸å¯¹ `/users` çš„ GET è¯·æ±‚å…³è”èµ·æ¥</label>
      <label><input type="radio" name="q2" value="c"> c) è·å–æ‰€æœ‰è£…é¥°å™¨çš„åˆ—è¡¨</label>
    </div>
    <div class="question">
      <p>3. è·¯å¾„ä¸­çš„ `"/items/{item_id}"` è¡¨ç¤ºä»€ä¹ˆï¼Ÿ</p>
      <label><input type="radio" name="q3" value="a"> a) éœ€è¦å¯»æ‰¾åä¸º `{item_id}` çš„æ–‡ä»¶å¤¹</label>
      <label><input type="radio" name="q3" value="b"> b) `item_id` æ˜¯ä¸€ä¸ªå°†ä» URL ä¸­è·å–çš„å‚æ•°</label>
      <label><input type="radio" name="q3" value="c"> c) è¿™æ˜¯ä¸€ä¸ªå°†è¢«å¿½ç•¥çš„æ³¨é‡Š</label>
    </div>
    <div class="question">
      <p>4. å‡½æ•°ä¸­ `ship_id: int` çš„ç±»å‹æç¤ºæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
      <label><input type="radio" name="q4" value="a"> a) è®© Python è¿è¡Œæ›´å¿«</label>
      <label><input type="radio" name="q4" value="b"> b) è®© FastAPI è‡ªåŠ¨éªŒè¯ ID æ˜¯å¦ä¸ºæ•°å­—</label>
      <label><input type="radio" name="q4" value="c"> c) è®©å˜é‡åœ¨å‡½æ•°å¤–éƒ¨å¯è§</label>
    </div>
    <div class="question">
      <p>5. å¦‚æœæ‚¨è¯·æ±‚ `/spaceships/abc`ï¼Œè€Œ FastAPI æœŸæœ›ä¸€ä¸ª `int`ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
      <label><input type="radio" name="q5" value="a"> a) æœåŠ¡å™¨ä¼šå›  500 é”™è¯¯â€œå´©æºƒâ€</label>
      <label><input type="radio" name="q5" value="b"> b) FastAPI å°†è¿”å› 422 é”™è¯¯</label>
      <label><input type="radio" name="q5" value="c"> c) FastAPI ä¼šå°è¯•å°†â€œabcâ€è½¬æ¢ä¸ºæ•°å­—</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æ²¡æœ‰å›ç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

æ‚¨å·²æˆåŠŸåœ¨æ‚¨çš„ API ç©ºé—´ç«™ä¸Šåˆ›å»ºäº†ä¸¤ä¸ªâ€œå¯¹æ¥ç«¯å£â€ï¼š

- ğŸ›°ï¸ ä¸€ä¸ªç”¨äºè·å–æ‰€æœ‰é£èˆ¹åˆ—è¡¨ (`/spaceships`)
- ğŸ”­ å¦ä¸€ä¸ªç”¨äºè·å–ç‰¹å®šèˆªå¤©å™¨çš„æ•°æ® (`/spaceships/{ship_id}`)

æ‚¨è¿˜çœ‹åˆ°äº† FastAPI è‡ªåŠ¨ç±»å‹éªŒè¯çš„å¼ºå¤§åŠŸèƒ½ï¼Œå®ƒèƒ½ä¿æŠ¤æ‚¨çš„ API å…å—ä¸æ­£ç¡®è¯·æ±‚çš„å½±å“ã€‚

**å¯¼èˆªç³»ç»Ÿå·²è®¾ç½®å®Œæ¯•ï¼** åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Pydantic åˆ›å»ºæˆ‘ä»¬çš„èˆªå¤©å™¨â€œè“å›¾â€ï¼Œä½¿æˆ‘ä»¬çš„ API æ›´æ™ºèƒ½ã€æ›´å¯é ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> - `uvicorn` æœåŠ¡å™¨å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œã€‚
> - URL `http://127.0.0.1:8000/spaceships` è¿”å›åŒ…å«é£èˆ¹åˆ—è¡¨çš„ JSONã€‚
> - URL `http://127.0.0.1:8000/spaceships/1` è¿”å›å…³äºâ€œæ—…è¡Œè€… 1 å·â€çš„æ•°æ®ã€‚
> - URL `http://127.0.0.1:8000/docs` æ˜¾ç¤ºä¸¤ä¸ªæ–°ç«¯ç‚¹ã€‚

> **âš ï¸ å¦‚æœå‡ºç°é”™è¯¯ï¼š**

> - **404 Not Foundï¼š** æ£€æŸ¥æµè§ˆå™¨ä¸­å’Œè£…é¥°å™¨ `@app.get(...)` ä¸­çš„ URL æ˜¯å¦æ­£ç¡®ã€‚
> - **ä»£ç é”™è¯¯ï¼š** ä»”ç»†æ£€æŸ¥è¯­æ³•ï¼Œå°¤å…¶æ˜¯ Python ä¸­çš„ç¼©è¿›å’Œå­—å…¸ä¸­çš„é€—å·ã€‚