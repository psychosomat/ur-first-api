# **ç¬¬ 3.1 ç« ï¼šå®‰è£… FastAPI å¹¶é…ç½®ç¯å¢ƒ**
**å­¦ä¹ æ—¶é—´ï¼š** 45 åˆ†é’Ÿ

---

#### **1. ä»€ä¹ˆæ˜¯ FastAPIï¼ŸAPI çš„è¶…å…‰é€Ÿå¼•æ“**
å¦‚æœ Flask æ˜¯çµæ´»çš„ä¾¦å¯Ÿæ¢æµ‹å™¨ï¼ŒDjango æ˜¯å·¨å¤§çš„èˆªæ¯ï¼Œé‚£ä¹ˆ **FastAPI** å°±æ˜¯**è¶…å…‰é€Ÿæˆ˜æ–—æœº**ã€‚

**FastAPI** æ˜¯ä¸€ä¸ªç°ä»£ã€é«˜æ€§èƒ½çš„ Web æ¡†æ¶ï¼Œç”¨äºä½¿ç”¨ Python 3.7+ æ„å»º APIã€‚å®ƒçš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š

- **é€Ÿåº¦ï¼š** Python ä¸­æœ€å¿«çš„æ¡†æ¶ä¹‹ä¸€ï¼Œå¯ä¸ NodeJS å’Œ Go åª²ç¾ã€‚
- **ç®€æ´ï¼š** æç®€ä¸”ç›´è§‚çš„è¯­æ³•ã€‚
- **è‡ªåŠ¨æ–‡æ¡£ï¼š** è‡ªåŠ¨ä¸ºæ‚¨çš„ API ç”Ÿæˆäº¤äº’å¼æ–‡æ¡£ã€‚
- **ç±»å‹åŒ–ï¼š** åˆ©ç”¨ Python æ ‡å‡†ç±»å‹æç¤ºè¿›è¡Œæ•°æ®éªŒè¯ã€è‡ªåŠ¨è¡¥å…¨å’Œæ–‡æ¡£ç”Ÿæˆã€‚

> ğŸ’¡ **å®‡å®™ç±»æ¯”ï¼š**

> FastAPI â€” å°±åƒæ‚¨ API é£èˆ¹çš„â€œè¶…å…‰é€Ÿå¼•æ“â€ã€‚å®ƒåŸºäºä¸¤ç§æŠ€æœ¯ï¼š

> - **Starlette**ï¼ˆæˆ˜æ–—æœºåº•ç›˜ï¼‰â€”â€” æä¾›å¼‚æ­¥å’Œå“è¶Šçš„æ€§èƒ½ã€‚
> - **Pydantic**ï¼ˆæœºè½½è®¡ç®—æœºï¼‰â€”â€” è´Ÿè´£æ•°æ®éªŒè¯å’Œé…ç½®ã€‚

---

#### **2. å‡†å¤‡å‘å°„å°ï¼šè™šæ‹Ÿç¯å¢ƒ**
åœ¨å»ºé€ æˆ‘ä»¬çš„æˆ˜æ–—æœºä¹‹å‰ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª**æ— èŒç»„è£…å®éªŒå®¤**ã€‚åœ¨ Python ä¸­ï¼Œè¿™é€šè¿‡**è™šæ‹Ÿç¯å¢ƒ**å®ç°ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ** ä¸ºäº†ç¡®ä¿æˆ‘ä»¬é¡¹ç›®çš„ä¾èµ–é¡¹ï¼ˆå¼•æ“ã€å¯¼èˆªç³»ç»Ÿï¼‰ä¸ä¼šä¸æ‚¨è®¡ç®—æœºä¸Šçš„å…¶ä»–é¡¹ç›®å†²çªã€‚

**æ­¥éª¤ 1ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
åœ¨æ‚¨çš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ `C:\Projects\FastAPI_Fleet`ï¼‰ä¸­æ‰“å¼€ç»ˆç«¯å¹¶æ‰§è¡Œï¼š

```bash
python -m venv venv
```
æ­¤å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º `venv` çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç‹¬ç«‹çš„ Python ç‰ˆæœ¬ã€‚

**æ­¥éª¤ 2ï¼šæ¿€æ´»å®éªŒå®¤çš„â€œåŠ›åœºâ€**

- **Windows (PowerShell):**

  ```powershell
  .\venv\Scripts\Activate.ps1
  ```
  *ï¼ˆå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯èƒ½éœ€è¦å…è®¸æ‰§è¡Œè„šæœ¬ï¼š`Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process`ï¼‰*

- **Windows (CMD):**

  ```cmd
  .\venv\Scripts\activate.bat
  ```

- **macOS / Linux:**

  ```bash
  source venv/bin/activate
  ```
æ¿€æ´»åï¼Œç»ˆç«¯è¡Œé¦–å°†å‡ºç° `(venv)`ã€‚è¿™æ„å‘³ç€æ‚¨å·²è¿›å…¥æ‚¨çš„å®éªŒå®¤ï¼

---

#### **3. å®‰è£…å¼•æ“ï¼šFastAPI å’Œ Uvicorn**
ç°åœ¨æˆ‘ä»¬å°†å®‰è£…ä¸¤ä¸ªå…³é”®ç»„ä»¶ï¼š

- **fastapiï¼š** æ¡†æ¶æœ¬èº«ã€‚
- **uvicornï¼š** é—ªç”µèˆ¬çš„ ASGI æœåŠ¡å™¨ï¼Œå®ƒå°†â€œå¯åŠ¨â€æˆ‘ä»¬çš„å¼•æ“ã€‚

åœ¨å·²æ¿€æ´»çš„ç¯å¢ƒä¸­æ‰§è¡Œï¼š
```bash
pip install "fastapi[all]"
```
> ğŸ’¡ **ä¸ºä»€ä¹ˆæ˜¯ `[all]`ï¼Ÿ**
> è¿™å°†å®‰è£… `fastapi`ã€`uvicorn` ä»¥åŠå…¶ä»–æœ‰ç”¨çš„åŒ…ï¼ˆä¾‹å¦‚ï¼Œç”¨äºæ”¯æŒ WebSocket å’Œ Jinja2ï¼‰ï¼Œè¿™äº›åœ¨æœªæ¥çš„ä»»åŠ¡ä¸­ä¼šæ´¾ä¸Šç”¨åœºã€‚

**å®‰è£…éªŒè¯ï¼š**
```bash
pip freeze
```
æ‚¨åº”è¯¥åœ¨åˆ—è¡¨ä¸­çœ‹åˆ° `fastapi`ã€`pydantic`ã€`starlette`ã€`uvicorn` åŠå…¶ä»–åŒ…ã€‚

---

#### **4. é¦–æ¬¡æ¥è§¦ï¼š`main.py` æ–‡ä»¶**
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `main.py` æ–‡ä»¶â€”â€”è¿™å°†æ˜¯æˆ‘ä»¬ API çš„**ä¸­å¤®æ§åˆ¶å°**ã€‚

**åœ¨ `main.py` ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š**
```python
from fastapi import FastAPI

# åˆ›å»ºæˆ‘ä»¬ API â€œå®‡å®™é£èˆ¹â€çš„å®ä¾‹
app = FastAPI()

# å®šä¹‰ç¬¬ä¸€ä¸ªâ€œåœé èŠ‚ç‚¹â€ï¼ˆendpointï¼‰
# è¿™æ˜¯æ ¹ URLï¼š/
@app.get("/")
def read_root():
    """
    è¿™æ˜¯é£æ§ä¸­å¿ƒçš„æ¶ˆæ¯ï¼Œæ‰€æœ‰è¿æ¥åˆ°ä¸»ç½‘å…³çš„ç”¨æˆ·éƒ½èƒ½çœ‹åˆ°ã€‚
    """
    return {"message": "æ¬¢è¿æ¥åˆ°å®‡å®™èˆ°é˜Ÿæ§åˆ¶ä¸­å¿ƒï¼"}
```
- `@app.get("/")`ï¼šè¿™æ˜¯ä¸€ä¸ª**è£…é¥°å™¨**ï¼Œå®ƒå‘Šè¯‰ FastAPIï¼Œ`read_root` å‡½æ•°åº”è¯¥å¤„ç†æ ¹ URL (`/`) ä¸Šçš„ `GET` è¯·æ±‚ã€‚

---

#### **5. ç‚¹ç«ï¼å¯åŠ¨æœåŠ¡å™¨**
æ˜¯æ—¶å€™å¯åŠ¨æˆ‘ä»¬çš„è¶…å…‰é€Ÿå¼•æ“äº†ï¼åœ¨ç»ˆç«¯ï¼ˆå·²æ¿€æ´» `venv`ï¼‰ä¸­æ‰§è¡Œï¼š
```bash
uvicorn main:app --reload
```
**å‘½ä»¤è§£æï¼š**

- `uvicorn`ï¼šå¯åŠ¨ Uvicorn æœåŠ¡å™¨ã€‚
- `main`ï¼š`main.py` æ–‡ä»¶ï¼ˆä¸å¸¦ `.py`ï¼‰ã€‚
- `app`ï¼šåœ¨ `main.py` ä¸­åˆ›å»ºçš„ `app = FastAPI()` å¯¹è±¡ã€‚
- `--reload`ï¼šâ€œè‡ªåŠ¨é©¾é©¶â€ã€‚æœåŠ¡å™¨å°†åœ¨æ¯æ¬¡ä»£ç æ›´æ”¹æ—¶è‡ªåŠ¨é‡å¯ã€‚

**ç»ˆç«¯é¢„æœŸè¾“å‡ºï¼š**
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345]
INFO:     Started server process [12346]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

---

#### **6. ä¸é£æ§ä¸­å¿ƒå»ºç«‹è¿æ¥**
æ‚¨çš„ API ç°å·²ä¸Šçº¿å¹¶ç›‘å¬ `8000` ç«¯å£ï¼

**æ­¥éª¤ 1ï¼šåœ¨æµè§ˆå™¨ä¸­æ£€æŸ¥**

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åœ°å€ `http://127.0.0.1:8000`ã€‚æ‚¨åº”è¯¥çœ‹åˆ°ï¼š
```json
{
  "message": "æ¬¢è¿æ¥åˆ°å®‡å®™èˆ°é˜Ÿæ§åˆ¶ä¸­å¿ƒï¼"
}
```

**æ­¥éª¤ 2ï¼šå±•æœ›æœªæ¥ï¼ˆè‡ªåŠ¨æ–‡æ¡£ï¼‰**

FastAPI å·²ç»ä¸ºæ‚¨å‡†å¤‡äº†ä¸¤ä»½ç¤¼ç‰©ã€‚æ‰“å¼€è¿™äº› URLï¼š

- `http://127.0.0.1:8000/docs`ï¼šäº¤äº’å¼ Swagger UI æ–‡æ¡£ã€‚
- `http://127.0.0.1:8000/redoc`ï¼šæ›¿ä»£ ReDoc æ–‡æ¡£ã€‚

æ‚¨å°†çœ‹åˆ°æ‚¨çš„ç¬¬ä¸€ä¸ªç«¯ç‚¹ï¼Œå¯ä»¥ç›´æ¥ä»æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯•ï¼

---

#### **å·©å›ºæµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI ä»¥å…¶...è€Œé—»å</p>
      <label><input type="radio" name="q1" value="a"> a) é€Ÿåº¦æ…¢ä½†å¯é çš„è¿è¡Œ</label>
      <label><input type="radio" name="q1" value="b"> b) é«˜æ€§èƒ½å’Œé€Ÿåº¦</label>
      <label><input type="radio" name="q1" value="c"> c) ä»…ä¸ Microsoft æ•°æ®åº“é›†æˆ</label>
    </div>
    <div class="question">
      <p>2. ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿç¯å¢ƒ (`venv`)ï¼Ÿ</p>
      <label><input type="radio" name="q2" value="a"> a) ä¸ºäº†åŠ é€Ÿ Python çš„è¿è¡Œ</label>
      <label><input type="radio" name="q2" value="b"> b) ä¸ºäº†éš”ç¦»é¡¹ç›®ä¾èµ–</label>
      <label><input type="radio" name="q2" value="c"> c) ä¸ºäº†è‡ªåŠ¨ç¼–å†™æµ‹è¯•</label>
    </div>
    <div class="question">
      <p>3. æœ¬è¯¾ç¨‹ä¸­ç”¨äºè¿è¡Œ FastAPI çš„æœåŠ¡å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
      <label><input type="radio" name="q3" value="a"> a) Apache</label>
      <label><input type="radio" name="q3" value="b"> b) Gunicorn</label>
      <label><input type="radio" name="q3" value="c"> c) Uvicorn</label>
    </div>
    <div class="question">
      <p>4. å‘½ä»¤ `uvicorn main:app --reload` æ„å‘³ç€ï¼š</p>
      <label><input type="radio" name="q4" value="a"> a) è¿è¡Œ `app.py` æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« `main` å¯¹è±¡</label>
      <label><input type="radio" name="q4" value="b"> b) è¿è¡Œ `main.py` æ–‡ä»¶ä¸­çš„ `app` å¯¹è±¡ï¼Œå¹¶åœ¨æ›´æ”¹æ—¶é‡æ–°å¯åŠ¨</label>
      <label><input type="radio" name="q4" value="c"> c) é‡å¯è®¡ç®—æœºå¹¶å¯åŠ¨åº”ç”¨ç¨‹åº</label>
    </div>
    <div class="question">
      <p>5. FastAPI ä¸­çš„è£…é¥°å™¨ `@app.get("/")` æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p>
      <label><input type="radio" name="q5" value="a"> a) ä» `app.py` æ–‡ä»¶è·å–æ•°æ®</label>
      <label><input type="radio" name="q5" value="b"> b) å‘å¤–éƒ¨æœåŠ¡å™¨å‘é€ GET è¯·æ±‚</label>
      <label><input type="radio" name="q5" value="c"> c) å°†å‡½æ•°ä¸æ ¹ URL ä¸Šçš„ GET è¯·æ±‚å…³è”èµ·æ¥</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'c', q4: 'b', q5: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æ— ç­”æ¡ˆã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

æ‚¨å·²æˆåŠŸç»„è£…å¹¶å¯åŠ¨äº†æ–° API çš„â€œè¶…å…‰é€Ÿå¼•æ“â€ï¼ç°åœ¨æ‚¨æ‹¥æœ‰ï¼š

- ğŸ› ï¸ ç‹¬ç«‹çš„å¼€å‘ç¯å¢ƒ (`venv`)
- ğŸš€ å·²å®‰è£… FastAPI å’Œ Uvicorn æœåŠ¡å™¨
- ğŸ›°ï¸ å…·æœ‰ä¸€ä¸ªç«¯ç‚¹çš„æ­£å¸¸è¿è¡Œçš„ API
- ğŸ“Š è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£

**æ‰€æœ‰ç³»ç»Ÿæ­£å¸¸ï¼** åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºç¬¬ä¸€ä¸ªå®Œæ•´çš„ç«¯ç‚¹ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªèˆªå¤©å™¨åˆ—è¡¨ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> - ç»ˆç«¯ä¸­å·²æ¿€æ´»ç¯å¢ƒ `(venv)`
> - Uvicorn æœåŠ¡å™¨å·²æ— é”™è¯¯å¯åŠ¨
> - åœ°å€ `http://127.0.0.1:8000/docs` å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€

> **âš ï¸ å¦‚æœå‡ºç°é”™è¯¯ï¼š**

> - `command not found`ï¼šè¯·ç¡®ä¿æ‚¨å·²æ¿€æ´»è™šæ‹Ÿç¯å¢ƒã€‚
> - `Port ... is already in use`ï¼šå…¶ä»–ç¨‹åºå ç”¨äº† 8000 ç«¯å£ã€‚è¯·åœæ­¢å®ƒæˆ–åœ¨å…¶ä»–ç«¯å£ä¸Šè¿è¡Œ uvicornï¼š`uvicorn main:app --reload --port 8001`ã€‚
> - åœ¨ PowerShell ä¸­æ¿€æ´» `venv` æ—¶å‡ºé”™ï¼šè¯·æ£€æŸ¥è„šæœ¬æ‰§è¡Œç­–ç•¥ã€‚