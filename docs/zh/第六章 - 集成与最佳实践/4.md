# **ç¬¬ 6.4 ç« ï¼šAPI æ–‡æ¡£åŒ–**
**å­¦ä¹ æ—¶é—´ï¼š** 30 åˆ†é’Ÿ

---

#### **1. ä¸ºä»€ä¹ˆéœ€è¦ API æ–‡æ¡£ï¼Ÿ**
æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ‹¿åˆ°ä¸€ä¸ªå¤æ‚å®‡å®™é£èˆ¹çš„æ§åˆ¶å°ï¼Œä¸Šé¢æ²¡æœ‰ä»»ä½•æŒ‰é’®çš„æ ‡ç­¾ã€‚ä½ ä¼šéšæ„æŒ‰ä¸‹å®ƒä»¬ï¼Œå†’ç€å¯åŠ¨å¼¹å°„è€Œéæ‰“å¼€ç¯å…‰çš„é£é™©ã€‚API æ–‡æ¡£æ­£æ˜¯é‚£äº›æ ‡ç­¾å’Œè¯´æ˜ã€‚

**å¥½çš„æ–‡æ¡£ï¼š**

- **èŠ‚çœæ—¶é—´ï¼š** å¼€å‘è€…æ— éœ€çŒœæµ‹å­˜åœ¨å“ªäº›ç«¯ç‚¹ã€å®ƒä»¬æ¥å—ä»€ä¹ˆå‚æ•°ä»¥åŠè¿”å›ä»€ä¹ˆã€‚
- **å‡å°‘é”™è¯¯ï¼š** æ¸…æ™°çš„æ•°æ®æ ¼å¼å’Œé”™è¯¯ä»£ç æè¿°æœ‰åŠ©äºé¿å…ä¸æ­£ç¡®åœ°ä½¿ç”¨ APIã€‚
- **ç®€åŒ–é›†æˆï¼š** å‰ç«¯å›¢é˜Ÿå¯ä»¥ä¸åç«¯å›¢é˜Ÿå¹¶è¡Œå·¥ä½œï¼Œå°†æ–‡æ¡£ä½œä¸ºå¥‘çº¦ã€‚
- **æ˜¯ä½ çš„é—äº§ï¼š** åŠå¹´åå½“ä½ å›åˆ°é¡¹ç›®æ—¶ï¼Œä½ ä¼šæ„Ÿè°¢è‡ªå·±ã€‚

> ğŸ’¡ **å®‡å®™ç±»æ¯”ï¼š**

> - **API** = å¤æ‚çš„ç©ºé—´ç«™ç®¡ç†ç³»ç»Ÿã€‚
> - **API æ–‡æ¡£** = å®‡èˆªå‘˜æ‰‹å†Œã€‚å…¶ä¸­æè¿°äº†ï¼š
>   - å‘é€ä»€ä¹ˆå‘½ä»¤ï¼ˆ`ç«¯ç‚¹`ï¼‰æ¥æ‰“å¼€æ°”é—¸ã€‚
>   - ä¼ é€’ä»€ä¹ˆå‚æ•°ï¼ˆ`è¯·æ±‚ä½“`ï¼‰æ¥é…ç½®ç”Ÿå‘½ç»´æŒç³»ç»Ÿã€‚
>   - æœŸæœ›æ”¶åˆ°ä»€ä¹ˆä¿¡å·ï¼ˆ`API å“åº”`ï¼‰ä½œä¸ºå›åº”ã€‚

---

#### **2. FastAPI ä¸­çš„æ–‡æ¡£ï¼šè‡ªåŠ¨åŒ–é­”æ³•**
FastAPI è®©æ–‡æ¡£åŒ–å˜å¾—å¼‚å¸¸ç®€å•ã€‚å®ƒåˆ©ç”¨ **OpenAPI** å’Œ **Swagger UI** æ ‡å‡†ï¼Œæ ¹æ®ä½ çš„ä»£ç **è‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼æ–‡æ¡£**ã€‚

**æ­¥éª¤ 1ï¼šåœ¨ä½ çš„åº”ç”¨ä¸­æ·»åŠ å…ƒæ•°æ®**

åœ¨ `main.py` ä¸­å¯ä»¥æ·»åŠ å°†å‡ºç°åœ¨æ–‡æ¡£ä¸­çš„æè¿°ã€‚

```python
# main.py
from fastapi import FastAPI
from pydantic import BaseModel, Field

# ... (FastAPI ä»£ç )

app = FastAPI(
    title="SpaceAPI",
    description="""
æ¢ç´¢é“¶æ²³ç³»çš„ APIã€‚ğŸš€

ä½ å°†èƒ½å¤Ÿï¼š
* **æŸ¥çœ‹è¡Œæ˜Ÿ**ã€‚
* **æ·»åŠ æ–°ä¸–ç•Œ**ï¼ˆéœ€è¦èº«ä»½éªŒè¯ï¼‰ã€‚
    """,
    version="1.0.0",
    contact={
        "name": "æ§åˆ¶ä¸­å¿ƒæ€»å·¥ç¨‹å¸ˆ",
        "url": "https://example.com/contact",
        "email": "engineer@example.com",
    },
)
```

**æ­¥éª¤ 2ï¼šæè¿°ä½ çš„æ¨¡å‹å’Œç«¯ç‚¹**

ä½ å¯¹ Pydantic æ¨¡å‹å’Œç«¯ç‚¹å‚æ•°çš„æè¿°è¶Šè¯¦ç»†ï¼Œæ–‡æ¡£å°±è¶Šå¥½ã€‚

```python
# åœ¨ Pydantic æ¨¡å‹æ–‡ä»¶æˆ– main.py ä¸­

class PlanetBase(BaseModel):
    name: str = Field(..., example="åœ°çƒ", description="è¡Œæ˜Ÿåç§°")
    description: str = Field(..., example="ä¸€é¢—æ‹¥æœ‰å¤šæ ·ç”Ÿå‘½çš„è“è‰²æ˜Ÿçƒ", description="ç®€çŸ­æè¿°")
    # ...

class Planet(PlanetBase):
    id: int
    is_habitable: bool

    class Config:
        orm_mode = True # æˆ– Pydantic v2 ä¸­çš„ from_attributes = True

# åœ¨è·¯ç”±æ–‡ä»¶ä¸­
@router.get(
    "/planets",
    response_model=list[Planet],
    summary="è·å–æ‰€æœ‰è¡Œæ˜Ÿåˆ—è¡¨",
    description="è¿”å›æ‰€æœ‰å·²çŸ¥è¡Œæ˜Ÿçš„åˆ—è¡¨ï¼Œï¼ˆæœªæ¥ï¼‰å¸¦åˆ†é¡µã€‚"
)
def get_planets():
    # ...

@router.post(
    "/planets",
    # ...
    summary="åˆ›å»ºæ–°è¡Œæ˜Ÿ",
    responses={
        401: {"description": "ç”¨æˆ·æœªæˆæƒ"},
        422: {"description": "æ•°æ®éªŒè¯é”™è¯¯"}
    }
)
def create_planet(planet: PlanetCreate, ...):
    # ...
```

- `Field(..., example="...")`: åœ¨æ–‡æ¡£ä¸­æ·»åŠ ç¤ºä¾‹ã€‚
- `summary`: ç«¯ç‚¹çš„ç®€è¦æè¿°ã€‚
- `description`: è¯¦ç»†æè¿°ã€‚
- `responses`: æè¿°é™¤æˆåŠŸå“åº”å¤–çš„å¯èƒ½çŠ¶æ€ç ã€‚

**æ­¥éª¤ 3ï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ–‡æ¡£**

å¯åŠ¨ä½ çš„ FastAPI æœåŠ¡å™¨å¹¶æ‰“å¼€ä¸¤ä¸ªç¥å¥‡çš„ URLï¼š

1.  **`http://127.0.0.1:8000/docs`** â€” å°†æ‰“å¼€äº¤äº’å¼ **Swagger UI** æ–‡æ¡£ã€‚ä½ ä¸ä»…å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»ï¼Œè¿˜å¯ä»¥ç›´æ¥ä»æµè§ˆå™¨ä¸­**æµ‹è¯•**ä½ çš„ç«¯ç‚¹ï¼
2.  **`http://127.0.0.1:8000/redoc`** â€” å°†æ‰“å¼€å¦ä¸€ç§æ–‡æ¡£è§†å›¾ **ReDoc**ã€‚å®ƒäº¤äº’æ€§è¾ƒå·®ï¼Œä½†é€šå¸¸æ›´å…·å¯è¯»æ€§ã€‚

---

#### **3. Laravel ä¸­çš„æ–‡æ¡£ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…**

ä¸ FastAPI ä¸åŒï¼ŒLaravel ä¸ä¼šâ€œå¼€ç®±å³ç”¨â€åœ°ç”Ÿæˆæ–‡æ¡£ã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›ä¼˜ç§€çš„åŒ…å¯ä»¥é€šè¿‡åˆ†æä½ çš„ä»£ç æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚æœ€å—æ¬¢è¿çš„æ˜¯ **Scribe**ã€‚

**æ­¥éª¤ 1ï¼šå®‰è£… Scribe**
```bash
composer require --dev "knuckleswtf/scribe"
```
```bash
php artisan vendor:publish --tag=scribe-config
php artisan scribe:generate
```

**æ­¥éª¤ 2ï¼šä½¿ç”¨ DocBlocks æè¿°ç«¯ç‚¹**

Scribe ä¼šè¯»å–ä½ çš„æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ–¹çš„ PHP DocBlocksï¼ˆ`/** ... */` å½¢å¼çš„æ³¨é‡Šï¼‰ã€‚

æ‰“å¼€ `app/Http/Controllers/PlanetController.php`:

```php
// app/Http/Controllers/PlanetController.php

/**
 * @group è¡Œæ˜Ÿ
 * è¡Œæ˜Ÿç®¡ç† API
 */
class PlanetController extends Controller
{
    /**
     * è·å–è¡Œæ˜Ÿåˆ—è¡¨
     *
     * è¿”å›é“¶æ²³ç³»ä¸­æ‰€æœ‰è¡Œæ˜Ÿçš„åˆ†é¡µåˆ—è¡¨ã€‚
     *
     * @unauthenticated
     */
    public function index()
    {
        // ...
    }

    /**
     * åˆ›å»ºæ–°è¡Œæ˜Ÿ
     *
     * @authenticated
     *
     * @bodyParam name string required è¡Œæ˜Ÿåç§°ã€‚Example: Kepler-186f
     * @bodyParam description string required è¡Œæ˜Ÿæè¿°ã€‚
     * @bodyParam size_km integer required ç›´å¾„ï¼ˆå…¬é‡Œï¼‰ã€‚Example: 14000
     * @bodyParam is_habitable boolean è¡Œæ˜Ÿæ˜¯å¦å®œå±…ã€‚Example: true
     *
     * @response 201 {
     *  "id": 4,
     *  "name": "Kepler-186f",
     *  "description": "ç¬¬ä¸€é¢—åœ¨å…¶ä»–æ’æ˜Ÿå®œå±…å¸¦ä¸­ç¡®è®¤çš„åœ°çƒå¤§å°è¡Œæ˜Ÿã€‚",
     *  "size_km": 14000,
     *  "is_habitable": true,
     *  "created_at": "2023-10-27T12:00:00.000000Z",
     *  "updated_at": "2023-10-27T12:00:00.000000Z"
     * }
     */
    public function store(Request $request)
    {
        // ...
    }
    // ... å…¶ä»–æ–¹æ³•ä»¥æ­¤ç±»æ¨
}
```

**Scribe å…³é”®æ ‡ç­¾ï¼š**

- `@group`: å¯¹ç«¯ç‚¹è¿›è¡Œåˆ†ç»„ã€‚
- `@unauthenticated` / `@authenticated`: æŒ‡ç¤ºæ˜¯å¦éœ€è¦ä»¤ç‰Œã€‚
- `@bodyParam`: æè¿°è¯·æ±‚ä½“ä¸­çš„å‚æ•°ã€‚
- `@response`: æˆåŠŸå“åº”çš„ç¤ºä¾‹ã€‚

**æ­¥éª¤ 3ï¼šç”Ÿæˆå’ŒæŸ¥çœ‹æ–‡æ¡£**

æ¯æ¬¡ä¿®æ”¹ DocBlocks åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
php artisan scribe:generate
```
Scribe å°†åˆ›å»ºåŒ…å«ä½ æ–‡æ¡£çš„é™æ€ HTML é¡µé¢ã€‚åœ¨ä»¥ä¸‹åœ°å€æ‰“å¼€å®ƒï¼š**`http://your-app-url/docs`**ã€‚

---

#### **å·©å›ºæµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI æ ¹æ®ä»¥ä¸‹æ ‡å‡†ç”Ÿæˆæ–‡æ¡£ï¼š</p>
      <label><input type="radio" name="q1" value="a"> a) GraphQL</label>
      <label><input type="radio" name="q1" value="b"> b) OpenAPI (Swagger)</label>
      <label><input type="radio" name="q1" value="c"> c) WSDL</label>
    </div>
    <div class="question">
      <p>2. FastAPI ä¸­é»˜è®¤æ‰“å¼€ Swagger UI çš„ URL æ˜¯å“ªä¸ªï¼Ÿ</p>
      <label><input type="radio" name="q2" value="a"> a) /api/docs</label>
      <label><input type="radio" name="q2" value="b"> b) /swagger</label>
      <label><input type="radio" name="q2" value="c"> c) /docs</label>
    </div>
    <div class="question">
      <p>3. Laravel ä¸­ç”¨äºç”Ÿæˆæ–‡æ¡£çš„æµè¡ŒåŒ…æ˜¯ï¼š</p>
      <label><input type="radio" name="q3" value="a"> a) Telescope</label>
      <label><input type="radio" name="q3" value="b"> b) Scribe</label>
      <label><input type="radio" name="q3" value="c"> c) Horizon</label>
    </div>
    <div class="question">
      <p>4. åœ¨ Scribe ä¸­ï¼Œç”¨äºæè¿°è¯·æ±‚ä½“å‚æ•°çš„æ ‡ç­¾æ˜¯ï¼š</p>
      <label><input type="radio" name="q4" value="a"> a) @param</label>
      <label><input type="radio" name="q4" value="b"> b) @bodyParam</label>
      <label><input type="radio" name="q4" value="c"> c) @request</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span>æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æ²¡æœ‰å›ç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>ä½ çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

ä½ å·²ç»åˆ›å»ºäº†ä¸“ä¸šçš„æ–‡æ¡£ï¼Œå°†ä½ çš„ API ä»â€œé»‘ç›’å­â€å˜æˆäº†æ¸…æ™°æ˜“ç”¨çš„å·¥å…·ã€‚

- âœ… ç†è§£äº† API æ–‡æ¡£åŒ–çš„å…³é”®é‡è¦æ€§ã€‚
- ğŸª„ å­¦ä¼šäº†å¦‚ä½•åœ¨ FastAPI ä¸­ä½¿ç”¨è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆã€‚
- âš™ï¸ æŒæ¡äº† Scribe åŒ…åœ¨ Laravel ä¸­è¿›è¡Œ API æ–‡æ¡£åŒ–çš„åŸºç¡€çŸ¥è¯†ã€‚
- ğŸ›°ï¸ ç¡®ä¿¡è‰¯å¥½çš„æ–‡æ¡£æ˜¯ä»»ä½•å¼€å‘è€…çš„æœ€ä½³å¸®æ‰‹ã€‚

**ä½ çš„ API ç°åœ¨ä¸ä»…å¯ä»¥å·¥ä½œå¹¶å—åˆ°ä¿æŠ¤ï¼Œè€Œä¸”å·²å®Œå…¨å‡†å¤‡å¥½ä¾›å›¢é˜Ÿå…¶ä»–æˆå‘˜ä½¿ç”¨ã€‚** å‰©ä¸‹æœ€åä½†æœ€é‡è¦çš„ä¸€æ­¥â€”â€”æœ€ç»ˆå®‰å…¨æ£€æŸ¥ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> - å¯¹äº FastAPIï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `/docs` å¹¶å°è¯•ç›´æ¥ä» Swagger UI ç•Œé¢å¯¹è¡Œæ˜Ÿåˆ—è¡¨æ‰§è¡Œ `GET` è¯·æ±‚ã€‚
> - å¯¹äº Laravelï¼šæ‰§è¡Œ `php artisan scribe:generate` å¹¶æ‰“å¼€ `/docs`ã€‚ç¡®ä¿ç«¯ç‚¹å·²åˆ†ç»„ï¼Œå¹¶ä¸” `store` æ–¹æ³•æœ‰å‚æ•°æè¿°ã€‚