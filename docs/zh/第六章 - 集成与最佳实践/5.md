# **ç¬¬ 6.5 ç« ï¼šAPI å®‰å…¨åŸºç¡€**
**å­¦ä¹ æ—¶é•¿ï¼š** 45 åˆ†é’Ÿ

---

#### **1. API å®‰å…¨ï¼šç©ºé—´ç«™çš„å¤šå±‚é˜²å¾¡**

æƒ³è±¡ä¸€ä¸‹æ‚¨çš„ç©ºé—´ç«™ (API) ä½äºæ•Œå¯¹çš„å¤ªç©ºåŒºåŸŸã€‚ä¸€ä¸ªåŠ›åœºï¼ˆèº«ä»½éªŒè¯ï¼‰æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚æ‚¨éœ€è¦ä¸€ä¸ªç»¼åˆé˜²å¾¡ç³»ç»Ÿï¼š

- **æŠ¤ç›¾ (HTTPS)ï¼š** åŠ å¯†æ‰€æœ‰æµé‡ã€‚
- **å¼‚å¸¸ä¼ æ„Ÿå™¨ (é€Ÿç‡é™åˆ¶)ï¼š** é˜²æ­¢è¿‡äºé¢‘ç¹çš„è¯·æ±‚ã€‚
- **å†…éƒ¨éš”èˆ± (æˆæƒ)ï¼š** åˆ†ç¦»è®¿é—®æƒé™ã€‚
- **è´§ç‰©æ£€æŸ¥ (éªŒè¯)ï¼š** ä¸ä¿¡ä»»ä»»ä½•ä¼ å…¥æ•°æ®ã€‚
- **ç§˜å¯†ä¿é™©ç®± (ç¯å¢ƒå˜é‡)ï¼š** å®‰å…¨å­˜å‚¨å¯†é’¥ã€‚

è®©æˆ‘ä»¬æ¥é…ç½®æ¯ä¸ªå±‚é¢ã€‚

---

#### **2. æŠ¤ç›¾ï¼šå§‹ç»ˆä½¿ç”¨ HTTPS**

**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ** HTTPS (HyperText Transfer Protocol Secure) æ˜¯ HTTP åè®®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒåŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰æ•°æ®ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œä»»ä½•â€œç›‘å¬â€ç½‘ç»œçš„äººï¼ˆä¾‹å¦‚ï¼Œåœ¨å…¬å…± Wi-Fi ä¸­ï¼‰éƒ½å¯ä»¥æ‹¦æˆªç™»å½•ä¿¡æ¯ã€å¯†ç å’Œä»¤ç‰Œã€‚

**å¦‚ä½•å®ç°ï¼Ÿ**

- **åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ â€” å¿…é¡»ã€‚** å°†æ‚¨çš„ API éƒ¨ç½²åˆ°çœŸå®æœåŠ¡å™¨ï¼ˆHerokuã€DigitalOcean ç­‰ï¼‰æ—¶ï¼Œé…ç½® Web æœåŠ¡å™¨ï¼ˆNginxã€Apacheï¼‰ä»¥ä½¿ç”¨ SSL è¯ä¹¦ã€‚**Let's Encrypt** ç­‰æœåŠ¡æä¾›å…è´¹è¯ä¹¦ã€‚
- **åœ¨æœ¬åœ°å¼€å‘ä¸­**ï¼Œè¿™ä¸é‚£ä¹ˆå…³é”®ï¼Œä½†åƒ **Laravel Herd** æˆ– **mkcert** è¿™æ ·çš„å·¥å…·å¯ä»¥è½»æ¾é…ç½®æœ¬åœ° HTTPSã€‚

> ğŸ’¡ **API å®‰å…¨ç¬¬ä¸€æ¡è§„åˆ™ï¼š** **æ²¡æœ‰ HTTPS â€” å°±æ²¡æœ‰å®‰å…¨ã€‚**

---

#### **3. å¼‚å¸¸ä¼ æ„Ÿå™¨ï¼šé€Ÿç‡é™åˆ¶ (Rate Limiting)**

**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ** é˜²æ­¢**æš´åŠ›ç ´è§£æ”»å‡»**ï¼ˆå½“æ”»å‡»è€…è¯•å›¾é€šè¿‡æ¯ç§’å‘é€æ•°åƒä¸ªè¯·æ±‚æ¥çŒœæµ‹å¯†ç æ—¶ï¼‰å’Œ **DoS æ”»å‡»**ï¼ˆå½“æœåŠ¡å™¨è¢«è¯·æ±‚â€œæ·¹æ²¡â€ä»¥ä½¿å…¶åœæ­¢å“åº”æ—¶ï¼‰ã€‚é€Ÿç‡é™åˆ¶é™åˆ¶äº†å•ä¸ªç”¨æˆ·ï¼ˆæˆ– IP åœ°å€ï¼‰åœ¨ç‰¹å®šæ—¶é—´å†…å¯ä»¥å‘å‡ºçš„è¯·æ±‚æ•°é‡ã€‚

**å¦‚ä½•å®ç°ï¼Ÿ**

- **åœ¨ Laravel ä¸­ï¼š** é€Ÿç‡é™åˆ¶çš„ä¸­é—´ä»¶å·²ç»å†…ç½®ï¼
  æ‰“å¼€ `app/Http/Kernel.php` å¹¶æŸ¥çœ‹ `middlewareGroups['api']` é”®ã€‚é‚£é‡Œå·²ç»æœ‰ `'throttle:api'`ã€‚æ­¤é™åˆ¶çš„è®¾ç½®ä½äº `app/Providers/RouteServiceProvider.php` çš„ `configureRateLimiting()` æ–¹æ³•ä¸­ã€‚
  ```php
  // app/Providers/RouteServiceProvider.php
  protected function configureRateLimiting()
  {
      RateLimiter::for('api', function (Request $request) {
          return Limit::perMinute(60)->by($request->user()?->id ?: $request->ip());
      });
  }
  ```
  è¿™æ„å‘³ç€ï¼šæ¯ä¸ªç”¨æˆ·ï¼ˆå¦‚æœå·²æˆæƒï¼‰æˆ–æ¯ä¸ª IP åœ°å€æ¯åˆ†é’Ÿ 60 ä¸ªè¯·æ±‚ã€‚

- **åœ¨ FastAPI ä¸­ï¼š** ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…ï¼Œä¾‹å¦‚ **`slowapi`**ã€‚

  1.  å®‰è£…ï¼š`pip install slowapi`
  2.  åœ¨ `main.py` ä¸­é›†æˆï¼š
      ```python
      # main.py
      from slowapi import Limiter, _rate_limit_exceeded_handler
      from slowapi.util import get_remote_address
      from slowapi.errors import RateLimitExceeded

      limiter = Limiter(key_func=get_remote_address)
      app = FastAPI(...)

      # è¿æ¥é”™è¯¯å¤„ç†å™¨å’Œé™é€Ÿå™¨æœ¬èº«
      app.state.limiter = limiter
      app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

      # åº”ç”¨äºç‰¹å®šçš„ç«¯ç‚¹
      @router.get("/planets")
      @limiter.limit("5/minute") # æ¯åˆ†é’Ÿ 5 ä¸ªè¯·æ±‚
      def get_planets(request: Request):
          # ...
      ```

---

#### **4. å†…éƒ¨éš”èˆ±ï¼šæˆæƒï¼ˆä¸è¦ä¸èº«ä»½éªŒè¯æ··æ·†ï¼ï¼‰**

**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**

- **èº«ä»½éªŒè¯** å›ç­”â€œä½ æ˜¯è°ï¼Ÿâ€è¿™ä¸ªé—®é¢˜ã€‚
- **æˆæƒ** å›ç­”â€œä½ è¢«å…è®¸åšä»€ä¹ˆï¼Ÿâ€è¿™ä¸ªé—®é¢˜ã€‚

ä¾‹å¦‚ï¼Œæ™®é€šç”¨æˆ·å¯ä»¥æŸ¥çœ‹è¡Œæ˜Ÿï¼Œä½†åªæœ‰å…·æœ‰â€œç®¡ç†å‘˜â€è§’è‰²çš„ç”¨æˆ·æ‰èƒ½åˆ é™¤å®ƒä»¬ã€‚

**å¦‚ä½•å®ç°ï¼Ÿ**

- **åœ¨ Laravel ä¸­ï¼š** ä½¿ç”¨ **Policies**ï¼ˆç­–ç•¥ï¼‰æˆ– **Gates**ï¼ˆé—¨ï¼‰ã€‚

  1.  åˆ›å»ºç­–ç•¥ï¼š`php artisan make:policy PlanetPolicy --model=Planet`
  2.  åœ¨ `app/Policies/PlanetPolicy.php` ä¸­æè¿°è§„åˆ™ï¼š
      ```php
      class PlanetPolicy
      {
          // åªå…è®¸ 'admin' è§’è‰²çš„ç”¨æˆ·åˆ é™¤
          public function delete(User $user, Planet $planet): bool
          {
              return $user->role === 'admin';
          }
      }
      ```
  3.  åœ¨æ§åˆ¶å™¨ `PlanetController.php` ä¸­åº”ç”¨ç­–ç•¥ï¼š
      ```php
      public function destroy(Planet $planet)
      {
          // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰åˆ é™¤æƒé™
          $this->authorize('delete', $planet);

          $planet->delete();
          return response()->json(null, 204);
      }
      ```

- **åœ¨ FastAPI ä¸­ï¼š** æˆæƒé€»è¾‘é€šå¸¸æ˜¯æ‰‹åŠ¨åœ¨ç«¯ç‚¹å†…éƒ¨ç¼–å†™ï¼Œä½¿ç”¨ä»ä»¤ç‰Œä¸­è·å–çš„ç”¨æˆ·ä¿¡æ¯ã€‚

  ```python
  # (å‡è®¾ä»¤ç‰Œä¸­æœ‰ 'roles' å­—æ®µ)
  def get_current_active_user(token: str = Depends(oauth2_scheme)):
      # ... è§£ç ä»¤ç‰Œå¹¶ä»æ•°æ®åº“è·å–å¸¦æœ‰è§’è‰²çš„ç”¨æˆ·
      # user = get_user_from_db(username)
      return user # è¿”å›ç”¨æˆ·å¯¹è±¡

  @router.delete("/planets/{planet_id}")
  def delete_planet(
      planet_id: int,
      current_user: User = Depends(get_current_active_user)
  ):
      if "admin" not in current_user.roles:
          raise HTTPException(
              status_code=status.HTTP_403_FORBIDDEN,
              detail="æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œæ­¤æ“ä½œ",
          )
      # ... åˆ é™¤é€»è¾‘ ...
  ```

---

#### **5. è´§ç‰©æ£€æŸ¥å’Œç§˜å¯†ä¿é™©ç®±ï¼šéªŒè¯å’Œç¯å¢ƒå˜é‡**

è¿™ä¸¤ä¸ªç‚¹æˆ‘ä»¬å·²ç»å®ç°è¿‡ï¼Œä½†é‡è¦çš„æ˜¯è¦å¼ºè°ƒå®ƒä»¬åœ¨å®‰å…¨ä¸­çš„ä½œç”¨ã€‚

- **æ°¸è¿œä¸è¦ä¿¡ä»»ä¼ å…¥æ•°æ®ï¼ˆéªŒè¯ï¼‰ï¼š**

  - æˆ‘ä»¬åœ¨ Laravel ä¸­ä½¿ç”¨äº† `$request->validate()`ï¼Œåœ¨ FastAPI ä¸­ä½¿ç”¨äº† Pydantic æ¨¡å‹ã€‚è¿™ä¿æŠ¤æˆ‘ä»¬å…å— **SQL æ³¨å…¥**ï¼ˆåœ¨ä½¿ç”¨ Eloquent/SQLAlchemy æ—¶ï¼‰å’Œå¯èƒ½ç ´ååº”ç”¨ç¨‹åºçš„ä¸æ­£ç¡®æ•°æ®ã€‚**å§‹ç»ˆéªŒè¯æ‰€æœ‰æ¥è‡ªå¤–éƒ¨çš„æ•°æ®ï¼**

- **å°†ç§˜å¯†å­˜å‚¨åœ¨ `.env` ä¸­ï¼ˆç¯å¢ƒå˜é‡ï¼‰ï¼š**

  - æ•°æ®åº“å¯†é’¥ã€JWT çš„å¯†é’¥ (`SECRET_KEY`)ã€ç¬¬ä¸‰æ–¹æœåŠ¡å¯†é’¥ â€” æ‰€æœ‰è¿™äº›**ç»ä¸**åº”è¯¥è¿›å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (Git)ã€‚è¿™å°±æ˜¯ `.env` æ–‡ä»¶çš„ä½œç”¨ï¼Œå®ƒä»¬è¢«æ·»åŠ åˆ° `.gitignore` ä¸­ã€‚

---

#### **å·©å›ºçŸ¥è¯†å°æµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. ä¸ºäº†é˜²æ­¢æ•°æ®åœ¨å…¬å…±ç½‘ç»œä¸­è¢«æ‹¦æˆªï¼Œåº”ä½¿ç”¨ï¼š</p>
      <label><input type="radio" name="q1" value="a"> a) é€Ÿç‡é™åˆ¶</label>
      <label><input type="radio" name="q1" value="b"> b) HTTPS</label>
      <label><input type="radio" name="q1" value="c"> c) CORS</label>
    </div>
    <div class="question">
      <p>2. é€Ÿç‡é™åˆ¶ (Rate Limiting) ä¸»è¦ç”¨äºé˜²å¾¡ï¼š</p>
      <label><input type="radio" name="q2" value="a"> a) SQL æ³¨å…¥</label>
      <label><input type="radio" name="q2" value="b"> b) æš´åŠ›ç ´è§£å’Œ DoS æ”»å‡»</label>
      <label><input type="radio" name="q2" value="c"> c) è·¨ç«™è„šæœ¬ (XSS)</label>
    </div>
    <div class="question">
      <p>3. è§£å†³â€œè¿™ä¸ªç”¨æˆ·è¢«å…è®¸åšä»€ä¹ˆï¼Ÿâ€çš„é—®é¢˜æ˜¯ï¼š</p>
      <label><input type="radio" name="q3" value="a"> a) èº«ä»½éªŒè¯</label>
      <label><input type="radio" name="q3" value="b"> b) æˆæƒ</label>
      <label><input type="radio" name="q3" value="c"> c) éªŒè¯</label>
    </div>
    <div class="question">
      <p>4. API å¯†é’¥å’Œæ•°æ®åº“å¯†ç åº”å­˜å‚¨åœ¨ï¼š</p>
      <label><input type="radio" name="q4" value="a"> a) ä¸ºäº†æ–¹ä¾¿ç›´æ¥å†™åœ¨ä»£ç ä¸­</label>
      <label><input type="radio" name="q4" value="b"> b) åœ¨ GitHub ä¸Šçš„å…¬å…±ä»“åº“ä¸­</label>
      <label><input type="radio" name="q4" value="c"> c) è¢« Git æ’é™¤çš„ `.env` æ–‡ä»¶ä¸­</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆ: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„åˆ†æ•°: ${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ è¯¾ç¨‹å®Œæˆ**
**æ­å–œæ‚¨ï¼ŒæŒ‡æŒ¥å®˜ï¼æ‚¨å·²æˆåŠŸå®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚**

æ‚¨ä»ä¸€ä¸ªåªå¬è¯´è¿‡ API çš„æ–°æ‰‹ï¼Œæˆé•¿ä¸ºä¸€åèƒ½å¤Ÿç‹¬ç«‹è®¾è®¡ã€å¼€å‘ã€ç¼–å†™æ–‡æ¡£ã€ä¿æŠ¤å’Œæµ‹è¯•å®Œæ•´çš„ Web æœåŠ¡å·¥ç¨‹å¸ˆï¼Œå¹¶ä¸”æŒæ¡äº†å…¶ç”Ÿæ€ç³»ç»Ÿä¸­æœ€æµè¡Œçš„ä¸¤ç§æŠ€æœ¯ã€‚

æ‚¨æŒæ¡äº†é€šç”¨çš„ REST è¯­è¨€ï¼Œå­¦ä¼šäº† Laravel å’Œ FastAPIï¼Œå¹¶ç”¨çº¯ JavaScript ä¸ºå®ƒä»¬æ„å»ºäº†ä¸€ä¸ªâ€œé£è¡Œæ§åˆ¶ä¸­å¿ƒâ€ã€‚

**è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆå°±ã€‚** API å¼€å‘çš„ä¸–ç•Œç°åœ¨å‘æ‚¨æ•å¼€ã€‚ç»§ç»­æ¢ç´¢ã€å­¦ä¹ å¹¶æ„å»ºä»¤äººæƒŠå¹çš„äº‹ç‰©ã€‚

**é€šè®¯ç»“æŸã€‚** ğŸš€
---
<h2>â˜„ æ”¯æŒæˆ‘ä»¬çš„ä»»åŠ¡</h2>
<p>åˆ›å»ºæœ¬æ•™ç¨‹æ˜¯ä¸€æ¬¡æ¼«é•¿è€Œå¤æ‚çš„é£è¡Œï¼Œéœ€è¦å¤§é‡æ—¶é—´å’Œç²¾åŠ›ã€‚å¦‚æœè¿™äº›ææ–™å¯¹æ‚¨æœ‰ç”¨ï¼Œæ‚¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¡¥å……è¿œå¾é˜Ÿçš„ç‡ƒæ–™ç®±ã€‚
æ¯ä¸€æ¬¡æ”¯æŒéƒ½æ˜¯æˆ‘ä»¬è¿ˆå‘æ–°æœ‰ç”¨ææ–™çš„åˆä¸€ä¸ªè½¨é“ã€‚
</p>
<a href='https://ko-fi.com/K3K41JFJ32' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi4.png?v=6' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>