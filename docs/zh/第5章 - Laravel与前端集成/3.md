# **ç¬¬ 5.3 ç« ï¼šåœ¨ Laravel è§†å›¾ä¸­åµŒå…¥ JavaScript**
**å­¦ä¹ æ—¶é—´ï¼š** 50 åˆ†é’Ÿ

---

### **1. Web ä¸­ JavaScript çš„ä¸¤ç§æ–¹æ³•**
è¿„ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ **æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR)** â€” æœåŠ¡å™¨ (Laravel) ç”Ÿæˆå®Œæ•´çš„ HTMLï¼ˆé€šè¿‡ Bladeï¼‰å¹¶å°†å…¶å‘é€åˆ°æµè§ˆå™¨ã€‚è¿™å¯¹äº SEO å’Œå¿«é€Ÿé¦–æ¬¡åŠ è½½éå¸¸æœ‰åˆ©ã€‚

ç°åœ¨æˆ‘ä»¬å°†æ·»åŠ **å®¢æˆ·ç«¯äº¤äº’**â€”â€”æµè§ˆå™¨åœ¨åŠ è½½é¡µé¢åå°†æ‰§è¡Œ JavaScript ä»£ç æ¥å®Œæˆä»¥ä¸‹æ“ä½œï¼š

-   æ— éœ€é‡æ–°åŠ è½½é¡µé¢å³å¯å‘æˆ‘ä»¬çš„ API å‘é€è¯·æ±‚ã€‚
-   åŠ¨æ€æ›´æ–°é¡µé¢éƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œå‘åˆ—è¡¨ä¸­æ·»åŠ æ–°è¡Œæ˜Ÿï¼‰ã€‚
-   æ˜¾ç¤ºé€šçŸ¥å’Œæ¨¡æ€çª—å£ã€‚

> ğŸ’¡ **å®‡å®™ç±»æ¯”ï¼š**

> æƒ³è±¡ä¸€ä¸‹ï¼Œ**SSR** å°±åƒåœ¨ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒ (æœåŠ¡å™¨) è·å–æ‰“å°å‡ºæ¥çš„å®Œæ•´æ˜Ÿç³»å›¾ã€‚æ‚¨å¯ä»¥çœ‹åˆ°æ‰“å°æ—¶çš„æ‰€æœ‰å¯¹è±¡ã€‚

> **å®¢æˆ·ç«¯ JS** å°±åƒæ‚¨çš„ä¸ªäººå¹³æ¿ç”µè„‘ (æµè§ˆå™¨)ï¼Œå®ƒå®æ—¶ä¸å«æ˜Ÿ (API) é€šä¿¡å¹¶æ›´æ–°æ‚¨åœ°å›¾ä¸Šå¯¹è±¡çš„ä½ç½®ï¼Œè€Œæ— éœ€å‘ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒè¯·æ±‚æ–°çš„çº¸è´¨åœ°å›¾ã€‚

---

### **2. JS ä»£ç çš„å­˜å‚¨ä½ç½®å’Œå¼•å…¥æ–¹å¼**
å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œæ‰€æœ‰å…¬å…±èµ„æºï¼ˆCSSã€JSã€å›¾åƒï¼‰éƒ½åº”ä½äº `public` æ–‡ä»¶å¤¹ä¸­ã€‚

**æ­£ç¡®ç»“æ„ï¼š**

1.  **æºæ–‡ä»¶ï¼š** æ‚¨æ‰€æœ‰çš„ä¸»è¦ JS ä»£ç éƒ½åº”ä½äº `public/js/` ä¸­ã€‚ä¾‹å¦‚ï¼Œ`public/js/planets.js`ã€‚
2.  **Blade ä¸­å¼•å…¥ï¼š** ä½¿ç”¨ `asset()` è¾…åŠ©å‡½æ•°ç”Ÿæˆæ­£ç¡®çš„ URLã€‚

**åœ¨ `layouts/app.blade.php` å¸ƒå±€ä¸­å¼•å…¥çš„ç¤ºä¾‹ï¼š**
```blade
<!DOCTYPE html>
<html>
<head>
    {{-- ... --}}
</head>
<body>
    {{-- ... å¤´éƒ¨å’Œä¸»ä½“ ... --}}

    <footer>
        <p>&copy; {{ date('Y') }} Space Command.</p>
    </footer>

    {{-- è„šæœ¬æœ€å¥½æ”¾åœ¨ body æ ‡ç­¾çš„æœ«å°¾ï¼Œä»¥åŠ å¿«é¡µé¢æ¸²æŸ“é€Ÿåº¦ --}}
    <script src="{{ asset('js/planets.js') }}"></script>
    @stack('scripts') {{-- ä¸ºç‰¹å®šé¡µé¢çš„è„šæœ¬åˆ›å»ºä¸€ä¸ªâ€œæ§½ä½â€ --}}
</body>
</html>
```

-   `@stack('scripts')` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Blade æŒ‡ä»¤ã€‚å®ƒå…è®¸å­è§†å›¾å°†è‡ªå·±çš„ JS ä»£ç â€œæ¨å…¥â€åˆ°è¿™ä¸ªä½ç½®ã€‚è¿™åœ¨æŸä¸ªé¡µé¢éœ€è¦ç‹¬ç‰¹è„šæœ¬è€Œå¦ä¸€ä¸ªé¡µé¢ä¸éœ€è¦æ—¶éå¸¸æœ‰ç”¨ã€‚

---

### **3. ç¤ºä¾‹ï¼šâ€œåˆ é™¤â€ç¡®è®¤æŒ‰é’®**
è®©æˆ‘ä»¬åœ¨è¡Œæ˜Ÿåˆ—è¡¨é¡µé¢ (`planets/index.blade.php`) ä¸Šä¸ºæ¯ä¸ªè¡Œæ˜Ÿæ·»åŠ ä¸€ä¸ªâ€œåˆ é™¤â€æŒ‰é’®ï¼Œè¯¥æŒ‰é’®å°†é€šè¿‡ JavaScript å’Œ Fetch API å·¥ä½œã€‚

**æ­¥éª¤ 1ï¼šåœ¨ `resources/views/planets/index.blade.php` ä¸­æ·»åŠ æŒ‰é’®**

ä¿®æ”¹è¡Œæ˜Ÿå¡ç‰‡ï¼Œæ·»åŠ å¸¦æœ‰ data å±æ€§çš„æŒ‰é’®ï¼š
```html
{{-- ... åœ¨ @forelse å¾ªç¯å†…éƒ¨ ... --}}
<div class="planet-card" id="planet-card-{{ $planet->id }}">
    <h3>{{ $planet->name }}</h3>
    <p>å¤ªé˜³ç³»ï¼š{{ $planet->solar_system }}</p>
    <p>ç›´å¾„ï¼š{{ number_format($planet->size_km, 0, '.', ' ') }} å…¬é‡Œ</p>
    <a href="/planets/{{ $planet->id }}">äº†è§£æ›´å¤š &rarr;</a>
    <button class="delete-btn" data-id="{{ $planet->id }}" data-url="/api/planets/{{ $planet->id }}">
        æŠ¥åºŸ
    </button>
</div>
<!-- ... åœ¨ body ç»“æŸæ ‡ç­¾ä¹‹å‰ ... -->
<script src="{{ asset('js/planets.js') }}" defer></script>
```

-   `id="planet-card-{{ $planet->id }}"` â€” æ•´ä¸ªå¡ç‰‡çš„å”¯ä¸€ IDï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨ DOM ä¸­å°†å…¶åˆ é™¤ã€‚
-   `data-id` å’Œ `data-url` â€” å°†æ•°æ®ä» PHP (Blade) ä¼ é€’åˆ° JavaScript çš„ä¾¿æ·æ–¹å¼ã€‚

**æ­¥éª¤ 2ï¼šç¼–å†™ JavaScript é€»è¾‘**

åˆ›å»ºæ–‡ä»¶ `public/js/planets.js` å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
```javascript
document.addEventListener('DOMContentLoaded', () => {
    // æŸ¥æ‰¾æ‰€æœ‰â€œåˆ é™¤â€æŒ‰é’®
    const deleteButtons = document.querySelectorAll('.delete-btn');

    deleteButtons.forEach(button => {
        button.addEventListener('click', async (event) => {
            const planetId = event.target.dataset.id;
            const apiUrl = event.target.dataset.url;

            if (!confirm(`æ‚¨ç¡®å®šè¦æŠ¥åºŸ ID ä¸º ${planetId} çš„è¡Œæ˜Ÿå—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ã€‚`)) {
                return; // ç”¨æˆ·ç‚¹å‡»äº†â€œå–æ¶ˆâ€
            }

            try {
                // å‘æˆ‘ä»¬çš„ API å‘é€ DELETE è¯·æ±‚
                const response = await fetch(apiUrl, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json',
                        // ç¨åæˆ‘ä»¬å°†åœ¨æ­¤å¤„æ·»åŠ  CSRF ä»¤ç‰Œ
                    }
                });

                if (response.status === 204) { // 204 æ— å†…å®¹ - æˆåŠŸåˆ é™¤
                    // ä»é¡µé¢ä¸­ç§»é™¤è¡Œæ˜Ÿå¡ç‰‡
                    const cardToRemove = document.getElementById(`planet-card-${planetId}`);
                    if (cardToRemove) {
                        cardToRemove.remove();
                    }
                    alert('è¡Œæ˜Ÿå·²æˆåŠŸæŠ¥åºŸã€‚');
                } else {
                    // å¦‚æœ API è¿”å›é”™è¯¯
                    const errorData = await response.json();
                    alert(`é”™è¯¯ï¼š${errorData.message || 'æœªèƒ½åˆ é™¤è¡Œæ˜Ÿã€‚'}`);
                }
            } catch (error) {
                console.error('å‘é€è¯·æ±‚æ—¶å‡ºé”™ï¼š', error);
                alert('å‘ç”Ÿç½‘ç»œé”™è¯¯ã€‚è¯·é‡è¯•ã€‚');
            }
        });
    });
});
```

ç°åœ¨ï¼Œå¦‚æœæ‚¨åˆ·æ–° `/planets` é¡µé¢ï¼Œæ‚¨å°†çœ‹åˆ°â€œæŠ¥åºŸâ€æŒ‰é’®ï¼Œç‚¹å‡»å®ƒä»¬å°†è§¦å‘æˆ‘ä»¬çš„ JavaScript ä»£ç ï¼

---

### **4. ä» Blade å‘ JavaScript ä¼ é€’æ•°æ®**
æœ‰æ—¶éœ€è¦å‘ JS ä¼ é€’çš„ä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ•´ä¸ªæ•°ç»„æˆ–å¯¹è±¡ã€‚

**é”™è¯¯çš„æ–¹æ³•ï¼ˆæ˜“å—æ”»å‡»ï¼‰ï¼š**
```javascript
let planets = {{ $planets }}; // è¿™å°†å¯¼è‡´è¯­æ³•é”™è¯¯ä¸”ä¸å®‰å…¨
```

**æ­£ç¡®çš„æ–¹æ³•ï¼ˆé€šè¿‡ JSONï¼‰ï¼š**
ä½¿ç”¨ `@json` æŒ‡ä»¤ã€‚å®ƒèƒ½å®‰å…¨åœ°å°† PHP æ•°ç»„/å¯¹è±¡è½¬æ¢ä¸ºæœ‰æ•ˆçš„ JSON å¯¹è±¡ã€‚

**åœ¨ `planets/index.blade.php` ä¸­çš„ç¤ºä¾‹ï¼š**
```blade
@extends('layouts.app')
{{-- ... --}}
@section('content')
    {{-- ... --}}
@endsection

@push('scripts') {{-- å°†æˆ‘ä»¬çš„è„šæœ¬â€œæ¨å…¥â€å¸ƒå±€ä¸­çš„ @stack('scripts') æ§½ä½ --}}
<script>
    // Laravel å®‰å…¨åœ°å°† $planets é›†åˆè½¬æ¢ä¸º JSON æ•°ç»„
    const planetsData = @json($planets);

    // ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ JS ä¸­ä½¿ç”¨è¿™ä¸ªæ•°ç»„äº†
    console.log('ä» Blade ä¼ é€’çš„è¡Œæ˜Ÿæ•°æ®ï¼š', planetsData);
    alert(`å·²åŠ è½½ ${planetsData.length} é¢—è¡Œæ˜Ÿï¼`);
</script>
@endpush
```

-   `@push('scripts')` å°†å†…å®¹æ”¾å…¥ `layouts/app.blade.php` ä¸­çš„ `@stack('scripts')` å†…éƒ¨ã€‚è¿™å…è®¸ä»…åœ¨çœŸæ­£éœ€è¦è„šæœ¬çš„é¡µé¢ä¸Šæ·»åŠ å®ƒä»¬ã€‚

---

### **å·©å›ºçŸ¥è¯†å°æµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. åœ¨ Laravel é¡¹ç›®ä¸­ï¼Œå…¬å…± JS å’Œ CSS æ–‡ä»¶åº”è¯¥å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ</p>
      <label><input type="radio" name="q1" value="a"> a) resources/js</label>
      <label><input type="radio" name="q1" value="b"> b) storage/app/public</label>
      <label><input type="radio" name="q1" value="c"> c) public/</label>
    </div>
    <div class="question">
      <p>2. å“ªä¸ª Blade è¾…åŠ©å‡½æ•°ç”¨äºæ­£ç¡®ç”Ÿæˆèµ„äº§ï¼ˆJSã€CSSï¼‰çš„ URLï¼Ÿ</p>
      <label><input type="radio" name="q2" value="a"> a) url()</label>
      <label><input type="radio" name="q2" value="b"> b) asset()</label>
      <label><input type="radio" name="q2" value="c"> c) public_path()</label>
    </div>
    <div class="question">
      <p>3. `@push('scripts')` / `@stack('scripts')` è¿™å¯¹æŒ‡ä»¤æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
      <label><input type="radio" name="q3" value="a"> a) å…è®¸å­è§†å›¾å°†è‡ªå·±çš„ JS ä»£ç æ·»åŠ åˆ°çˆ¶å¸ƒå±€ä¸­çš„ç‰¹å®šä½ç½®</label>
      <label><input type="radio" name="q3" value="b"> b) å°†æ‰€æœ‰ JS æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ª</label>
      <label><input type="radio" name="q3" value="c"> c) å°† JS ä»£ç å‘é€åˆ°æœåŠ¡å™¨</label>
    </div>
    <div class="question">
      <p>4. å¦‚ä½•å®‰å…¨åœ°å°† PHP æ•°ç»„ `$data` ä» Blade ä¼ é€’åˆ° JavaScriptï¼Ÿ</p>
      <label><input type="radio" name="q4" value="a"> a) let jsData = {{ $data }};</label>
      <label><input type="radio" name="q4" value="b"> b) let jsData = '@php echo json_encode($data); @endphp';</label>
      <label><input type="radio" name="q4" value="c"> c) let jsData = @json($data);</label>
    </div>
    <div class="question">
      <p>5. ä¸ºä»€ä¹ˆå»ºè®®å°† JS è„šæœ¬æ”¾åœ¨ body æ ‡ç­¾çš„æœ«å°¾å¼•å…¥ï¼Ÿ</p>
      <label><input type="radio" name="q5" value="a"> a) ä¸ºäº†é¿å…å®ƒä»¬é˜»å¡é¡µé¢ä¸»è¦ HTML å†…å®¹çš„æ¸²æŸ“</label>
      <label><input type="radio" name="q5" value="b"> b) è¿™æ˜¯ HTML5 æ ‡å‡†çš„è¦æ±‚</label>
      <label><input type="radio" name="q5" value="c"> c) è¿™æ ·è„šæœ¬æ‰§è¡Œå¾—æ›´å¿«</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'c', q2: 'b', q3: 'a', q4: 'c', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

æ‚¨å·²å­¦ä¼šé€šè¿‡æ·»åŠ å®¢æˆ·ç«¯é€»è¾‘æ¥ä¸ºé™æ€ Blade é¡µé¢æ³¨å…¥æ´»åŠ›ã€‚å…³é”®æŠ€èƒ½åŒ…æ‹¬ï¼š

-   åœ¨ Laravel é¡¹ç›®ä¸­æ­£ç¡®ç»„ç»‡å’Œå¼•å…¥ JS æ–‡ä»¶ã€‚
-   ä½¿ç”¨ `data-*` å±æ€§å°†æ•°æ®ä» HTML ä¼ é€’åˆ° JSã€‚
-   ä½¿ç”¨ Fetch åŠ¨æ€ä¸ API äº¤äº’ï¼Œæ— éœ€é‡æ–°åŠ è½½é¡µé¢ã€‚
-   ä½¿ç”¨ `@json` æŒ‡ä»¤å®‰å…¨åœ°å°† PHP å˜é‡ä¼ é€’ç»™ JavaScriptã€‚
-   ä½¿ç”¨ `@push` å’Œ `@stack` æ¥ç»„ç»‡è„šæœ¬ã€‚
**æ‚¨çš„"æ§åˆ¶é¢æ¿"å˜å¾—å¯äº¤äº’äº†ã€‚**ç„¶è€Œï¼Œç›®å‰æˆ‘ä»¬çš„ä¿®æ”¹è¯·æ±‚ï¼ˆPOSTã€PUTã€DELETEï¼‰å­˜åœ¨æ¼æ´ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªè‡³å…³é‡è¦çš„ä¿æŠ¤æœºåˆ¶â€”â€”CSRF ä»¤ç‰Œã€‚