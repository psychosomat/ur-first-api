# **第1.5章：通过Postman测试API**
**学习时间：** 50分钟

---

#### **1. 为什么测试API？发射前检查**
想象一下：在火箭发射前，工程师们会进行**系统测试启动**。如果跳过检查，任务可能会失败！

**API测试**是您的控制测试：

- ✅ 检查“对接节点”的功能

- 🛡️ 在实际使用前发现漏洞

- 📊 确保数据传输无失真

> 💡 **太空类比：**
> Postman就像一个任务控制中心（ЦУП）的测试控制台，用于模拟所有场景：“如果请求一个不存在的星球数据会怎样？服务器能承受1000次请求/秒吗？”

---

#### **2. Postman：“API飞行控制中心”**
**功能：**

- 📡 发送任何HTTP请求（GET, POST, PUT, DELETE）

- 🔍 分析响应（状态码、请求头、JSON正文）

- 🧪 编写自动化测试（JavaScript）

- 🌐 使用环境变量（测试环境 vs 生产环境）

[👉 下载Postman](https://www.postman.com/downloads/)

---

#### **3. 首次启动：测试行星API**
**步骤1：创建请求**

1. 打开Postman → New → Request

2. 输入URL：`https://api.spacexdata.com/v4/rockets`

3. 选择方法：**GET**

**步骤2：发送“信号”**
```bash
[任务控制中心] -- GET /planets --> [SpaceX服务器]
```

**步骤3：分析遥测数据：**
- 状态：`200 OK`
- 响应正文（JSON）：包含参数的火箭列表
```json
[
  {
    "name": "Falcon 1",
    "type": "rocket",
    "active": false,
    "stages": 2,
    "id": "5e9d0d95eda69955f709d1eb"
  },
  {
    "name": "Falcon 9",
    "type": "rocket",
    "active": true,
    "id": "5e9d0d95eda69973a809d1ec"
  }
]
```

---

#### **4. 结构图：Postman组件**
```
[工作区]
├── “Params”标签页（查询参数）
├── “Headers”标签页（请求头）
├── “Body”标签页（POST/PUT请求体）
├── “Tests”标签页（用于检查的脚本）
└── 响应面板（状态、时间、大小、正文）
```

---

#### **5. 创建复杂场景：启动任务**
**测试：将新行星添加到目录**

1. 方法：**POST**

2. URL：`https://jsonplaceholder.typicode.com/posts` (示例)

3. 在Headers中：
   ```json
	{ "Content-Type": "application/json" }
   ```
4. 在Body中 (raw → JSON)：
   ```json
   {
	"title": "New Exoplanet Found",
	"body": "Proxima Centauri b shows signs of a stable atmosphere.",
	"userId": 1
	}
   ```

**在Tests中进行自动化检查：**
```javascript
// 检查状态
pm.test("Post created successfully", () => {
    pm.response.to.have.status(201);
});

// 检查响应的结构和数据
pm.test("Response contains the new post data", () => {
    const response = pm.response.json();
    pm.expect(response).to.have.property("id"); // 检查服务器是否分配了ID
    pm.expect(response.title).to.eql("New Exoplanet Found");
});
```

---

#### **6. 环境变量：地球 vs 火星**

如何在不同服务器（测试/生产）上进行测试？

1. 创建环境：
   - `Local` → `http://localhost:3000`
   - `Production` → `https://api.nasa.gov`

2. 在请求中使用变量：
   ```bash
   {{base_url}}/planets  # 替换为当前URL
   ```

> ⚠️ **重要！** 切勿在生产服务器上测试`DELETE`操作！

---

#### **7. 集合：宇宙任务库**
分组请求：
```
	📂 “NASA”集合
  	├── GET 行星
  	├── POST 新行星
  	└── DELETE 行星（测试模式）
```
**优势：**

- 🚀 一键运行所有测试
- 📤 导出/导入配置
- 👨‍🚀 团队协作

---

#### **8. 自动化：定期卫星检查**

通过Postman配置**API监控**：

1. Schedule → 每2小时

2. 测试：
   ```javascript
   pm.test("卫星在线", () => {
     pm.response.to.have.status(200);
     pm.expect(pm.response.json().signal).above(50); // 信号 >50%
   });
   ```

3. 发生故障时在Slack/电子邮件中通知

---

#### **巩固测验**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Postman用于：</p>
      <label><input type="radio" name="q1" value="a"> a) 发送邮件</label>
      <label><input type="radio" name="q1" value="b"> b) 测试API</label>
      <label><input type="radio" name="q1" value="c"> c) 创建数据库</label>
    </div>
    <div class="question">
      <p>2. 成功创建对象时应预期哪个状态？</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 201 Created</label>
      <label><input type="radio" name="q2" value="c"> c) 404 Not Found</label>
    </div>
    <div class="question">
      <p>3. 在Postman中哪里编写自动化测试？</p>
      <label><input type="radio" name="q3" value="a"> a) “Body”标签页</label>
      <label><input type="radio" name="q3" value="b"> b) “Tests”标签页</label>
      <label><input type="radio" name="q3" value="c"> c) “Cookies”标签页</label>
    </div>
    <div class="question">
      <p>4. 环境变量的用途是：</p>
      <label><input type="radio" name="q4" value="a"> a) 在测试和生产服务器之间切换</label>
      <label><input type="radio" name="q4" value="b"> b) 以明文形式存储密码</label>
      <label><input type="radio" name="q4" value="c"> c) 生成随机数据</label>
    </div>
    <div class="question">
      <p>5. 定期监控检查什么？</p>
      <label><input type="radio" name="q5" value="a"> a) API的稳定性</label>
      <label><input type="radio" name="q5" value="b"> b) 互联网速度</label>
      <label><input type="radio" name="q5" value="c"> c) 文档的及时性</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">检查</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'a', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>结果：</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>问题 ${question.slice(1)}: <span style="color:green;">正确！</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>问题 ${question.slice(1)}: <span style="color:red;">错误。</span>正确答案：<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>问题 ${question.slice(1)}: <span style="color:orange;">没有答案。</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>您的得分：${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**🚀 本章总结：**
Postman是您进行API测试的通用“控制台”。有了它，您可以：
- 在启动前检查“机载系统”的运行情况
- 创建测试场景库
- 自动化宇宙服务的监控

> **📌 实践任务：**

> 1. 安装Postman
> 2. 创建一个到SpaceX API的请求：`GET https://api.spacexdata.com/v4/launches/latest`
> 3. 编写一个测试，检查：
>    - 响应状态为`200`
>    - `name`字段中包含单词“Falcon”
>    - 响应时间 < 500毫秒

**恭喜您完成第1章！**

您已经掌握了API的基本操作。在接下来的章节中，我们将构建自己的“宇宙飞船”——一个使用宇宙API的Web应用程序！

> **🌌 额外资源：**

> - [SpaceX API Documentation](https://docs.spacexdata.com/)