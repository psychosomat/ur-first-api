# **ç¬¬2.6ç« ï¼šæ•°æ®éªŒè¯**
**å­¦ä¹ æ—¶é—´ï¼š** 50 åˆ†é’Ÿ

---

#### **1. éªŒè¯ï¼šå®‡å®™çº§é˜²æŠ¤ç›¾**
**éªŒè¯**æ˜¯æŒ‡æ£€æŸ¥ä¼ å…¥æ•°æ®æ˜¯å¦ç¬¦åˆè§„åˆ™ã€‚æ²¡æœ‰å®ƒï¼š

- ğŸš€ ä¸æ­£ç¡®çš„æ•°æ®å¯èƒ½ä¼šâ€œç ´åâ€ä½ çš„æ•°æ®åº“
- ğŸŒŒ æ¶æ„æ”»å‡»è€…å¯èƒ½ä¼šæ³¨å…¥æ¶æ„ä»£ç 
- ğŸª ç”¨æˆ·ä¼šæ”¶åˆ°éš¾ä»¥ç†è§£çš„é”™è¯¯

> ğŸ’¡ **å®‡å®™ç±»æ¯”ï¼š**
> éªŒè¯ = ç©ºé—´ç«™é˜²å¾¡ç³»ç»Ÿï¼š

> - åœ¨å¯¹æ¥å‰æ£€æŸ¥â€œè´§ç‰©â€ï¼ˆæ•°æ®ï¼‰
> - æ‹’ç»å±é™©ç‰©ä½“
> - è¿‡æ»¤å¤ªç©ºç¢ç‰‡

---

#### **2. åœ¨ Laravel API ä¸­ä½•å¤„è¿›è¡ŒéªŒè¯**
ä¸»è¦æ–¹æ³•ï¼š

1. **åœ¨æ§åˆ¶å™¨ä¸­** (å¿«æ·ï¼Œä½†ä¼šä½¿ä»£ç è‡ƒè‚¿)
2. **è¡¨å•è¯·æ±‚ (Form Request)** (æ¨èï¼Œæ¶æ„æ¸…æ™°)

---

#### **3. åœ¨æ§åˆ¶å™¨ä¸­è¿›è¡ŒéªŒè¯**
ä½¿ç”¨ Request å¯¹è±¡çš„ `validate()` æ–¹æ³•ï¼š
```php
<?php
public function store(Request $request)
{
    $validated = $request->validate([
        'name' => 'required|string|max:255|unique:planets',
        'description' => 'required|string',
        'size_km' => 'required|integer|min:100|max:500000',
        'solar_system' => 'required|string|max:100',
        'image_url' => 'nullable|url|max:2048',
        'is_habitable' => 'boolean'
    ]);

    // ... åˆ›å»ºæ˜Ÿçƒ
}
```

**å¸¸ç”¨éªŒè¯è§„åˆ™ï¼š**

| è§„åˆ™                 | æè¿°                      | ç¤ºä¾‹                     |
|----------------------|---------------------------|--------------------------|
| `required`           | å¿…å¡«å­—æ®µ                  | `'name' => 'required'`   |
| `string`             | å­—ç¬¦ä¸²å€¼                  | `'description' => 'string'`|
| `integer`            | æ•´æ•°                      | `'size_km' => 'integer'` |
| `min:value`          | æœ€å°å€¼/æœ€å°é•¿åº¦           | `'size_km' => 'min:100'` |
| `max:value`          | æœ€å¤§å€¼/æœ€å¤§é•¿åº¦           | `'name' => 'max:255'`    |
| `unique:table,column`| è¡¨ä¸­å”¯ä¸€æ€§                | `'name' => 'unique:planets'` |
| `url`                | æœ‰æ•ˆ URL                  | `'image_url' => 'url'`   |
| `boolean`            | true/false/1/0            | `'is_habitable' => 'boolean'` |

---

#### **4. è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯**
ä¿®æ”¹é»˜è®¤çš„é”™è¯¯æ–‡æœ¬ï¼š
```php
<?php
$validated = $request->validate(
    [
        'name' => 'required|unique:planets',
        'size_km' => 'min:1000'
    ],
    [
        'name.required' => 'æ˜Ÿçƒåç§°æ˜¯å¿…å¡«çš„ï¼',
        'name.unique' => 'ç›®å½•ä¸­å·²å­˜åœ¨åŒåæ˜Ÿçƒ',
        'size_km.min' => 'æ˜Ÿçƒç›´å¾„ä¸èƒ½å°äº 1000 å…¬é‡Œ'
    ]
);
```

**é”™è¯¯å“åº”ç¤ºä¾‹ (è‡ªåŠ¨è¿”å› 422 Unprocessable Entity)ï¼š**
```json
{
    "message": "The given data was invalid.",
    "errors": {
        "name": ["ç›®å½•ä¸­å·²å­˜åœ¨åŒåæ˜Ÿçƒ"],
        "size_km": ["æ˜Ÿçƒç›´å¾„ä¸èƒ½å°äº 1000 å…¬é‡Œ"]
    }
}
```

---

#### **5. åˆ›å»ºè¡¨å•è¯·æ±‚ (Form Request)**
å¯¹äºå¤æ‚çš„éªŒè¯ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç±»ï¼š

**æ­¥éª¤ 1ï¼šç”Ÿæˆ**
```bash
php artisan make:request StorePlanetRequest
```

**æ­¥éª¤ 2ï¼šç¼–è¾‘ `app/Http/Requests/StorePlanetRequest.php`**
```php
<?php
public function authorize()
{
    return true; // å¯¹äº API é€šå¸¸ä¸º true
}

public function rules()
{
    return [
        'name' => 'required|string|max:255|unique:planets',
        'description' => 'required|string',
        'size_km' => 'required|integer|min:100|max:500000',
        'solar_system' => 'required|string|max:100',
        'image_url' => 'nullable|url|max:2048',
        'is_habitable' => 'boolean'
    ];
}

public function messages()
{
    return [
        'name.unique' => 'åŒåæ˜Ÿçƒå·²å­˜åœ¨ï¼',
        'size_km.min' => 'ç›´å¾„ä¸èƒ½å°äº 100 å…¬é‡Œ'
    ];
}
```

**æ­¥éª¤ 3ï¼šåœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨**
```php
<?php
use App\Http\Requests\StorePlanetRequest;

public function store(StorePlanetRequest $request)
{
    // æ•°æ®å·²éªŒè¯ï¼
    $validated = $request->validated();
    $planet = Planet::create($validated);
    return response()->json($planet, 201);
}
```

---

#### **6. è‡ªå®šä¹‰éªŒè¯è§„åˆ™**
æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè§„åˆ™æ¥æ£€æŸ¥æ˜Ÿçƒåç§°çš„â€œåˆç†æ€§â€ã€‚Laravel çš„æ ‡å‡†è§„åˆ™æ— æ³•æ£€æŸ¥åç§°æ˜¯å¦è¢«â€œç¦æ­¢â€ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ç¼–å†™è‡ªå·±çš„é€»è¾‘ã€‚

**æ­¥éª¤ 1ï¼šç”Ÿæˆè§„åˆ™**

Laravel æä¾›äº†ä¸€ä¸ª Artisan å‘½ä»¤æ¥åˆ›å»ºè§„åˆ™ç±»çš„â€œéª¨æ¶â€ã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œå®ƒï¼š

```bash
php artisan make:rule ValidPlanetName
```

**æ­¥éª¤ 2ï¼šç¼–è¾‘ `app/Rules/ValidPlanetName.php`**

æ‰“å¼€åˆ›å»ºçš„æ–‡ä»¶ã€‚å…¶ç»“æ„ç®€å•æ˜äº†ã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åœ¨ `validate` æ–¹æ³•å†…éƒ¨å®ç°é€»è¾‘ã€‚

```php
<?php

namespace App\Rules;

use Closure;
use Illuminate\Contracts\Validation\ValidationRule;

class ValidPlanetName implements ValidationRule
{
    /**
     * è¿è¡ŒéªŒè¯è§„åˆ™ã€‚
     *
     * @param  \Closure(string): \Illuminate\Translation\PotentiallyTranslatedString  $fail
     */
    public function validate(string $attribute, mixed $value, Closure $fail): void
    {
        // æˆ‘ä»¬çš„åç§°â€œé»‘åå•â€
        $forbidden = ['Ğ—ĞµĞ¼Ğ»Ñ 2.0', 'ĞĞ¸Ğ±Ğ¸Ñ€Ñƒ', 'ĞŸĞ»Ğ°Ğ½ĞµÑ‚Ğ° X'];

        // æ£€æŸ¥è¾“å…¥å€¼æ˜¯å¦åœ¨æˆ‘ä»¬çš„åˆ—è¡¨ä¸­ï¼Œ
        // å¿½ç•¥å¤§å°å†™ã€‚
        if (in_array(strtolower($value), array_map('strtolower', $forbidden))) {
            // å¦‚æœéªŒè¯æœªé€šè¿‡ï¼Œè°ƒç”¨ $fail å‡½æ•°
            // å¹¶é™„ä¸Šç”¨æˆ·å°†çœ‹åˆ°çš„é”™è¯¯æ–‡æœ¬ã€‚
            $fail('æ­¤æ˜Ÿçƒåç§°ç¦æ­¢ä½¿ç”¨ï¼');
        }
    }
}
```

**æ­¥éª¤ 3ï¼šåœ¨è¡¨å•è¯·æ±‚ (Form Request) ä¸­ä½¿ç”¨**

ç°åœ¨æˆ‘ä»¬çš„è‡ªå®šä¹‰è§„åˆ™å·²å‡†å¤‡å°±ç»ªã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•è¡¨å•è¯·æ±‚ä¸­å¼•ç”¨å®ƒï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬çš„ç±»çš„æ–°å®ä¾‹å³å¯ã€‚

æ‰“å¼€ `app/Http/Requests/StorePlanetRequest.php` å¹¶å°† `new ValidPlanetName` æ·»åŠ åˆ° `name` å­—æ®µçš„è§„åˆ™æ•°ç»„ä¸­ã€‚

```php
<?php
// app/Http/Requests/StorePlanetRequest.php

namespace App\Http\Requests;

use App\Rules\ValidPlanetName; // <-- åˆ«å¿˜äº†å¯¼å…¥ç±»
use Illuminate\Foundation\Http\FormRequest;

class StorePlanetRequest extends FormRequest
{
    // ... (authorize æ–¹æ³•)

    public function rules(): array
    {
        return [
            'name' => [
                'sometimes',
                'string',
                'max:255',
                'unique:planets',
                new ValidPlanetName, // <-- è¿™å°±æ˜¯æˆ‘ä»¬çš„è‡ªå®šä¹‰è§„åˆ™
            ],
            'description' => 'sometimes|string',
            'size_km' => 'sometimes|integer|min:100|max:500000',
            'solar_system' => 'sometimes|string|max:100',
            'image_url' => 'nullable|url|max:2048',
            'is_habitable' => 'sometimes|boolean'
        ];
    }

    // ... (messages æ–¹æ³•)
}
```
å®Œæˆã€‚ç°åœ¨ï¼Œå½“åˆ›å»ºæ˜Ÿçƒæ—¶ï¼ŒLaravel å°†ä¾æ¬¡å¯¹ `name` å­—æ®µåº”ç”¨æ‰€æœ‰è§„åˆ™ï¼Œå¹¶åœ¨é‡åˆ° `new ValidPlanetName` æ—¶æ‰§è¡Œæˆ‘ä»¬çš„è‡ªå®šä¹‰é€»è¾‘ã€‚

---

#### **7. ç”¨äºæ›´æ–° (Update) çš„éªŒè¯**
æ›´æ–°æ•°æ®æ—¶çš„ç‰¹ç‚¹ï¼š

> æ›´æ–°è®°å½•æ—¶ï¼ŒéªŒè¯è§„åˆ™é€šå¸¸æœ‰æ‰€ä¸åŒã€‚ä¸»è¦çš„ç‰¹ç‚¹æ˜¯å”¯ä¸€æ€§æ£€æŸ¥ï¼Œå®ƒåº”è¯¥å¿½ç•¥å½“å‰æ­£åœ¨æ›´æ–°çš„è®°å½•ã€‚

**æ­¥éª¤ 1ï¼šä¸ºæ›´æ–°åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¡¨å•è¯·æ±‚ (Form Request)**
 ```bash
 php artisan make:request UpdatePlanetRequest
 ```
**æ­¥éª¤ 2ï¼šç¼–è¾‘ `app/Http/Requests/UpdatePlanetRequest.php`**
```php
<?php
use Illuminate\Validation\Rule;

public function authorize(): bool
{
    return true;
}
public function rules(): array
{
	$planet = $this->route('planet'); // ä»è·¯ç”±ä¸­è·å–æ¨¡å‹

     return [
         'name' => [
             'sometimes', // ä»…å½“å­—æ®µå­˜åœ¨äºè¯·æ±‚ä¸­æ—¶æ‰è¿›è¡ŒéªŒè¯
             'required',
             'string',
             'max:255',
             Rule::unique('planets')->ignore($planetId),
         ],
         'description'  => 'sometimes|required|string',
         'size_km'      => 'sometimes|required|integer|min:100|max:500000',
         // ... å…¶ä»–å¸¦æœ‰ 'sometimes' çš„å­—æ®µ
     ];
 }
```
**æ­¥éª¤ 3ï¼šåœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨**
```php
<?php
 use App\Http\Requests\UpdatePlanetRequest;

 public function update(UpdatePlanetRequest $request, Planet $planet)
 {
     $validated = $request->validated();
     $planet->update($validated);
     return response()->json($planet);
 }
```

---

#### **8. åœ¨ Postman ä¸­æµ‹è¯•éªŒè¯**
**åœºæ™¯ 1ï¼šåç§°å”¯ä¸€æ€§é”™è¯¯**
```json
POST /api/planets
{
    "name": "ĞœĞ°Ñ€Ñ",
    "description": "ĞšÑ€Ğ°ÑĞ½Ğ°Ñ Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚Ğ°, Ñ†ĞµĞ»ÑŒ Ğ±ÑƒĞ´ÑƒÑÑ‰Ğ¸Ñ… ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¹",
    "size_km": 6779,
    "solar_system": "Solar System",
    "is_habitable": false
}
```
**é¢„æœŸå“åº”ï¼š**
```json
{
    "message": "The given data was invalid.",
    "errors": {
        "name": ["åŒåæ˜Ÿçƒå·²å­˜åœ¨ï¼"]
    }
}
```

**åœºæ™¯ 2ï¼šç›´å¾„ä¸æ­£ç¡®**
```json
{
    "name": "ĞŸĞ»Ğ°Ğ½ĞµÑ‚Ğ°-Ğ“Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ½Ğ°",
    "size_km": 50 // < min:100
}
```
**é¢„æœŸå“åº”ï¼š**
```json
"errors": {
    "size_km": ["ç›´å¾„ä¸èƒ½å°äº 100 å…¬é‡Œ"]
}
```

---

#### **å·©å›ºçŸ¥è¯†çš„æµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. éªŒè¯é”™è¯¯æ—¶çš„ HTTP çŠ¶æ€ç æ˜¯ï¼š</p>
      <label><input type="radio" name="q1" value="a"> a) 400 Bad Request</label>
      <label><input type="radio" name="q1" value="b"> b) 422 Unprocessable Entity</label>
      <label><input type="radio" name="q1" value="c"> c) 500 Internal Server Error</label>
    </div>
    <div class="question">
      <p>2. ç”¨äºæ£€æŸ¥å”¯ä¸€æ€§çš„è§„åˆ™æ˜¯ï¼š</p>
      <label><input type="radio" name="q2" value="a"> a) unique:table</label>
      <label><input type="radio" name="q2" value="b"> b) distinct</label>
      <label><input type="radio" name="q2" value="c"> c) only:table</label>
    </div>
    <div class="question">
      <p>3. å¤æ‚çš„éªŒè¯è§„åˆ™æœ€å¥½æ”¾åœ¨å“ªé‡Œï¼Ÿ</p>
      <label><input type="radio" name="q3" value="a"> a) åœ¨æ§åˆ¶å™¨ä¸­</label>
      <label><input type="radio" name="q3" value="b"> b) åœ¨æ¨¡å‹ä¸­</label>
      <label><input type="radio" name="q3" value="c"> c) åœ¨è¡¨å•è¯·æ±‚ (Form Request) ä¸­</label>
    </div>
    <div class="question">
      <p>4. Form Request ä¸­çš„ `authorize()` æ–¹æ³•åº”è¿”å›ï¼š</p>
      <label><input type="radio" name="q4" value="a"> a) false</label>
      <label><input type="radio" name="q4" value="b"> b) true</label>
      <label><input type="radio" name="q4" value="c"> c) null</label>
    </div>
    <div class="question">
      <p>5. sometimes è§„åˆ™æ„å‘³ç€ï¼š</p>
      <label><input type="radio" name="q5" value="a"> a) å­—æ®µæ˜¯å¿…å¡«çš„</label>
      <label><input type="radio" name="q5" value="b"> b) å­—æ®µä»…åœ¨å­˜åœ¨æ—¶æ‰è¢«éªŒè¯</label>
      <label><input type="radio" name="q5" value="c"> c) å­—æ®µè¢«å¿½ç•¥</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>
<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'a', q3: 'c', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆ: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

**ğŸš€ ç« èŠ‚æ€»ç»“ï¼š**

æ‚¨å·²ä¸ºæ‚¨çš„å®‡å®™ API å»ºç«‹äº†å¼ºå¤§çš„ä¿æŠ¤ç³»ç»Ÿï¼š

- ğŸ›¡ï¸ åŸºæœ¬å’Œè‡ªå®šä¹‰éªŒè¯è§„åˆ™
- ğŸ“ å¯è¯»çš„é”™è¯¯æ¶ˆæ¯
- ğŸ§© Form Request ç”¨äºå¤æ‚åœºæ™¯
- âš™ï¸ æ›´æ–°æ•°æ®çš„å”¯ä¸€è§„åˆ™

**æ‚¨çš„å®‡å®™ç°å·²å—åˆ°ä¿æŠ¤ï¼** æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å¤„ç†â€œå®‡å®™äº‹æ•…â€â€”â€”æœåŠ¡å™¨é”™è¯¯ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> 1. åˆ›å»ºç”¨äºæ›´æ–°è¡Œæ˜Ÿçš„ Form Request
> 2. æ·»åŠ è‡ªå®šä¹‰åç§°éªŒè¯è§„åˆ™
> 3. é€šè¿‡ Postman æµ‹è¯•é”™è¯¯

> **âš ï¸ å¦‚æœéªŒè¯å¤±è´¥ï¼š**

> - æ£€æŸ¥æ§åˆ¶å™¨ä¸­ Form Request çš„å¼•å…¥
> - ç¡®ä¿ `authorize()` è¿”å› true
> - å¯¹äºæ›´æ–°æ—¶çš„å”¯ä¸€æ€§ï¼Œè¯·ä½¿ç”¨ `Rule::unique`