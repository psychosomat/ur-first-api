# **ç¬¬2.4ç« ï¼šPlanetController API æ§åˆ¶å™¨**
**å­¦ä¹ æ—¶é—´ï¼š** 1 å°æ—¶

---

#### **1. æ§åˆ¶å™¨ï¼šå®‡å®™å¯¹è±¡ç®¡ç†ä¸­å¿ƒ**
åœ¨ MVC æ¶æ„ä¸­ï¼Œ**æ§åˆ¶å™¨**æ˜¯æ¨¡å‹å’Œè¯·æ±‚ä¹‹é—´çš„ä¸­ä»‹ï¼š

- ğŸ“¡ æ¥æ”¶ HTTP è¯·æ±‚ (GET, POST, PUT, DELETE)
- ğŸ” é€šè¿‡æ¨¡å‹ä»æ•°æ®åº“ä¸­æå–æ•°æ®
- ğŸ“¦ æ ¼å¼åŒ– API çš„ JSON å“åº”

> ğŸ’¡ **å®‡å®™ç±»æ¯”ï¼š**
> `PlanetController` = ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒï¼š

> - æ¥æ”¶æ¥è‡ªåœ°çƒçš„è¯·æ±‚ï¼ˆ`GET /planets`ï¼‰
> - å‘â€œæ¢æµ‹å™¨â€ï¼ˆæ¨¡å‹ï¼‰å‘å‡ºæŒ‡ä»¤
> - ä»¥ JSON æ ¼å¼è¿”å›é¥æµ‹æ•°æ®

---

#### **2. åˆ›å»ºèµ„æºæ§åˆ¶å™¨**
èµ„æºæ§åˆ¶å™¨è‡ªåŠ¨åŒ…å«ç”¨äº CRUD æ“ä½œçš„æ–¹æ³•ã€‚

**æ­¥éª¤ 1ï¼šç”Ÿæˆæ§åˆ¶å™¨**
```bash
php artisan make:controller PlanetController --api --model=Planet
```

**å°†åœ¨ `app/Http/Controllers/PlanetController.php` ä¸­åˆ›å»ºä»¥ä¸‹å†…å®¹ï¼š**
```php
<?php

namespace App\Http\Controllers;

use App\Models\Planet;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule; // åˆ«å¿˜äº†æ·»åŠ æ­¤å¯¼å…¥

class PlanetController extends Controller
{
    // æ˜¾ç¤ºè¡Œæ˜Ÿåˆ—è¡¨
    public function index(Request $request) {}

    // åˆ›å»ºæ–°è¡Œæ˜Ÿ
    public function store(Request $request) {}

    // æ˜¾ç¤ºç‰¹å®šè¡Œæ˜Ÿ
    public function show(Planet $planet) {}

    // æ›´æ–°è¡Œæ˜Ÿ
    public function update(Request $request, Planet $planet) {}

    // åˆ é™¤è¡Œæ˜Ÿ
    public function destroy(Planet $planet) {}
}
```

---

#### **3. å®ç° API æ–¹æ³•**

**A. `index()` - è·å–è¡Œæ˜Ÿåˆ—è¡¨**
```php
<?php
public function index(Request $request)
{
    // è·å–åˆ†é¡µè¡Œæ˜Ÿï¼Œæ¯é¡µ 15 ä¸ª
    $planets = Planet::paginate($request->get('per_page', 15));
    return response()->json($planets); // è‡ªåŠ¨ 200 OK
}
```

**B. `store()` - åˆ›å»ºæ–°è¡Œæ˜Ÿ**
```php
<?php
public function store(Request $request)
{
    $data = $request->validate([
        'name' => 'required|string|max:255|unique:planets',
        'description' => 'required|string',
        'size_km' => 'required|integer|min:100',
        'solar_system' => 'required|string|max:100',
        'image_url' => 'nullable|url',
        'is_habitable' => 'boolean'
    ]);

    $planet = Planet::create($data);
    return response()->json($planet, 201); // 201 Created
}
```

**C. `show()` - æŸ¥çœ‹å•ä¸ªè¡Œæ˜Ÿ**
```php
<?php
public function show(Planet $planet)
{
    return response()->json($planet); // è‡ªåŠ¨ 200 OK
}
```

**D. `update()` - æ›´æ–°è¡Œæ˜Ÿ**
```php
<?php
public function update(Request $request, Planet $planet)
{
    $data = $request->validate([
        'name' => [
            'string',
            'max:255',
            Rule::unique('planets')->ignore($planet->id),
        ],
        'description' => 'sometimes|string', // 'sometimes' - ä»…å½“å­—æ®µå­˜åœ¨æ—¶æ‰éªŒè¯
        'size_km' => 'sometimes|integer|min:100',
        'solar_system' => 'sometimes|string|max:100',
        'image_url' => 'sometimes|nullable|url',
        'is_habitable' => 'sometimes|boolean'
    ]);

    $planet->update($data);
    return response()->json($planet); // 200 OK
}
```

**E. `destroy()` - åˆ é™¤è¡Œæ˜Ÿ**
```php
<?php
public function destroy(Planet $planet)
{
    $planet->delete();
    return response()->json(null, 204); // 204 No Content
}
```

---

#### **4. è·¯ç”±æ¨¡å‹ç»‘å®š (Route Model Binding)**
Laravel æ ¹æ® ID è‡ªåŠ¨æ³¨å…¥è¡Œæ˜Ÿå¯¹è±¡ï¼š
```php
// åœ¨è·¯ç”±ä¸­: GET /planets/{planet}
// åœ¨æ–¹æ³•ä¸­: show(Planet $planet)
```

- å¦‚æœè¡Œæ˜Ÿæœªæ‰¾åˆ° â†’ è‡ªåŠ¨ 404
- æ— éœ€æ‰‹åŠ¨è°ƒç”¨ `findOrFail()` æŸ¥è¯¢

---

#### **5. å“åº”æ ¼å¼åŒ–**
**`index()` æ–¹æ³•çš„æ”¹è¿›å“åº”ç¤ºä¾‹ï¼š**
```php
<?php
public function index()
{
    return response()->json([
        'success' => true,
        'data' => Planet::all(),
        'message' => 'è¡Œæ˜Ÿè·å–æˆåŠŸ'
    ]);
}
```

**404 é”™è¯¯å“åº”ï¼ˆè‡ªåŠ¨ï¼‰ï¼š**
```json
{
    "message": "No query results for model [App\\Models\\Planet] 123",
    "exception": "Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException"
}
```

---

#### **å·©å›ºæµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. ç”¨äºåˆ›å»º API æ§åˆ¶å™¨çš„æ ‡å¿—ï¼š</p>
      <label><input type="radio" name="q1" value="a"> a) --api</label>
      <label><input type="radio" name="q1" value="b"> b) --resource</label>
      <label><input type="radio" name="q1" value="c"> c) --model</label>
    </div>
    <div class="question">
      <p>2. æˆåŠŸåˆ›å»ºæ—¶åº”è¿”å›ä»€ä¹ˆçŠ¶æ€ï¼Ÿ</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 201 Created</label>
      <label><input type="radio" name="q2" value="c"> c) 204 No Content</label>
    </div>
    <div class="question">
      <p>3. è·¯ç”±æ¨¡å‹ç»‘å®šå…è®¸ï¼š</p>
      <label><input type="radio" name="q3" value="a"> a) è‡ªåŠ¨æ ¹æ® ID è·å–å¯¹è±¡</label>
      <label><input type="radio" name="q3" value="b"> b) ç”Ÿæˆ HTML è¡¨å•</label>
      <label><input type="radio" name="q3" value="c"> c) ç¼“å­˜è¯·æ±‚</label>
    </div>
    <div class="question">
      <p>4. åˆ é™¤è¡Œæ˜Ÿæ—¶è¿”å›ï¼š</p>
      <label><input type="radio" name="q4" value="a"> a) åŒ…å«è¡Œæ˜Ÿæ•°æ®çš„ JSON</label>
      <label><input type="radio" name="q4" value="b"> b) null å’Œ 204 çŠ¶æ€ç </label>
      <label><input type="radio" name="q4" value="c"> c) ç©ºå­—ç¬¦ä¸²</label>
    </div>
    <div class="question">
      <p>5. $request->validate() ç”¨äºï¼š</p>
      <label><input type="radio" name="q5" value="a"> a) éªŒè¯è¾“å…¥æ•°æ®</label>
      <label><input type="radio" name="q5" value="b"> b) åŠ å¯†è¯·æ±‚</label>
      <label><input type="radio" name="q5" value="c"> c) ç¼“å­˜å“åº”</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'b', q3: 'a', q4: 'b', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æœªä½œç­”ã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**

æ‚¨å·²ç»åˆ›å»ºäº†è¡Œæ˜Ÿç³»ç»Ÿçš„â€œæ§åˆ¶å°â€ï¼ç°åœ¨æ‚¨çš„æ§åˆ¶å™¨èƒ½å¤Ÿï¼š

- ğŸŒŒ æ˜¾ç¤ºè¡Œæ˜Ÿåˆ—è¡¨ï¼ˆ`index`ï¼‰
- ğŸª åˆ›å»ºæ–°ä¸–ç•Œï¼ˆ`store`ï¼‰
- ğŸ”­ è¯¦ç»†æ˜¾ç¤ºè¡Œæ˜Ÿæ•°æ®ï¼ˆ`show`ï¼‰
- ğŸ› ï¸ æ›´æ–°ä¿¡æ¯ï¼ˆ`update`ï¼‰
- ğŸ’¥ é”€æ¯è¡Œæ˜Ÿï¼ˆ`destroy`ï¼‰

**å‰©ä¸‹çš„å°±æ˜¯é…ç½®è·¯ç”±äº†ï¼** åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠæ§åˆ¶å™¨è¿æ¥åˆ° API è·¯ç”±ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> ç¡®ä¿ `app/Http/Controllers` ä¸­å­˜åœ¨åŒ…å« 5 ä¸ªæ–¹æ³•çš„ `PlanetController.php` æ–‡ä»¶ã€‚

> **âš ï¸ å¦‚æœæœ‰é”™è¯¯ï¼š**

> - æ£€æŸ¥æ¨¡å‹åç§°ï¼š`use App\Models\Planet;`
> - æ£€æŸ¥å¯¼å…¥
> - å¯¹äº PostgreSQLï¼šç¡®ä¿ `Planet::all()` è¿”å›æ•°æ®
> - å¦‚æœ Tinker å‡ºç°é—®é¢˜ï¼šæ‰§è¡Œ `composer dump-autoload`