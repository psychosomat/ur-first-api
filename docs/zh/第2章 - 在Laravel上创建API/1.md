# **第 2.1 章：准备 Laravel 环境**
**学习时间：** 1-2 小时
---

#### **1. 为什么需要本地环境？**
想象一下，您正在建造一个宇宙探测器。在将其发射到太空之前，您会**在地球上测试所有系统**。本地环境就是您的代码的“控制实验室”：

- 安全的实验，不影响生产服务器
- 快速部署依赖项
- 轻松切换软件版本

> 💡 **宇宙类比：**
> Herd = 移动发射复合体
> Docker = 空间站模拟器
> XAMPP = 固定试验台

---

#### **2. 安装 Herd**
**Herd** — 现代化的 PHP 环境管理工具（类似于 Laravel Valet）。

**安装步骤：**

1. 下载安装程序：[herd.laravel.com](https://herd.laravel.com)
2. 运行 `Herd Installer.exe` → Next → Install
3. 安装后：
   	- 从“开始”菜单打开 Herd。应用程序图标将出现在系统托盘中（时钟旁边）。
   	- 单击 Herd 图标：确保 Nginx 和所需的 PHP 版本（例如 8.3）正在运行（用绿点标记）。
   	- 转到 Herd Paths 并添加将存储您项目的文件夹（例如 C:\Users\YourUser\Code）。Herd 将自动为该文件夹中的每个子目录创建漂亮的域名，例如 folder-name.test。

> ⚠️ **重要提示！** 安装时：
> - 允许网络访问（如果防火墙请求）
> - 检查 PATH 中的路径：`C:\Program Files\Herd\bin`

**检查工作：**

1. 单击系统托盘中的 Herd 图标。
2. 确保 Nginx 和 PHP 服务处于活动状态（绿色指示灯）。
3. 在您的项目文件夹中（例如 C:\Users\YourUser\Code）创建一个名为 test 的文件夹，并在其中创建一个名为 index.php 的文件，其内容为 ```<?php phpinfo(); ?>```。
4. 在 Herd 中，通过 sites 选项卡指定 test 文件夹的路径，然后单击 "Add site"。
5. 在浏览器中打开地址 http://test.test。您应该会看到显示 PHP 信息的页面。

---

#### **3. 替代方法（简要）**
| 工具       | 适用对象              | 优点                          | 缺点                  |
|------------------|-----------------------|--------------------------------|-------------------------|
| **Laravel Sail (Docker)**       | 适合所有级别  | 完全隔离，环境可重复性，Laravel 官方支持 | 需要安装 Docker，消耗更多资源   |
| **XAMPP**        | 初学者           | 一体化安装程序（All-in-One）              | 笨重，更难管理软件版本，污染系统   |
| **Laragon**      | Windows 开发者 | 快速，易于切换版本，自动配置主机        | 添加新项目时需要手动重启 Web 服务器     |

> **Docker 示例 (Laravel Sail):**
> ```dockerfile
> # 安装 Docker 后
> ./vendor/bin/sail up
> ```

---

#### **4. 安装 PHP 和 Composer**
**如果您不使用 Herd：**

1. PHP：
   	- 下载 [适用于 Windows 的 PHP 8.3](https://windows.php.net/download/)
   	- 解压到 `C:\PHP`
   	- 添加到 PATH：
     ```powershell
	 # 建议以管理员身份在 PowerShell 中执行
     [Environment]::SetEnvironmentVariable("Path", "$env:Path;C:\PHP", "User")
     ```
2. Composer：
   	- 运行 [Composer-Setup.exe](https://getcomposer.org/download/)
   	- 检查：
     ```cmd
     php -v
     composer --version
     ```

---

#### **5. 安装 PostgreSQL**
**用于数据库操作：**

1. 下载 [PostgreSQL 15](https://www.postgresql.org/download/windows/)
2. 运行安装程序：
   - 超级用户密码：`admin`（或您自己的）
   - 端口：`5432`（标准）
3. 安装后：
   - 打开 **pgAdmin 4**（图形客户端）
   > 您可以使用任何其他数据库客户端，例如 DBeaver、DataGrip 甚至命令行。
   > 我更喜欢 DBeaver - 但这取决于个人喜好
   - 为项目创建数据库：`space_api`

---

#### **6. 安装 Laravel**
1. 通过 Composer：
```bash
composer create-project laravel/laravel space-api
cd space-api
```

2. Git 初始化（可选）：
```bash
git init
git add .
git commit -m "启动宇宙项目"
```

3. 启动并检查服务器：
>如果您使用 Herd：
确保您的 space-api 项目位于您已添加到 Herd 的文件夹中。
在浏览器中打开地址：http://space-api.test
您应该看到 Laravel 的起始页面。服务器已经通过 Herd 运行！

如果您不使用 Herd（手动安装）：
```bash
php artisan serve
```
在浏览器中打开：[http://localhost:8000](http://localhost:8000) → 应该会出现 Laravel 的起始页面！

### 在 Herd 中创建项目时：

只需按照屏幕上的说明操作即可。为方便起见，项目名称为 `space-api`。入门套件可以是任何一个，但我更喜欢 React。

##### 务必启用 phpunit - 我们稍后会用到它

---

#### **7. 项目配置**
**重要文件：**

- `.env` — 环境设置（密钥，数据库）
- `config/database.php` — 数据库管理系统配置
- `composer.json` — PHP 依赖项

**将数据库连接到项目：**

添加到 `.env`：

```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=space_api
DB_USERNAME=postgres # PostgreSQL 登录名
DB_PASSWORD=admin # PostgreSQL 密码
```

**Artisan 的第一批命令：**
```bash
php artisan key:generate  # 生成应用程序密钥
php artisan migrate:fresh # 数据库迁移（切换到 PostgreSQL 时）
```

---

#### **巩固知识小测验**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Herd 是...</p>
      <label><input type="radio" name="q1" value="a"> a) 用于管理 PHP 环境的工具</label>
      <label><input type="radio" name="q1" value="b"> b) 代码编辑器</label>
      <label><input type="radio" name="q1" value="c"> c) 操作系统</label>
    </div>
    <div class="question">
      <p>2. Laravel 使用哪种工具来管理 PHP 依赖项？</p>
      <label><input type="radio" name="q2" value="a"> a) npm</label>
      <label><input type="radio" name="q2" value="b"> b) Composer</label>
      <label><input type="radio" name="q2" value="c"> c) Artisan</label>
    </div>
    <div class="question">
      <p>3. PostgreSQL 的标准端口是：</p>
      <label><input type="radio" name="q3" value="a"> a) 3306</label>
      <label><input type="radio" name="q3" value="b"> b) 5432</label>
      <label><input type="radio" name="q3" value="c"> c) 8000</label>
    </div>
    <div class="question">
      <p>4. 通过 Composer 创建 Laravel 项目的命令是：</p>
      <label><input type="radio" name="q4" value="a"> a) composer create-laravel</label>
      <label><input type="radio" name="q4" value="b"> b) laravel new</label>
      <label><input type="radio" name="q4" value="c"> c) composer create-project laravel/laravel</label>
    </div>
    <div class="question">
      <p>5. 包含环境设置的文件是？</p>
      <label><input type="radio" name="q5" value="a"> a) .env</label>
      <label><input type="radio" name="q5" value="b"> b) config.php</label>
      <label><input type="radio" name="q5" value="c"> c) settings.ini</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">检查</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'b', q3: 'b', q4: 'c', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>结果：</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>问题 ${question.slice(1)}: <span style="color:green;">正确！</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>问题 ${question.slice(1)}: <span style="color:red;">错误。</span> 正确答案：<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>问题 ${question.slice(1)}: <span style="color:orange;">无答案。</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>您的得分：${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

### **🚀 本章总结**
> 您已经为宇宙 API 部署了“发射台”！现在您拥有：

> - 🛠️ 本地环境（Herd 或手动安装），包含 PHP 和 Nginx
> - 🐘 已安装的 PostgreSQL 数据库服务器
> - 🚀 Laravel 项目 `space-api`
> - 🔌 已配置的数据库连接
>
> **📌 检查：**

> - **如果您使用 Herd：** 确保 `http://space-api.test` 地址能够打开网站。
> - **如果您不使用 Herd：** 确保 `php artisan serve` 命令有效，并且网站可以通过 `http://localhost:8000` 地址打开。
> - 无论哪种情况，请检查 `pgAdmin 4` 中是否能看到已创建的 `space_api` 数据库。