# **ç¬¬ 2.2 ç« ï¼šåˆ›å»º Planet æ¨¡å‹**
**å­¦ä¹ æ—¶é—´ï¼š** 45 åˆ†é’Ÿ

---

#### **1. Laravel ä¸­çš„æ¨¡å‹ï¼šå®‡å®™å¯¹è±¡çš„è“å›¾**
åœ¨ MVC æ¶æ„ï¼ˆModel-View-Controllerï¼‰ä¸­ï¼Œ**æ¨¡å‹** æ˜¯ï¼š

- ğŸ“¦ æ•°æ®çš„å®¹å™¨ï¼ˆè¡Œæ˜Ÿå‚æ•°ï¼‰
- ğŸ”Œ æ•°æ®åº“æ“ä½œæ¥å£
- ğŸ›¡ï¸ åº”ç”¨ç¨‹åºä¸šåŠ¡é€»è¾‘çš„ä¸­å¿ƒ

> ğŸ’¡ **å®‡å®™ç±»æ¯”ï¼š**
> `Planet` æ¨¡å‹ = ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒè®¡ç®—æœºä¸­çš„è¡Œæ˜Ÿè“å›¾ã€‚é€šè¿‡å®ƒå¯ä»¥ï¼š

> - åœ¨ç›®å½•ä¸­åˆ›å»ºæ–°è¡Œæ˜Ÿ (`INSERT`)
> - è·å–ç«æ˜Ÿæ•°æ® (`SELECT`)
> - æ›´æ–°å¤§æ°”å±‚ä¿¡æ¯ (`UPDATE`)

---

#### **2. åˆ›å»ºæ¨¡å‹å’Œè¿ç§»**
Laravel ä½¿ç”¨ Artisan CLI â€” æ‚¨çš„é¡¹ç›®â€œæ§åˆ¶å°â€ã€‚

**æ­¥éª¤ 1ï¼šç”Ÿæˆå¸¦è¿ç§»çš„æ¨¡å‹**
```bash
php artisan make:model Planet -m
```

**å·²åˆ›å»ºæ–‡ä»¶ï¼š**
```
app/
  â””â”€â”€ Models/
      â””â”€â”€ Planet.php    â† æ¨¡å‹
database/
  â””â”€â”€ migrations/
      â””â”€â”€ 2025_08_04_000000_create_planets_table.php  â† è¿ç§»
```

**Artisan æ ‡å¿—ï¼š**

- `-m` â†’ åˆ›å»ºè¿ç§»
- `-c` â†’ åˆ›å»ºæ§åˆ¶å™¨
- `-r` â†’ èµ„æºæ§åˆ¶å™¨

> ğŸ’¡ **ä¸“ä¸šæç¤ºï¼š** è¿™äº›æ ‡å¿—å¯ä»¥ç»„åˆä½¿ç”¨ä»¥è·å¾—æœ€å¤§æ•ˆç‡ã€‚å‘½ä»¤ `php artisan make:model Planet -mcr` å°†ç«‹å³åˆ›å»ºæ¨¡å‹ã€è¿ç§»å’Œç”¨äºç®¡ç†è¯¥æ¨¡å‹çš„èµ„æºæ§åˆ¶å™¨ã€‚è¿™èŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚

---

#### **3. é…ç½® Planet æ¨¡å‹**
æ‰“å¼€ `app/Models/Planet.php`ï¼š
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Planet extends Model
{
    // è¡¨åï¼ˆé»˜è®¤ä¸ºï¼š'planets'ï¼‰
	// Laravel é»˜è®¤å‡å®šè¡¨åæ˜¯æ¨¡å‹åçš„å°å†™å¤æ•°å½¢å¼ (Planet -> planets)ã€‚
     // å› æ­¤ï¼Œæ­¤å¤„æ­¤å±æ€§å¹¶éå¿…éœ€ï¼Œä½†æœ‰åŠ©äºæé«˜å¯è¯»æ€§ã€‚
    protected $table = 'planets';

    // å…è®¸æ‰¹é‡èµ‹å€¼çš„å­—æ®µ
    protected $fillable = [
        'name',
        'description',
        'size_km',
        'solar_system',
        'image_url'
    ];

    // è‡ªåŠ¨ç±»å‹è½¬æ¢
    protected $casts = [
        'size_km' => 'integer'
    ];
}
```

**å±æ€§è¯´æ˜ï¼š**

| å±æ€§         | å€¼                         | æ•°æ®ç¤ºä¾‹              |
|------------------|----------------------------------|----------------------------|
| `$table`         | æ•°æ®åº“ä¸­çš„è¡¨å                 | `planets`                  |
| `$fillable`      | å…è®¸æ‰¹é‡èµ‹å€¼çš„å­—æ®µ    | `name`, `size_km`          |
| `$casts`         | è‡ªåŠ¨ç±»å‹è½¬æ¢ | `size_km: integer`       |

---

#### **4. è¡Œæ˜Ÿè¡¨è®¾è®¡**
åœ¨ç¼–è¾‘è¿ç§»æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰â€œè¡Œæ˜Ÿâ€çš„ç»“æ„ï¼š

| å­—æ®µ             | æ•°æ®ç±»å‹       | æè¿°                     | ç¤ºä¾‹å€¼       |
|------------------|------------------|------------------------------|-----------------------|
| `id`             | BIGINT (PK)      | å”¯ä¸€ ID                | 1                     |
| `name`           | VARCHAR(255)     | è¡Œæ˜Ÿåç§°             | "ç«æ˜Ÿ"                |
| `description`    | TEXT             | æè¿°                     | "çº¢è‰²è¡Œæ˜Ÿ..."  |
| `size_km`        | INTEGER          | ç›´å¾„ï¼ˆå…¬é‡Œï¼‰                 | 6779                  |
| `solar_system`   | VARCHAR(100)     | å¤ªé˜³ç³»            | "å¤ªé˜³ç³»"   |
| `image_url`      | VARCHAR(2048)    | å›¾ç‰‡ URLï¼ˆå¯ä¸ºç©ºï¼‰   | "https://..."         |
| `created_at`     | TIMESTAMP        | åˆ›å»ºæ—¥æœŸ                | 2025-08-04 12:00:00   |
| `updated_at`     | TIMESTAMP        | æ›´æ–°æ—¥æœŸ              | 2025-08-05 09:30:00   |

---

#### **5. ç¼–è¾‘è¿ç§»æ–‡ä»¶**
æ‰“å¼€ `database/migrations/..._create_planets_table.php` ä¸­çš„è¿ç§»æ–‡ä»¶ï¼š

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreatePlanetsTable extends Migration
{
    public function up()
    {
        Schema::create('planets', function (Blueprint $table) {
            $table->id(); // BIGINT è‡ªå¢

            $table->string('name')->unique();
            $table->text('description');
            $table->integer('size_km');
            $table->string('solar_system', 100);
            $table->string('image_url', 2048)->nullable();

            $table->timestamps(); // created_at + updated_at
        });
    }

    public function down()
    {
        Schema::dropIfExists('planets');
    }
}
```

**è¦ç‚¹ï¼š**

- `->unique()` â†’ ç¡®ä¿åç§°çš„å”¯ä¸€æ€§
- `->nullable()` â†’ å­—æ®µå¯ä»¥ä¸ºç©º
- `timestamps()` â†’ è‡ªåŠ¨ç®¡ç†æ—¥æœŸæ—¶é—´

---

#### **6. è¿è¡Œè¿ç§»ï¼ˆé¢„è§ˆï¼‰**
è™½ç„¶è¿ç§»å°†åœ¨ç¬¬ 2.3 ç« ä¸­è¿è¡Œï¼Œä½†æˆ‘ä»¬å…ˆçœ‹çœ‹å®ƒä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼š
```bash
php artisan migrate
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Migrating: 2025_08_04_000000_create_planets_table
Migrated:  2025_08_04_000000_create_planets_table (32.15ms)
```

**åœ¨ pgAdmin 4 ä¸­æ£€æŸ¥ï¼š**

1. æ‰“å¼€ `space_api` æ•°æ®åº“ â†’ Schemas â†’ Tables
2. åº”è¯¥ä¼šå‡ºç° `planets` è¡¨å’Œæ‚¨çš„å­—æ®µ

---

#### **7. æ›¿ä»£æ–¹æ³•ï¼šä»£ç ç”Ÿæˆå™¨**
ä¸ºäº†åŠ é€Ÿå¼€å‘ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹åŒ…ï¼š

- **Laravel Blueprint** - æ ¹æ® YAML æè¿°åˆ›å»ºæ¨¡å‹/è¿ç§»
- **InfyOm Laravel Generator** - åŸºäºæ•°æ®åº“ schema çš„ç”Ÿæˆå™¨

**Blueprint ç¤ºä¾‹ï¼š**
```yaml
models:
  Planet:
    name: string:255
    description: text
    size_km: integer
    solar_system: string:100
    image_url: string:2048? # '?' ç¬¦å·è¡¨ç¤ºå­—æ®µå¯ä¸ºç©º
```

---

#### **å·©å›ºæµ‹éªŒ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. ç”¨äºåˆ›å»ºæ¨¡å‹åŠå…¶ç›¸å…³è¿ç§»çš„ Artisan å‘½ä»¤ï¼š</p>
      <label><input type="radio" name="q1" value="a"> a) php artisan make:model Planet -m</label>
      <label><input type="radio" name="q1" value="b"> b) php artisan create:model Planet</label>
      <label><input type="radio" name="q1" value="c"> c) php artisan model:new Planet --m</label>
    </div>
    <div class="question">
      <p>2. æ¨¡å‹ä¸­çš„ `$fillable` å±æ€§ç”¨äº</p>
      <label><input type="radio" name="q2" value="a"> a) é˜²æ­¢æ‰¹é‡èµ‹å€¼</label>
      <label><input type="radio" name="q2" value="b"> b) è‡ªåŠ¨åŠ å¯†æ•°æ®</label>
      <label><input type="radio" name="q2" value="c"> c) æè¿°å¤–é”®</label>
    </div>
    <div class="question">
      <p>3. è¿ç§»ä¸­çš„ `nullable()` æ„å‘³ç€ï¼š</p>
      <label><input type="radio" name="q3" value="a"> a) å­—æ®µå¿…é¡»å¡«å†™</label>
      <label><input type="radio" name="q3" value="b"> b) å­—æ®µå¯ä»¥ä¸ºç©º</label>
      <label><input type="radio" name="q3" value="c"> c) å­—æ®µå°†è¢«åˆ é™¤</label>
    </div>
    <div class="question">
      <p>4. ç”¨äºè¡Œæ˜Ÿé•¿æè¿°çš„å­—æ®µç±»å‹ï¼š</p>
      <label><input type="radio" name="q4" value="a"> a) string</label>
      <label><input type="radio" name="q4" value="b"> b) text</label>
      <label><input type="radio" name="q4" value="c"> c) varchar</label>
    </div>
    <div class="question">
      <p>5. `timestamps()` æ–¹æ³•åˆ›å»ºï¼š</p>
      <label><input type="radio" name="q5" value="a"> a) ä»… created_at</label>
      <label><input type="radio" name="q5" value="b"> b) created_at å’Œ updated_at</label>
      <label><input type="radio" name="q5" value="c"> c) id, created_at, updated_at</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">æ£€æŸ¥</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'a', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ç»“æœï¼š</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:green;">æ­£ç¡®ï¼</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:red;">é”™è¯¯ã€‚</span> æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>é—®é¢˜ ${question.slice(1)}: <span style="color:orange;">æ— ç­”æ¡ˆã€‚</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>æ‚¨çš„å¾—åˆ†ï¼š${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ æœ¬ç« æ€»ç»“ï¼š**
æ‚¨å·²ç»åˆ›å»ºäº†è¡Œæ˜Ÿçš„â€œæ•°å­—å­ªç”Ÿâ€ï¼ç°åœ¨æ‚¨çš„é¡¹ç›®æ‹¥æœ‰ï¼š

- ğŸª åŒ…å«ä¸šåŠ¡é€»è¾‘çš„ `Planet` æ¨¡å‹
- ğŸ“Š ç”¨äº PostgreSQL ä¸­ `planets` è¡¨çš„è¿ç§»
- ğŸ› ï¸ é…ç½®å¥½çš„æ¨¡å‹å±æ€§ï¼ˆ`fillable`ã€`casts`ï¼‰

**å‡†å¤‡å¥½æ•°æ®åº“ï¼** åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†è¿è¡Œè¿ç§»å¹¶ç”¨ç¬¬ä¸€æ‰¹è¡Œæ˜Ÿå¡«å……å®‡å®™ã€‚

> **ğŸ“Œ æ£€æŸ¥ï¼š**

> ç¡®ä¿ `Planet.php` å’Œ `..._create_planets_table.php` æ–‡ä»¶å·²åœ¨æ­£ç¡®çš„ç›®å½•ä¸­åˆ›å»ºã€‚

> **âš ï¸ å¦‚æœ Artisan æŠ¥é”™ï¼š**

> - æ£€æŸ¥æ‚¨æ˜¯å¦åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­
> - ç¡®ä¿å·²å®‰è£…ä¾èµ–é¡¹ï¼ˆ`composer install`ï¼‰
> - å¯¹äº Windowsï¼šå°† PHP å’Œ Composer æ·»åŠ åˆ° PATH