# **Chapitre 4.6 : Cr√©ation d'une interface simple pour l'API**
**Temps d'√©tude :** 1 heure 15 minutes

---

#### **1. Assemblage final : Lancement du "Centre de Contr√¥le de Vol"**
Nous avons √©tudi√© tous les syst√®mes individuellement : configur√© "l'antenne" (`Fetch`), appris √† envoyer des "commandes" (`GET`, `POST`, `DELETE`), d√©velopp√© des "protocoles d'urgence" (gestion des erreurs).

Il est temps de **rassembler tous les composants** et de lancer notre CCV ‚Äì une interface compl√®te et interactive pour la gestion de la flotte spatiale.

**Notre objectif :**

- Cr√©er une interface unifi√©e, propre et claire.
- Impl√©menter un cycle CRUD complet : cr√©ation, affichage, mise √† jour et suppression de vaisseaux.
- Ajouter un retour visuel pour l'utilisateur (chargement, succ√®s, erreur).

> üí° **Analogie spatiale :**

> Nous passons des consoles de test individuelles √† l'**√©cran principal du CCV**. Il doit contenir tous les boutons et indicateurs n√©cessaires pour qu'un seul op√©rateur puisse g√©rer toute la flotte sans basculer entre des dizaines de syst√®mes diff√©rents.

---

#### **2. Conception de l'interface : "Tableau de bord"**
Nous aurons besoin d'un HTML plus structur√©. Nous utiliserons des "cartes" pour afficher les vaisseaux et une fen√™tre modale pour leur √©dition.

**Mise √† jour de `index.html` :**
```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CCV v2.0 - Gestion de la Flotte</title>
    <link rel="stylesheet" href="style.css"> <!-- Connexion des styles -->
</head>
<body>
    <header>
        <h1>Panneau de contr√¥le de la flotte spatiale</h1>
    </header>

    <main>
        <section id="fleet-controls">
            <button id="load-fleet-btn">Actualiser la liste de la flotte</button>
            <button id="show-create-form-btn">Lancer un nouvel appareil</button>
        </section>

        <section id="fleet-display">
            <h2>Composition actuelle de la flotte</h2>
            <div id="fleet-list" class="cards-container">
                <!-- Les cartes des vaisseaux seront ici -->
            </div>
        </section>
    </main>

    <!-- Fen√™tre modale pour la cr√©ation/√©dition (initialement cach√©e) -->
    <div id="modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="modal-title">Lancement d'un nouvel appareil</h2>
            <form id="ship-form">
                <input type="hidden" id="ship-id">
                <input type="text" id="ship-name" placeholder="Nom" required>
                <input type="text" id="ship-type" placeholder="Type" required>
                <input type="number" id="ship-year" placeholder="Ann√©e de lancement" required>
                <input type="text" id="ship-status" placeholder="Statut" required>
                <div class="modal-actions">
                    <button type="submit" id="save-btn">Enregistrer</button>
                    <button type="button" id="cancel-btn">Annuler</button>
                </div>
            </form>
            <div id="notification-area"></div>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="app.js"></script>
</body>
</html>
```

---

#### **3. Ajout du design "spatial" : `style.css`**
Cr√©ez le fichier `style.css` pour que notre CCV ait une apparence digne.
```css
/* style.css */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1a1a2e;
    color: #e0e0e0;
    margin: 0;
    padding: 20px;
}
header { text-align: center; margin-bottom: 20px; }
button {
    background-color: #4a4e69;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}
button:hover { background-color: #6a6e94; }
.cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}
.card {
    background-color: #2a2a4e;
    border: 1px solid #4a4e69;
    border-radius: 8px;
    padding: 15px;
}
.card h3 { margin-top: 0; color: #9394a5; }
.card-actions { margin-top: 15px; }

/* Styles pour la fen√™tre modale */
.modal-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: #1a1a2e;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #4a4e69;
    width: 90%;
    max-width: 500px;
}
#ship-form input {
    width: calc(100% - 20px);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #4a4e69;
    background-color: #2a2a4e;
    color: white;
}
.modal-actions { text-align: right; }
```

---

#### **4. Reconstitution compl√®te de la logique : `app.js`**
Nous allons maintenant √©crire la version finale de `app.js`, en combinant toutes nos connaissances.

```javascript
// app.js

// --- √âl√©ments DOM ---
const loadFleetBtn = document.getElementById('load-fleet-btn');
const fleetListContainer = document.getElementById('fleet-list');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modal-title');
const shipForm = document.getElementById('ship-form');
const saveBtn = document.getElementById('save-btn');
const cancelBtn = document.getElementById('cancel-btn');
const showCreateFormBtn = document.getElementById('show-create-form-btn');
const notificationArea = document.getElementById('notification-area');

// --- Fonctions pour l'UI ---

function showNotification(message, isError = false) {
    notificationArea.textContent = message;
    notificationArea.style.color = isError ? '#ff6b6b' : '#6bff6b';
}

function openModalForCreate() {
    shipForm.reset();
    document.getElementById('ship-id').value = '';
    modalTitle.textContent = 'Lancement d'un nouvel appareil';
    modal.style.display = 'flex';
}

function openModalForEdit(ship) {
    shipForm.reset();
    document.getElementById('ship-id').value = ship.id;
    document.getElementById('ship-name').value = ship.name;
    document.getElementById('ship-type').value = ship.type;
    document.getElementById('ship-year').value = ship.launch_year;
    document.getElementById('ship-status').value = ship.status;
    modalTitle.textContent = `Modification : ${ship.name}`;
    modal.style.display = 'flex';
}

function closeModal() {
    modal.style.display = 'none';
    notificationArea.textContent = '';
}

function createShipCard(ship) {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
        <h3>${ship.name} (ID: ${ship.id})</h3>
        <p>Type : ${ship.type}</p>
        <p>Ann√©e de lancement : ${ship.launch_year}</p>
        <p>Statut : ${ship.status}</p>
        <div class="card-actions">
            <button class="edit-btn" data-ship-id="${ship.id}">Modifier</button>
            <button class="delete-btn" data-ship-id="${ship.id}">Mettre au rebut</button>
        </div>
    `;
    return card;
}

// --- Logique API et affichage ---

async function fetchAndDisplayFleet() {
    try {
        fleetListContainer.innerHTML = '<p>Chargement de la t√©l√©m√©trie...</p>';
        const ships = await apiRequest('/spaceships');

        fleetListContainer.innerHTML = '';
        if (ships.length === 0) {
            fleetListContainer.innerHTML = '<p>Aucun appareil dans le registre.</p>';
            return;
        }
        ships.forEach(ship => {
            const card = createShipCard(ship);
            fleetListContainer.appendChild(card);
        });
    } catch (error) {
        fleetListContainer.innerHTML = `<p style="color: #ff6b6b;">Erreur de chargement de la flotte : ${error.message}</p>`;
    }
}

async function handleSaveShip(event) {
    event.preventDefault();
    const shipId = document.getElementById('ship-id').value;
    const shipData = {
        name: document.getElementById('ship-name').value,
        type: document.getElementById('ship-type').value,
        launch_year: parseInt(document.getElementById('ship-year').value),
        status: document.getElementById('ship-status').value
    };

    try {
        let response;
        if (shipId) {
            // Mise √† jour (PUT)
            response = await apiRequest(`/spaceships/${shipId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(shipData)
            });
            showNotification(`L'appareil "${response.name}" a √©t√© mis √† jour avec succ√®s !`);
        } else {
            // Cr√©ation (POST)
            response = await apiRequest('/spaceships', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(shipData)
            });
            showNotification(`L'appareil "${response.name}" a √©t√© lanc√© avec succ√®s ! ID : ${response.id}`);
        }

        setTimeout(() => {
            closeModal();
            fetchAndDisplayFleet();
        }, 1500);

    } catch (error) {
        showNotification(error.message, true);
    }
}

async function handleDeleteShip(shipId) {
    if (!confirm(`√ätes-vous s√ªr de vouloir mettre au rebut l'appareil avec l'ID ${shipId} ?`)) return;

    try {
        await apiRequest(`/spaceships/${shipId}`, { method: 'DELETE' });
        alert('L'appareil a √©t√© mis au rebut avec succ√®s.');
        fetchAndDisplayFleet();
    } catch (error) {
        alert(`Erreur lors de la mise au rebut : ${error.message}`);
    }
}

// --- Gestionnaires d'√©v√©nements ---

document.addEventListener('DOMContentLoaded', fetchAndDisplayFleet);
loadFleetBtn.addEventListener('click', fetchAndDisplayFleet);
showCreateFormBtn.addEventListener('click', openModalForCreate);
cancelBtn.addEventListener('click', closeModal);
shipForm.addEventListener('submit', handleSaveShip);

fleetListContainer.addEventListener('click', async (event) => {
    const target = event.target;
    if (target.classList.contains('delete-btn')) {
        handleDeleteShip(target.dataset.shipId);
    }
    if (target.classList.contains('edit-btn')) {
        try {
            const ship = await apiRequest(`/spaceships/${target.dataset.shipId}`);
            openModalForEdit(ship);
        } catch (error) {
            alert(`Impossible de charger les donn√©es pour la modification : ${error.message}`);
        }
    }
});
```

---

#### **5. Tests finaux**

1.  **Lancez le serveur FastAPI :** `uvicorn main:app --reload`
2.  **Ouvrez `index.html`** dans le navigateur (via Live Server).
3.  **V√©rifiez le cycle complet :**
    - La liste des vaisseaux doit se charger automatiquement.
    - Cliquez sur "Lancer un nouvel appareil", remplissez le formulaire et enregistrez. Assurez-vous que le nouveau vaisseau appara√Æt dans la liste.
    - Cliquez sur "Modifier" sur n'importe quel vaisseau, modifiez les donn√©es et enregistrez. Assurez-vous que les informations ont √©t√© mises √† jour.
    - Cliquez sur "Mettre au rebut" sur n'importe quel vaisseau, confirmez l'action. Assurez-vous qu'il dispara√Æt de la liste.
    - V√©rifiez tous les sc√©narios d'erreur (donn√©es incorrectes, arr√™t du serveur).

---

#### **Quiz pour la consolidation**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>
<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Une fen√™tre modale dans une interface web est...</p>
      <label><input type="radio" name="q1" value="a"> a) Un nouveau tag en HTML6</label>
      <label><input type="radio" name="q1" value="b"> b) Une bo√Æte de dialogue pop-up qui bloque le reste de l'interface</label>
      <label><input type="radio" name="q1" value="c"> c) Une fen√™tre pour afficher les erreurs de la console</label>
    </div>
    <div class="question">
      <p>2. L'√©v√©nement `DOMContentLoaded` se produit quand...</p>
      <label><input type="radio" name="q2" value="a"> a) Toutes les images et les styles sont enti√®rement charg√©s</label>
      <label><input type="radio" name="q2" value="b"> b) Le navigateur a construit l'arbre DOM √† partir du HTML, mais les ressources peuvent encore √™tre en cours de chargement</label>
      <label><input type="radio" name="q2" value="c"> c) Une erreur de chargement de la page s'est produite</label>
    </div>
    <div class="question">
      <p>3. Pourquoi, dans la version finale, utilisons-nous un seul formulaire pour la cr√©ation et l'√©dition ?</p>
      <label><input type="radio" name="q3" value="a"> a) Pour √©viter la duplication du code HTML et simplifier la logique</label>
      <label><input type="radio" name="q3" value="b"> b) Parce que le navigateur ne permet pas d'avoir plus d'un formulaire par page</label>
      <label><input type="radio" name="q3" value="c"> c) C'est une exigence de FastAPI</label>
    </div>
    <div class="question">
      <p>4. `data-ship-id="${ship.id}"` ‚Äî c'est un exemple de...</p>
      <label><input type="radio" name="q4" value="a"> a) Classe CSS</label>
      <label><input type="radio" name="q4" value="b"> b) Variable JavaScript</label>
      <label><input type="radio" name="q4" value="c"> c) Attribut de donn√©es personnalis√© pour stocker des informations en HTML</label>
    </div>
    <div class="question">
      <p>5. Le refactoring de code (par exemple, le d√©placement de la logique dans `api.js`) est n√©cessaire pour...</p>
      <label><input type="radio" name="q5" value="a"> a) Rendre le code plus complexe pour le prot√©ger contre la copie</label>
      <label><input type="radio" name="q5" value="b"> b) Am√©liorer la lisibilit√©, la maintenabilit√© et la r√©utilisation du code</label>
      <label><input type="radio" name="q5" value="c"> c) R√©duire la taille du fichier final</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'a', q4: 'c', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ R√©sum√© du chapitre**

Vous avez achev√© avec succ√®s la construction et le lancement de votre "Centre de Contr√¥le de Mission".

- üñ•Ô∏è Vous avez cr√©√© une interface HTML/CSS structur√©e et stylis√©e.
- ‚öôÔ∏è Vous avez √©crit un code JavaScript propre et modulaire, impl√©mentant un cycle CRUD complet.
- üõ∞Ô∏è Votre frontend peut d√©sormais g√©rer enti√®rement le backend cr√©√© avec FastAPI.

**F√©licitations pour avoir termin√© le Chapitre 4 !** Vous avez parcouru tout le chemin, de l'envoi d'une simple requ√™te `fetch` √† la cr√©ation d'une application web compl√®te qui interagit avec votre propre API.