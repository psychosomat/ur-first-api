# **Chapitre 5.2 : Cr√©ation de vues simples pour l'API**
**Temps d'√©tude :** 45 minutes

---

### **1. Objectif : Visualiser les donn√©es**

Notre API au Chapitre 2 est capable de renvoyer des donn√©es au format JSON. C'est excellent pour les machines, mais les humains pr√©f√®rent voir les informations sur des pages web joliment con√ßues. Notre objectif est de cr√©er deux pages de ce type :

1.  **Liste de toutes les plan√®tes** (`/planets`)
2.  **Page d'une seule plan√®te** (`/planets/{id}`)

Pour cela, nous utiliserons la combinaison "Route ‚Üí Contr√¥leur ‚Üí Vue".

> üí° **Analogie spatiale :**

> Imaginez que le JSON de l'API sont des donn√©es de t√©l√©m√©trie brutes, juste un flux de chiffres. Notre t√¢che aujourd'hui est de cr√©er deux √©crans (deux "vues") au centre de contr√¥le :

> - **√âcran g√©n√©ral :** affiche le statut de tous les objets du syst√®me (liste des plan√®tes).
> - **√âcran d√©taill√© :** en cliquant sur un objet, affiche toutes les informations le concernant (page d'une seule plan√®te).

---

### **2. √âtape 1 : Cr√©ation du contr√¥leur pour les pages web**
Pour la puret√© de l'architecture, il ne faut pas m√©langer la logique de l'API et la logique des pages web dans un seul contr√¥leur. Nous allons cr√©er un nouveau contr√¥leur sp√©cifiquement pour afficher nos vues Blade.

Ex√©cutez dans le terminal :
```bash
php artisan make:controller Web/PlanetPageController
```
*Nous le cr√©ons dans le sous-dossier `Web` pour le s√©parer des contr√¥leurs d'API.*

Ouvrez le fichier cr√©√© `app/Http/Controllers/Web/PlanetPageController.php`.

---

### **√âtape 2 : Page avec la liste de toutes les plan√®tes**
**1. Cr√©ation d'une m√©thode dans le contr√¥leur :**
Dans `PlanetPageController`, ajoutez la m√©thode `index` qui r√©cup√©rera toutes les plan√®tes de la base de donn√©es et les transmettra √† la vue.
```php
<?php

namespace App\Http\Controllers\Web;

use App\Http\Controllers\Controller;
use App\Models\Planet; // N'oubliez pas d'importer le mod√®le

class PlanetPageController extends Controller
{
    /**
     * Affiche la page avec la liste de toutes les plan√®tes.
     */
    public function index()
    {
        // 1. R√©cup√©rons toutes les plan√®tes de la BDD
        $planets = Planet::all();

        // 2. Retournons la vue et transmettons les donn√©es
        return view('planets.index', ['planets' => $planets]);
    }
}
```

**2. Cr√©ation de la vue Blade :**
Cr√©ez le fichier `resources/views/planets/index.blade.php`. Nous utiliserons la mise en page cr√©√©e dans le chapitre pr√©c√©dent.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planets</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 2em;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
        }
        h2 {
            color: #1a202c;
        }
        hr {
            border: none;
            border-top: 1px solid #e2e8f0;
            margin: 1.5em 0;
        }
        .planet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5em;
        }
        .planet-card {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5em;
            padding: 1.5em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        .planet-card:hover {
            transform: translateY(-5px);
        }
        .planet-card h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .planet-card p {
            margin-bottom: 0.5em;
            color: #4a5568;
        }
        .planet-card a {
            color: #4299e1;
            text-decoration: none;
            font-weight: bold;
        }
        .planet-card a:hover {
            text-decoration: underline;
        }
        .no-planets {
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Liste de toutes les plan√®tes connues</h2>
        <hr>
        <div class="planet-list">
            @forelse($planets as $planet)
                <div class="planet-card">
                    <h3>{{ $planet->name }}</h3>
                    <p>Syst√®me solaire : {{ $planet->solar_system }}</p>
                    <p>Diam√®tre : {{ number_format($planet->size_km, 0, '.', ' ') }} km</p>
                    <a href="/planets/{{ $planet->id }}">En savoir plus &rarr;</a>
                </div>
            @empty
                <p class="no-planets">Il n'y a aucune plan√®te dans la base de donn√©es. Veuillez ex√©cuter les seeders.</p>
            @endforelse
        </div>
    </div>
</body>
</html>
```

-   `number_format(...)` est une fonction PHP standard pour un formatage agr√©able des nombres. Elle peut √™tre utilis√©e directement dans Blade.

**3. Cr√©ation de la route dans `routes/web.php` :**
```php
use App\Http\Controllers\Web\PlanetPageController;

// ...

Route::get('/planets', [PlanetPageController::class, 'index']);
```
Maintenant, si vous vous rendez √† l'adresse `/planets` dans votre navigateur, vous verrez la page avec la liste des plan√®tes !

---

### **4. √âtape 3 : Page d'une seule plan√®te**
**1. Cr√©ation d'une m√©thode dans le contr√¥leur :**

Dans `PlanetPageController`, nous ajouterons la m√©thode `show`. Gr√¢ce au Route Model Binding, Laravel trouvera automatiquement la plan√®te par son ID et la transmettra √† la m√©thode.

```php
<?php
// √Ä l'int√©rieur de la classe PlanetPageController
/**
 * Affiche la page d'une plan√®te sp√©cifique.
 */
public function show(Planet $planet)
{
    // Laravel a d√©j√† trouv√© la plan√®te pour nous.
    // Si elle n'est pas trouv√©e, il retournera automatiquement une erreur 404.

    return view('planets.show', ['planet' => $planet]);
}
```

**2. Cr√©ation de la vue Blade :**

Cr√©ez le fichier `resources/views/planets/show.blade.php`.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ $planet->name }}</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            width: 100%;
        }
        .planet-detail {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5em;
            padding: 2em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .planet-detail h1 {
            margin-top: 0;
            color: #2d3748;
        }
        .planet-detail p {
            margin-bottom: 1em;
            color: #4a5568;
            font-size: 1.1em;
        }
        .back-link {
            display: inline-block;
            margin-top: 1.5em;
            color: #4299e1;
            text-decoration: none;
            font-weight: bold;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="planet-detail">
            @if($planet->image_url)
                <img src="{{ $planet->image_url }}" alt="Image de {{ $planet->name }}" style="max-width: 100%; height: auto; border-radius: 0.5em; margin-bottom: 1em;">
            @endif
            <h1>{{ $planet->name }}</h1>
            @if($planet->description)
                <p>{{ $planet->description }}</p>
            @endif
            <p><strong>Syst√®me solaire :</strong> {{ $planet->solar_system }}</p>
            <p><strong>Diam√®tre :</strong> {{ number_format($planet->size_km, 0, '.', ' ') }} km</p>
            <a href="/planets" class="back-link">&larr; Retour √† la liste des plan√®tes</a>
        </div>
    </div>
</body>
</html>
```

**3. Cr√©ation de la route dans `routes/web.php` :**
```php
// Ajoutez cette route apr√®s la route pour /planets
Route::get('/planets/{planet}', [PlanetPageController::class, 'show']);
```
-   Le nom du param√®tre `{planet}` doit correspondre au nom de la variable dans la m√©thode du contr√¥leur (`show(Planet $planet)`) pour que le Route Model Binding fonctionne correctement.

Maintenant, en cliquant sur le lien "En savoir plus" sur la page de la liste, vous acc√©derez √† la page d√©taill√©e d'une plan√®te sp√©cifique.

---

### **Quiz de consolidation**


<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Quelle approche est la meilleure pratique pour s√©parer la logique de l'API et des pages web ?</p>
      <label><input type="radio" name="q1" value="a"> a) Utiliser un seul contr√¥leur pour tout</label>
      <label><input type="radio" name="q1" value="b"> b) Cr√©er des contr√¥leurs distincts (par exemple, dans les dossiers `Web` et `Api`)</label>
      <label><input type="radio" name="q1" value="c"> c) Placer toute la logique dans le fichier de routes</label>
    </div>
    <div class="question">
      <p>2. Que fait return view('planets.index', ['planets' => $planets]);?</p>
      <label><input type="radio" name="q2" value="a"> a) Renvoie un tableau JSON avec les donn√©es des plan√®tes</label>
      <label><input type="radio" name="q2" value="b"> b) Rend le fichier resources/views/planets/index.blade.php et lui transmet la variable `$planets`</label>
      <label><input type="radio" name="q2" value="c"> c) Redirige vers l'URL /planets/index</label>
    </div>
    <div class="question">
      <p>3. Qu'est-ce que le Route Model Binding dans le contexte de `show(Planet $planet)` ?</p>
      <label><input type="radio" name="q3" value="a"> a) Laravel lie manuellement la route au mod√®le dans la configuration</label>
      <label><input type="radio" name="q3" value="b"> b) Laravel trouve automatiquement dans la BDD l'enregistrement `Planet` par le param√®tre de l'URL (`{planet}`)</label>
      <label><input type="radio" name="q3" value="c"> c) Laravel cr√©e une nouvelle plan√®te si elle n'est pas trouv√©e</label>
    </div>
    <div class="question">
      <p>4. Comment formater une date √† partir du champ `created_at` dans Blade ?</p>
      <label><input type="radio" name="q4" value="a"> a) {{ $planet->created_at->format('Y-m-d') }}</label>
      <label><input type="radio" name="q4" value="b"> b) {{ format_date($planet->created_at) }}</label>
      <label><input type="radio" name="q4" value="c"> c) Cela ne peut √™tre fait que dans le contr√¥leur</label>
    </div>
    <div class="question">
      <p>5. Si la route sp√©cifie `/posts/{post}`, comment doit se pr√©senter la signature de la m√©thode dans le contr√¥leur pour que le Route Model Binding fonctionne ?</p>
      <label><input type="radio" name="q5" value="a"> a) public function show(Post $post)</label>
      <label><input type="radio" name="q5" value="b"> b) public function show(Post $p)</label>
      <label><input type="radio" name="q5" value="c"> c) public function show($post)</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'a', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';
for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre r√©sultat : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ R√©sum√© du chapitre :**

Vous avez r√©ussi √† cr√©er une "vitrine" pour votre API en utilisant l'architecture Laravel MVC. Vous avez maintenant :

-   Un contr√¥leur s√©par√© pour la logique des pages web.
-   Une page dynamique avec la liste de toutes les plan√®tes, r√©cup√©rant les donn√©es de la base de donn√©es.
-   Une page d√©taill√©e pour chaque plan√®te utilisant le Route Model Binding.
-   Deux routes web dans `routes/web.php` pour acc√©der √† ces pages.

**Vous avez transform√© des donn√©es brutes en informations claires et utiles pour l'utilisateur.** Dans le chapitre suivant, nous ajouterons de l'interactivit√© en int√©grant du JavaScript dans nos vues Blade pour interagir avec l'API sans recharger la page.