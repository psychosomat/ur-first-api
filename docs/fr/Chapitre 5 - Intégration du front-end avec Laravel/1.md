# **Chapitre 5.1: Les mod√®les Blade dans Laravel**
**Temps d'√©tude:** 40 minutes

---

### **1. Qu'est-ce que Blade? Votre "plan intelligent"**

Jusqu'√† pr√©sent, nous avons travaill√© avec deux extr√™mes: un `index.html` pur et une r√©ponse JSON pure d'une API. Mais comment cr√©er des pages web compl√®tes qui affichent dynamiquement des donn√©es de notre backend?

**Blade** est le moteur de templating int√©gr√© √† Laravel. Il nous permet d'√©crire du HTML ordinaire, mais avec des "super-pouvoirs":

-   Ins√©rer des variables et ex√©cuter du code PHP avec une syntaxe √©l√©gante.
-   Cr√©er des "layouts" de pages r√©utilisables (en-t√™tes, pieds de page).
-   Utiliser des boucles et des conditions directement dans le code HTML.
-   Se prot√©ger automatiquement des attaques XSS.

> üí° **Analogie spatiale:**

> Imaginez que le HTML est un simple plan de vaisseau spatial. Blade est un syst√®me de CAO avanc√©. Vous ne dessinez pas seulement des lignes, vous ajoutez des objets "intelligents". Vous dites: "Voici la liste de l'√©quipage", et Blade demande automatiquement les donn√©es et la remplit. "Voici l'√©cran principal", et Blade ins√®re l'interface standard.

Tous les fichiers Blade ont l'extension `.blade.php` et sont stock√©s dans le dossier `resources/views/`.

---

### **2. Les bases de la syntaxe: Affichage des donn√©es**
La chose la plus simple que Blade fait est d'afficher des donn√©es.

**Syntaxe `{{ }}`**

Ces doubles accolades sont la commande pour Blade "prendre une variable et afficher son contenu en toute s√©curit√©".

**Exemple:**

1.  **Route dans `routes/web.php`:**
    ```php
	<?php
    Route::get('/mission-briefing', function () {
        $mission = '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É Kepler-186';
        return view('briefing', ['mission_name' => $mission]); // indique √† Laravel de trouver le fichier resources/views/briefing.blade.php
    });
    ```

    -   `view('briefing', ...)` indique √† Laravel de trouver le fichier `resources/views/briefing.blade.php`.
    -   `['mission_name' => $mission]` ‚Äî c'est un tableau de donn√©es que nous "passons" √† notre vue.

2.  **Vue dans `resources/views/briefing.blade.php`:**
    ```html
    <h1>Mission du Centre de Contr√¥le</h1>
    <p>T√¢che actuelle: {{ $mission_name }}</p>
    ```

**R√©sultat dans le navigateur √† l'adresse `/mission-briefing`:**
```html
<h1>Mission du Centre de Contr√¥le</h1>
<p>T√¢che actuelle: Explorer le syst√®me Kepler-186</p>
```

> üõ°Ô∏è **Important √† savoir:** Blade √©chappe automatiquement toutes les donn√©es √† l'int√©rieur de `{{ }}`. Cela signifie que si une variable contient des balises HTML ou un script malveillant, elles seront affich√©es comme du texte brut et non ex√©cut√©es. C'est une protection int√©gr√©e contre les attaques XSS.

> *Pour afficher du HTML non √©chapp√© (faites-le avec prudence!), utilisez la syntaxe `{!! $variable !!}`.*

---

### **3. Directives: Ajouter de la logique au HTML**
Les directives Blade commencent par le symbole `@`. Elles permettent d'utiliser des boucles, des conditions et bien plus encore.

**Conditions (`@if`, `@else`):**
```js
@if($planet->is_habitable)
    <p style="color: green;">La plan√®te est habitable!</p>
@else
    <p style="color: red;">Combinaison spatiale requise. L'atmosph√®re est hostile.</p>
@endif
```

**Boucles (`@foreach`, `@forelse`):**

`@forelse` est une directive tr√®s pratique qui combine une boucle et une v√©rification de vide.
```js
<h2>Liste des plan√®tes du syst√®me:</h2>
<ul>
    @forelse($planets as $planet)
        <li>
            {{ $loop->iteration }}. {{ $planet->name }}
            <!-- $loop - variable sp√©ciale disponible dans la boucle -->
        </li>
    @empty
        <li>Aucune plan√®te d√©tect√©e dans ce syst√®me.</li>
    @endforelse
</ul>
```

---

### **4. Layouts et sections: Ne vous r√©p√©tez pas (DRY)**
La fonctionnalit√© la plus puissante de Blade est la cr√©ation de layouts r√©utilisables. Vous n'avez pas besoin de copier l'en-t√™te et le pied de page du site sur chaque page.

**√âtape 1: Cr√©er un layout ma√Ætre**

Cr√©ez le fichier `resources/views/layouts/app.blade.php`:
```php
<?php
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Centre de Contr√¥le - @yield('title')</title>
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
</head>
<body>
    <header>
        <h1>Centre de Commandement de la Flotte Galactique</h1>
    </header>

    <main>
        @yield('content') <!-- Le contenu unique de la page sera ici -->
    </main>

    <footer>
        <p>&copy; {{ date('Y') }} Space Command. Tous droits r√©serv√©s.</p>
    </footer>
</body>
</html>
```
-   `@yield('title')` et `@yield('content')` sont des "slots" ou "placeholders".

**√âtape 2: Cr√©er une vue enfant qui utilise le layout**

Cr√©ez le fichier `resources/views/planets/index.blade.php`:
```php
<?php
@extends('layouts.app') {{-- H√©rite de notre layout ma√Ætre --}}

@section('title', 'Liste des plan√®tes') {{-- Remplit la section 'title' --}}

@section('content') {{-- Remplit la section principale 'content' --}}
    <h2>Plan√®tes enregistr√©es</h2>
    <p>Ceci est une liste de tous les mondes que nous connaissons.</p>
    {{-- Votre boucle @forelse pour afficher les plan√®tes peut √™tre ici --}}
@endsection
```

Maintenant, lorsque Laravel rendra `planets.index`, il prendra d'abord `layouts.app`, puis ins√©rera le contenu des sections `@section`.

---

### **Quiz pour la consolidation**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Quelle extension ont les fichiers de mod√®les Blade?</p>
      <label><input type="radio" name="q1" value="a"> a) .html</label>
      <label><input type="radio" name="q1" value="b"> b) .blade.php</label>
      <label><input type="radio" name="q1" value="c"> c) .php.blade</label>
    </div>
    <div class="question">
      <p>2. Comment afficher en toute s√©curit√© une variable `$name` dans Blade?</p>
      <label><input type="radio" name="q2" value="a"> a) <?php echo $name; ?></label>
      <label><input type="radio" name="q2" value="b"> b) {{ $name }}</label>
      <label><input type="radio" name="q2" value="c"> c) [[$name]]</label>
    </div>
    <div class="question">
      <p>3. Quelle directive est utilis√©e pour h√©riter un layout ma√Ætre?</p>
      <label><input type="radio" name="q3" value="a"> a) @include('layouts.app')</label>
      <label><input type="radio" name="q3" value="b"> b) @layout('layouts.app')</label>
      <label><input type="radio" name="q3" value="c"> c) @extends('layouts.app')</label>
    </div>
    <div class="question">
      <p>4. Que fait la directive `@yield('content')`?</p>
      <label><input type="radio" name="q4" value="a"> a) D√©finit un placeholder (emplacement pour ins√©rer du contenu)</label>
      <label><input type="radio" name="q4" value="b"> b) Ins√®re le contenu du fichier `content.blade.php`</label>
      <label><input type="radio" name="q4" value="c"> c) Termine la section de contenu</label>
    </div>
    <div class="question">
      <p>5. Quelle directive est id√©ale pour boucler sur un tableau qui peut √™tre vide?</p>
      <label><input type="radio" name="q5" value="a"> a) @foreach</label>
      <label><input type="radio" name="q5" value="b"> b) @while</label>
      <label><input type="radio" name="q5" value="c"> c) @forelse</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'c', q4: 'a', q5: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Bonne r√©ponse: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score: ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ R√©sum√© du chapitre:**

Vous avez appris les bases de Blade ‚Äî un outil puissant pour cr√©er des pages web dynamiques. Vous savez maintenant comment:

-   Afficher des donn√©es avec une protection automatique contre les XSS.
-   Utiliser des directives pour ajouter de la logique (`@if`, `@forelse`).
-   Cr√©er des layouts r√©utilisables √† l'aide de `@extends` et `@yield`.

Nous avons pr√©par√© les "plans" pour les panneaux de contr√¥le de notre vaisseau. Dans le chapitre suivant, nous cr√©erons des "panneaux" (vues) sp√©cifiques pour notre API et y afficherons des donn√©es r√©elles.