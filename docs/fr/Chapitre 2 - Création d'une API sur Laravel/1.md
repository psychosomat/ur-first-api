# **Chapitre 2.1 : Pr√©paration de l'environnement Laravel**
**Temps d'√©tude :** 1-2 heures
---

#### **1. Pourquoi un environnement local est-il n√©cessaire ?**
Imaginez que vous construisez une sonde spatiale. Avant de la lancer dans l'espace, vous **testez tous les syst√®mes sur Terre**. L'environnement local est votre "laboratoire de contr√¥le" pour le code :

- Exp√©riences s√©curis√©es sans impact sur le serveur de production
- D√©ploiement rapide des d√©pendances
- Basculement facile entre les versions logicielles

> üí° **Analogie spatiale :**
> Herd = Complexe de lancement mobile
> Docker = Simulateur de station spatiale
> XAMPP = Banc d'essai stationnaire

---

#### **2. Installation de Herd**
**Herd** ‚Äî un outil moderne pour g√©rer l'environnement PHP (analogue √† Laravel Valet).

**√âtapes d'installation :**

1. T√©l√©chargez l'installateur : [herd.laravel.com](https://herd.laravel.com)
2. Ex√©cutez `Herd Installer.exe` ‚Üí Suivant ‚Üí Installer
3. Apr√®s l'installation :
   	- Ouvrez Herd depuis le menu D√©marrer. L'ic√¥ne de l'application appara√Ætra dans la barre d'√©tat syst√®me (√† c√¥t√© de l'horloge).
   	- Cliquez sur l'ic√¥ne Herd : assurez-vous que Nginx et la version de PHP souhait√©e (par exemple, 8.3) sont d√©marr√©s (indiqu√©s par un point vert).
   	- Allez dans Herd Paths et ajoutez le dossier o√π vos projets seront stock√©s (par exemple, C:\Users\YourUser\Code). Herd cr√©era automatiquement pour chaque sous-r√©pertoire de ce dossier un joli domaine de type nom-du-dossier.test.

> ‚ö†Ô∏è **Important !** Lors de l'installation :
> - Autorisez l'acc√®s au r√©seau (si le pare-feu le demande)
> - V√©rifiez le chemin dans PATH : `C:\Program Files\Herd\bin`

**V√©rification du fonctionnement :**

1. Cliquez sur l'ic√¥ne Herd dans la barre d'√©tat syst√®me.
2. Assurez-vous que les services Nginx et PHP sont actifs (indicateurs verts).
3. Cr√©ez un dossier test dans votre dossier de projets (par exemple, C:\Users\YourUser\Code), et √† l'int√©rieur, un fichier index.php avec le contenu ```<?php phpinfo(); ?>```.
4. Dans Herd, via l'onglet sites, indiquez le chemin vers le dossier test et cliquez sur "Add site".
5. Ouvrez l'adresse http://test.test dans votre navigateur. Vous devriez voir la page d'informations PHP.

---

#### **3. M√©thodes alternatives (en bref)**
| Outil       | Pour qui              | Avantages                          | Inconv√©nients                  |
|------------------|-----------------------|--------------------------------|-------------------------|
| **Laravel Sail (Docker)**       | Pour tous les niveaux  | Isolation compl√®te, r√©p√©tabilit√© de l'environnement, support officiel de Laravel | N√©cessite l'installation de Docker, consomme plus de ressources   |
| **XAMPP**        | D√©butants           | Tout en un (All-in-One)              | Encombrant, plus difficile √† g√©rer les versions logicielles, pollue le syst√®me   |
| **Laragon**      | D√©veloppeurs Windows | Rapide, facile √† changer de version, configuration automatique des h√¥tes        | N√©cessite un red√©marrage manuel du serveur web lors de l'ajout d'un nouveau projet     |

> **Exemple avec Docker (Laravel Sail) :**
> ```dockerfile
> # Apr√®s l'installation de Docker
> ./vendor/bin/sail up
> ```

---

#### **4. Installation de PHP et Composer**
**Si vous n'utilisez pas Herd :**

1. PHP :
   	- T√©l√©chargez [PHP 8.3 pour Windows](https://windows.php.net/download/)
   	- D√©compressez dans `C:\PHP`
   	- Ajoutez au PATH :
     ```powershell
	 # Recommand√© d'ex√©cuter dans PowerShell en tant qu'administrateur
     [Environment]::SetEnvironmentVariable("Path", "$env:Path;C:\PHP", "User")
     ```
2. Composer :
   	- Ex√©cutez [Composer-Setup.exe](https://getcomposer.org/download/)
   	- V√©rification :
     ```cmd
     php -v
     composer --version
     ```

---

#### **5. Installation de PostgreSQL**
**Pour travailler avec les bases de donn√©es :**

1. T√©l√©chargez [PostgreSQL 15](https://www.postgresql.org/download/windows/)
2. Ex√©cutez l'installateur :
   - Mot de passe du superutilisateur : `admin` (ou le v√¥tre)
   - Port : `5432` (standard)
3. Apr√®s l'installation :
   - Ouvrez **pgAdmin 4** (client graphique)
   > Vous pouvez utiliser n'importe quel autre client pour travailler avec la base de donn√©es, par exemple, DBeaver, DataGrip ou m√™me la ligne de commande.
   > Je pr√©f√®re DBeaver - mais c'est une question de go√ªt
   - Cr√©ez une base de donn√©es pour le projet : `space_api`

---

#### **6. Installation de Laravel**
1. Via Composer :
```bash
composer create-project laravel/laravel space-api
cd space-api
```

2. Initialisation de Git (optionnel) :
```bash
git init
git add .
git commit -m "D√©marrage du projet spatial"
```

3. D√©marrage et v√©rification du serveur :
>Si vous utilisez Herd :
Assurez-vous que votre projet space-api se trouve dans le dossier que vous avez ajout√© √† Herd.
Ouvrez l'adresse dans votre navigateur : http://space-api.test
Vous devriez voir la page d'accueil de Laravel. Le serveur fonctionne d√©j√† gr√¢ce √† Herd !

Si vous N'UTILISEZ PAS Herd (installation manuelle) :
```bash
php artisan serve
```
Ouvrez dans le navigateur : [http://localhost:8000](http://localhost:8000) ‚Üí La page d'accueil de Laravel devrait appara√Ætre !

### Lors de la cr√©ation du projet dans Herd :

Suivez simplement les instructions √† l'√©cran. Pour plus de commodit√©, le nom du projet sera `space-api`. Le kit de d√©marrage ‚Äî n'importe lequel, mais je pr√©f√®re React.

##### Assurez-vous d'activer phpunit - il nous sera utile plus tard

---

#### **7. Configuration du projet**
**Fichiers importants :**

- `.env` ‚Äî param√®tres d'environnement (cl√©s, bases de donn√©es)
- `config/database.php` ‚Äî configuration SGBD
- `composer.json` ‚Äî d√©pendances PHP

**Connexion de la BDD au projet :**

Ajoutez dans `.env` :

```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=space_api
DB_USERNAME=postgres # Nom d'utilisateur pour postgres
DB_PASSWORD=admin # Mot de passe pour postgres
```

**Premi√®res commandes Artisan :**
```bash
php artisan key:generate  # G√©n√©ration de la cl√© de l'application
php artisan migrate:fresh # Migration de la base de donn√©es (Lors du passage √† postgres)
```

---

#### **Quiz de consolidation**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Herd est...</p>
      <label><input type="radio" name="q1" value="a"> a) Un outil de gestion d'environnement PHP</label>
      <label><input type="radio" name="q1" value="b"> b) Un √©diteur de code</label>
      <label><input type="radio" name="q1" value="c"> c) Un syst√®me d'exploitation</label>
    </div>
    <div class="question">
      <p>2. Quel outil Laravel utilise-t-il pour g√©rer les d√©pendances PHP ?</p>
      <label><input type="radio" name="q2" value="a"> a) npm</label>
      <label><input type="radio" name="q2" value="b"> b) Composer</label>
      <label><input type="radio" name="q2" value="c"> c) Artisan</label>
    </div>
    <div class="question">
      <p>3. Le port standard pour PostgreSQL est :</p>
      <label><input type="radio" name="q3" value="a"> a) 3306</label>
      <label><input type="radio" name="q3" value="b"> b) 5432</label>
      <label><input type="radio" name="q3" value="c"> c) 8000</label>
    </div>
    <div class="question">
      <p>4. La commande pour cr√©er un projet Laravel via Composer est :</p>
      <label><input type="radio" name="q4" value="a"> a) composer create-laravel</label>
      <label><input type="radio" name="q4" value="b"> b) laravel new</label>
      <label><input type="radio" name="q4" value="c"> c) composer create-project laravel/laravel</label>
    </div>
    <div class="question">
      <p>5. Quel fichier contient les param√®tres d'environnement ?</p>
      <label><input type="radio" name="q5" value="a"> a) .env</label>
      <label><input type="radio" name="q5" value="b"> b) config.php</label>
      <label><input type="radio" name="q5" value="c"> c) settings.ini</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'b', q3: 'b', q4: 'c', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

### **üöÄ R√©sum√© du chapitre**
> Vous avez d√©ploy√© la "plateforme de lancement" pour l'API spatiale ! Vous disposez maintenant de :

> - üõ†Ô∏è Un environnement local (Herd ou installation manuelle) avec PHP et Nginx
> - üêò Un serveur de bases de donn√©es PostgreSQL install√©
> - üöÄ Un projet Laravel `space-api`
> - üîå Une connexion configur√©e √† la base de donn√©es
>
> **üìå V√©rification :**

> - **Si vous utilisez Herd :** Assurez-vous que le site s'ouvre √† l'adresse `http://space-api.test`.
> - **Si sans Herd :** Assurez-vous que la commande `php artisan serve` fonctionne et que le site s'ouvre √† l'adresse `http://localhost:8000`.
> - Dans tous les cas, v√©rifiez que la base de donn√©es `space_api` cr√©√©e est visible dans `pgAdmin 4`.