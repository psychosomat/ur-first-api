# **Chapitre 2.2 : Cr√©ation du mod√®le Planet**
**Temps d'√©tude :** 45 minutes

---

#### **1. Le mod√®le dans Laravel : Plan d'un objet cosmique**
Dans l'architecture MVC (Model-View-Controller), le **mod√®le** est :

- üì¶ Un conteneur pour les donn√©es (param√®tres des plan√®tes)
- üîå Une interface de travail avec la base de donn√©es
- üõ°Ô∏è Le centre de la logique m√©tier de l'application

> üí° **Analogie spatiale :**
> Le mod√®le `Planet` = Le plan d'une plan√®te dans l'ordinateur du centre de contr√¥le. Avec lui, on peut :

> - Cr√©er une nouvelle plan√®te dans le catalogue (`INSERT`)
> - Obtenir des donn√©es sur Mars (`SELECT`)
> - Mettre √† jour les informations sur l'atmosph√®re (`UPDATE`)

---

#### **2. Cr√©ation du mod√®le et de la migration**
Laravel utilise Artisan CLI ‚Äî votre "t√©l√©commande" de projet.

**√âtape 1 : G√©n√©ration du mod√®le avec migration**
```bash
php artisan make:model Planet -m
```

**Ce qui a √©t√© cr√©√© :**
```
app/
  ‚îî‚îÄ‚îÄ Models/
      ‚îî‚îÄ‚îÄ Planet.php    ‚Üê Mod√®le
database/
  ‚îî‚îÄ‚îÄ migrations/
      ‚îî‚îÄ‚îÄ 2025_08_04_000000_create_planets_table.php  ‚Üê Migration
```

**Options Artisan :**

- `-m` ‚Üí Cr√©er une migration
- `-c` ‚Üí Cr√©er un contr√¥leur
- `-r` ‚Üí Contr√¥leur de ressources

> üí° **Conseil de pro :** Ces options peuvent √™tre combin√©es pour une efficacit√© maximale. La commande `php artisan make:model Planet -mcr` cr√©era instantan√©ment un mod√®le, une migration et un contr√¥leur de ressources pour g√©rer ce mod√®le. Cela fait gagner beaucoup de temps.

---

#### **3. Configuration du mod√®le Planet**
Ouvrez `app/Models/Planet.php` :
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Planet extends Model
{
    // Nom de la table (par d√©faut : 'planets')
	// Laravel suppose automatiquement que le nom de la table est la forme plurielle du nom du mod√®le en snake_case (Planet -> planets).
     // Par cons√©quent, cette propri√©t√© n'est pas obligatoire ici, mais utile pour la clart√©.
    protected $table = 'planets';

    // Champs autoris√©s pour l'assignation massive
    protected $fillable = [
        'name',
        'description',
        'size_km',
        'solar_system',
        'image_url'
    ];

    // Types de donn√©es pour la conversion automatique
    protected $casts = [
        'size_km' => 'integer'
    ];
}
```

**Explication des propri√©t√©s :**

| Propri√©t√©         | Valeur                                 | Exemple de donn√©es        |
|-------------------|----------------------------------------|---------------------------|
| `$table`          | Nom de la table dans la BDD            | `planets`                 |
| `$fillable`       | Champs pour l'assignation massive      | `name`, `size_km`         |
| `$casts`          | Conversion automatique des types       | `size_km: integer`        |

---

#### **4. Conception de la table des plan√®tes**
Avant d'√©diter la migration, d√©finissons la structure d'une "plan√®te" :

| Champ          | Type de donn√©es  | Description                          | Exemple de valeur       |
|----------------|------------------|--------------------------------------|-------------------------|
| `id`           | BIGINT (PK)      | ID unique                            | 1                       |
| `name`         | VARCHAR(255)     | Nom de la plan√®te                    | "Mars"                  |
| `description`  | TEXT             | Description                          | "Plan√®te rouge..."      |
| `size_km`      | INTEGER          | Diam√®tre en km                       | 6779                    |
| `solar_system` | VARCHAR(100)     | Syst√®me solaire                      | "Syst√®me solaire"       |
| `image_url`    | VARCHAR(2048)    | URL de la photo (peut √™tre null)     | "https://..."           |
| `created_at`   | TIMESTAMP        | Date de cr√©ation                     | 2025-08-04 12:00:00     |
| `updated_at`   | TIMESTAMP        | Date de mise √† jour                  | 2025-08-05 09:30:00     |

---

#### **5. √âdition de la migration**
Ouvrez le fichier de migration dans `database/migrations/..._create_planets_table.php` :

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreatePlanetsTable extends Migration
{
    public function up()
    {
        Schema::create('planets', function (Blueprint $table) {
            $table->id(); // BIGINT auto-incr√©ment

            $table->string('name')->unique();
            $table->text('description');
            $table->integer('size_km');
            $table->string('solar_system', 100);
            $table->string('image_url', 2048)->nullable();

            $table->timestamps(); // created_at + updated_at
        });
    }

    public function down()
    {
        Schema::dropIfExists('planets');
    }
}
```

**Points cl√©s :**

- `->unique()` ‚Üí Garantit l'unicit√© des noms
- `->nullable()` ‚Üí Le champ peut √™tre vide
- `timestamps()` ‚Üí Gestion automatique des dates

---

#### **6. Ex√©cution de la migration (pr√©liminaire)**
Bien que l'ex√©cution se fasse au chapitre 2.3, voyons √† quoi cela ressemblera :
```bash
php artisan migrate
```

**Sortie attendue :**
```
Migrating: 2025_08_04_000000_create_planets_table
Migrated:  2025_08_04_000000_create_planets_table (32.15ms)
```

**V√©rification dans pgAdmin 4 :**

1. Ouvrez la base de donn√©es `space_api` ‚Üí Schemas ‚Üí Tables
2. La table `planets` avec vos champs devrait appara√Ætre

---

#### **7. Approche alternative : G√©n√©rateurs de code**
Pour acc√©l√©rer le d√©veloppement, vous pouvez utiliser des packages :

- **Laravel Blueprint** - cr√©e des mod√®les/migrations √† partir d'une description YAML
- **InfyOm Laravel Generator** - g√©n√©rateur bas√© sur le sch√©ma de la BDD

**Exemple Blueprint :**
```yaml
models:
  Planet:
    name: string:255
    description: text
    size_km: integer
    solar_system: string:100
    image_url: string:2048? # Le signe '?' signifie que le champ est nullable
```

---

#### **Quiz de r√©vision**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Commande Artisan pour cr√©er un mod√®le et la migration associ√©e :</p>
      <label><input type="radio" name="q1" value="a"> a) php artisan make:model Planet -m</label>
      <label><input type="radio" name="q1" value="b"> b) php artisan create:model Planet</label>
      <label><input type="radio" name="q1" value="c"> c) php artisan model:new Planet --m</label>
    </div>
    <div class="question">
      <p>2. La propri√©t√© `$fillable` dans le mod√®le est utilis√©e pour</p>
      <label><input type="radio" name="q2" value="a"> a) La protection contre l'assignation massive</label>
      <label><input type="radio" name="q2" value="b"> b) Le chiffrement automatique des donn√©es</label>
      <label><input type="radio" name="q2" value="c"> c) La description des cl√©s √©trang√®res</label>
    </div>
    <div class="question">
      <p>3. nullable() dans une migration signifie :</p>
      <label><input type="radio" name="q3" value="a"> a) Le champ est obligatoire</label>
      <label><input type="radio" name="q3" value="b"> b) Le champ peut √™tre vide</label>
      <label><input type="radio" name="q3" value="c"> c) Le champ sera supprim√©</label>
    </div>
    <div class="question">
      <p>4. Type de champ pour une longue description de la plan√®te :</p>
      <label><input type="radio" name="q4" value="a"> a) string</label>
      <label><input type="radio" name="q4" value="b"> b) text</label>
      <label><input type="radio" name="q4" value="c"> c) varchar</label>
    </div>
    <div class="question">
      <p>5. La m√©thode `timestamps()` cr√©e :</p>
      <label><input type="radio" name="q5" value="a"> a) Seulement created_at</label>
      <label><input type="radio" name="q5" value="b"> b) created_at et updated_at</label>
      <label><input type="radio" name="q5" value="c"> c) id, created_at, updated_at</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'a', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ R√©sum√© du chapitre :**
Vous avez cr√©√© le "jumeau num√©rique" d'une plan√®te ! D√©sormais, votre projet contient :

- ü™ê Le mod√®le `Planet` avec sa logique m√©tier
- üìä Une migration pour la table `planets` dans PostgreSQL
- üõ†Ô∏è Des propri√©t√©s de mod√®le configur√©es (`fillable`, `casts`)

**Pr√©parez la base de donn√©es !** Dans le chapitre suivant, nous ex√©cuterons la migration et peuplerons l'univers avec les premi√®res plan√®tes.

> **üìå V√©rification :**

> Assurez-vous que les fichiers `Planet.php` et `..._create_planets_table.php` sont cr√©√©s dans les bons r√©pertoires.

> **‚ö†Ô∏è Si Artisan se plaint :**

> - V√©rifiez que vous √™tes dans le dossier du projet
> - Assurez-vous que les d√©pendances sont install√©es (`composer install`)
> - Pour Windows : ajoutez PHP et Composer au PATH