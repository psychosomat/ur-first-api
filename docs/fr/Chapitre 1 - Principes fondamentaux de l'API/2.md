# **Chapitre 1.2 : M√©thodes HTTP et codes de statut**
**Temps d'√©tude :** 40 minutes

---

#### **1. HTTP : Le langage de communication dans l'espace**
Imaginez que vous √™tes le **Centre de Contr√¥le de Mission (CCM)**, et le serveur API est le **vaisseau spatial**. HTTP (HyperText Transfer Protocol) est la **communication radio** entre vous.

Chaque message contient :

- **M√©thode** ‚Üí Ce qu'il faut faire (par exemple, "envoyer une sonde")

- **Code de statut** ‚Üí R√©sultat de l'op√©ration ("sonde lanc√©e avec succ√®s !")

> üí° **Analogie spatiale :**
> `GET /stars` = "CCM ‚Üí Vaisseau : Donne les coordonn√©es des √©toiles !"
> `200 OK` = "Vaisseau ‚Üí CCM : Coordonn√©es transmises !"

---

#### **2. M√©thodes HTTP principales**
Chaque m√©thode est comme un type de commande pour une mission spatiale :

| M√©thode    | Analogie spatiale                   | Exemple de requ√™te         | Description                   |
|------------|-------------------------------------|----------------------------|-------------------------------|
| **GET**    | Demande de donn√©es (t√©lescope)      | `GET /planets`             | Obtenir la liste des plan√®tes |
| **POST**   | Envoi d'un nouvel objet (lancement de fus√©e) | `POST /satellites`         | Cr√©er un nouveau satellite    |
| **PUT**    | Mise √† jour compl√®te d'un objet (correction d'orbite) | `PUT /satellites/iss`      | Mettre √† jour les donn√©es de l'ISS |
| **DELETE** | Destruction d'un objet (d√©sorbitation) | `DELETE /debris/123`       | Supprimer les d√©bris spatiaux |

**‚ö° Exemple de code (Python) :**
```python
import requests

# GET : Obtenir les donn√©es de la fus√©e Falcon 9
# Nous utilisons un endpoint r√©el de l'API SpaceX
response = requests.get("https://api.spacexdata.com/v4/rockets/5e9d0d95eda69973a809d1ec")
print(response.status_code, response.json()['name']) # 200 Falcon 9

# POST : Cr√©er un nouveau post dans une API de test
# Nous utilisons le service bac √† sable jsonplaceholder
new_post = {"title": "Artemis Mission", "body": "Ready for launch", "userId": 1}
response = requests.post("https://jsonplaceholder.typicode.com/posts", json=new_post)
print(response.status_code, response.json()['id'])  # 201 101 (ou autre ID)
```

---

#### **3. Codes de statut importants**
La r√©ponse du serveur est comme un signal d'un vaisseau spatial :

| Groupe | Code | Analogie spatiale                     | Description                  |
|--------|------|---------------------------------------|------------------------------|
| `2xx`  | 200  | ‚úÖ "Mission accomplie !"               | Succ√®s                       |
|        | 201  | üöÄ "Fus√©e lanc√©e !"                   | Objet cr√©√©                   |
| `3xx`  | 301  | üåç "Le CCM a √©t√© d√©plac√© vers une nouvelle adresse" | Redirection                  |
| `4xx`  | 400  | ‚ùå "Coordonn√©es incorrectes dans la requ√™te !" | Erreur client                |
|        | 404  | ü™ê "Plan√®te introuvable !"             | Ressource introuvable        |
| `5xx`  | 500  | üî• "Panne du syst√®me de propulsion !"  | Erreur serveur               |

---

#### **4. Pratique : Gestion des codes de statut**
V√©rifiez toujours la r√©ponse de l'API ! Exemple de gestion des erreurs :
```python
import requests

def get_post_data(post_id):
    """Fonction pour obtenir les donn√©es d'un post avec gestion des codes de statut."""
    try:
        response = requests.get(f"https://jsonplaceholder.typicode.com/posts/{post_id}")

        # V√©rifie le code de statut de la r√©ponse
        if response.status_code == 200:
            print(f"‚úÖ Donn√©es pour le post {post_id} obtenues avec succ√®s !")
            return response.json()
        elif response.status_code == 404:
            print(f"‚ö†Ô∏è Ressource pour le post {post_id} introuvable !")
            return None
        else:
            # G√®re les autres erreurs client (4xx) ou serveur (5xx)
            print(f"üö® Une erreur est survenue ! Code de statut : {response.status_code}")
            return None

    except requests.exceptions.RequestException as e:
        # G√®re les erreurs de connexion (par exemple, pas d'internet)
        print(f"üî• Erreur de connexion : {e}")
        return None

# --- Testons notre fonction ---
print("--- Recherche d'un post existant ---")
get_post_data(1)

print("\n--- Recherche d'un post inexistant ---")
get_post_data(9999) # Ce post n'existe pas, nous attendons 404
```

> **üî≠ Exemple d'une API r√©elle (SpaceX) :**
> Requ√™te : `GET https://api.spacexdata.com/v4/ships/OCISLY`
> R√©ponse : `200 OK` + donn√©es sur le vaisseau
> Requ√™te : `GET https://api.spacexdata.com/v4/ships/UNICORN`
> R√©ponse : `404 Not Found`

---

#### **Quiz de consolidation**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Quelle m√©thode utiliser pour obtenir des donn√©es sur les √©toiles ?</p>
      <label><input type="radio" name="q1" value="a"> a) POST</label>
      <label><input type="radio" name="q1" value="b"> b) PUT</label>
      <label><input type="radio" name="q1" value="c"> c) GET</label>
    </div>
    <div class="question">
      <p>2. Le statut `201 Created` signifie :</p>
      <label><input type="radio" name="q2" value="a"> a) Objet supprim√©</label>
      <label><input type="radio" name="q2" value="b"> b) Objet cr√©√©</label>
      <label><input type="radio" name="q2" value="c"> c) Erreur serveur</label>
    </div>
    <div class="question">
      <p>3. La m√©thode pour une mise √† jour compl√®te des donn√©es d'un satellite :</p>
      <label><input type="radio" name="q4" value="a"> a) PATCH</label>
      <label><input type="radio" name="q4" value="b"> b) DELETE</label>
      <label><input type="radio" name="q4" value="c"> c) PUT</label>
    </div>
    <div class="question">
      <p>4. Que signifie le statut `500 Internal Server Error` ?</p>
      <label><input type="radio" name="q5" value="a"> a) Erreur dans la requ√™te du client</label>
      <label><input type="radio" name="q5" value="b"> b) Panne du serveur</label>
      <label><input type="radio" name="q5" value="c"> c) Ex√©cution r√©ussie</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'c', q2: 'b', q4: 'c', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:red;">Incorrect.</span> R√©ponse correcte : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre r√©sultat : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ R√©sum√© du chapitre :**
Les m√©thodes HTTP sont vos commandes pour les missions spatiales, et les codes de statut sont les rapports sur leur ex√©cution. Rappelez-vous :
> `GET` = "Donne les donn√©es", `POST` = "Cr√©e un nouveau", `PUT` = "Mets tout √† jour", `DELETE` = "Supprime"
> `2xx` = Succ√®s, `4xx` = Ton erreur, `5xx` = Probl√®me c√¥t√© serveur

**Pr√©parez-vous au lancement !** Dans le prochain chapitre, nous d√©chiffrerons les "t√©l√©grammes" du serveur : le format JSON.

> **üìå Pratique :** Utilisez l'[API SpaceX](https://docs.spacexdata.com/) pour envoyer un `GET /launches/latest` et √©tudier les codes de r√©ponse !