# **Chapitre 1.4 : Structure de l'API REST**
**Temps d'√©tude :** 45 minutes

---

#### **1. API REST : Architecture d'une station spatiale**
Imaginez une station spatiale o√π chaque module dispose de :

- **Un port d'amarrage standard** (interface unique)

- **Une sp√©cialisation claire** (module d'habitation, laboratoire, stockage)

- **Un syst√®me de coordonn√©es** (emplacement pr√©cis)

L'API **REST (Representational State Transfer)** fonctionne selon les m√™mes principes :

- Une interface unique pour toutes les ressources

- Une s√©paration claire des composants

- Adressage via URI (coordonn√©es spatiales)

> üí° **Id√©e cl√© :**

> Chaque ressource (plan√®tes, fus√©es, astronautes) poss√®de une URL unique et interagit via des m√©thodes HTTP.

---

#### **2. Les 6 principes de REST par analogie spatiale**
| Principe REST          | Analogie avec l'ISS                     | Signification pour l'API                    |
|-----------------------|-----------------------------------------|---------------------------------------------|
| **Interface uniforme**| N≈ìuds d'amarrage standards             | R√®gles identiques pour toutes les requ√™tes  |
| **Stateless**         | Chaque commande est autonome            | Le serveur ne conserve pas l'√©tat du client |
| **Mise en cache**     | R√©serves de provisions locales          | Conservation des r√©ponses fr√©quentes        |
| **Client-serveur**    | S√©paration claire : Centre de contr√¥le ‚Üî Station | D√©veloppement ind√©pendant des composants   |
| **Syst√®me de couches**| Satellites relais                       | Proxys, √©quilibreurs de charge              |
| **Code √† la demande** | T√©l√©chargement de logiciels pour les exp√©riences | (Optionnel) Transfert de scripts            |

---

#### **3. Ressources et URI : Coordonn√©es spatiales**
Chaque objet dans l'API est une ressource avec une adresse unique :
```
https://api.spacexdata.com/v4/    ‚Üê URL de base
          rockets/            ‚Üê Collection de fus√©es
          rockets/5e9d0d95eda69973a809d1ec ‚Üê Fus√©e sp√©cifique (par ID)
```

**Exemples de ressources spatiales :**

- `GET /stars` ‚Üí Liste des √©toiles
- `GET /stars/sirius` ‚Üí Donn√©es sur Sirius
- `POST /satellites` ‚Üí Lancer un nouveau satellite
- `PUT /missions/artemis` ‚Üí Mettre √† jour une mission

**Sch√©ma d'arborescence URI :**
```
[URL de base]
‚îú‚îÄ‚îÄ /planets          ‚Üí Collection de plan√®tes
‚îÇ   ‚îú‚îÄ‚îÄ /mars         ‚Üí Ressource "Mars"
‚îÇ   ‚îî‚îÄ‚îÄ /venus        ‚Üí Ressource "V√©nus"
‚îî‚îÄ‚îÄ /launches         ‚Üí Collection de lancements
    ‚îú‚îÄ‚îÄ /upcoming     ‚Üí Sous-collection
    ‚îî‚îÄ‚îÄ /latest       ‚Üí Ressource
```

---

#### **4. Op√©rations CRUD via les m√©thodes HTTP**
| Op√©ration  | M√©thode HTTP | Exemple (Station spatiale)             | R√©ponse du serveur |
|------------|--------------|----------------------------------------|--------------------|
| **Create** | `POST`       | Envoyer un nouveau module              | `201 Created`      |
| **Read**   | `GET`        | Demander des donn√©es sur un module     | `200 OK`           |
| **Update** | `PUT`        | Reconfigurer un module                 | `200 OK`           |
| **Delete** | `DELETE`     | D√©samarrer un ancien module            | `204 No Content`   |

**‚ö° Exemple de code (Ajout d'un satellite) :**
```python
import requests

# Nous utilisons un service de test qui simule la cr√©ation d'une ressource
new_post = {
    "title": "Nouveau lancement de t√©lescope",
    "body": "Hubble-2 est pr√™t √† √™tre d√©ploy√©.",
    "userId": 1
}

# Cl√© API conditionnelle pour la d√©monstration des en-t√™tes
headers = {
    "Authorization": "Bearer YOUR_DEMO_KEY",
    "Content-Type": "application/json; charset=UTF-8"
}

response = requests.post(
    "https://jsonplaceholder.typicode.com/posts",
    json=new_post,
    headers=headers
)

if response.status_code == 201:
    print("‚úÖ Article sur le nouveau satellite cr√©√© avec succ√®s !")
    print("R√©ponse du serveur :")
    print(response.json())
else:
    print(f"‚ùå Erreur ! Statut : {response.status_code}")
```

---

#### **5. Versioning de l'API : √âvolution de la station**
Comme l'ISS est mise √† jour (Module "Zarya" ‚Üí "Nauka"), l'API change de versions :

- Dans l'URL : `https://api.spacex.com/v4/rockets`
- Dans les en-t√™tes : `Accept: application/vnd.spacex-v5+json`

**Pourquoi c'est important :**

- v1 : Fonctionnalit√© de base
- v2 : Nouveaux champs ajout√©s
- v3 : Structure des r√©ponses modifi√©e

> ‚ö†Ô∏è **Conseil :** Sp√©cifiez toujours la version dans vos requ√™tes, sinon "l'amarrage" pourrait √©chouer !

---

#### **6. Hypermedia (HATEOAS) : Navigation dans l'espace**
La r√©ponse de l'API contient des liens vers des ressources associ√©es ‚Äî comme une carte de la station :
```json
{
  "id": "iss",
  "name": "Station Spatiale Internationale",
  "crew": 7,
  "_links": {
    "self": { "href": "/stations/iss" },
    "modules": { "href": "/stations/iss/modules" },
    "schedule": { "href": "/stations/iss/schedule" }
  }
}
```

---

#### **Quiz pour consolidation**


<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. REST signifie :</p>
      <label><input type="radio" name="q1" value="a"> a) Rocket Engine System Transfer</label>
      <label><input type="radio" name="q1" value="b"> b) Representational State Transfer</label>
      <label><input type="radio" name="q1" value="c"> c) Remote Space Technology</label>
    </div>
    <div class="question">
      <p>2. Le principe "Stateless" signifie :</p>
      <label><input type="radio" name="q2" value="a"> a) Le serveur conserve l'historique des requ√™tes</label>
      <label><input type="radio" name="q2" value="b"> b) Chaque requ√™te est autonome</label>
      <label><input type="radio" name="q2" value="c"> c) Les donn√©es sont transf√©r√©es uniquement via SSL</label>
    </div>
    <div class="question">
      <p>3. URI pour obtenir des donn√©es sur la fus√©e Falcon Heavy :</p>
      <label><input type="radio" name="q3" value="a"> a) POST /rockets/falcon-heavy</label>
      <label><input type="radio" name="q3" value="b"> b) GET /falcon-heavy</label>
      <label><input type="radio" name="q3" value="c"> c) GET /rockets/falcon-heavy</label>
    </div>
    <div class="question">
      <p>4. M√©thode pour la mise √† jour compl√®te d'une ressource :</p>
      <label><input type="radio" name="q4" value="a"> a) PATCH</label>
      <label><input type="radio" name="q4" value="b"> b) POST</label>
      <label><input type="radio" name="q4" value="c"> c) PUT</label>
    </div>
    <div class="question">
      <p>5. HATEOAS dans une API est :</p>
      <label><input type="radio" name="q5" value="a"> a) Un syst√®me de liens vers des ressources associ√©es</label>
      <label><input type="radio" name="q5" value="b"> b) Un protocole de chiffrement</label>
      <label><input type="radio" name="q5" value="c"> c) Un langage de requ√™te</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'c', q4: 'c', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ R√©sum√© du chapitre :**

L'API REST est une "architecture de station spatiale" standardis√©e pour les services web. Retenez :

- Ressources = Objets (fus√©es, plan√®tes)
- URI = Coordonn√©es des objets
- M√©thodes HTTP = Commandes de contr√¥le
- Versions = Modernisations de la station

**Fin de la pr√©paration !** Dans le prochain chapitre, nous lancerons une "sonde de test" ‚Äî nous apprendrons √† tester les API via Postman.

> **üìå Pratique :**
√âtudiez la structure de l'[API SpaceX](https://docs.spacexdata.com/) et essayez d'ex√©cuter :

> `GET https://api.spacexdata.com/v4/launches/latest` ‚Äî faites attention √† l'URI et √† la structure JSON !