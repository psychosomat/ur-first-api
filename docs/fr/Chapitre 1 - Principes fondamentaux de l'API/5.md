# **Chapitre 1.5 : Tester l'API avec Postman**
**Temps d'√©tude :** 50 minutes

---

#### **1. Pourquoi tester l'API ? V√©rification avant le lancement**
Imaginez : avant de lancer une fus√©e, les ing√©nieurs proc√®dent √† des **mises sous tension des syst√®mes pour test**. Oubliez la v√©rification ‚Äî et la mission pourrait √©chouer !

Le **test d'API** ‚Äî c'est votre s√©rie de tests de contr√¥le :

- ‚úÖ V√©rifier la fonctionnalit√© des "points d'amarrage"

- üõ°Ô∏è D√©tecter les vuln√©rabilit√©s avant l'utilisation op√©rationnelle

- üìä S'assurer que les donn√©es sont transmises sans distorsion

> üí° **Analogie spatiale :**
> Postman ‚Äî comme une console de test du Centre de Contr√¥le de Mission (CCM) pour simuler tous les sc√©narios : "Que se passe-t-il si je demande des donn√©es sur une plan√®te inexistante ? Le serveur supportera-t-il 1000 requ√™tes/seconde ?"

---

#### **2. Postman : "Centre de contr√¥le des missions" pour les API**
**Fonctionnalit√©s :**

- üì° Envoi de toute requ√™te HTTP (GET, POST, PUT, DELETE)

- üîç Analyse des r√©ponses (codes de statut, en-t√™tes, corps JSON)

- üß™ √âcriture de tests automatis√©s (JavaScript)

- üåê Gestion des variables d'environnement (test vs production)

[üëâ T√©l√©charger Postman](https://www.postman.com/downloads/)

---

#### **3. Premier lancement : Testons l'API des plan√®tes**
**√âtape 1 : Cr√©er une requ√™te**

1. Ouvrez Postman ‚Üí New ‚Üí Request

2. Saisissez l'URL : `https://api.spacexdata.com/v4/rockets`

3. S√©lectionnez la m√©thode : **GET**

**√âtape 2 : Envoyer un "signal"**
```bash
[CCM] -- GET /planets --> [Serveur SpaceX]
```

**√âtape 3 : Analyser la t√©l√©m√©trie :**
- Statut : `200 OK`
- Corps de la r√©ponse (JSON) : liste des fus√©es avec leurs param√®tres
```json
[
  {
    "name": "Falcon 1",
    "type": "rocket",
    "active": false,
    "stages": 2,
    "id": "5e9d0d95eda69955f709d1eb"
  },
  {
    "name": "Falcon 9",
    "type": "rocket",
    "active": true,
    "id": "5e9d0d95eda69973a809d1ec"
  }
]
```

---

#### **4. Sch√©ma : Composants de Postman**
```
[Espace de travail]
‚îú‚îÄ‚îÄ Onglet "Params" (Param√®tres de requ√™te)
‚îú‚îÄ‚îÄ Onglet "Headers" (En-t√™tes)
‚îú‚îÄ‚îÄ Onglet "Body" (Corps de la requ√™te pour POST/PUT)
‚îú‚îÄ‚îÄ Onglet "Tests" (Scripts de v√©rification)
‚îî‚îÄ‚îÄ Panneau de r√©ponse (Status, Time, Size, Body)
```

---

#### **5. Cr√©er un sc√©nario complexe : Lancement de mission**
**Test : Ajout d'une nouvelle plan√®te au catalogue**

1. M√©thode : **POST**

2. URL : `https://jsonplaceholder.typicode.com/posts` (exemple)

3. Dans les Headers :
   ```json
	{ "Content-Type": "application/json" }
   ```
4. Dans le Body (raw ‚Üí JSON) :
   ```json
   {
	"title": "New Exoplanet Found",
	"body": "Proxima Centauri b shows signs of a stable atmosphere.",
	"userId": 1
	}
   ```

**V√©rification automatis√©e dans les Tests :**
```javascript
// V√©rification du statut
pm.test("Post created successfully", () => {
    pm.response.to.have.status(201);
});

// V√©rification de la structure et des donn√©es de la r√©ponse
pm.test("Response contains the new post data", () => {
    const response = pm.response.json();
    pm.expect(response).to.have.property("id"); // On v√©rifie que le serveur a attribu√© un ID
    pm.expect(response.title).to.eql("New Exoplanet Found");
});
```

---

#### **6. Variables d'environnement : Terre vs Mars**

Comment tester sur diff√©rents serveurs (test/production) ?

1. Cr√©ez des environnements :
   - `Local` ‚Üí `http://localhost:3000`
   - `Production` ‚Üí `https://api.nasa.gov`

2. Dans les requ√™tes, utilisez des variables :
   ```bash
   {{base_url}}/planets  # Substituera l'URL actuelle
   ```

> ‚ö†Ô∏è **Important !** Ne testez jamais `DELETE` sur un serveur de production !

---

#### **7. Collections : Biblioth√®que de missions spatiales**
Regroupez les requ√™tes :
```
	üìÇ Collection "NASA"
  	‚îú‚îÄ‚îÄ GET Plan√®tes
  	‚îú‚îÄ‚îÄ POST Nouvelle plan√®te
  	‚îî‚îÄ‚îÄ DELETE Plan√®te (mode test)
```
**Avantages :**

- üöÄ Lancement de tous les tests en un seul clic
- üì§ Export/import de configurations
- üë®‚ÄçüöÄ Travail d'√©quipe collaboratif

---

#### **8. Automatisation : V√©rifications r√©guli√®res des satellites**

Configurez le **monitoring d'API** via Postman :

1. Schedule ‚Üí Toutes les 2 heures

2. Tests :
   ```javascript
   pm.test("–°–ø—É—Ç–Ω–∏–∫ –æ–Ω–ª–∞–π–Ω", () => {
     pm.response.to.have.status(200);
     pm.expect(pm.response.json().signal).above(50); // Signal >50%
   });
   ```

3. Notifications dans Slack/par e-mail en cas d'√©chec

---

#### Quiz de r√©vision

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Postman est utilis√© pour :</p>
      <label><input type="radio" name="q1" value="a"> a) Envoyer des e-mails</label>
      <label><input type="radio" name="q1" value="b"> b) Tester des API</label>
      <label><input type="radio" name="q1" value="c"> c) Cr√©er des bases de donn√©es</label>
    </div>
    <div class="question">
      <p>2. Quel statut attendre lors de la cr√©ation r√©ussie d'un objet ?</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 201 Created</label>
      <label><input type="radio" name="q2" value="c"> c) 404 Not Found</label>
    </div>
    <div class="question">
      <p>3. O√π √©crire les tests automatis√©s dans Postman ?</p>
      <label><input type="radio" name="q3" value="a"> a) Onglet "Body"</label>
      <label><input type="radio" name="q3" value="b"> b) Onglet "Tests"</label>
      <label><input type="radio" name="q3" value="c"> c) Onglet "Cookies"</label>
    </div>
    <div class="question">
      <p>4. Les variables d'environnement sont n√©cessaires pour :</p>
      <label><input type="radio" name="q4" value="a"> a) Basculer entre les serveurs de test et de production</label>
      <label><input type="radio" name="q4" value="b"> b) Stocker les mots de passe en clair</label>
      <label><input type="radio" name="q4" value="c"> c) G√©n√©rer des donn√©es al√©atoires</label>
    </div>
    <div class="question">
      <p>5. Que v√©rifient les monitorings r√©guliers ?</p>
      <label><input type="radio" name="q5" value="a"> a) La stabilit√© du fonctionnement de l'API</label>
      <label><input type="radio" name="q5" value="b"> b) La vitesse d'Internet</label>
      <label><input type="radio" name="q5" value="c"> c) L'actualit√© de la documentation</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'a', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**üöÄ Bilan du chapitre :**
Postman ‚Äî votre "tableau de bord" universel pour tester les API. Avec lui, vous :
- V√©rifierez le fonctionnement des "syst√®mes de bord" avant le lancement
- Cr√©erez une biblioth√®que de sc√©narios de test
- Automatiserez la surveillance des services spatiaux

> **üìå Exercice pratique :**

> 1. Installez Postman
> 2. Cr√©ez une requ√™te vers l'API SpaceX : `GET https://api.spacexdata.com/v4/launches/latest`
> 3. √âcrivez un test v√©rifiant que :
>    - Le statut de la r√©ponse est `200`
>    - Le champ `name` contient le mot "Falcon"
>    - Le temps de r√©ponse est < 500 ms

**F√©licitations pour avoir termin√© le Chapitre 1 !**

Vous avez ma√Ætris√© les bases de l'utilisation des API. Dans les prochains chapitres, nous construirons notre propre "vaisseau spatial" ‚Äî une application web utilisant les API spatiales !

> **üåå Ressources suppl√©mentaires :**

> - [Documentation de l'API SpaceX](https://docs.spacexdata.com/)