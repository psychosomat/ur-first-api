# **Chapitre 6.4 : Documentation de l'API**
**Temps d'√©tude :** 30 minutes

---

#### **1. Pourquoi documenter une API ?**
Imaginez qu'on vous donne une t√©l√©commande d'un vaisseau spatial complexe sans aucune √©tiquette sur les boutons. Vous les presseriez au hasard, risquant de lancer le si√®ge √©jectable au lieu d'allumer la lumi√®re. La documentation d'API, ce sont ces √©tiquettes et ces instructions.

**Une bonne documentation :**

- **√âconomise du temps :** Les d√©veloppeurs n'ont pas √† deviner quels sont les points d'API existants, quels param√®tres ils acceptent et ce qu'ils retournent.
- **R√©duit les erreurs :** Une description claire des formats de donn√©es et des codes d'erreur aide √† √©viter une mauvaise utilisation de l'API.
- **Simplifie l'int√©gration :** L'√©quipe frontend peut travailler en parall√®le avec l'√©quipe backend, en se basant sur la documentation comme sur un contrat.
- **Est votre h√©ritage :** Dans six mois, vous vous remercierez vous-m√™me lorsque vous reviendrez sur le projet.

> üí° **Analogie spatiale :**

> - **API** = Syst√®me de contr√¥le complexe d'une station spatiale.
> - **Documentation de l'API** = Guide pour les astronautes. Il d√©crit :
>   - Quelle commande (`point d'API`) envoyer pour ouvrir le sas.
>   - Quels param√®tres (`corps de requ√™te`) transmettre pour configurer le syst√®me de survie.
>   - Quels signaux (`r√©ponses de l'API`) attendre en retour.

---

#### **2. Documentation dans FastAPI : La magie automatique**
FastAPI rend la documentation incroyablement simple. Il **g√©n√®re automatiquement une documentation interactive** bas√©e sur votre code, en utilisant les standards **OpenAPI** et **Swagger UI**.

**√âtape 1 : Ajoutez des m√©tadonn√©es √† votre application**

Dans `main.py`, vous pouvez ajouter des descriptions qui appara√Ætront dans la documentation.

```python
# main.py
from fastapi import FastAPI
from pydantic import BaseModel, Field

# ... (code FastAPI)

app = FastAPI(
    title="SpaceAPI",
    description="""
API pour l'exploration de la galaxie. üöÄ

Vous pourrez :
* **Consulter les plan√®tes**.
* **Ajouter de nouveaux mondes** (authentification requise).
    """,
    version="1.0.0",
    contact={
        "name": "Ing√©nieur en chef du centre de contr√¥le",
        "url": "https://example.com/contact",
        "email": "engineer@example.com",
    },
)
```

**√âtape 2 : D√©crivez vos mod√®les et points d'API**

Plus vous d√©crivez en d√©tail les mod√®les Pydantic et les param√®tres des points d'API, meilleure sera la documentation.

```python
# Dans le fichier des mod√®les Pydantic ou dans main.py

class PlanetBase(BaseModel):
    name: str = Field(..., example="Terre", description="Nom de la plan√®te")
    description: str = Field(..., example="Plan√®te bleue avec une vie diverse", description="Br√®ve description")
    # ...

class Planet(PlanetBase):
    id: int
    is_habitable: bool

    class Config:
        orm_mode = True # ou from_attributes = True dans Pydantic v2

# Dans le fichier des routes
@router.get(
    "/planets",
    response_model=list[Planet],
    summary="Obtenir la liste de toutes les plan√®tes",
    description="Retourne une liste de toutes les plan√®tes connues avec pagination (√† l'avenir)."
)
def get_planets():
    # ...

@router.post(
    "/planets",
    # ...
    summary="Cr√©er une nouvelle plan√®te",
    responses={
        401: {"description": "Utilisateur non autoris√©"},
        422: {"description": "Erreur de validation des donn√©es"}
    }
)
def create_planet(planet: PlanetCreate, ...):
    # ...
```

- `Field(..., example="...")`: Ajoute des exemples √† la documentation.
- `summary`: Br√®ve description du point d'API.
- `description`: Description d√©taill√©e.
- `responses`: Description des codes de r√©ponse possibles, en dehors du succ√®s.

**√âtape 3 : Ouvrez la documentation dans le navigateur**

Lancez votre serveur FastAPI et ouvrez deux URL magiques :

1.  **`http://127.0.0.1:8000/docs`** ‚Äî ouvrira la documentation interactive **Swagger UI**. Ici, vous pouvez non seulement lire, mais aussi **tester** vos points d'API directement depuis le navigateur !
2.  **`http://127.0.0.1:8000/redoc`** ‚Äî ouvrira une vue alternative de la documentation **ReDoc**. Elle est moins interactive, mais souvent plus lisible.

---

#### **3. Documentation dans Laravel : Utilisation de paquets tiers**

Contrairement √† FastAPI, Laravel ne g√©n√®re pas de documentation "pr√™te √† l'emploi". Cependant, il existe d'excellents paquets qui le font en analysant votre code. Le plus populaire est **Scribe**.

**√âtape 1 : Installation de Scribe**
```bash
composer require --dev "knuckleswtf/scribe"
```
```bash
php artisan vendor:publish --tag=scribe-config
php artisan scribe:generate
```

**√âtape 2 : Description des points d'API avec les DocBlocks**

Scribe lit les DocBlocks PHP (commentaires de type `/** ... */`) au-dessus des m√©thodes de votre contr√¥leur.

Ouvrez `app/Http/Controllers/PlanetController.php` :

```php
// app/Http/Controllers/PlanetController.php

/**
 * @group Plan√®tes
 * API pour la gestion des plan√®tes
 */
class PlanetController extends Controller
{
    /**
     * Obtenir la liste des plan√®tes
     *
     * Retourne une liste pagin√©e de toutes les plan√®tes de la galaxie.
     *
     * @unauthenticated
     */
    public function index()
    {
        // ...
    }

    /**
     * Cr√©er une nouvelle plan√®te
     *
     * @authenticated
     *
     * @bodyParam name string required Nom de la plan√®te. Example: Kepler-186f
     * @bodyParam description string required Description de la plan√®te.
     * @bodyParam size_km integer required Diam√®tre en kilom√®tres. Example: 14000
     * @bodyParam is_habitable boolean La plan√®te est-elle habitable. Example: true
     *
     * @response 201 {
     *  "id": 4,
     *  "name": "Kepler-186f",
     *  "description": "Premi√®re plan√®te de la taille de la Terre confirm√©e dans la zone habitable d'une autre √©toile.",
     *  "size_km": 14000,
     *  "is_habitable": true,
     *  "created_at": "2023-10-27T12:00:00.000000Z",
     *  "updated_at": "2023-10-27T12:00:00.000000Z"
     * }
     */
    public function store(Request $request)
    {
        // ...
    }
    // ... et ainsi de suite pour les autres m√©thodes
}
```

**Balises cl√©s de Scribe :**

- `@group`: Regroupe les points d'API.
- `@unauthenticated` / `@authenticated`: Indique si un jeton est requis.
- `@bodyParam`: D√©crit un param√®tre dans le corps de la requ√™te.
- `@response`: Exemple de r√©ponse r√©ussie.

**√âtape 3 : G√©n√©ration et visualisation de la documentation**

Chaque fois apr√®s avoir apport√© des modifications aux DocBlocks, ex√©cutez la commande :

```bash
php artisan scribe:generate
```
Scribe cr√©era une page HTML statique avec votre documentation. Ouvrez-la √† l'adresse : **`http://your-app-url/docs`**.

---

#### **Quiz pour la consolidation**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI g√©n√®re la documentation bas√©e sur le standard :</p>
      <label><input type="radio" name="q1" value="a"> a) GraphQL</label>
      <label><input type="radio" name="q1" value="b"> b) OpenAPI (Swagger)</label>
      <label><input type="radio" name="q1" value="c"> c) WSDL</label>
    </div>
    <div class="question">
      <p>2. Quelle URL ouvre Swagger UI dans FastAPI par d√©faut ?</p>
      <label><input type="radio" name="q2" value="a"> a) /api/docs</label>
      <label><input type="radio" name="q2" value="b"> b) /swagger</label>
      <label><input type="radio" name="q2" value="c"> c) /docs</label>
    </div>
    <div class="question">
      <p>3. Paquet populaire pour la g√©n√©ration de documentation dans Laravel :</p>
      <label><input type="radio" name="q3" value="a"> a) Telescope</label>
      <label><input type="radio" name="q3" value="b"> b) Scribe</label>
      <label><input type="radio" name="q3" value="c"> c) Horizon</label>
    </div>
    <div class="question">
      <p>4. Dans Scribe, la balise utilis√©e pour d√©crire les param√®tres du corps de la requ√™te est :</p>
      <label><input type="radio" name="q4" value="a"> a) @param</label>
      <label><input type="radio" name="q4" value="b"> b) @bodyParam</label>
      <label><input type="radio" name="q4" value="c"> c) @request</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ R√©sum√© du chapitre :**

Vous avez cr√©√© une documentation professionnelle, transformant vos API de "bo√Ætes noires" en outils clairs et faciles √† utiliser.

- ‚úÖ Compris l'importance critique de la documentation des API.
- ü™Ñ Appris √† utiliser la g√©n√©ration automatique de documentation dans FastAPI.
- ‚öôÔ∏è Ma√Ætris√© les bases du paquet Scribe pour documenter les API avec Laravel.
- üõ∞Ô∏è Constat√© qu'une bonne documentation est le meilleur alli√© de tout d√©veloppeur.

**Vos API fonctionnent et sont s√©curis√©es, et elles sont d√©sormais enti√®rement pr√™tes √† √™tre utilis√©es par d'autres membres de l'√©quipe.** Il ne reste qu'une derni√®re √©tape, mais la plus importante : la v√©rification finale de la s√©curit√©.

> **üìå V√©rification :**

> - Pour FastAPI : ouvrez `/docs` dans le navigateur et essayez d'effectuer une requ√™te `GET` vers la liste des plan√®tes directement depuis l'interface Swagger UI.
> - Pour Laravel : ex√©cutez `php artisan scribe:generate` et ouvrez `/docs`. Assurez-vous que les points d'API sont regroup√©s et que la m√©thode `store` a une description des param√®tres.