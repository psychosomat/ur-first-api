# **Chapitre 3.1 : Installation de FastAPI et configuration de l'environnement**
**Temps d'√©tude :** 45 minutes

---

#### **1. Qu'est-ce que FastAPI ? Un hyperdrive pour API**
Si Flask est une sonde de reconnaissance maniable, et Django un √©norme porte-vaisseaux, alors **FastAPI** est un **chasseur supersonique**.

**FastAPI** est un framework web moderne et performant pour la cr√©ation d'API en Python 3.7+. Ses principaux avantages sont :

- **Vitesse :** L'un des frameworks Python les plus rapides, comparable √† NodeJS et Go.
- **Simplicit√© :** Syntaxe minimaliste et intuitive.
- **Auto-documentation :** G√©n√®re automatiquement une documentation interactive pour votre API.
- **Typage :** Utilise les annotations de type Python standard pour la validation, l'autocompl√©tion et la documentation.

> üí° **Analogie spatiale :**

> FastAPI est comme un "hyperdrive" pour votre vaisseau-API. Il est bas√© sur deux technologies :

> - **Starlette** (le ch√¢ssis du chasseur) ‚Äî assure l'asynchronisme et les performances les plus √©lev√©es.
> - **Pydantic** (l'ordinateur de bord) ‚Äî est responsable de la validation des donn√©es et des param√®tres.

---

#### **2. Pr√©paration du pas de tir : Environnement virtuel**
Avant de construire notre chasseur, nous devons cr√©er un **laboratoire d'assemblage st√©rile**. En Python, les **environnements virtuels** sont utilis√©s √† cette fin.

**Pourquoi est-ce n√©cessaire ?** Pour que les d√©pendances de notre projet (moteurs, syst√®mes de navigation) n'entrent pas en conflit avec d'autres projets sur votre ordinateur.

**√âtape 1 : Cr√©er un environnement virtuel**
Ouvrez un terminal dans le dossier de votre projet (par exemple, `C:\Projects\FastAPI_Fleet`) et ex√©cutez :

```bash
python -m venv venv
```
Cette commande cr√©era un dossier `venv` avec une version isol√©e de Python.

**√âtape 2 : Activer le "champ de force" du laboratoire**

- **Windows (PowerShell) :**

  ```powershell
  .\venv\Scripts\Activate.ps1
  ```
  *(Si une erreur se produit, il peut √™tre n√©cessaire d'autoriser l'ex√©cution des scripts : `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process`)*

- **Windows (CMD) :**

  ```cmd
  .\venv\Scripts\activate.bat
  ```

- **macOS / Linux :**

  ```bash
  source venv/bin/activate
  ```
Apr√®s l'activation, `(venv)` appara√Ætra au d√©but de la ligne de commande du terminal. Cela signifie que vous √™tes √† l'int√©rieur de votre laboratoire !

---

#### **3. Installation du moteur : FastAPI et Uvicorn**
Nous allons maintenant installer deux composants cl√©s :

- **fastapi :** Le framework lui-m√™me.
- **uvicorn :** Un serveur ASGI ultra-rapide qui "lancera" notre moteur.

Ex√©cutez dans l'environnement activ√© :
```bash
pip install "fastapi[all]"
```
> üí° **Pourquoi `[all]` ?**
> Cela installera `fastapi`, `uvicorn` et d'autres paquets utiles (par exemple, pour le support des WebSockets et Jinja2) qui seront utiles pour les futures missions.

**V√©rification de l'installation :**
```bash
pip freeze
```
Vous devriez voir `fastapi`, `pydantic`, `starlette`, `uvicorn` et d'autres paquets dans la liste.

---

#### **4. Premier contact : Le fichier `main.py`**
Cr√©ez un fichier `main.py` √† la racine du projet ‚Äî ce sera le **tableau de commande central** de notre API.

**Ajoutez le code suivant √† `main.py` :**
```python
from fastapi import FastAPI

# Cr√©ons une instance de notre "vaisseau spatial" API
app = FastAPI()

# D√©finissons le premier "n≈ìud d'amarrage" (endpoint)
# C'est l'URL racine : /
@app.get("/")
def read_root():
    """
    C'est le message du Centre de Contr√¥le de Mission, vu par tous ceux
    qui se connectent √† la passerelle principale.
    """
    return {"message": "Bienvenue au Centre de Commande de la Flotte Spatiale !"}
```
- `@app.get("/") :` C'est un **d√©corateur** qui indique √† FastAPI que la fonction `read_root` doit g√©rer les requ√™tes `GET` sur l'URL racine (`/`).

---

#### **5. Allumage ! D√©marrage du serveur**
Il est temps de d√©marrer notre hyperdrive ! Dans le terminal (avec `venv` actif), ex√©cutez :
```bash
uvicorn main:app --reload
```
**D√©tails de la commande :**

- `uvicorn :` Lance le serveur Uvicorn.
- `main :` Le fichier `main.py` (sans `.py`).
- `app :` L'objet `app = FastAPI()`, cr√©√© dans `main.py`.
- `--reload :` "Pilote automatique". Le serveur red√©marrera automatiquement √† chaque modification du code.

**Sortie attendue dans le terminal :**
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345]
INFO:     Started server process [12346]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

---

#### **6. V√©rification de la communication avec le CCM**
Votre API est maintenant en ligne et √©coute sur le port `8000` !

**√âtape 1 : V√©rification dans le navigateur**

Ouvrez l'adresse `http://127.0.0.1:8000` dans votre navigateur. Vous devriez voir :
```json
{
  "message": "Bienvenue au Centre de Commande de la Flotte Spatiale !"
}
```

**√âtape 2 : Un regard vers l'avenir (auto-documentation)**

FastAPI vous a d√©j√† fait deux cadeaux. Ouvrez ces URL :

- `http://127.0.0.1:8000/docs :` Documentation interactive Swagger UI.
- `http://127.0.0.1:8000/redoc :` Documentation alternative ReDoc.

Vous verrez votre premier endpoint, que vous pouvez tester directement depuis le navigateur !

---

#### **Quiz pour la consolidation**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI est connu pour sa/son...</p>
      <label><input type="radio" name="q1" value="a"> a) Fonctionnement lent mais fiable</label>
      <label><input type="radio" name="q1" value="b"> b) Haute performance et vitesse</label>
      <label><input type="radio" name="q1" value="c"> c) Int√©gration uniquement avec les bases de donn√©es Microsoft</label>
    </div>
    <div class="question">
      <p>2. Pourquoi un environnement virtuel (`venv`) est-il n√©cessaire ?</p>
      <label><input type="radio" name="q2" value="a"> a) Pour acc√©l√©rer le fonctionnement de Python</label>
      <label><input type="radio" name="q2" value="b"> b) Pour isoler les d√©pendances du projet</label>
      <label><input type="radio" name="q2" value="c"> c) Pour l'√©criture automatique de tests</label>
    </div>
    <div class="question">
      <p>3. Quel serveur est utilis√© pour ex√©cuter FastAPI dans cette le√ßon ?</p>
      <label><input type="radio" name="q3" value="a"> a) Apache</label>
      <label><input type="radio" name="q3" value="b"> b) Gunicorn</label>
      <label><input type="radio" name="q3" value="c"> c) Uvicorn</label>
    </div>
    <div class="question">
      <p>4. La commande `uvicorn main:app --reload` signifie :</p>
      <label><input type="radio" name="q4" value="a"> a) Ex√©cuter le fichier `app.py` avec l'objet `main`</label>
      <label><input type="radio" name="q4" value="b"> b) Ex√©cuter l'objet `app` dans le fichier `main.py` et red√©marrer en cas de modifications</label>
      <label><input type="radio" name="q4" value="c"> c) Red√©marrer l'ordinateur et lancer l'application</label>
    </div>
    <div class="question">
      <p>5. Que fait le d√©corateur `@app.get("/")` dans FastAPI ?</p>
      <label><input type="radio" name="q5" value="a"> a) R√©cup√®re les donn√©es du fichier `app.py`</label>
      <label><input type="radio" name="q5" value="b"> b) Envoie une requ√™te GET √† un serveur externe</label>
      <label><input type="radio" name="q5" value="c"> c) Associe la fonction √† une requ√™te GET sur l'URL racine</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'c', q4: 'b', q5: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Conclusion du chapitre :**

Vous avez r√©ussi √† assembler et √† lancer le "hyperdrive" de votre nouvelle API ! Vous avez maintenant :

- üõ†Ô∏è Un environnement de d√©veloppement isol√© (`venv`)
- üöÄ FastAPI et le serveur Uvicorn install√©s
- üõ∞Ô∏è Une API fonctionnelle avec un seul endpoint
- üìä Une documentation g√©n√©r√©e automatiquement

**Tous les syst√®mes sont en ordre !** Dans le prochain chapitre, nous allons cr√©er notre premier endpoint complet qui renverra une liste de vaisseaux spatiaux.

> **üìå V√©rification :**

> - L'environnement `(venv)` est actif dans le terminal
> - Le serveur `uvicorn` est lanc√© sans erreurs
> - L'adresse `http://127.0.0.1:8000/docs` s'ouvre dans le navigateur

> **‚ö†Ô∏è Si des erreurs :**

> - `command not found` : Assurez-vous d'avoir activ√© l'environnement virtuel.
> - `Port ... is already in use` : Un autre programme utilise le port 8000. Arr√™tez-le ou lancez uvicorn sur un autre port : `uvicorn main:app --reload --port 8001`.
> - Erreurs lors de l'activation de `venv` dans PowerShell : V√©rifiez la politique d'ex√©cution des scripts.