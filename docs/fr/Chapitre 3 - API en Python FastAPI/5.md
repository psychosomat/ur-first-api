# **Chapitre 3.5 : Documentation Swagger automatique**
**Temps d'√©tude :** 30 minutes

---

#### **1. Documentation API : Le manuel d'utilisation de la station spatiale**
Imaginez que vous √™tes un nouvel astronaute arrivant √† l'ISS. Comment sauriez-vous √† quoi sert chaque interrupteur et comment contr√¥ler le bras robotique ? Il vous faudrait un **manuel d√©taill√© et √† jour**.

La **documentation API** est un manuel similaire pour les d√©veloppeurs. Elle explique :

- Quels "ports d'amarrage" (endpoints) sont disponibles.
- Quelles "commandes" (m√©thodes HTTP) peuvent √™tre envoy√©es.
- Quelle "cargaison" (donn√©es) doit √™tre transmise.
- Quelle "t√©l√©m√©trie" (r√©ponses) attendre.

Le probl√®me est que la r√©daction manuelle de la documentation est longue, fastidieuse et qu'elle est presque toujours obsol√®te.

> üí° **Analogie spatiale :**

> La documentation manuelle, ce sont des plans papier qui se trouvent dans les archives et ne sont pas mis √† jour apr√®s la modernisation de la station.
> La **documentation automatique FastAPI** est un **√©cran interactif au centre de contr√¥le des missions**, qui se met √† jour en temps r√©el apr√®s chaque modification sur la station.

---

#### **2. La magie de FastAPI : Comment √ßa marche ?**
FastAPI fait tout le "sale boulot" pour vous, en se basant sur votre propre code. Il scanne :

1.  **Routes :** Tous les d√©corateurs `@app.get`, `@app.post`, etc.
2.  **Param√®tres :** Les param√®tres de chemin (`ship_id: int`) et de requ√™te.
3.  **Mod√®les Pydantic :** Vos "plans" (`Spaceship`, `SpaceshipCreate`).
4.  **Cha√Ænes de documentation (docstrings) :** Les descriptions que vous √©crivez entre guillemets triples.

Sur la base de ces donn√©es, FastAPI g√©n√®re un sch√©ma selon la norme **OpenAPI** (anciennement connue sous le nom de Swagger), puis l'affiche via deux belles interfaces.

---

#### **3. Explorons l'"√©cran du centre de contr√¥le des missions" : Swagger UI**
**Swagger UI** est une interface interactive qui permet non seulement de lire la documentation, mais aussi de **tester l'API directement depuis le navigateur**.

**Ouvrez `http://127.0.0.1:8000/docs`**

Vous verrez :

- **Liste des endpoints :** Regroup√©s par balises (par d√©faut, par nom de ressource) et color√©s selon les m√©thodes HTTP.
- **Descriptions :** Les textes de vos docstrings (`"""..."""`) s'affichent comme descriptions des endpoints.
- **Param√®tres :** Indique les param√®tres (comme `ship_id`) attendus par l'endpoint, leur type et leur caract√®re obligatoire.
- **Corps de la requ√™te (Request Body) :** Pour `POST` et `PUT`, affiche le sch√©ma JSON g√©n√©r√© √† partir de votre mod√®le Pydantic (`SpaceshipCreate`).
- **R√©ponses (Responses) :** Affiche les codes de statut possibles et les sch√©mas de r√©ponse, bas√©s sur `response_model`.
- **Bouton "Try it out" :** Permet de renseigner les param√®tres et d'envoyer une requ√™te r√©elle √† votre serveur.

---

#### **4. Am√©liorer la documentation : Balises et descriptions**
Rendons notre documentation encore plus professionnelle.

**√âtape 1 : Ajouter des m√©tadonn√©es dans `FastAPI`**
Lors de la cr√©ation de l'objet `app`, vous pouvez transmettre des informations g√©n√©rales sur votre API.

**Modifiez la ligne `app = FastAPI()` dans `main.py` :**
```python
# main.py

app = FastAPI(
    title="API de Gestion de Flotte",
    description="API pour la gestion d'une flotte de vaisseaux spatiaux.",
    version="1.0.0",
)
```
Maintenant, le titre et la description appara√Ætront en haut de votre documentation.

**√âtape 2 : Regrouper les endpoints √† l'aide de balises**
Vous pouvez ajouter des balises √† chaque endpoint pour les regrouper par signification.

**Ajoutez le param√®tre `tags` aux d√©corateurs :**
```python
# GET /spaceships
@app.get("/spaceships", response_model=List[Spaceship], tags=["Vaisseaux spatiaux"])
# ...

# GET /spaceships/{ship_id}
@app.get("/spaceships/{ship_id}", response_model=Spaceship, tags=["Vaisseaux spatiaux"])
# ...

# POST /spaceships
@app.post("/spaceships", response_model=Spaceship, status_code=201, tags=["Vaisseaux spatiaux"])
# ...

# et ainsi de suite pour PUT et DELETE
```
Maintenant, toutes vos op√©rations CRUD seront soigneusement regroup√©es sous le titre "Vaisseaux spatiaux".

---

#### **5. Vue alternative : ReDoc**
FastAPI fournit une autre interface de documentation "pr√™te √† l'emploi" ‚Äî **ReDoc**. Elle est moins interactive, mais est souvent consid√©r√©e comme plus lisible et convient parfaitement √† la documentation statique.

**Ouvrez `http://127.0.0.1:8000/redoc`**

Vous verrez une mise en page √† trois colonnes avec navigation, descriptions des endpoints et sch√©mas de donn√©es. C'est un excellent moyen de fournir de la documentation √† vos "clients" (par exemple, l'√©quipe frontend).

---

#### **Quiz de r√©vision**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>


<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI g√©n√®re la documentation bas√©e sur...</p>
      <label><input type="radio" name="q1" value="a"> a) Des fichiers `.html` s√©par√©s, qui doivent √™tre cr√©√©s manuellement</label>
      <label><input type="radio" name="q1" value="b"> b) Votre code Python : routes, mod√®les Pydantic et docstrings</label>
      <label><input type="radio" name="q1" value="c"> c) Des commentaires commen√ßant par `#`</label>
    </div>
    <div class="question">
      <p>2. Quelle norme est √† la base de l'auto-documentation FastAPI ?</p>
      <label><input type="radio" name="q2" value="a"> a) GraphQL</label>
      <label><input type="radio" name="q2" value="b"> b) XML-RPC</label>
      <label><input type="radio" name="q2" value="c"> c) OpenAPI (Swagger)</label>
    </div>
    <div class="question">
      <p>3. √Ä quelle URL la documentation interactive Swagger UI est-elle accessible par d√©faut ?</p>
      <label><input type="radio" name="q3" value="a"> a) `/admin`</label>
      <label><input type="radio" name="q3" value="b"> b) `/docs`</label>
      <label><input type="radio" name="q3" value="c"> c) `/api/help`</label>
    </div>
    <div class="question">
      <p>4. Le param√®tre `tags` dans le d√©corateur `@app.get` est utilis√© pour :</p>
      <label><input type="radio" name="q4" value="a"> a) Ajouter des m√©ta-balises en HTML</label>
      <label><input type="radio" name="q4" value="b"> b) Regrouper les endpoints dans la documentation</label>
      <label><input type="radio" name="q4" value="c"> c) Marquer un endpoint comme obsol√®te</label>
    </div>
    <div class="question">
      <p>5. ReDoc est...</p>
      <label><input type="radio" name="q5" value="a"> a) Un outil d'√©dition de code dans le navigateur</label>
      <label><input type="radio" name="q5" value="b"> b) Une interface alternative, plus statique, pour la documentation API</label>
      <label><input type="radio" name="q5" value="c"> c) Un syst√®me pour d√©tecter le code "rouge" (non fonctionnel)</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">V√©rifier</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>R√©sultats :</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:green;">Correct !</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:red;">Incorrect.</span> Bonne r√©ponse : <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)} : <span style="color:orange;">Pas de r√©ponse.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Votre score : ${score} sur ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**üöÄ R√©sum√© du chapitre :**

Vous avez d√©couvert l'une des "superpouvoirs" les plus puissants de FastAPI : la cr√©ation de documentation sans aucun effort.

- üìñ Votre API dispose d√©sormais de deux types de documentation √† jour : **Swagger UI** et **ReDoc**.
- üî¨ La documentation est interactive et permet de tester l'API √† la vol√©e.
- üè∑Ô∏è Vous avez appris √† l'am√©liorer √† l'aide de m√©tadonn√©es et de balises.

**Le manuel d'utilisation est pr√™t et toujours √† jour !** Dans le dernier chapitre de cette section, nous apprendrons √† g√©rer les "anomalies spatiales" ‚Äî les erreurs et les donn√©es incorrectes.

> **üìå V√©rification :**

> - Assurez-vous que le titre, la description et les endpoints regroup√©s par balises s'affichent √† l'adresse `http://127.0.0.1:8000/docs`.
> - V√©rifiez que votre mod√®le `Spaceship` est visible dans la section "Schemas".
> - Ouvrez `http://127.0.0.1:8000/redoc` et √©valuez la vue alternative.

> **‚ö†Ô∏è Si les modifications ne s'affichent pas :**

> - Assurez-vous d'avoir enregistr√© le fichier `main.py`.
> - V√©rifiez que le serveur `uvicorn` est lanc√© avec le drapeau `--reload` et qu'il a red√©marr√© avec succ√®s.