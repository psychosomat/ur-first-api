# **Cap√≠tulo 5.5: Roteamento para P√°ginas Web**
**Tempo de estudo:** 40 minutos

---

### **1. `routes/web.php` vs `routes/api.php`: Dois Pain√©is de Controle Diferentes**

√â importante refor√ßar novamente a diferen√ßa fundamental:

| Caracter√≠stica          | `routes/web.php` (Painel Web)                               | `routes/api.php` (Painel API)                                 |
| ----------------------- | ----------------------------------------------------------- | ------------------------------------------------------------- |
| **Tarefa Principal**    | Exibi√ß√£o de p√°ginas HTML, processamento de formul√°rios      | Fornecimento de dados em formato JSON para outras aplica√ß√µes  |
| **Estado (State)**      | **Stateful** (com estado) ‚Äî usa sess√µes e cookies           | **Stateless** (sem estado) ‚Äî cada requisi√ß√£o √© independente   |
| **Middleware padr√£o**   | `web` (inclui sess√µes, prote√ß√£o CSRF, criptografia de cookies) | `api` (inclui "throttling" ‚Äî limita√ß√£o de frequ√™ncia de requisi√ß√µes) |
| **Prefixo da URL**      | Nenhum (raiz do seu site)                                   | `/api/` (configur√°vel em `RouteServiceProvider`)              |
| **Autentica√ß√£o**        | Geralmente via sess√µes (Login/Senha)                        | Geralmente via tokens (Sanctum, Passport)                     |

Trabalhamos com `routes/web.php` para construir a interface para um ser humano.

---

### **2. Rotas de Recurso para a Web**

Similar a `Route::apiResource`, para a web existe `Route::resource`. Ele cria rotas para o ciclo CRUD completo, incluindo p√°ginas para exibir formul√°rios de cria√ß√£o e edi√ß√£o.

Vamos criar um conjunto completo de rotas para gerenciar nossos planetas atrav√©s da interface web.

**Passo 1: Criamos a rota em `routes/web.php`**

Comente ou exclua as rotas antigas para `/planets` e substitua-as por uma √∫nica linha:

```php
use App\Http\Controllers\Web\PlanetPageController;

// Route::get('/planets', [PlanetPageController::class, 'index']);
// Route::get('/planets/{planet}', [PlanetPageController::class, 'show']);

Route::resource('planets', PlanetPageController::class);
```

**Passo 2: Verificamos o que foi criado**
Execute no terminal o comando `php artisan route:list --except-vendor`:

```
+--------+-----------+------------------------+------------------+-------------------------------------------------+------------+
| Method | URI       | Name                   | Action           | Middleware                                      |
+--------+-----------+------------------------+------------------+-------------------------------------------------+------------+
| GET|HEAD | planets                | planets.index          | ...\PlanetPageController@index                    | web        |
| POST   | planets                | planets.store          | ...\PlanetPageController@store                    | web        |
| GET|HEAD | planets/create         | planets.create         | ...\PlanetPageController@create                   | web        |
| GET|HEAD | planets/{planet}       | planets.show           | ...\PlanetPageController@show                     | web        |
| PUT|PATCH | planets/{planet}       | planets.update         | ...\PlanetPageController@update                   | web        |
| DELETE | planets/{planet}       | planets.destroy        | ...\PlanetPageController@destroy                  | web        |
| GET|HEAD | planets/{planet}/edit  | planets.edit           | ...\PlanetPageController@edit                     | web        |
+--------+-----------+------------------------+------------------+-------------------------------------------------+------------+
```

`Route::resource` criou 7 rotas para n√≥s, incluindo:

-   `planets.create` (GET `/planets/create`): p√°gina com formul√°rio de cria√ß√£o.
-   `planets.store` (POST `/planets`): processamento deste formul√°rio.
-   `planets.edit` (GET `/planets/{planet}/edit`): p√°gina com formul√°rio de edi√ß√£o.
-   `planets.update` (PUT/PATCH `/planets/{planet}`): processamento do formul√°rio de edi√ß√£o.
-   `planets.destroy` (DELETE `/planets/{planet}`): exclus√£o do recurso.

---

### **3. Rotas Nomeadas: Convenientes "Coordenadas C√≥smicas"**
Observe a coluna `Name`. O Laravel atribuiu automaticamente a cada rota um nome √∫nico (por exemplo, `planets.index`). Usar nomes em vez de URLs hardcoded √© a **melhor pr√°tica**.

**Por qu√™?** Se voc√™ decidir alterar a URL de `/planets` para `/worlds`, n√£o precisar√° procurar e alterar todos os links em seus templates. Voc√™ simplesmente o altera em um √∫nico lugar ‚Äî no arquivo de rotas, e os nomes permanecem os mesmos.

**Exemplo de uso no Blade:**

Antes escrev√≠amos assim:

```blade
<a href="/planets/{{ $planet->id }}">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ &rarr;</a>
```

Agora escreveremos assim, usando o helper `route()`:
```blade
<a href="{{ route('planets.show', ['planet' => $planet->id]) }}">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ &rarr;</a>
```

-   `route('planets.show', ...)` ‚Äî gera a URL para a rota com o nome `planets.show`.
-   `['planet' => $planet->id]` ‚Äî passa os par√¢metros necess√°rios para a URL. O Laravel ir√° preencher o ID em `{planet}`. Voc√™ pode at√© passar o modelo completo: `['planet' => $planet]`.

---

### **4. Implementa√ß√£o dos M√©todos Faltantes no Controller**
`Route::resource` criou as rotas, mas precisamos criar os m√©todos correspondentes em `PlanetPageController` n√≥s mesmos.

Abra `app/Http/Controllers/Web/PlanetPageController.php` e os adicionaremos.

```php
<?php
use Illuminate\Http\Request; // <-- Adicionar

class PlanetPageController extends Controller
{
    // index() e show() n√≥s j√° temos

    /**
     * Mostra o formul√°rio para criar um novo planeta.
     */
    public function create()
    {
        return view('planets.create'); // Apenas retornamos a view com o formul√°rio
    }

    /**
     * Salva um novo planeta no banco de dados.
     */
    public function store(Request $request)
    {
        // Valida√ß√£o dos dados do formul√°rio
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:planets',
            'solar_system' => 'required|string|max:100',
            // ... outras regras
        ]);

        Planet::create($validated);

        // Redirecionamos o usu√°rio para a p√°gina da lista com uma mensagem de sucesso
        return redirect()->route('planets.index')->with('success', 'Planeta criado com sucesso!');
    }

    /**
     * Mostra o formul√°rio para editar um planeta.
     */
    public function edit(Planet $planet)
    {
        return view('planets.edit', ['planet' => $planet]);
    }

    /**
     * Atualiza os dados do planeta no banco de dados.
     */
    public function update(Request $request, Planet $planet)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:planets,name,' . $planet->id,
            'solar_system' => 'required|string|max:100',
        ]);

        $planet->update($validated);

        return redirect()->route('planets.show', $planet)->with('success', 'Dados do planeta atualizados!');
    }

    /**
     * Exclui um planeta.
     */
    public function destroy(Planet $planet)
    {
        $planet->delete();

        return redirect()->route('planets.index')->with('success', 'Planeta removido.');
    }
}
```

-   `redirect()->route(...)` ‚Äî redireciona o usu√°rio para outra rota nomeada.
-   `->with('success', '...')` ‚Äî adiciona uma "mensagem flash" √† sess√£o, que estar√° dispon√≠vel na pr√≥xima p√°gina exatamente uma vez. Podemos exibi-la em nosso template Blade.

---

### **5. Agrupamento de Rotas**
Se voc√™ tiver muitas rotas com caracter√≠sticas comuns (por exemplo, todas elas s√£o para o painel de administra√ß√£o e devem ter o prefixo `/admin` e um middleware especial), elas podem ser agrupadas.

```php
<?php
Route::middleware(['auth', 'admin'])->prefix('admin')->name('admin.')->group(function () {
    // Todas as rotas dentro deste grupo ter√£o:
    // 1. Middleware 'auth' e 'admin'
    // 2. Prefixo da URL '/admin' (por exemplo, /admin/planets)
    // 3. Prefixo do nome 'admin.' (por exemplo, admin.planets.index)

    Route::resource('planets', PlanetPageController::class);
    // Route::get('/dashboard', ...)->name('dashboard'); // -> admin.dashboard
});
```

---

### **Quiz para Fixa√ß√£o**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>
<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Qual comando em `routes/web.php` criar√° um conjunto completo de rotas CRUD para a interface web?</p>
      <label><input type="radio" name="q1" value="a"> a) Route::crud('planets', Controller::class)</label>
      <label><input type="radio" name="q1" value="b"> b) Route::apiResource('planets', Controller::class)</label>
      <label><input type="radio" name="q1" value="c"> c) Route::resource('planets', Controller::class)</label>
    </div>
    <div class="question">
      <p>2. Qual √© a principal vantagem de usar rotas nomeadas?</p>
      <label><input type="radio" name="q2" value="a"> a) Elas funcionam mais r√°pido do que URLs diretas</label>
      <label><input type="radio" name="q2" value="b"> b) Permitem mudar facilmente a URL no arquivo de rotas, sem quebrar os links nos templates</label>
      <label><input type="radio" name="q2" value="c"> c) Elas s√£o automaticamente protegidas por CSRF</label>
    </div>
    <div class="question">
      <p>3. Qual rota ser√° gerada para o m√©todo `create()` em `Route::resource('articles', ...)`?</p>
      <label><input type="radio" name="q3" value="a"> a) GET `/articles/new`</label>
      <label><input type="radio" name="q3" value="b"> b) GET `/articles/create`</label>
      <label><input type="radio" name="q3" value="c"> c) POST `/articles/create`</label>
    </div>
    <div class="question">
      <p>4. O que o c√≥digo `redirect()->route('home')->with('status', 'OK')` faz?</p>
      <label><input type="radio" name="q4" value="a"> a) Retorna JSON com 'status' => 'OK' para a URL `/home`</label>
      <label><input type="radio" name="q4" value="b"> b) Redireciona para a rota nomeada `home` e adiciona uma mensagem 'status' flash √† sess√£o</label>
      <label><input type="radio" name="q4" value="c"> c) Exibe a view `home.blade.php` com a vari√°vel `$status`</label>
    </div>
    <div class="question">
      <p>5. Para que `Route::prefix('dashboard')` √© usado?</p>
      <label><input type="radio" name="q5" value="a"> a) Para adicionar um prefixo a todas as URLs dentro do grupo</label>
      <label><input type="radio" name="q5" value="b"> b) Para adicionar um prefixo a todos os nomes de rotas dentro do grupo</label>
      <label><input type="radio" name="q5" value="c"> c) Para aplicar o middleware `dashboard`</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'c', q2: 'b', q3: 'b', q4: 'b', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:green;">Correto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:red;">Incorreto.</span> Resposta correta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pergunta ${question.slice(1)}: <span style="color:orange;">Sem resposta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Seu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

**üöÄ Resumo do Cap√≠tulo:**

Voc√™ dominou uma abordagem estruturada e profissional para a organiza√ß√£o de rotas web no Laravel. Agora voc√™ √© capaz de:

-   Distinguir as rotas `web` e `api` e seus prop√≥sitos.
-   Usar `Route::resource` para gerar rapidamente rotas CRUD padr√£o.
-   Aplicar rotas nomeadas para criar um c√≥digo flex√≠vel e de f√°cil manuten√ß√£o.
-   Criar opera√ß√µes CRUD completas no controlador com valida√ß√£o e redirecionamentos.
-   Agrupar rotas para aplicar regras comuns.

**O sistema de navega√ß√£o da sua "nave" agora √© tolerante a falhas e est√° pronto para expans√£o.** No cap√≠tulo final desta se√ß√£o, combinaremos todo o conhecimento adquirido e exibiremos os dados dos planetas, obtidos via Fetch, em nossa p√°gina Blade.