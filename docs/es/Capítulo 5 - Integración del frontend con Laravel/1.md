# **Cap√≠tulo 5.1: Plantillas Blade en Laravel**
**Tiempo de estudio:** 40 minutos

---

### **1. ¬øQu√© es Blade? Tu dise√±o "inteligente"**

Hasta ahora hemos trabajado con dos extremos: un `index.html` puro y una respuesta JSON pura de una API. Pero, ¬øc√≥mo crear p√°ginas web completas que muestren din√°micamente los datos de nuestro backend?

**Blade** es el motor de plantillas integrado en Laravel. Nos permite escribir HTML normal, pero con "superpoderes":

-   Insertar variables y ejecutar c√≥digo PHP con una sintaxis elegante.
-   Crear "dise√±os" de p√°gina reutilizables (cabeceras, pies de p√°gina).
-   Usar bucles y condiciones directamente en el c√≥digo HTML.
-   Proteger autom√°ticamente contra ataques XSS.

> üí° **Analog√≠a espacial:**

> Imagina que HTML es un plano simple de una nave espacial. Blade es un sistema CAD avanzado. No solo dibujas l√≠neas, sino que a√±ades objetos "inteligentes". Dices: "Aqu√≠ ir√° la lista de la tripulaci√≥n", y Blade autom√°ticamente solicita los datos y los rellena. "Aqu√≠ ir√° la pantalla principal", y Blade inserta la interfaz est√°ndar.

Todos los archivos Blade tienen la extensi√≥n `.blade.php` y se almacenan en la carpeta `resources/views/`.

---

### **2. Fundamentos de la sintaxis: Mostrar datos**
Lo m√°s simple que hace Blade es mostrar datos.

**Sintaxis `{{ }}`**

Estas dobles llaves son el comando para Blade de "tomar una variable y mostrar su contenido de forma segura".

**Ejemplo:**

1.  **Ruta en `routes/web.php`:**
    ```php
	<?php
    Route::get('/mission-briefing', function () {
        $mission = 'Explorar el sistema Kepler-186';
        return view('briefing', ['mission_name' => $mission]);
    });
    ```

    -   `view('briefing', ...)` le dice a Laravel que busque el archivo `resources/views/briefing.blade.php`.
    -   `['mission_name' => $mission]` es un array de datos que "pasamos" a nuestra vista.

2.  **Vista en `resources/views/briefing.blade.php`:**
    ```html
    <h1>Misi√≥n Centro de Control</h1>
    <p>Tarea actual: {{ $mission_name }}</p>
    ```

**Resultado en el navegador en la direcci√≥n `/mission-briefing`:**
```html
<h1>Misi√≥n Centro de Control</h1>
<p>Tarea actual: Explorar el sistema Kepler-186</p>
```

> üõ°Ô∏è **Importante saber:** Blade escapa autom√°ticamente todos los datos dentro de `{{ }}`. Esto significa que si una variable contiene etiquetas HTML o un script malicioso, se mostrar√°n como texto normal y no se ejecutar√°n. Esta es una protecci√≥n incorporada contra ataques XSS.

> *Para mostrar HTML sin escapar (¬°haga esto con precauci√≥n!) se utiliza la sintaxis `{!! $variable !!}`.*

---

### **3. Directivas: A√±adir l√≥gica en HTML**
Las directivas Blade comienzan con el s√≠mbolo `@`. Permiten usar bucles, condiciones y mucho m√°s.

**Condiciones (`@if`, `@else`):**
```js
@if($planet->is_habitable)
    <p style="color: green;">¬°Planeta habitable!</p>
@else
    <p style="color: red;">Se requiere traje espacial. La atm√≥sfera es hostil.</p>
@endif
```

**Bucles (`@foreach`, `@forelse`):**

`@forelse` es una directiva muy conveniente que combina un bucle y una comprobaci√≥n de vac√≠o.
```js
<h2>Lista de planetas en el sistema:</h2>
<ul>
    @forelse($planets as $planet)
        <li>
            {{ $loop->iteration }}. {{ $planet->name }}
            <!-- $loop - variable especial disponible en el bucle -->
        </li>
    @empty
        <li>No se han detectado planetas en este sistema.</li>
    @endforelse
</ul>
```

---

### **4. Dise√±os y secciones: No te repitas (DRY)**
La capacidad m√°s potente de Blade es la creaci√≥n de dise√±os (layouts) reutilizables. No necesitas copiar la cabecera y el pie de p√°gina del sitio en cada p√°gina.

**Paso 1: Creamos el dise√±o maestro (`layout`)**

Crea el archivo `resources/views/layouts/app.blade.php`:
```php
<?php
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Centro de Control - @yield('title')</title>
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
</head>
<body>
    <header>
        <h1>Centro de Mando de la Flota Gal√°ctica</h1>
    </header>

    <main>
        @yield('content') <!-- Aqu√≠ ir√° el contenido √∫nico de la p√°gina -->
    </main>

    <footer>
        <p>&copy; {{ date('Y') }} Space Command. Todos los derechos reservados.</p>
    </footer>
</body>
</html>
```
-   `@yield('title')` y `@yield('content')` son "slots" o "marcadores de posici√≥n".

**Paso 2: Creamos una vista hija que utiliza el dise√±o**

Crea el archivo `resources/views/planets/index.blade.php`:
```php
<?php
@extends('layouts.app') {{-- Heredamos nuestro dise√±o maestro --}}

@section('title', 'Lista de planetas') {{-- Rellenamos la secci√≥n 'title' --}}

@section('content') {{-- Rellenamos la secci√≥n principal 'content' --}}
    <h2>Planetas registrados</h2>
    <p>Esta es una lista de todos los mundos que conocemos.</p>
    {{-- Aqu√≠ puede ir tu bucle @forelse para mostrar los planetas --}}
@endsection
```

Ahora, cuando Laravel renderice `planets.index`, primero tomar√° `layouts.app` y luego insertar√° en √©l el contenido de las secciones `@section`.

---

### **Cuestionario para afianzar conocimientos**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. ¬øQu√© extensi√≥n tienen los archivos de plantilla Blade?</p>
      <label><input type="radio" name="q1" value="a"> a) .html</label>
      <label><input type="radio" name="q1" value="b"> b) .blade.php</label>
      <label><input type="radio" name="q1" value="c"> c) .php.blade</label>
    </div>
    <div class="question">
      <p>2. ¬øC√≥mo mostrar de forma segura la variable `$name` en Blade?</p>
      <label><input type="radio" name="q2" value="a"> a) <?php echo $name; ?></label>
      <label><input type="radio" name="q2" value="b"> b) {{ $name }}</label>
      <label><input type="radio" name="q2" value="c"> c) [[$name]]</label>
    </div>
    <div class="question">
      <p>3. ¬øQu√© directiva se utiliza para heredar un dise√±o maestro?</p>
      <label><input type="radio" name="q3" value="a"> a) @include('layouts.app')</label>
      <label><input type="radio" name="q3" value="b"> b) @layout('layouts.app')</label>
      <label><input type="radio" name="q3" value="c"> c) @extends('layouts.app')</label>
    </div>
    <div class="question">
      <p>4. ¬øQu√© hace la directiva `@yield('content')`?</p>
      <label><input type="radio" name="q4" value="a"> a) Define un placeholder (espacio para insertar contenido)</label>
      <label><input type="radio" name="q4" value="b"> b) Inserta el contenido del archivo `content.blade.php`</label>
      <label><input type="radio" name="q4" value="c"> c) Finaliza la secci√≥n de contenido</label>
    </div>
    <div class="question">
      <p>5. ¬øQu√© directiva es ideal para un bucle sobre un array que podr√≠a estar vac√≠o?</p>
      <label><input type="radio" name="q5" value="a"> a) @foreach</label>
      <label><input type="radio" name="q5" value="b"> b) @while</label>
      <label><input type="radio" name="q5" value="c"> c) @forelse</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'c', q4: 'a', q5: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Tu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumen del cap√≠tulo:**

Has aprendido los fundamentos de Blade, una potente herramienta para crear p√°ginas web din√°micas. Ahora sabes:

-   Mostrar datos con protecci√≥n autom√°tica contra XSS.
-   Usar directivas para a√±adir l√≥gica (`@if`, `@forelse`).
-   Crear dise√±os reutilizables con `@extends` y `@yield`.
**Hemos dise√±ado los "planos" para los paneles de control de nuestra nave.** En el siguiente cap√≠tulo crearemos "paneles" (vistas) concretos para nuestra API y mostraremos datos reales en ellos.
