# **Cap√≠tulo 5.2: Creaci√≥n de vistas sencillas para la API**
**Tiempo de estudio:** 45 minutos

---

### **1. Tarea: Visualizar datos**

Nuestra API en el Cap√≠tulo 2 puede entregar datos en formato JSON. Esto es excelente para m√°quinas, pero las personas prefieren ver la informaci√≥n en p√°ginas web bellamente dise√±adas. Nuestro objetivo es crear dos de esas p√°ginas:

1.  **Lista de todos los planetas** (`/planets`)
2.  **P√°gina de un solo planeta** (`/planets/{id}`)

Para ello, utilizaremos la combinaci√≥n "Ruta ‚Üí Controlador ‚Üí Vista".

> üí° **Analog√≠a espacial:**

> Imagine que el JSON de la API son datos de telemetr√≠a sin procesar, simplemente un flujo de n√∫meros. Nuestra tarea hoy es crear dos pantallas (dos "vistas") en el Centro de Control de la Misi√≥n:

> - **Pantalla general:** muestra el estado de todos los objetos en el sistema (lista de planetas).
> - **Pantalla detallada:** al hacer clic en un objeto, muestra toda la informaci√≥n sobre √©l (p√°gina de un solo planeta).

---

### **2. Paso 1: Creaci√≥n de un controlador para p√°ginas web**
Para la limpieza de la arquitectura, no conviene mezclar la l√≥gica de la API y la l√≥gica de las p√°ginas web en un solo controlador. Crearemos un nuevo controlador espec√≠ficamente para mostrar nuestras vistas Blade.

Ejecute en la terminal:
```bash
php artisan make:controller Web/PlanetPageController
```
*Lo creamos en la subcarpeta `Web` para separarlo de los controladores de API.*

Abra el archivo creado `app/Http/Controllers/Web/PlanetPageController.php`.

---

### **Paso 2: P√°gina con la lista de todos los planetas**
**1. Crear un m√©todo en el controlador:**
En `PlanetPageController`, a√±ada el m√©todo `index`, que obtendr√° todos los planetas de la base de datos y los pasar√° a la vista.
```php
<?php

namespace App\Http\Controllers\Web;

use App\Http\Controllers\Controller;
use App\Models\Planet; // No olvide importar el modelo

class PlanetPageController extends Controller
{
    /**
     * Muestra la p√°gina con la lista de todos los planetas.
     */
    public function index()
    {
        // 1. Obtenemos todos los planetas de la DB
        $planets = Planet::all();

        // 2. Devolvemos la vista y le pasamos los datos
        return view('planets.index', ['planets' => $planets]);
    }
}
```

**2. Crear una vista Blade:**
Cree el archivo `resources/views/planets/index.blade.php`. Usaremos el layout creado en el cap√≠tulo anterior.

```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planetas</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 2em;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
        }
        h2 {
            color: #1a202c;
        }
        hr {
            border: none;
            border-top: 1px solid #e2e8f0;
            margin: 1.5em 0;
        }
        .planet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5em;
        }
        .planet-card {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5em;
            padding: 1.5em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        .planet-card:hover {
            transform: translateY(-5px);
        }
        .planet-card h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .planet-card p {
            margin-bottom: 0.5em;
            color: #4a5568;
        }
        .planet-card a {
            color: #4299e1;
            text-decoration: none;
            font-weight: bold;
        }
        .planet-card a:hover {
            text-decoration: underline;
        }
        .no-planets {
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Lista de todos los planetas conocidos</h2>
        <hr>
        <div class="planet-list">
            @forelse($planets as $planet)
                <div class="planet-card">
                    <h3>{{ $planet->name }}</h3>
                    <p>Sistema solar: {{ $planet->solar_system }}</p>
                    <p>Di√°metro: {{ number_format($planet->size_km, 0, '.', ' ') }} km</p>
                    <a href="/planets/{{ $planet->id }}">Saber m√°s &rarr;</a>
                </div>
            @empty
                <p class="no-planets">No hay planetas en la base de datos. Por favor, ejecute los seeders.</p>
            @endforelse
        </div>
    </div>
</body>
</html>
```

-   `number_format(...)` ‚Äî es una funci√≥n PHP com√∫n para formatear n√∫meros de forma agradable. Se puede usar directamente en Blade.

**3. Crear una ruta en `routes/web.php`:**
```php
use App\Http\Controllers\Web\PlanetPageController;

// ...

Route::get('/planets', [PlanetPageController::class, 'index']);
```
¬°Ahora, si navega a `/planets` en su navegador, ver√° la p√°gina con la lista de planetas!

---

### **4. Paso 3: P√°gina de un solo planeta**
**1. Crear un m√©todo en el controlador:**

En `PlanetPageController`, a√±adiremos el m√©todo `show`. Gracias al Route Model Binding, Laravel encontrar√° autom√°ticamente el planeta por ID y lo pasar√° al m√©todo.

```php
<?php
// Dentro de la clase PlanetPageController
/**
 * Muestra la p√°gina de un planeta espec√≠fico.
 */
public function show(Planet $planet)
{
    // Laravel ya ha encontrado el planeta para nosotros.
    // Si no se encuentra, devolver√° autom√°ticamente un error 404.

    return view('planets.show', ['planet' => $planet]);
}
```

**2. Crear una vista Blade:**

Cree el archivo `resources/views/planets/show.blade.php`.

```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ $planet->name }}</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            width: 100%;
        }
        .planet-detail {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5em;
            padding: 2em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .planet-detail h1 {
            margin-top: 0;
            color: #2d3748;
        }
        .planet-detail p {
            margin-bottom: 1em;
            color: #4a5568;
            font-size: 1.1em;
        }
        .back-link {
            display: inline-block;
            margin-top: 1.5em;
            color: #4299e1;
            text-decoration: none;
            font-weight: bold;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="planet-detail">
            @if($planet->image_url)
                <img src="{{ $planet->image_url }}" alt="Imagen de {{ $planet->name }}" style="max-width: 100%; height: auto; border-radius: 0.5em; margin-bottom: 1em;">
            @endif
            <h1>{{ $planet->name }}</h1>
            @if($planet->description)
                <p>{{ $planet->description }}</p>
            @endif
            <p><strong>Sistema solar:</strong> {{ $planet->solar_system }}</p>
            <p><strong>Di√°metro:</strong> {{ number_format($planet->size_km, 0, '.', ' ') }} km</p>
            <a href="/planets" class="back-link">&larr; Volver a la lista de planetas</a>
        </div>
    </div>
</body>
</html>
```

**3. Crear una ruta en `routes/web.php`:**
```php
// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç –ø–æ—Å–ª–µ –º–∞—Ä—à—Ä—É—Ç–∞ –¥–ª—è /planets
Route::get('/planets/{planet}', [PlanetPageController::class, 'show']);
```
-   El nombre del par√°metro `{planet}` debe coincidir con el nombre de la variable en el m√©todo del controlador (`show(Planet $planet)`) para que Route Model Binding funcione correctamente.

Ahora, al hacer clic en el enlace "Saber m√°s" en la p√°gina de la lista, acceder√° a la p√°gina de detalles de un planeta espec√≠fico.

---

### **Cuestionario de consolidaci√≥n**


<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>
<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. ¬øCu√°l es el mejor enfoque para separar la l√≥gica de la API y las p√°ginas web?</p>
      <label><input type="radio" name="q1" value="a"> a) Usar un solo controlador para todo</label>
      <label><input type="radio" name="q1" value="b"> b) Crear controladores separados (por ejemplo, en las carpetas `Web` y `Api`)</label>
      <label><input type="radio" name="q1" value="c"> c) Poner toda la l√≥gica en el archivo de rutas</label>
    </div>
    <div class="question">
      <p>2. ¬øQu√© hace return view('planets.index', ['planets' => $planets]);?</p>
      <label><input type="radio" name="q2" value="a"> a) Devuelve un array JSON con los datos de los planetas</label>
      <label><input type="radio" name="q2" value="b"> b) Renderiza el archivo resources/views/planets/index.blade.php y le pasa la variable `$planets`</label>
      <label><input type="radio" name="q2" value="c"> c) Redirige a la URL /planets/index</label>
    </div>
    <div class="question">
      <p>3. ¬øQu√© es Route Model Binding en el contexto de `show(Planet $planet)`?</p>
      <label><input type="radio" name="q3" value="a"> a) Laravel vincula manualmente la ruta con el modelo en la configuraci√≥n</label>
      <label><input type="radio" name="q3" value="b"> b) Laravel encuentra autom√°ticamente un registro `Planet` en la DB usando el par√°metro de la URL (`{planet}`)</label>
      <label><input type="radio" name="q3" value="c"> c) Laravel crea un nuevo planeta si no se encuentra</label>
    </div>
    <div class="question">
      <p>4. ¬øC√≥mo se puede formatear la fecha del campo `created_at` en Blade?</p>
      <label><input type="radio" name="q4" value="a"> a) {{ $planet->created_at->format('Y-m-d') }}</label>
      <label><input type="radio" name="q4" value="b"> b) {{ format_date($planet->created_at) }}</label>
      <label><input type="radio" name="q4" value="c"> c) Esto solo se puede hacer en el controlador</label>
    </div>
    <div class="question">
      <p>5. Si la ruta es `/posts/{post}`, ¬øc√≥mo deber√≠a ser la firma del m√©todo en el controlador para que funcione el Route Model Binding?</p>
      <label><input type="radio" name="q5" value="a"> a) public function show(Post $post)</label>
      <label><input type="radio" name="q5" value="b"> b) public function show(Post $p)</label>
      <label><input type="radio" name="q5" value="c"> c) public function show($post)</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'a', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Tu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumen del cap√≠tulo:**

Has creado con √©xito un "escaparate" para tu API, utilizando la arquitectura Laravel MVC. Ahora tienes:

-   Un controlador separado para la l√≥gica de las p√°ginas web.
-   Una p√°gina din√°mica con una lista de todos los planetas, que obtiene datos de la DB.
-   Una p√°gina de detalles para cada planeta, utilizando Route Model Binding.
-   Dos rutas web en `routes/web.php` para acceder a estas p√°ginas.

**Has transformado los datos brutos en informaci√≥n comprensible y √∫til para el usuario.** En el siguiente cap√≠tulo, a√±adiremos interactividad, incrustando JavaScript en nuestras vistas Blade para interactuar con la API sin recargar la p√°gina.
