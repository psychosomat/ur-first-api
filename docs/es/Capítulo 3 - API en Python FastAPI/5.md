# **Cap√≠tulo 3.5: Documentaci√≥n autom√°tica de Swagger**
**Tiempo de estudio:** 30 minutos

---

#### **1. Documentaci√≥n de la API: Manual de operaciones de una estaci√≥n espacial**
Imagina que eres un astronauta nuevo llegando a la ISS. ¬øC√≥mo sabr√≠as qu√© interruptor controla qu√© y c√≥mo manejar el brazo rob√≥tico? Necesitar√≠as **instrucciones detalladas y actualizadas**.

La **documentaci√≥n de la API** es un manual similar para los desarrolladores. Explica:

- Qu√© "puertos de acoplamiento" (endpoints) est√°n disponibles.
- Qu√© "comandos" (m√©todos HTTP) se pueden enviar.
- Qu√© "carga" (datos) se necesita transmitir.
- Qu√© "telemetr√≠a" (respuestas) esperar.

El problema es que escribir la documentaci√≥n manualmente es largo, aburrido y casi siempre se vuelve obsoleta.

> üí° **Analog√≠a espacial:**

> La documentaci√≥n manual son planos de papel que est√°n en un archivo y no se actualizan despu√©s de la modernizaci√≥n de la estaci√≥n.
> La **documentaci√≥n autom√°tica de FastAPI** es un **display interactivo en el Centro de Control de Misi√≥n** que se actualiza en tiempo real despu√©s de cada cambio en la estaci√≥n.

---

#### **2. La Magia de FastAPI: ¬øC√≥mo funciona?**
FastAPI hace todo el "trabajo sucio" por ti, bas√°ndose en tu propio c√≥digo. Escanea:

1.  **Rutas:** Todos los decoradores `@app.get`, `@app.post`, etc.
2.  **Par√°metros:** Par√°metros de ruta (`ship_id: int`) y de consulta.
3.  **Modelos Pydantic:** Tus "planos" (`Spaceship`, `SpaceshipCreate`).
4.  **Cadenas de documentaci√≥n (docstrings):** Descripciones que escribes entre comillas triples.

Bas√°ndose en estos datos, FastAPI genera un esquema seg√∫n el est√°ndar **OpenAPI** (anteriormente conocido como Swagger), y luego lo muestra a trav√©s de dos hermosas interfaces.

---

#### **3. Explorando el "display del Centro de Control de Misi√≥n": Swagger UI**
**Swagger UI** es una interfaz interactiva que permite no solo leer la documentaci√≥n, sino tambi√©n **probar la API directamente desde el navegador**.

**Abra `http://127.0.0.1:8000/docs`**

Ver√°:

-   **Lista de endpoints:** Agrupados por etiquetas (por defecto, por nombre de recurso) y coloreados seg√∫n los m√©todos HTTP.
-   **Descripciones:** Los textos de sus docstrings (`"""..."""`) se muestran como descripciones de los endpoints.
-   **Par√°metros:** Muestra qu√© par√°metros (como `ship_id`) espera el endpoint, su tipo y si son obligatorios.
-   **Cuerpo de la solicitud (Request Body):** Para `POST` y `PUT` muestra el esquema JSON generado a partir de su modelo Pydantic (`SpaceshipCreate`).
-   **Respuestas (Responses):** Muestra los posibles c√≥digos de estado y esquemas de respuesta, basados en `response_model`.
-   **Bot√≥n "Try it out":** Permite rellenar los par√°metros y enviar una solicitud real a su servidor.

---

#### **4. Mejorando la documentaci√≥n: Etiquetas y descripciones**
Hagamos nuestra documentaci√≥n a√∫n m√°s profesional.

**Paso 1: A√±adiendo metadatos en `FastAPI`**
Al crear `app`, puede pasar informaci√≥n general sobre su API.

**Cambie la l√≠nea `app = FastAPI()` en `main.py`:**
```python
# main.py

app = FastAPI(
    title="API de Gesti√≥n de Flota",
    description="API para la gesti√≥n de flotas de naves espaciales.",
    version="1.0.0",
)
```
Ahora aparecer√°n el t√≠tulo y la descripci√≥n en la parte superior de su documentaci√≥n.

**Paso 2: Agrupando endpoints con etiquetas**
Puede a√±adir etiquetas a cada endpoint para agruparlos por significado.

**A√±ada el par√°metro `tags` en los decoradores:**
```python
# GET /spaceships
@app.get("/spaceships", response_model=List[Spaceship], tags=["Naves espaciales"])
# ...

# GET /spaceships/{ship_id}
@app.get("/spaceships/{ship_id}", response_model=Spaceship, tags=["Naves espaciales"])
# ...

# POST /spaceships
@app.post("/spaceships", response_model=Spaceship, status_code=201, tags=["Naves espaciales"])
# ...

# y as√≠ sucesivamente para PUT y DELETE
```
Ahora todas sus operaciones CRUD estar√°n agrupadas ordenadamente bajo el encabezado "Naves espaciales".

---

#### **5. Vista alternativa: ReDoc**
FastAPI proporciona otra interfaz para la documentaci√≥n "de forma nativa" ‚Äî **ReDoc**. Es menos interactiva, pero a menudo se considera m√°s legible y es ideal para documentaci√≥n est√°tica.

**Abra `http://127.0.0.1:8000/redoc`**

Ver√° un dise√±o de tres columnas con navegaci√≥n, descripciones de endpoints y esquemas de datos. Es una excelente manera de proporcionar documentaci√≥n a sus "clientes" (por ejemplo, al equipo de frontend).

---

#### **Cuestionario de repaso**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>


<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI genera la documentaci√≥n bas√°ndose en...</p>
      <label><input type="radio" name="q1" value="a"> a) Archivos `.html` separados que deben crearse manualmente</label>
      <label><input type="radio" name="q1" value="b"> b) Su c√≥digo Python: rutas, modelos Pydantic y docstrings</label>
      <label><input type="radio" name="q1" value="c"> c) Comentarios que comienzan con `#`</label>
    </div>
    <div class="question">
      <p>2. ¬øQu√© est√°ndar subyace a la autodocumentaci√≥n de FastAPI?</p>
      <label><input type="radio" name="q2" value="a"> a) GraphQL</label>
      <label><input type="radio" name="q2" value="b"> b) XML-RPC</label>
      <label><input type="radio" name="q2" value="c"> c) OpenAPI (Swagger)</label>
    </div>
    <div class="question">
      <p>3. ¬øEn qu√© URL est√° disponible por defecto la documentaci√≥n interactiva de Swagger UI?</p>
      <label><input type="radio" name="q3" value="a"> a) `/admin`</label>
      <label><input type="radio" name="q3" value="b"> b) `/docs`</label>
      <label><input type="radio" name="q3" value="c"> c) `/api/help`</label>
    </div>
    <div class="question">
      <p>4. El par√°metro `tags` en el decorador `@app.get` se utiliza para:</p>
      <label><input type="radio" name="q4" value="a"> a) A√±adir metaetiquetas a HTML</label>
      <label><input type="radio" name="q4" value="b"> b) Agrupar endpoints en la documentaci√≥n</label>
      <label><input type="radio" name="q4" value="c"> c) Marcar un endpoint como obsoleto</label>
    </div>
    <div class="question">
      <p>5. ReDoc es...</p>
      <label><input type="radio" name="q5" value="a"> a) Una herramienta para editar c√≥digo en el navegador</label>
      <label><input type="radio" name="q5" value="b"> b) Una interfaz alternativa y m√°s est√°tica para la documentaci√≥n de la API</label>
      <label><input type="radio" name="q5" value="c"> c) Un sistema para detectar c√≥digo "rojo" (no funcional)</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Su resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Conclusi√≥n del cap√≠tulo:**

Ha visto una de las "superpoderes" m√°s potentes de FastAPI: la creaci√≥n de documentaci√≥n sin ning√∫n esfuerzo.

-   üìñ Su API ahora tiene dos tipos de documentaci√≥n actualizada: **Swagger UI** y **ReDoc**.
-   üî¨ La documentaci√≥n es interactiva y permite probar la API al vuelo.
-   üè∑Ô∏è Aprendi√≥ a mejorarla con metadatos y etiquetas.

**¬°El manual de operaciones est√° listo y siempre actualizado!** En el cap√≠tulo final de esta secci√≥n, aprenderemos a manejar las "anomal√≠as espaciales": errores y datos incorrectos.

> **üìå Verificaci√≥n:**

> -   Aseg√∫rese de que en la direcci√≥n `http://127.0.0.1:8000/docs` se muestren el t√≠tulo, la descripci√≥n y los endpoints agrupados por etiquetas.
> -   Verifique que su modelo `Spaceship` sea visible en la secci√≥n "Schemas".
> -   Abra `http://127.0.0.1:8000/redoc` y eval√∫e la vista alternativa.

> **‚ö†Ô∏è Si los cambios no aparecen:**
> - Aseg√∫rese de haber guardado el archivo `main.py`.
> - Compruebe que el servidor `uvicorn` est√° ejecut√°ndose con el flag `--reload` y se ha recargado exitosamente.
