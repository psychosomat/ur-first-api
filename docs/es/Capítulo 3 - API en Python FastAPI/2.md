# **Cap√≠tulo 3.2: Creaci√≥n del primer endpoint de API**
**Tiempo de estudio:** 30 minutos

---

#### **1. Endpoint: Puerto de acoplamiento para datos**
Imagine que nuestra API es una estaci√≥n espacial. Un **Endpoint** (punto final) es un **puerto de acoplamiento** espec√≠fico, dise√±ado para un tipo particular de naves.

- Puerto `‚Ññ1` ‚Äî para naves de carga (datos sobre planetas).
- Puerto `‚Ññ2` ‚Äî para sondas de investigaci√≥n (datos sobre misiones).
- Puerto `‚Ññ3` ‚Äî para transbordadores de pasajeros (datos sobre astronautas).

Cada endpoint es una URL √∫nica que se encarga de una operaci√≥n espec√≠fica con un recurso particular.

> üí° **Analog√≠a espacial:**
> `GET /spaceships` ‚Äî es el comando "Control de Misi√≥n ‚Üí Estaci√≥n: Informe la lista de todas las naves acopladas". Este endpoint devuelve una colecci√≥n de recursos.

---

#### **2. Creaci√≥n de una "flota espacial"**
Como todav√≠a no tenemos una base de datos, crearemos una "simulaci√≥n": una lista simple de naves espaciales en forma de diccionario de Python.

**Abra `main.py` y a√±ada este c√≥digo antes de la definici√≥n de `app`:**
```python
# main.py

# Paso 1: Creamos una simulaci√≥n de base de datos
db_spaceships = {
    1: {
        "name": "Voyager-1",
        "type": "Sonda",
        "launch_year": 1977,
        "status": "Activo"
    },
    2: {
        "name": "Hubble Space Telescope",
        "type": "Telescopio",
        "launch_year": 1990,
        "status": "Activo"
    },
    3: {
        "name": "ISS",
        "type": "Estaci√≥n",
        "launch_year": 1998,
        "status": "En √≥rbita"
    }
}

# ... aqu√≠ el c√≥digo app = FastAPI()
```
Este es nuestro "registro de naves espaciales" con el que trabajaremos.

---

#### **3. Primer endpoint: Lista de naves**
Ahora crearemos un endpoint que devolver√° toda nuestra flota.

**A√±ada este c√≥digo en `main.py` despu√©s de `@app.get("/")`:**
```python
# main.py

# ... c√≥digo con db_spaceships, FastAPI, app y read_root() ...

@app.get("/spaceships")
def get_spaceships():
    """
    Devuelve una lista de todas las naves espaciales en el registro.
    """
    return db_spaceships
```

- `@app.get("/spaceships")`: Hemos creado una nueva ruta. Ahora las solicitudes `GET` a la URL `/spaceships` ser√°n manejadas por la funci√≥n `get_spaceships`.
- `return db_spaceships`: FastAPI convertir√° autom√°ticamente el diccionario de Python en una respuesta JSON correcta.

---

#### **4. Verificaci√≥n del funcionamiento del nuevo puerto de acoplamiento**
Si su servidor `uvicorn` todav√≠a est√° en ejecuci√≥n con la bandera `--reload`, ya se habr√° recargado y estar√° listo para funcionar. Si no, ejec√∫telo de nuevo:
```bash
uvicorn main:app --reload
```

**Paso 1: Verificaci√≥n en el navegador**

Abra en el navegador la direcci√≥n `http://127.0.0.1:8000/spaceships`.
Deber√≠a ver la lista completa de sus naves en formato JSON:
```json
{
  "1": {
    "name": "Voyager-1",
    "type": "Sonda",
    "launch_year": 1977,
    "status": "Activo"
  },
  "2": {
    "name": "Hubble Space Telescope",
    "type": "Telescopio",
    "launch_year": 1990,
    "status": "Activo"
  },
  "3": {
    "name": "ISS",
    "type": "Estaci√≥n",
    "launch_year": 1998,
    "status": "En √≥rbita"
  }
}
```

**Paso 2: Verificaci√≥n en la autodocumentaci√≥n**

Vaya a `http://127.0.0.1:8000/docs`. Ver√° que en la documentaci√≥n ha aparecido una nueva secci√≥n para el endpoint `GET /spaceships`. ¬°Puede hacer clic en "Try it out" y "Execute" para probarlo directamente desde all√≠!

---

#### **5. Endpoint con par√°metro: Datos sobre una nave espec√≠fica**
¬øQu√© pasa si solo necesitamos datos sobre el "Voyager-1"? Para ello, crearemos un endpoint con un **par√°metro de ruta (path parameter)**.

**A√±ada este c√≥digo en `main.py`:**
```python
# main.py

# ... resto del c√≥digo ...

@app.get("/spaceships/{ship_id}")
def get_spaceship(ship_id: int):
    """
    Devuelve datos sobre una nave espacial espec√≠fica por su ID.
    """
    return db_spaceships.get(ship_id)
```

- `"/spaceships/{ship_id}"`: Los corchetes `{}` le dicen a FastAPI que `ship_id` es una variable que se pasar√° desde la URL.
- `ship_id: int`: Esto es una **pista de tipo (type hint)**. FastAPI verificar√° autom√°ticamente que el ID pasado es un n√∫mero entero. Si alguien solicita `/spaceships/voyager`, FastAPI devolver√° un error de validaci√≥n `422 Unprocessable Entity`. ¬°Esto es magia!

**Verificaci√≥n:**

Abra `http://127.0.0.1:8000/spaceships/2`. Deber√≠a obtener datos solo sobre el telescopio "Hubble". Y si abre `http://127.0.0.1:8000/spaceships/99` ‚Äî obtendr√° `null`, ya que esa nave no existe.

---

#### **Cuestionario para consolidar**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Un endpoint en una API es...</p>
      <label><input type="radio" name="q1" value="a"> a) Un punto final del Universo</label>
      <label><input type="radio" name="q1" value="b"> b) Una URL √∫nica para una operaci√≥n espec√≠fica con un recurso</label>
      <label><input type="radio" name="q1" value="c"> c) El nombre de la base de datos</label>
    </div>
    <div class="question">
      <p>2. ¬øQu√© hace el decorador `@app.get("/users")`?</p>
      <label><input type="radio" name="q2" value="a"> a) Crea un nuevo usuario</label>
      <label><input type="radio" name="q2" value="b"> b) Vincula una funci√≥n a una solicitud GET a `/users`</label>
      <label><input type="radio" name="q2" value="c"> c) Obtiene una lista de todos los decoradores</label>
    </div>
    <div class="question">
      <p>3. ¬øQu√© significa la entrada `"/items/{item_id}"` en la ruta?</p>
      <label><input type="radio" name="q3" value="a"> a) Que se debe buscar una carpeta con el nombre `{item_id}`</label>
      <label><input type="radio" name="q3" value="b"> b) Que `item_id` es un par√°metro que se tomar√° de la URL</label>
      <label><input type="radio" name="q3" value="c"> c) Es un comentario que ser√° ignorado</label>
    </div>
    <div class="question">
      <p>4. ¬øPor qu√© se necesita la pista de tipo `ship_id: int` en la funci√≥n?</p>
      <label><input type="radio" name="q4" value="a"> a) Para que Python funcione m√°s r√°pido</label>
      <label><input type="radio" name="q4" value="b"> b) Para que FastAPI valide autom√°ticamente que el ID es un n√∫mero</label>
      <label><input type="radio" name="q4" value="c"> c) Para que la variable sea visible fuera de la funci√≥n</label>
    </div>
    <div class="question">
      <p>5. Si solicita `/spaceships/abc` y FastAPI espera un `int`, ¬øqu√© suceder√°?</p>
      <label><input type="radio" name="q5" value="a"> a) El servidor "caer√°" con un error 500</label>
      <label><input type="radio" name="q5" value="b"> b) FastAPI devolver√° un error 422</label>
      <label><input type="radio" name="q5" value="c"> c) FastAPI intentar√° convertir "abc" en un n√∫mero</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Su resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**üöÄ Resumen del cap√≠tulo:**

Ha creado con √©xito dos "puertos de acoplamiento" en su estaci√≥n espacial API:

- üõ∞Ô∏è Uno para obtener la lista de todas las naves (`/spaceships`)
- üî≠ Otro para obtener datos sobre una nave espec√≠fica (`/spaceships/{ship_id}`)

Tambi√©n ha visto el poder de la validaci√≥n autom√°tica de tipos de FastAPI, que protege su API de solicitudes incorrectas.

**¬°El sistema de navegaci√≥n est√° configurado!** En el pr√≥ximo cap√≠tulo, crearemos "planos" para nuestras naves espaciales usando Pydantic, para hacer nuestra API a√∫n m√°s inteligente y robusta.

> **üìå Verificaci√≥n:**
> - El servidor `uvicorn` est√° iniciado y funcionando.
> - La URL `http://127.0.0.1:8000/spaceships` devuelve un JSON con la lista de naves espaciales.
> - La URL `http://127.0.0.1:8000/spaceships/1` devuelve datos sobre el "Voyager-1".
> - La URL `http://127.0.0.1:8000/docs` muestra dos nuevos endpoints.

> **‚ö†Ô∏è Si hay errores:**

> - **404 Not Found:** Compruebe que la URL est√° escrita correctamente en el navegador y en el decorador `@app.get(...)`.
> - **Error en el c√≥digo:** Revise cuidadosamente la sintaxis, especialmente las indentaciones en Python y las comas en el diccionario.
