# **Cap√≠tulo 3.1: Instalaci√≥n de FastAPI y configuraci√≥n del entorno**
**Tiempo de estudio:** 45 minutos

---

#### **1. ¬øQu√© es FastAPI? El hiperpropulsor para tu API**
Si Flask es una sonda de reconocimiento √°gil y Django es un enorme portaaviones, entonces **FastAPI** es un **caza estelar superluminal**.

**FastAPI** es un framework web moderno y de alto rendimiento para construir APIs en Python 3.7+. Sus principales ventajas son:

- **Velocidad:** Uno de los frameworks de Python m√°s r√°pidos, comparable con NodeJS y Go.
- **Sencillez:** Sintaxis minimalista e intuitiva.
- **Auto-documentaci√≥n:** Genera autom√°ticamente documentaci√≥n interactiva para tu API.
- **Tipado:** Utiliza las sugerencias de tipo est√°ndar de Python para validaci√≥n, autocompletado y documentaci√≥n.

> üí° **Analog√≠a espacial:**

> FastAPI es como el "hiperpropulsor" para tu nave-API. Se basa en dos tecnolog√≠as:

> - **Starlette** (el chasis del caza) ‚Äî proporciona asincron√≠a y el m√°s alto rendimiento.
> - **Pydantic** (el ordenador de a bordo) ‚Äî se encarga de la validaci√≥n de datos y la configuraci√≥n.

---

#### **2. Preparaci√≥n de la plataforma de lanzamiento: Entorno virtual**
Antes de construir nuestro caza, necesitamos crear un **laboratorio de ensamblaje est√©ril**. En Python, para esto se utilizan los **entornos virtuales**.

**¬øPor qu√© es necesario?** Para que las dependencias de nuestro proyecto (motores, sistemas de navegaci√≥n) no entren en conflicto con otros proyectos en tu ordenador.

**Paso 1: Creamos el entorno virtual**
Abre la terminal en la carpeta de tu proyecto (por ejemplo, `C:\Projects\FastAPI_Fleet`) y ejecuta:

```bash
python -m venv venv
```
Este comando crear√° una carpeta `venv` con una versi√≥n aislada de Python.

**Paso 2: Activamos el "campo de fuerza" del laboratorio**

- **Windows (PowerShell):**

  ```powershell
  .\venv\Scripts\Activate.ps1
  ```
  *(Si aparece un error, es posible que necesites permitir la ejecuci√≥n de scripts: `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process`)*

- **Windows (CMD):**

  ```cmd
  .\venv\Scripts\activate.bat
  ```

- **macOS / Linux:**

  ```bash
  source venv/bin/activate
  ```
Despu√©s de la activaci√≥n, `(venv)` aparecer√° al principio de la l√≠nea de la terminal. ¬°Esto significa que est√°s dentro de tu laboratorio!

---

#### **3. Instalaci√≥n del motor: FastAPI y Uvicorn**
Ahora instalaremos dos componentes clave:

- **fastapi:** El framework en s√≠.
- **uvicorn:** Un servidor ASGI ultrarr√°pido que "ejecutar√°" nuestro motor.

Ejecuta en el entorno activado:
```bash
pip install "fastapi[all]"
```
> üí° **¬øPor qu√© `[all]`?**
> Esto instalar√° `fastapi`, `uvicorn` y otros paquetes √∫tiles (por ejemplo, para soporte de websockets y Jinja2), que ser√°n √∫tiles en futuras misiones.

**Verificaci√≥n de la instalaci√≥n:**
```bash
pip freeze
```
Deber√≠as ver `fastapi`, `pydantic`, `starlette`, `uvicorn` y otros paquetes en la lista.

---

#### **4. Primer contacto: Archivo `main.py`**
Crea el archivo `main.py` en la ra√≠z del proyecto ‚Äî este ser√° el **panel de control central** de nuestra API.

**A√±ade el siguiente c√≥digo a `main.py`:**
```python
from fastapi import FastAPI

# Creamos una instancia de nuestra "nave espacial" API
app = FastAPI()

# Definimos el primer "punto de acoplamiento" (endpoint)
# Esta es la URL ra√≠z: /
@app.get("/")
def read_root():
    """
    Este es el mensaje del Centro de Control de Misiones (CCM)
    que ven todos los que se conectan a la puerta principal.
    """
    return {"message": "¬°Bienvenido al Centro de Control de la Flota Espacial!"}
```
- `@app.get("/")`: Este es un **decorador** que le dice a FastAPI que la funci√≥n `read_root` debe manejar las solicitudes `GET` en la URL ra√≠z (`/`).

---

#### **5. ¬°Ignici√≥n! Inicio del servidor**
¬°Ha llegado el momento de arrancar nuestro hiperpropulsor! En la terminal (con `venv` activo) ejecuta:
```bash
uvicorn main:app --reload
```
**Desglose del comando:**

- `uvicorn`: Iniciamos el servidor Uvicorn.
- `main`: El archivo `main.py` (sin `.py`).
- `app`: El objeto `app = FastAPI()`, creado dentro de `main.py`.
- `--reload`: "Piloto autom√°tico". El servidor se reiniciar√° autom√°ticamente con cada cambio en el c√≥digo.

**Salida esperada en la terminal:**
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345]
INFO:     Started server process [12346]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

---

#### **6. Prueba de comunicaci√≥n con el CCM**
¬°Tu API ya est√° en l√≠nea y escuchando en el puerto `8000`!

**Paso 1: Verificaci√≥n en el navegador**

Abre en tu navegador la direcci√≥n `http://127.0.0.1:8000`. Deber√≠as ver:
```json
{
  "message": "¬°Bienvenido al Centro de Control de la Flota Espacial!"
}
```

**Paso 2: Un vistazo al futuro (auto-documentaci√≥n)**

FastAPI ya ha creado dos regalos para ti. Abre estas URL:

- `http://127.0.0.1:8000/docs`: Documentaci√≥n interactiva Swagger UI.
- `http://127.0.0.1:8000/redoc`: Documentaci√≥n alternativa ReDoc.

¬°Ver√°s tu primer endpoint, que puedes probar directamente desde el navegador!

---

#### **Cuestionario para afianzar conocimientos**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI es conocido por su...</p>
      <label><input type="radio" name="q1" value="a"> a) Trabajo lento pero fiable</label>
      <label><input type="radio" name="q1" value="b"> b) Alto rendimiento y velocidad</label>
      <label><input type="radio" name="q1" value="c"> c) Integraci√≥n solo con bases de datos Microsoft</label>
    </div>
    <div class="question">
      <p>2. ¬øPara qu√© se necesita un entorno virtual (`venv`)?</p>
      <label><input type="radio" name="q2" value="a"> a) Para acelerar el funcionamiento de Python</label>
      <label><input type="radio" name="q2" value="b"> b) Para aislar las dependencias del proyecto</label>
      <label><input type="radio" name="q2" value="c"> c) Para la escritura autom√°tica de pruebas</label>
    </div>
    <div class="question">
      <p>3. ¬øQu√© servidor se utiliza para ejecutar FastAPI en esta lecci√≥n?</p>
      <label><input type="radio" name="q3" value="a"> a) Apache</label>
      <label><input type="radio" name="q3" value="b"> b) Gunicorn</label>
      <label><input type="radio" name="q3" value="c"> c) Uvicorn</label>
    </div>
    <div class="question">
      <p>4. El comando `uvicorn main:app --reload` significa:</p>
      <label><input type="radio" name="q4" value="a"> a) Ejecutar el archivo `app.py` con el objeto `main`</label>
      <label><input type="radio" name="q4" value="b"> b) Ejecutar el objeto `app` en el archivo `main.py` y reiniciar con los cambios</label>
      <label><input type="radio" name="q4" value="c"> c) Reiniciar el ordenador y ejecutar la aplicaci√≥n</label>
    </div>
    <div class="question">
      <p>5. ¬øQu√© hace el decorador `@app.get("/")` en FastAPI?</p>
      <label><input type="radio" name="q5" value="a"> a) Obtiene datos del archivo `app.py`</label>
      <label><input type="radio" name="q5" value="b"> b) Env√≠a una solicitud GET a un servidor externo</label>
      <label><input type="radio" name="q5" value="c"> c) Vincula la funci√≥n a una solicitud GET en la URL ra√≠z</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'c', q4: 'b', q5: 'c' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Tu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumen del cap√≠tulo:**

¬°Has ensamblado y lanzado con √©xito el "hiperpropulsor" de tu nueva API! Ahora tienes:
- üõ†Ô∏è Entorno de desarrollo aislado (`venv`)
- üöÄ FastAPI y servidor Uvicorn instalados
- üõ∞Ô∏è API funcionando con un solo endpoint
- üìä Documentaci√≥n generada autom√°ticamente

**¬°Todos los sistemas en orden!** En el siguiente cap√≠tulo, crearemos nuestro primer endpoint completo que devolver√° una lista de naves espaciales.

> **üìå Verificaci√≥n:**

> - El entorno `(venv)` est√° activo en el terminal
> - El servidor `uvicorn` se ha iniciado sin errores
> - La direcci√≥n `http://127.0.0.1:8000/docs` se abre en el navegador

> **‚ö†Ô∏è Si hay errores:**

> - `command not found`: Aseg√∫rate de haber activado el entorno virtual.
> - `Port ... is already in use`: Otro programa est√° usando el puerto 8000. Det√©nlo o inicia uvicorn en otro puerto: `uvicorn main:app --reload --port 8001`.
> - Errores al activar `venv` en PowerShell: Verifica la pol√≠tica de ejecuci√≥n de scripts.
