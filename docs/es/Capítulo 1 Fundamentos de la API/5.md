# **CapÃ­tulo 1.5: Pruebas de API a travÃ©s de Postman**
**Tiempo de estudio:** 50 minutos

---

#### **1. Â¿Por quÃ© probamos las API? VerificaciÃ³n previa al lanzamiento**
Imagine: antes del lanzamiento de un cohete, los ingenieros realizan **pruebas de encendido de sistemas**. Si se omite una verificaciÃ³n, Â¡la misiÃ³n podrÃ­a fallar!

Las **pruebas de API** son sus pruebas de control:

- âœ… Verificar la operatividad de los "nodos de acoplamiento"

- ðŸ›¡ï¸ Detectar vulnerabilidades antes de su uso en combate

- ðŸ“Š Asegurarse de que los datos se transmitan sin distorsiones

> ðŸ’¡ **AnalogÃ­a espacial:**
> Postman es como una consola de pruebas del Centro de Control de Misiones (CCM) para simular todos los escenarios: "Â¿QuÃ© pasa si se solicitan datos de un planeta inexistente? Â¿SoportarÃ¡ el servidor 1000 solicitudes/seg?"

---

#### **2. Postman: "Centro de Control de Vuelo" para API**
**Capacidades:**

- ðŸ“¡ EnvÃ­o de cualquier solicitud HTTP (GET, POST, PUT, DELETE)

- ðŸ” AnÃ¡lisis de respuestas (cÃ³digos de estado, encabezados, cuerpo JSON)

- ðŸ§ª Escritura de pruebas automatizadas (JavaScript)

- ðŸŒ Trabajo con variables de entorno (pruebas vs producciÃ³n)

[ðŸ‘‰ Descargar Postman](https://www.postman.com/downloads/)

---

#### **3. Primer lanzamiento: Probando la API de planetas**
**Paso 1: Crear una solicitud**

1. Abrir Postman â†’ New â†’ Request

2. Introducir URL: `https://api.spacexdata.com/v4/rockets`

3. Seleccionar mÃ©todo: **GET**

**Paso 2: Enviar la "seÃ±al"**
```bash
[CCM] -- GET /planets --> [Servidor SpaceX]
```

**Paso 3: Analizar la telemetrÃ­a:**
- Estado: `200 OK`
- Cuerpo de la respuesta (JSON): lista de cohetes con parÃ¡metros
```json
[
  {
    "name": "Falcon 1",
    "type": "rocket",
    "active": false,
    "stages": 2,
    "id": "5e9d0d95eda69955f709d1eb"
  },
  {
    "name": "Falcon 9",
    "type": "rocket",
    "active": true,
    "id": "5e9d0d95eda69973a809d1ec"
  }
]
```

---

#### **4. Esquema: Componentes de Postman**
```
[Espacio de trabajo]
â”œâ”€â”€ PestaÃ±a "Params" (ParÃ¡metros de consulta)
â”œâ”€â”€ PestaÃ±a "Headers" (Encabezados)
â”œâ”€â”€ PestaÃ±a "Body" (Cuerpo de la solicitud para POST/PUT)
â”œâ”€â”€ PestaÃ±a "Tests" (Scripts para verificaciones)
â””â”€â”€ Panel de respuesta (Estado, Tiempo, TamaÃ±o, Cuerpo)
```

---

#### **5. Creando un escenario complejo: Lanzamiento de una misiÃ³n**
**Prueba: AÃ±adir un nuevo planeta al catÃ¡logo**

1. MÃ©todo: **POST**

2. URL: `https://jsonplaceholder.typicode.com/posts` (ejemplo)

3. En Encabezados:
   ```json
	{ "Content-Type": "application/json" }
   ```
4. En Cuerpo (raw â†’ JSON):
   ```json
   {
	"title": "New Exoplanet Found",
	"body": "Proxima Centauri b shows signs of a stable atmosphere.",
	"userId": 1
	}
   ```

**VerificaciÃ³n automÃ¡tica en Tests:**
```javascript
// VerificaciÃ³n de estado
pm.test("Post created successfully", () => {
    pm.response.to.have.status(201);
});

// VerificaciÃ³n de estructura y datos de la respuesta
pm.test("Response contains the new post data", () => {
    const response = pm.response.json();
    pm.expect(response).to.have.property("id"); // Verificamos que el servidor asignÃ³ un ID
    pm.expect(response.title).to.eql("New Exoplanet Found");
});
```

---

#### **6. Variables de entorno: Tierra vs Marte**

Â¿CÃ³mo probar en diferentes servidores (de prueba/producciÃ³n)?

1. Crear entornos:
   - `Local` â†’ `http://localhost:3000`
   - `Production` â†’ `https://api.nasa.gov`

2. En las solicitudes, usar variables:
   ```bash
   {{base_url}}/planets  # SustituirÃ¡ la URL actual
   ```

> âš ï¸ **Â¡Importante!** Â¡Nunca pruebe `DELETE` en un servidor de producciÃ³n!

---

#### **7. Colecciones: Biblioteca de misiones espaciales**
Agrupar solicitudes:
```
	ðŸ“‚ ColecciÃ³n "NASA"
  	â”œâ”€â”€ GET Planetas
  	â”œâ”€â”€ POST Nuevo planeta
  	â””â”€â”€ DELETE Planeta (modo de prueba)
```
**Ventajas:**

- ðŸš€ Ejecutar todas las pruebas con un solo botÃ³n
- ðŸ“¤ Exportar/importar configuraciones
- ðŸ‘¨â€ðŸš€ Trabajo colaborativo en equipo

---

#### **8. AutomatizaciÃ³n: Verificaciones regulares de satÃ©lites**

Configurar la **monitorizaciÃ³n de API** a travÃ©s de Postman:

1. Schedule â†’ Cada 2 horas

2. Pruebas:
   ```javascript
   pm.test("SatÃ©lite en lÃ­nea", () => {
     pm.response.to.have.status(200);
     pm.expect(pm.response.json().signal).above(50); // SeÃ±al >50%
   });
   ```

3. Notificaciones en Slack/email en caso de fallo

---

#### **Cuestionario para consolidar**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Postman se utiliza para:</p>
      <label><input type="radio" name="q1" value="a"> a) Enviar correo</label>
      <label><input type="radio" name="q1" value="b"> b) Probar API</label>
      <label><input type="radio" name="q1" value="c"> c) Crear bases de datos</label>
    </div>
    <div class="question">
      <p>2. Â¿QuÃ© estado esperar al crear un objeto con Ã©xito?</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 201 Created</label>
      <label><input type="radio" name="q2" value="c"> c) 404 Not Found</label>
    </div>
    <div class="question">
      <p>3. Â¿DÃ³nde escribir pruebas automatizadas en Postman?</p>
      <label><input type="radio" name="q3" value="a"> a) PestaÃ±a "Body"</label>
      <label><input type="radio" name="q3" value="b"> b) PestaÃ±a "Tests"</label>
      <label><input type="radio" name="q3" value="c"> c) PestaÃ±a "Cookies"</label>
    </div>
    <div class="question">
      <p>4. Las variables de entorno son necesarias para:</p>
      <label><input type="radio" name="q4" value="a"> a) Alternar entre el servidor de prueba y el de producciÃ³n</label>
      <label><input type="radio" name="q4" value="b"> b) Almacenar contraseÃ±as en texto claro</label>
      <label><input type="radio" name="q4" value="c"> c) Generar datos aleatorios</label>
    </div>
    <div class="question">
      <p>5. Â¿QuÃ© verifican las monitorizaciones regulares?</p>
      <label><input type="radio" name="q5" value="a"> a) La estabilidad del funcionamiento de la API</label>
      <label><input type="radio" name="q5" value="b"> b) La velocidad de internet</label>
      <label><input type="radio" name="q5" value="c"> c) La actualidad de la documentaciÃ³n</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'a', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">Â¡Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Su resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>


---

**ðŸš€ Resumen del capÃ­tulo:**
Postman es su "consola de control" universal para probar API. Con Ã©l, usted:
- VerificarÃ¡ el funcionamiento de los "sistemas a bordo" antes del lanzamiento
- CrearÃ¡ una biblioteca de escenarios de prueba
- AutomatizarÃ¡ la monitorizaciÃ³n de servicios espaciales

> **ðŸ“Œ Ejercicio prÃ¡ctico:**

> 1. Instale Postman
> 2. Cree una solicitud a la API de SpaceX: `GET https://api.spacexdata.com/v4/launches/latest`
> 3. Escriba una prueba que verifique que:
>    - El estado de la respuesta es `200`
>    - El campo `name` contiene la palabra "Falcon"
>    - El tiempo de respuesta es < 500 ms

**Â¡Felicidades por completar el CapÃ­tulo 1!**

Ha dominado los fundamentos del trabajo con API. Â¡En los prÃ³ximos capÃ­tulos construiremos nuestra propia "nave espacial" â€“ una aplicaciÃ³n web que utiliza API espaciales!

> **ðŸŒŒ Recursos adicionales:**

> - [SpaceX API Documentation](https://docs.spacexdata.com/)