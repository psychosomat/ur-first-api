# **CapÃ­tulo 1.2: MÃ©todos HTTP y cÃ³digos de estado**
**Tiempo de estudio:** 40 minutos

---

#### **1. HTTP: El lenguaje de comunicaciÃ³n en el espacio**
Imagina que eres el **Centro de Control de Misiones (CCM)**, y el servidor API es una **nave espacial**. HTTP (HyperText Transfer Protocol) es la **radiocomunicaciÃ³n** entre vosotros.

Cada mensaje contiene:

- **MÃ©todo** â†’ QuÃ© hacer (por ejemplo, "enviar sonda")

- **CÃ³digo de estado** â†’ Resultado de la operaciÃ³n ("Â¡sonda lanzada con Ã©xito!")

> ðŸ’¡ **AnalogÃ­a espacial:**
> `GET /stars` = "CCM â†’ Nave: Â¡Informa las coordenadas de las estrellas!"
> `200 OK` = "Nave â†’ CCM: Â¡Coordenadas transmitidas!"

---

#### **2. MÃ©todos HTTP principales**
Cada mÃ©todo es como un tipo de comando para una misiÃ³n espacial:

| MÃ©todo    | AnÃ¡logo en el espacio                  | Ejemplo de solicitud         | DescripciÃ³n                   |
|-----------|----------------------------------------|------------------------------|-------------------------------|
| **GET**   | Solicitud de datos (telescopio)        | `GET /planets`               | Obtener lista de planetas     |
| **POST**  | EnvÃ­o de nuevo objeto (lanzamiento de cohete) | `POST /satellites`           | Crear nuevo satÃ©lite          |
| **PUT**   | ActualizaciÃ³n completa de objeto (correcciÃ³n de Ã³rbita) | `PUT /satellites/iss`        | Actualizar datos de la ISS    |
| **DELETE**| DestrucciÃ³n de objeto (salida de Ã³rbita) | `DELETE /debris/123`         | Eliminar basura espacial      |

**âš¡ Ejemplo de cÃ³digo (Python):**
```python
import requests

# GET: Obtener datos sobre el cohete Falcon 9
# Usamos un endpoint real de la API de SpaceX
response = requests.get("https://api.spacexdata.com/v4/rockets/5e9d0d95eda69973a809d1ec")
print(response.status_code, response.json()['name']) # 200 Falcon 9

# POST: Crear una nueva publicaciÃ³n en una API de prueba
# Usamos el servicio sandbox jsonplaceholder
new_post = {"title": "MisiÃ³n Artemis", "body": "Listo para el lanzamiento", "userId": 1}
response = requests.post("https://jsonplaceholder.typicode.com/posts", json=new_post)
print(response.status_code, response.json()['id'])  # 201 101 (o otro ID)
```

---

#### **3. CÃ³digos de estado importantes**
La respuesta del servidor es como una seÃ±al de la nave espacial:

| Grupo | CÃ³digo | AnÃ¡logo en el espacio                     | DescripciÃ³n                  |
|-------|--------|-------------------------------------------|------------------------------|
| `2xx` | 200    | âœ… "Â¡Tarea completada!"                     | Ã‰xito                        |
|       | 201    | ðŸš€ "Â¡Cohete lanzado!"                      | Objeto creado                |
| `3xx` | 301    | ðŸŒ "CCM reubicado a nueva direcciÃ³n"      | RedirecciÃ³n                  |
| `4xx` | 400    | âŒ "Â¡Coordenadas incorrectas en la solicitud!" | Error del cliente            |
|       | 404    | ðŸª "Â¡Planeta no encontrado!"              | Recurso no encontrado        |
| `5xx` | 500    | ðŸ”¥ "Â¡Fallo en el sistema de propulsiÃ³n!"   | Error del servidor           |

---

#### **4. PrÃ¡ctica: Manejo de cÃ³digos de estado**
Â¡Siempre verifica la respuesta de la API! Ejemplo de manejo de errores:
```python
import requests

def get_post_data(post_id):
    """FunciÃ³n para obtener datos de una publicaciÃ³n con manejo de cÃ³digos de estado."""
    try:
        response = requests.get(f"https://jsonplaceholder.typicode.com/posts/{post_id}")

        # Verificamos el cÃ³digo de estado de la respuesta
        if response.status_code == 200:
            print(f"âœ… Â¡Datos para la publicaciÃ³n {post_id} obtenidos con Ã©xito!")
            return response.json()
        elif response.status_code == 404:
            print(f"âš ï¸ Â¡Recurso para la publicaciÃ³n {post_id} no encontrado!")
            return None
        else:
            # Manejo de otros errores de cliente (4xx) o de servidor (5xx)
            print(f"ðŸš¨ Â¡OcurriÃ³ un error! CÃ³digo de estado: {response.status_code}")
            return None

    except requests.exceptions.RequestException as e:
        # Manejo de errores de conexiÃ³n (por ejemplo, sin internet)
        print(f"ðŸ”¥ Error de conexiÃ³n: {e}")
        return None

# --- Probando nuestra funciÃ³n ---
print("--- Buscando publicaciÃ³n existente ---")
get_post_data(1)

print("\n--- Buscando publicaciÃ³n inexistente ---")
get_post_data(9999) # Esta publicaciÃ³n no existe, esperamos 404
```

> **ðŸ”­ Ejemplo de una API real (SpaceX):**
> Solicitud: `GET https://api.spacexdata.com/v4/ships/OCISLY`
> Respuesta: `200 OK` + datos de la nave
> Solicitud: `GET https://api.spacexdata.com/v4/ships/UNICORN`
> Respuesta: `404 Not Found`

---

#### **Cuestionario de consolidaciÃ³n**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Â¿QuÃ© mÃ©todo usar para obtener datos sobre las estrellas?</p>
      <label><input type="radio" name="q1" value="a"> a) POST</label>
      <label><input type="radio" name="q1" value="b"> b) PUT</label>
      <label><input type="radio" name="q1" value="c"> c) GET</label>
    </div>
    <div class="question">
      <p>2. El estado `201 Created` significa:</p>
      <label><input type="radio" name="q2" value="a"> a) Objeto eliminado</label>
      <label><input type="radio" name="q2" value="b"> b) Objeto creado</label>
      <label><input type="radio" name="q2" value="c"> c) Error del servidor</label>
    </div>
    <div class="question">
      <p>3. MÃ©todo para la actualizaciÃ³n completa de los datos de un satÃ©lite:</p>
      <label><input type="radio" name="q4" value="a"> a) PATCH</label>
      <label><input type="radio" name="q4" value="b"> b) DELETE</label>
      <label><input type="radio" name="q4" value="c"> c) PUT</label>
    </div>
    <div class="question">
      <p>4. Â¿QuÃ© significa el estado `500 Internal Server Error`?</p>
      <label><input type="radio" name="q5" value="a"> a) Error en la solicitud del cliente</label>
      <label><input type="radio" name="q5" value="b"> b) Fallo en el servidor</label>
      <label><input type="radio" name="q5" value="c"> c) EjecuciÃ³n exitosa</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'c', q2: 'b', q4: 'c', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">Â¡Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Tu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ðŸš€ Resumen del capÃ­tulo:**
Los mÃ©todos HTTP son vuestros comandos para misiones espaciales, y los cÃ³digos de estado son los informes de su ejecuciÃ³n. Recordad:
> `GET` = "Dame datos", `POST` = "Crea nuevo", `PUT` = "Actualiza todo", `DELETE` = "Destruye"
> `2xx` = Ã‰xito, `4xx` = Tu error, `5xx` = Problema del servidor

**Â¡Preparados para el lanzamiento!** En el prÃ³ximo capÃ­tulo descifraremos los "telegramas" del servidor: el formato JSON.

> **ðŸ“Œ PrÃ¡ctica:** Â¡Usad la [API de SpaceX](https://docs.spacexdata.com/) para enviar `GET /launches/latest` y estudiar los cÃ³digos de respuesta!
