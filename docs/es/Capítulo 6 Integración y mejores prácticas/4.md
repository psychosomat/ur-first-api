# **Cap√≠tulo 6.4: Documentaci√≥n de API**
**Tiempo de estudio:** 30 minutos

---

#### **1. ¬øPor qu√© es necesaria la documentaci√≥n de API?**
Imagine que le dan un mando de control de una nave espacial compleja sin ninguna etiqueta en los botones. Los pulsar√≠a al azar, arriesg√°ndose a activar la catapulta en lugar de encender la luz. La documentaci√≥n de API son precisamente esas etiquetas e instrucciones.

**Una buena documentaci√≥n:**

- **Ahorra tiempo:** Los desarrolladores no necesitan adivinar qu√© endpoints existen, qu√© par√°metros aceptan y qu√© devuelven.
- **Reduce errores:** Una descripci√≥n clara de los formatos de datos y los c√≥digos de error ayuda a evitar el uso incorrecto de la API.
- **Simplifica la integraci√≥n:** El equipo de frontend puede trabajar en paralelo con el equipo de backend, bas√°ndose en la documentaci√≥n como un contrato.
- **Es su legado:** Dentro de seis meses, se lo agradecer√° a usted mismo cuando regrese al proyecto.

> üí° **Analog√≠a espacial:**

> - **API** = Sistema de control complejo de una estaci√≥n espacial.
> - **Documentaci√≥n de API** = Manual para astronautas. Describe:
>   - Qu√© comando (`endpoint`) enviar para abrir la compuerta.
>   - Qu√© par√°metros (`cuerpo de la solicitud`) pasar para configurar el sistema de soporte vital.
>   - Qu√© se√±ales (`respuestas de API`) esperar a cambio.

---

#### **2. Documentaci√≥n en FastAPI: Magia autom√°tica**
FastAPI hace que la documentaci√≥n sea incre√≠blemente sencilla. **Genera autom√°ticamente documentaci√≥n interactiva** basada en su c√≥digo, utilizando los est√°ndares de **OpenAPI** y **Swagger UI**.

**Paso 1: Agregue metadatos a su aplicaci√≥n**

En `main.py` puede agregar descripciones que aparecer√°n en la documentaci√≥n.

```python
# main.py
from fastapi import FastAPI
from pydantic import BaseModel, Field

# ... (c√≥digo FastAPI)

app = FastAPI(
    title="SpaceAPI",
    description="""
API para la exploraci√≥n de la galaxia. üöÄ

Podr√°:
* **Ver planetas**.
* **Agregar nuevos mundos** (se requiere autenticaci√≥n).
    """,
    version="1.0.0",
    contact={
        "name": "Ingeniero Jefe del Centro de Control de Misi√≥n",
        "url": "https://example.com/contact",
        "email": "engineer@example.com",
    },
)
```

**Paso 2: Describa sus modelos y endpoints**

Cuanto m√°s detalladamente describa los modelos Pydantic y los par√°metros de los endpoints, mejor ser√° la documentaci√≥n.

```python
# En el archivo de modelos Pydantic o en main.py

class PlanetBase(BaseModel):
    name: str = Field(..., example="Tierra", description="Nombre del planeta")
    description: str = Field(..., example="Un planeta azul con vida diversa", description="Breve descripci√≥n")
    # ...

class Planet(PlanetBase):
    id: int
    is_habitable: bool

    class Config:
        orm_mode = True # o from_attributes = True en Pydantic v2

# En el archivo de rutas
@router.get(
    "/planets",
    response_model=list[Planet],
    summary="Obtener la lista de todos los planetas",
    description="Devuelve una lista de todos los planetas conocidos con paginaci√≥n (en el futuro)."
)
def get_planets():
    # ...

@router.post(
    "/planets",
    # ...
    summary="Crear un nuevo planeta",
    responses={
        401: {"description": "Usuario no autorizado"},
        422: {"description": "Error de validaci√≥n de datos"}
    }
)
def create_planet(planet: PlanetCreate, ...):
    # ...
```

- `Field(..., example="...")`: Agrega ejemplos a la documentaci√≥n.
- `summary`: Descripci√≥n breve del endpoint.
- `description`: Descripci√≥n detallada.
- `responses`: Descripci√≥n de posibles c√≥digos de respuesta, adem√°s del exitoso.

**Paso 3: Abra la documentaci√≥n en el navegador**

Inicie su servidor FastAPI y abra dos URL m√°gicas:

1.  **`http://127.0.0.1:8000/docs`** ‚Äî abrir√° la documentaci√≥n interactiva de **Swagger UI**. ¬°Aqu√≠ no solo podr√° leer, sino tambi√©n **probar** sus endpoints directamente desde el navegador!
2.  **`http://127.0.0.1:8000/redoc`** ‚Äî abrir√° una vista alternativa de la documentaci√≥n de **ReDoc**. Es menos interactiva, pero a menudo m√°s legible.



---

#### **3. Documentaci√≥n en Laravel: Uso de paquetes de terceros**

A diferencia de FastAPI, Laravel no genera documentaci√≥n "de f√°brica". Sin embargo, existen excelentes paquetes que lo hacen, analizando su c√≥digo. El m√°s popular es **Scribe**.

**Paso 1: Instalaci√≥n de Scribe**
```bash
composer require --dev "knuckleswtf/scribe"
```
```bash
php artisan vendor:publish --tag=scribe-config
php artisan scribe:generate
```

**Paso 2: Descripci√≥n de endpoints usando DocBlocks**

Scribe lee los PHP DocBlocks (comentarios como `/** ... */`) sobre los m√©todos de su controlador.

Abra `app/Http/Controllers/PlanetController.php`:

```php
// app/Http/Controllers/PlanetController.php

/**
 * @group Planetas
 * API para la gesti√≥n de planetas
 */
class PlanetController extends Controller
{
    /**
     * Obtener lista de planetas
     *
     * Devuelve una lista paginada de todos los planetas en la galaxia.
     *
     * @unauthenticated
     */
    public function index()
    {
        // ...
    }

    /**
     * Crear un nuevo planeta
     *
     * @authenticated
     *
     * @bodyParam name string required Nombre del planeta. Example: Kepler-186f
     * @bodyParam description string required Descripci√≥n del planeta.
     * @bodyParam size_km integer required Di√°metro en kil√≥metros. Example: 14000
     * @bodyParam is_habitable boolean ¬øEs habitable el planeta? Example: true
     *
     * @response 201 {
     *  "id": 4,
     *  "name": "Kepler-186f",
     *  "description": "Primer planeta confirmado del tama√±o de la Tierra en la zona habitable de otra estrella.",
     *  "size_km": 14000,
     *  "is_habitable": true,
     *  "created_at": "2023-10-27T12:00:00.000000Z",
     *  "updated_at": "2023-10-27T12:00:00.000000Z"
     * }
     */
    public function store(Request $request)
    {
        // ...
    }
    // ... y as√≠ sucesivamente para otros m√©todos
}
```

**Etiquetas clave de Scribe:**

- `@group`: Agrupa los endpoints.
- `@unauthenticated` / `@authenticated`: Indica si se necesita un token.
- `@bodyParam`: Describe un par√°metro en el cuerpo de la solicitud.
- `@response`: Ejemplo de una respuesta exitosa.

**Paso 3: Generaci√≥n y visualizaci√≥n de la documentaci√≥n**

Cada vez que realice cambios en los DocBlocks, ejecute el comando:

```bash
php artisan scribe:generate
```
Scribe crear√° una p√°gina HTML est√°tica con su documentaci√≥n. √Åbrala en: **`http://your-app-url/docs`**.



---

#### **Cuestionario de refuerzo**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. FastAPI genera documentaci√≥n basada en el est√°ndar:</p>
      <label><input type="radio" name="q1" value="a"> a) GraphQL</label>
      <label><input type="radio" name="q1" value="b"> b) OpenAPI (Swagger)</label>
      <label><input type="radio" name="q1" value="c"> c) WSDL</label>
    </div>
    <div class="question">
      <p>2. ¬øQu√© URL abre Swagger UI en FastAPI por defecto?</p>
      <label><input type="radio" name="q2" value="a"> a) /api/docs</label>
      <label><input type="radio" name="q2" value="b"> b) /swagger</label>
      <label><input type="radio" name="q2" value="c"> c) /docs</label>
    </div>
    <div class="question">
      <p>3. Paquete popular para generar documentaci√≥n en Laravel:</p>
      <label><input type="radio" name="q3" value="a"> a) Telescope</label>
      <label><input type="radio" name="q3" value="b"> b) Scribe</label>
      <label><input type="radio" name="q3" value="c"> c) Horizon</label>
    </div>
    <div class="question">
      <p>4. En Scribe, la etiqueta utilizada para describir los par√°metros del cuerpo de la solicitud es:</p>
      <label><input type="radio" name="q4" value="a"> a) @param</label>
      <label><input type="radio" name="q4" value="b"> b) @bodyParam</label>
      <label><input type="radio" name="q4" value="c"> c) @request</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'b', q2: 'c', q3: 'b', q4: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;
if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Tu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumen del cap√≠tulo:**

Has creado documentaci√≥n profesional, transformando tus APIs de "cajas negras" en herramientas comprensibles y f√°ciles de usar.

- ‚úÖ Has comprendido la importancia cr√≠tica de documentar APIs.
- ü™Ñ Has aprendido a usar la generaci√≥n autom√°tica de documentaci√≥n en FastAPI.
- ‚öôÔ∏è Has dominado los fundamentos del paquete Scribe para documentar APIs en Laravel.
- üõ∞Ô∏è Te has asegurado de que una buena documentaci√≥n es el mejor asistente para cualquier desarrollador.

**Tus APIs no solo funcionan y est√°n protegidas, sino que tambi√©n est√°n completamente listas para ser usadas por otros miembros del equipo.** Queda un √∫ltimo paso, pero el m√°s importante: la verificaci√≥n de seguridad final.

> **üìå Verificaci√≥n:**

> - Para FastAPI: abre `/docs` en el navegador y prueba a ejecutar un `GET`-request a la lista de planetas directamente desde la interfaz de Swagger UI.
> - Para Laravel: ejecuta `php artisan scribe:generate` y abre `/docs`. Aseg√∫rate de que los endpoints est√©n agrupados y que el m√©todo `store` tenga una descripci√≥n de los par√°metros.
