# **Cap√≠tulo 2.2: Creaci√≥n del modelo Planet**
**Tiempo de estudio:** 45 minutos

---

#### **1. El modelo en Laravel: Planos de un objeto espacial**
En la arquitectura MVC (Modelo-Vista-Controlador), el **modelo** es:

- üì¶ Contenedor de datos (par√°metros de planetas)
- üîå Interfaz de trabajo con la base de datos
- üõ°Ô∏è Centro de la l√≥gica de negocio de la aplicaci√≥n

> üí° **Analog√≠a espacial:**
> El modelo `Planet` = Planos de un planeta en el ordenador del Centro de Control de Misi√≥n. Con √©l se puede:

> - Crear un nuevo planeta en el cat√°logo (`INSERT`)
> - Obtener datos sobre Marte (`SELECT`)
> - Actualizar informaci√≥n sobre la atm√≥sfera (`UPDATE`)

---

#### **2. Creaci√≥n del modelo y la migraci√≥n**
Laravel utiliza Artisan CLI ‚Äî su "panel de control" del proyecto.

**Paso 1: Generaci√≥n del modelo con migraci√≥n**
```bash
php artisan make:model Planet -m
```

**Lo que se cre√≥:**
```
app/
  ‚îî‚îÄ‚îÄ Models/
      ‚îî‚îÄ‚îÄ Planet.php    ‚Üê Modelo
database/
  ‚îî‚îÄ‚îÄ migrations/
      ‚îî‚îÄ‚îÄ 2025_08_04_000000_create_planets_table.php  ‚Üê Migraci√≥n
```

**Banderas de Artisan:**

- `-m` ‚Üí Crear migraci√≥n
- `-c` ‚Üí Crear controlador
- `-r` ‚Üí Controlador de recursos

> üí° **Consejo profesional:** Estas banderas se pueden combinar para una m√°xima eficiencia. El comando `php artisan make:model Planet -mcr` crear√° inmediatamente el modelo, la migraci√≥n y el controlador de recursos para gestionar este modelo. Esto ahorra mucho tiempo.

---

#### **3. Configuraci√≥n del modelo Planet**
Abra `app/Models/Planet.php`:
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Planet extends Model
{
    // Nombre de la tabla (por defecto: 'planets')
	// Laravel asume autom√°ticamente que el nombre de la tabla es la forma plural del nombre del modelo en snake_case (Planet -> planets).
     //Por lo tanto, esta propiedad no es obligatoria aqu√≠, pero es √∫til para mayor claridad.
    protected $table = 'planets';

    // Campos permitidos para asignaci√≥n masiva
    protected $fillable = [
        'name',
        'description',
        'size_km',
        'solar_system',
        'image_url'
    ];

    // Tipos de datos para conversi√≥n autom√°tica
    protected $casts = [
        'size_km' => 'integer'
    ];
}
```

**Explicaci√≥n de las propiedades:**

| Propiedad        | Valor                                 | Ejemplo de datos           |
|------------------|---------------------------------------|----------------------------|
| `$table`         | Nombre de la tabla en la BD           | `planets`                  |
| `$fillable`      | Campos para asignaci√≥n masiva         | `name`, `size_km`          |
| `$casts`         | Conversi√≥n autom√°tica de tipos        | `size_km: integer`       |

---

#### **4. Dise√±o de la tabla de planetas**
Antes de editar la migraci√≥n, definamos la estructura del "planeta":

| Campo          | Tipo de datos       | Descripci√≥n                     | Valor de ejemplo      |
|----------------|---------------------|---------------------------------|-----------------------|
| `id`           | BIGINT (PK)         | ID √∫nico                        | 1                     |
| `name`         | VARCHAR(255)        | Nombre del planeta              | "Marte"               |
| `description`  | TEXT                | Descripci√≥n                     | "Planeta rojo..."     |
| `size_km`      | INTEGER             | Di√°metro en km                  | 6779                  |
| `solar_system` | VARCHAR(100)        | Sistema Solar                   | "Sistema Solar"       |
| `image_url`    | VARCHAR(2048)       | URL de la foto (puede ser nulo) | "https://..."         |
| `created_at`   | TIMESTAMP           | Fecha de creaci√≥n               | 2025-08-04 12:00:00   |
| `updated_at`   | TIMESTAMP           | Fecha de actualizaci√≥n          | 2025-08-05 09:30:00   |

---

#### **5. Edici√≥n de la migraci√≥n**
Abra el archivo de migraci√≥n en `database/migrations/..._create_planets_table.php`:

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreatePlanetsTable extends Migration
{
    public function up()
    {
        Schema::create('planets', function (Blueprint $table) {
            $table->id(); // BIGINT autoincremental

            $table->string('name')->unique();
            $table->text('description');
            $table->integer('size_km');
            $table->string('solar_system', 100);
            $table->string('image_url', 2048)->nullable();

            $table->timestamps(); // created_at + updated_at
        });
    }

    public function down()
    {
        Schema::dropIfExists('planets');
    }
}
```

**Puntos clave:**

- `->unique()` ‚Üí Garantiza la unicidad de los nombres
- `->nullable()` ‚Üí El campo puede estar vac√≠o
- `timestamps()` ‚Üí Gesti√≥n autom√°tica de fechas

---

#### **6. Ejecuci√≥n de la migraci√≥n (preliminar)**
Aunque la ejecuci√≥n se realizar√° en el cap√≠tulo 2.3, veamos c√≥mo se ver√°:
```bash
php artisan migrate
```

**Salida esperada:**
```
Migrating: 2025_08_04_000000_create_planets_table
Migrated:  2025_08_04_000000_create_planets_table (32.15ms)
```

**Verificaci√≥n en pgAdmin 4:**

1. Abra la base de datos `space_api` ‚Üí Schemas ‚Üí Tables
2. Deber√≠a aparecer la tabla `planets` con sus campos

---

#### **7. Enfoque alternativo: Generadores de c√≥digo**
Para acelerar el desarrollo se pueden utilizar paquetes:

- **Laravel Blueprint** - crea modelos/migraciones a partir de una descripci√≥n YAML
- **InfyOm Laravel Generator** - generador basado en el esquema de la BD

**Ejemplo de Blueprint:**
```yaml
models:
  Planet:
    name: string:255
    description: text
    size_km: integer
    solar_system: string:100
    image_url: string:2048? # El signo '?' indica que el campo puede ser nulo
```

---

#### **Cuestionario para consolidaci√≥n**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Comando Artisan para crear un modelo y su migraci√≥n asociada:</p>
      <label><input type="radio" name="q1" value="a"> a) php artisan make:model Planet -m</label>
      <label><input type="radio" name="q1" value="b"> b) php artisan create:model Planet</label>
      <label><input type="radio" name="q1" value="c"> c) php artisan model:new Planet --m</label>
    </div>
    <div class="question">
      <p>2. La propiedad `$fillable` en el modelo es necesaria para</p>
      <label><input type="radio" name="q2" value="a"> a) Proteger contra la asignaci√≥n masiva</label>
      <label><input type="radio" name="q2" value="b"> b) Cifrado autom√°tico de datos</label>
      <label><input type="radio" name="q2" value="c"> c) Descripci√≥n de claves for√°neas</label>
    </div>
    <div class="question">
      <p>3. `nullable()` en la migraci√≥n significa:</p>
      <label><input type="radio" name="q3" value="a"> a) El campo es obligatorio</label>
      <label><input type="radio" name="q3" value="b"> b) El campo puede estar vac√≠o</label>
      <label><input type="radio" name="q3" value="c"> c) El campo ser√° eliminado</label>
    </div>
    <div class="question">
      <p>4. Tipo de campo para una descripci√≥n larga del planeta:</p>
      <label><input type="radio" name="q4" value="a"> a) string</label>
      <label><input type="radio" name="q4" value="b"> b) text</label>
      <label><input type="radio" name="q4" value="c"> c) varchar</label>
    </div>
    <div class="question">
      <p>5. El m√©todo `timestamps()` crea:</p>
      <label><input type="radio" name="q5" value="a"> a) Solo created_at</label>
      <label><input type="radio" name="q5" value="b"> b) created_at y updated_at</label>
      <label><input type="radio" name="q5" value="c"> c) id, created_at, updated_at</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'a', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }
resultsHTML += `</ul><p><b>Tu resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**üöÄ Resumen del cap√≠tulo:**
¬°Has creado un "gemelo digital" del planeta! Ahora tu proyecto tiene:

- ü™ê Modelo `Planet` con l√≥gica de negocio
- üìä Migraci√≥n para la tabla `planets` en PostgreSQL
- üõ†Ô∏è Propiedades del modelo configuradas (`fillable`, `casts`)

**¬°Prepara la base de datos!** En el siguiente cap√≠tulo ejecutaremos la migraci√≥n y poblaremos el universo con los primeros planetas.

> **üìå Comprobaci√≥n:**

> Aseg√∫rate de que los archivos `Planet.php` y `..._create_planets_table.php` hayan sido creados en los directorios correctos.

> **‚ö†Ô∏è Si Artisan da errores:**

> - Verifica que est√©s en la carpeta del proyecto
> - Aseg√∫rate de que las dependencias est√©n instaladas (`composer install`)
> - Para Windows: a√±ade PHP y Composer al PATH