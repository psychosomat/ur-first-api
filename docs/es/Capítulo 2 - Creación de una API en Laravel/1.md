# **Cap√≠tulo 2.1: Preparaci√≥n del entorno de Laravel**
**Tiempo de estudio:** 1-2 horas
---

#### **1. ¬øPor qu√© se necesita un entorno local?**
Imagine que est√° construyendo una sonda espacial. Antes de lanzarla al espacio, **prueba todos los sistemas en la Tierra**. Un entorno local es su "laboratorio de control" para el c√≥digo:

- Experimentos seguros sin afectar al servidor de producci√≥n
- Despliegue r√°pido de dependencias
- F√°cil cambio entre versiones de software

> üí° **Analog√≠a espacial:**
> Herd = Complejo de lanzamiento m√≥vil
> Docker = Simulador de estaci√≥n espacial
> XAMPP = Banco de pruebas estacionario

---

#### **2. Instalaci√≥n de Herd**
**Herd** ‚Äî una herramienta moderna para la gesti√≥n del entorno PHP (an√°logo a Laravel Valet).

**Pasos de instalaci√≥n:**

1. Descargue el instalador: [herd.laravel.com](https://herd.laravel.com)
2. Ejecute `Herd Installer.exe` ‚Üí Siguiente ‚Üí Instalar
3. Despu√©s de la instalaci√≥n:
   	- Abra Herd desde el men√∫ Inicio. El icono de la aplicaci√≥n aparecer√° en la bandeja del sistema (junto al reloj).
   	- Haga clic en el icono de Herd: aseg√∫rese de que Nginx y la versi√≥n de PHP necesaria (por ejemplo, 8.3) est√©n en ejecuci√≥n (marcados con un punto verde).
   	- Vaya a Herd Paths y a√±ada la carpeta donde se almacenar√°n sus proyectos (por ejemplo, C:\Users\SuUsuario\Code). Herd crear√° autom√°ticamente un dominio atractivo para cada subdirectorio en esta carpeta, del tipo nombre-de-carpeta.test.

> ‚ö†Ô∏è **¬°Importante!** Durante la instalaci√≥n:
> - Permita el acceso a la red (si el firewall lo solicita)
> - Verifique la ruta en PATH: `C:\Program Files\Herd\bin`

**Verificaci√≥n de funcionamiento:**

1. Haga clic en el icono de Herd en la bandeja del sistema.
2. Aseg√∫rese de que los servicios Nginx y PHP est√©n activos (indicadores verdes).
3. Cree en su carpeta de proyectos (por ejemplo, C:\Users\SuUsuario\Code) una carpeta llamada test, y dentro de ella un archivo index.php con el contenido ```<?php phpinfo(); ?>```.
4. En Herd, a trav√©s de la pesta√±a de sitios, especifique la ruta a la carpeta test y haga clic en "Add site".
5. Abra en el navegador la direcci√≥n http://test.test. Deber√≠a ver una p√°gina con informaci√≥n sobre PHP.

---

#### **3. M√©todos alternativos (brevemente)**
| Herramienta       | Para qui√©n              | Pros                          | Contras                  |
|-------------------|-----------------------|--------------------------------|-------------------------|
| **Laravel Sail (Docker)**       | Para todos los niveles  | Aislamiento completo, repetibilidad del entorno, soporte oficial de Laravel | Requiere instalaci√≥n de Docker, consume m√°s recursos   |
| **XAMPP**        | Principiantes           | Todo en un instalador (All-in-One)              | Voluminoso, m√°s dif√≠cil de gestionar versiones de software, ensucia el sistema   |
| **Laragon**      | Desarrolladores de Windows | R√°pido, f√°cil de cambiar versiones, configuraci√≥n autom√°tica de hosts        | Requiere reinicio manual del servidor web al a√±adir un nuevo proyecto     |

> **Ejemplo con Docker (Laravel Sail):**
> ```dockerfile
> # Despu√©s de instalar Docker
> ./vendor/bin/sail up
> ```

---

#### **4. Instalaci√≥n de PHP y Composer**
**Si no usa Herd:**

1. PHP:
   	- Descargue [PHP 8.3 para Windows](https://windows.php.net/download/)
   	- Descomprima en `C:\PHP`
   	- A√±ada a PATH:
     ```powershell
	 # Se recomienda ejecutar en PowerShell como administrador
     [Environment]::SetEnvironmentVariable("Path", "$env:Path;C:\PHP", "User")
     ```
2. Composer:
   	- Ejecute [Composer-Setup.exe](https://getcomposer.org/download/)
   	- Verificaci√≥n:
     ```cmd
     php -v
     composer --version
     ```

---

#### **5. Instalaci√≥n de PostgreSQL**
**Para trabajar con bases de datos:**

1. Descargue [PostgreSQL 15](https://www.postgresql.org/download/windows/)
2. Ejecute el instalador:
   - Contrase√±a para el superusuario: `admin` (o la suya)
   - Puerto: `5432` (est√°ndar)
3. Despu√©s de la instalaci√≥n:
   - Abra **pgAdmin 4** (cliente gr√°fico)
   > Puede utilizar cualquier otro cliente para trabajar con la base de datos, por ejemplo, DBeaver, DataGrip o incluso la l√≠nea de comandos.
   > Yo prefiero DBeaver - pero es cuesti√≥n de gustos
   - Cree una base de datos para el proyecto: `space_api`

---

#### **6. Instalaci√≥n de Laravel**
1. A trav√©s de Composer:
```bash
composer create-project laravel/laravel space-api
cd space-api
```

2. Inicializaci√≥n de Git (opcional):
```bash
git init
git add .
git commit -m "Inicio del proyecto espacial"
```

3. Inicio y verificaci√≥n del servidor:
>Si utiliza Herd:
Aseg√∫rese de que su proyecto space-api se encuentre en la carpeta que a√±adi√≥ a Herd.
Abra en el navegador la direcci√≥n: http://space-api.test
Deber√≠a ver la p√°gina de inicio de Laravel. ¬°El servidor ya est√° funcionando gracias a Herd!

Si NO utiliza Herd (instalaci√≥n manual):
```bash
php artisan serve
```
Abra en el navegador: [http://localhost:8000](http://localhost:8000) ‚Üí ¬°Deber√≠a aparecer la p√°gina de inicio de Laravel!

### Al crear un proyecto en Herd:

Simplemente siga las instrucciones en pantalla. Para mayor comodidad, el nombre del proyecto ser√° `space-api`. El kit de inicio puede ser cualquiera, pero yo prefiero React.

##### Aseg√∫rese de incluir phpunit - nos ser√° √∫til m√°s adelante

---

#### **7. Configuraci√≥n del proyecto**
**Archivos importantes:**

- `.env` ‚Äî configuraci√≥n del entorno (claves, bases de datos)
- `config/database.php` ‚Äî configuraci√≥n de la SGBD
- `composer.json` ‚Äî dependencias de PHP

**Conexi√≥n de la BD al proyecto:**

A√±ada a `.env`:

```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=space_api
DB_USERNAME=postgres # Usuario para postgres
DB_PASSWORD=admin # Contrase√±a para postgres
```

**Primeros comandos Artisan:**
```bash
php artisan key:generate  # Generaci√≥n de la clave de la aplicaci√≥n
php artisan migrate:fresh # Migraci√≥n de la base de datos (al cambiar a postgres)
```

---

#### **Cuestionario de repaso**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Herd es...</p>
      <label><input type="radio" name="q1" value="a"> a) Una herramienta para gestionar el entorno PHP</label>
      <label><input type="radio" name="q1" value="b"> b) Un editor de c√≥digo</label>
      <label><input type="radio" name="q1" value="c"> c) Un sistema operativo</label>
    </div>
    <div class="question">
      <p>2. ¬øQu√© herramienta utiliza Laravel para gestionar las dependencias de PHP?</p>
      <label><input type="radio" name="q2" value="a"> a) npm</label>
      <label><input type="radio" name="q2" value="b"> b) Composer</label>
      <label><input type="radio" name="q2" value="c"> c) Artisan</label>
    </div>
    <div class="question">
      <p>3. Puerto est√°ndar para PostgreSQL:</p>
      <label><input type="radio" name="q3" value="a"> a) 3306</label>
      <label><input type="radio" name="q3" value="b"> b) 5432</label>
      <label><input type="radio" name="q3" value="c"> c) 8000</label>
    </div>
    <div class="question">
      <p>4. Comando para crear un proyecto Laravel a trav√©s de Composer:</p>
      <label><input type="radio" name="q4" value="a"> a) composer create-laravel</label>
      <label><input type="radio" name="q4" value="b"> b) laravel new</label>
      <label><input type="radio" name="q4" value="c"> c) composer create-project laravel/laravel</label>
    </div>
    <div class="question">
      <p>5. ¬øArchivo con la configuraci√≥n del entorno?</p>
      <label><input type="radio" name="q5" value="a"> a) .env</label>
      <label><input type="radio" name="q5" value="b"> b) config.php</label>
      <label><input type="radio" name="q5" value="c"> c) settings.ini</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Verificar</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'b', q3: 'b', q4: 'c', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Resultados:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:green;">¬°Correcto!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:red;">Incorrecto.</span> Respuesta correcta: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Pregunta ${question.slice(1)}: <span style="color:orange;">Sin respuesta.</span></li>`;
      }
    }
resultsHTML += `</ul><p><b>Su resultado: ${score} de ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

### **üöÄ Conclusi√≥n del Cap√≠tulo**
> ¬°Ha desplegado la "plataforma de lanzamiento" para la API espacial! Ahora tiene:

> - üõ†Ô∏è Entorno local (Herd o instalaci√≥n manual) con PHP y Nginx
> - üêò Servidor de base de datos PostgreSQL instalado
> - üöÄ Proyecto Laravel `space-api`
> - üîå Conexi√≥n a la base de datos configurada
>
> **üìå Verificaci√≥n:**

> - **Si usa Herd:** Aseg√∫rese de que el sitio web se abra en la direcci√≥n `http://space-api.test`.
> - **Si no usa Herd:** Aseg√∫rese de que el comando `php artisan serve` funcione y que el sitio web se abra en la direcci√≥n `http://localhost:8000`.
> - En cualquier caso, compruebe que la base de datos `space_api` creada sea visible en `pgAdmin 4`.
