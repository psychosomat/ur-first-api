# **2.4ì¥: PlanetController API ì»¨íŠ¸ë¡¤ëŸ¬**
**í•™ìŠµ ì‹œê°„:** 1ì‹œê°„

---

#### **1. ì»¨íŠ¸ë¡¤ëŸ¬: ìš°ì£¼ ê°ì²´ ê´€ë¦¬ ì„¼í„°**
MVC ì•„í‚¤í…ì²˜ì—ì„œ **ì»¨íŠ¸ë¡¤ëŸ¬**ëŠ” ëª¨ë¸ê³¼ ìš”ì²­ ì‚¬ì´ì˜ ì¤‘ê°œìì…ë‹ˆë‹¤:

- ğŸ“¡ HTTP ìš”ì²­(GET, POST, PUT, DELETE) ìˆ˜ì‹ 
- ğŸ” ëª¨ë¸ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„° ì¶”ì¶œ
- ğŸ“¦ APIë¥¼ ìœ„í•œ JSON ì‘ë‹µ ìƒì„±

> ğŸ’¡ **ìš°ì£¼ ë¹„ìœ :**
> `PlanetController` = ë¯¸ì…˜ í†µì œ ì„¼í„°(MCC):

> - ì§€êµ¬ë¡œë¶€í„° ìš”ì²­ ìˆ˜ì‹  (`GET /planets`)
> - "íƒì‚¬ì„ "(ëª¨ë¸)ì— ëª…ë ¹ ì „ë‹¬
> - JSON í˜•ì‹ìœ¼ë¡œ ì›ê²© ì¸¡ì • ë°ì´í„° ë°˜í™˜

---

#### **2. ë¦¬ì†ŒìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±**
ë¦¬ì†ŒìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” CRUD ì‘ì—…ì„ ìœ„í•œ ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ í¬í•¨í•©ë‹ˆë‹¤.

**1ë‹¨ê³„: ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±**
```bash
php artisan make:controller PlanetController --api --model=Planet
```

`app/Http/Controllers/PlanetController.php`ì— ìƒì„±ë  ë‚´ìš©:
```php
<?php

namespace App\Http\Controllers;

use App\Models\Planet;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule; // ì´ ì„í¬íŠ¸ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”.

class PlanetController extends Controller
{
    // í–‰ì„± ëª©ë¡ í‘œì‹œ
    public function index(Request $request) {}

    // ìƒˆë¡œìš´ í–‰ì„± ìƒì„±
    public function store(Request $request) {}

    // íŠ¹ì • í–‰ì„± í‘œì‹œ
    public function show(Planet $planet) {}

    // í–‰ì„± ì—…ë°ì´íŠ¸
    public function update(Request $request, Planet $planet) {}

    // í–‰ì„± ì‚­ì œ
    public function destroy(Planet $planet) {}
}
```

---

#### **3. API ë©”ì„œë“œ êµ¬í˜„**

**A. `index()` - í–‰ì„± ëª©ë¡ ê°€ì ¸ì˜¤ê¸°**
```php
<?php
public function index(Request $request)
{
    // í˜ì´ì§€ë‹¹ 15ê°œì”©, í˜ì´ì§€ë„¤ì´ì…˜ëœ í–‰ì„± ê°€ì ¸ì˜¤ê¸°
    $planets = Planet::paginate($request->get('per_page', 15));
    return response()->json($planets); // ìë™ 200 OK
}
```

**B. `store()` - ìƒˆë¡œìš´ í–‰ì„± ìƒì„±**
```php
<?php
public function store(Request $request)
{
    $data = $request->validate([
        'name' => 'required|string|max:255|unique:planets',
        'description' => 'required|string',
        'size_km' => 'required|integer|min:100',
        'solar_system' => 'required|string|max:100',
        'image_url' => 'nullable|url',
        'is_habitable' => 'boolean'
    ]);

    $planet = Planet::create($data);
    return response()->json($planet, 201); // 201 Created
}
```

**C. `show()` - ë‹¨ì¼ í–‰ì„± ë³´ê¸°**
```php
<?php
public function show(Planet $planet)
{
    return response()->json($planet); // ìë™ 200 OK
}
```

**D. `update()` - í–‰ì„± ì—…ë°ì´íŠ¸**
```php
<?php
public function update(Request $request, Planet $planet)
{
    $data = $request->validate([
        'name' => [
            'string',
            'max:255',
            Rule::unique('planets')->ignore($planet->id),
        ],
        'description' => 'sometimes|string', // 'sometimes' - í•„ë“œê°€ ì „ì†¡ëœ ê²½ìš°ì—ë§Œ ìœ íš¨ì„± ê²€ì‚¬
        'size_km' => 'sometimes|integer|min:100',
        'solar_system' => 'sometimes|string|max:100',
        'image_url' => 'sometimes|nullable|url',
        'is_habitable' => 'sometimes|boolean'
    ]);

    $planet->update($data);
    return response()->json($planet); // 200 OK
}
```

**E. `destroy()` - í–‰ì„± ì‚­ì œ**
```php
<?php
public function destroy(Planet $planet)
{
    $planet->delete();
    return response()->json(null, 204); // 204 No Content
}
```

---

#### **4. ë¼ìš°íŠ¸ ëª¨ë¸ ë°”ì¸ë”© (Route Model Binding)**
Laravelì€ IDì— ë”°ë¼ í–‰ì„± ê°ì²´ë¥¼ ìë™ìœ¼ë¡œ ì‚½ì…í•©ë‹ˆë‹¤:
```php
// ë¼ìš°íŠ¸: GET /planets/{planet}
// ë©”ì„œë“œ: show(Planet $planet)
```

- í–‰ì„±ì„ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš° â†’ ìë™ 404
- `findOrFail()`ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ë™ìœ¼ë¡œ ì¿¼ë¦¬í•  í•„ìš” ì—†ìŒ

---

#### **5. ì‘ë‹µ í˜•ì‹ ì§€ì •**
**`index()`ì— ëŒ€í•œ ê°œì„ ëœ ì‘ë‹µ ì˜ˆì‹œ:**
```php
<?php
public function index()
{
    return response()->json([
        'success' => true,
        'data' => Planet::all(),
        'message' => 'í–‰ì„±ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤'
    ]);
}
```

**404 ì˜¤ë¥˜ ì‹œ ì‘ë‹µ (ìë™):**
```json
{
    "message": "No query results for model [App\\Models\\Planet] 123",
    "exception": "Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException"
}
```

---

#### **ë³µìŠµ í€´ì¦ˆ**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. API ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìƒì„±í•˜ëŠ” í”Œë˜ê·¸:</p>
      <label><input type="radio" name="q1" value="a"> a) --api</label>
      <label><input type="radio" name="q1" value="b"> b) --resource</label>
      <label><input type="radio" name="q1" value="c"> c) --model</label>
    </div>
    <div class="question">
      <p>2. ì„±ê³µì ì¸ ìƒì„± ì‹œ ì–´ë–¤ ìƒíƒœë¥¼ ë°˜í™˜í•´ì•¼ í•©ë‹ˆê¹Œ?</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 201 Created</label>
      <label><input type="radio" name="q2" value="c"> c) 204 No Content</label>
    </div>
    <div class="question">
      <p>3. ë¼ìš°íŠ¸ ëª¨ë¸ ë°”ì¸ë”©ì€ ë‹¤ìŒì„ í—ˆìš©í•©ë‹ˆë‹¤:</p>
      <label><input type="radio" name="q3" value="a"> a) IDë¡œ ê°ì²´ë¥¼ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤</label>
      <label><input type="radio" name="q3" value="b"> b) HTML í¼ì„ ìƒì„±í•©ë‹ˆë‹¤</label>
      <label><input type="radio" name="q3" value="c"> c) ìš”ì²­ì„ ìºì‹œí•©ë‹ˆë‹¤</label>
    </div>
    <div class="question">
      <p>4. í–‰ì„± ì‚­ì œ ì‹œ ë°˜í™˜í•˜ëŠ” ê²ƒì€:</p>
      <label><input type="radio" name="q4" value="a"> a) í–‰ì„± ë°ì´í„°ê°€ í¬í•¨ëœ JSON</label>
      <label><input type="radio" name="q4" value="b"> b) 204 ì½”ë“œì™€ í•¨ê»˜ null</label>
      <label><input type="radio" name="q4" value="c"> c) ë¹ˆ ë¬¸ìì—´</label>
    </div>
    <div class="question">
      <p>5. `$request->validate()`ëŠ” ë‹¤ìŒ ìš©ë„ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤:</p>
      <label><input type="radio" name="q5" value="a"> a) ì…ë ¥ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬</label>
      <label><input type="radio" name="q5" value="b"> b) ìš”ì²­ ì•”í˜¸í™”</label>
      <label><input type="radio" name="q5" value="c"> c) ì‘ë‹µ ìºì‹±</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">í™•ì¸</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'b', q3: 'a', q4: 'b', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>ê²°ê³¼:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>ì§ˆë¬¸ ${question.slice(1)}: <span style="color:green;">ì •ë‹µì…ë‹ˆë‹¤!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>ì§ˆë¬¸ ${question.slice(1)}: <span style="color:red;">ì˜¤ë‹µì…ë‹ˆë‹¤.</span> ì •ë‹µ: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>ì§ˆë¬¸ ${question.slice(1)}: <span style="color:orange;">ì‘ë‹µ ì—†ìŒ.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>ê·€í•˜ì˜ ì ìˆ˜: ${Object.keys(correctAnswers).length}ì  ì¤‘ ${score}ì </b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ğŸš€ ì´ ì¥ì˜ ìš”ì•½:**

ì´ì œ í–‰ì„± ì‹œìŠ¤í…œì˜ "ì œì–´íŒ"ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ğŸŒŒ í–‰ì„± ëª©ë¡ í‘œì‹œ (`index`)
- ğŸª ìƒˆë¡œìš´ í–‰ì„± ìƒì„± (`store`)
- ğŸ”­ í–‰ì„± ë°ì´í„° ìƒì„¸ í‘œì‹œ (`show`)
- ğŸ› ï¸ ì •ë³´ ì—…ë°ì´íŠ¸ (`update`)
- ğŸ’¥ í–‰ì„± ì‚­ì œ (`destroy`)

**ì´ì œ ê²½ë¡œë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤!** ë‹¤ìŒ ì¥ì—ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ API ê²½ë¡œì— ì—°ê²°í•  ê²ƒì…ë‹ˆë‹¤.

> **ğŸ“Œ í™•ì¸:**

> `app/Http/Controllers`ì— 5ê°œì˜ ë©”ì„œë“œê°€ ìˆëŠ” `PlanetController.php`ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

> **âš ï¸ ì˜¤ë¥˜ ë°œìƒ ì‹œ:**

> - ëª¨ë¸ ì´ë¦„ í™•ì¸: `use App\Models\Planet;`
> - ì„í¬íŠ¸ í™•ì¸
> - PostgreSQLì˜ ê²½ìš°: `Planet::all()`ì´ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
> - Tinker ë¬¸ì œ ë°œìƒ ì‹œ: `composer dump-autoload`ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.