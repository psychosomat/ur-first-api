# **μ 3μ¥ 3.4: μ°μ£Όμ„  CRUD μ‘μ—…**
**ν•™μµ μ‹κ°„:** 1μ‹κ°„

---

#### **1. CRUD: μ°μ£Ό μ„λ¬΄ κ΄€λ¦¬μ μ „μ²΄ μ£ΌκΈ°**
μ§€κΈκΉμ§€λ” λ°μ΄ν„°λ§ μ½μ—μµλ‹λ‹¤(`Read`). κ·Έλ¬λ‚ μ§„μ •ν• λΉ„ν–‰ ν†µμ  μ„Όν„°λ” λ¨λ“  κ²ƒμ„ ν•  μ μμ–΄μ•Ό ν•©λ‹λ‹¤:

- **C**reate (μƒμ„±): μƒλ΅μ΄ μ„μ„±μ„ κ¶¤λ„μ— μ§„μ…μ‹ν‚µλ‹λ‹¤.
- **R**ead (μ½κΈ°): κΈ°μ΅΄ μ°μ£Όμ„ μ μƒνƒλ¥Ό μ”μ²­ν•©λ‹λ‹¤.
- **U**pdate (μ—…λ°μ΄νΈ): κ¶¤λ„λ¥Ό μμ •ν•κ±°λ‚ μ†ν”„νΈμ›¨μ–΄λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤.
- **D**elete (μ‚­μ ): μ¤λλ μ„μ„±μ„ κ¶¤λ„μ—μ„ μ΄νƒμ‹ν‚µλ‹λ‹¤.

μ΄ λ„¤ κ°€μ§€ μ‘μ—…μΈ **CRUD**λ” λ€λ¶€λ¶„μ APIμ κΈ°λ³Έμ„ μ΄λ£Ήλ‹λ‹¤. μ΄ μ¥μ—μ„λ” μ°λ¦¬ ν•¨λ€ κ΄€λ¦¬λ¥Ό μ„ν• μ™„μ „ν• μ£ΌκΈ°λ¥Ό κµ¬ν„ν•  κ²ƒμ…λ‹λ‹¤.

---

#### **2. Create: μƒλ΅μ΄ μ°μ£Όμ„  λ°μ‚¬ (POST)**
μƒλ΅μ΄ μ°μ£Όμ„ μ„ μƒμ„±ν•κΈ° μ„ν•΄ `POST` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•  κ²ƒμ…λ‹λ‹¤. μƒλ΅μ΄ μ°μ£Όμ„ μ— λ€ν• λ°μ΄ν„°λ” μ”μ²­ λ³Έλ¬Έμ— JSON ν•μ‹μΌλ΅ μ „λ‹¬λ©λ‹λ‹¤.

**λ‹¨κ³„ 1: λ“¤μ–΄μ¤λ” λ°μ΄ν„°λ¥Ό μ„ν• μƒλ΅μ΄ Pydantic λ¨λΈ μƒμ„±**
μƒλ΅μ΄ λ¨λΈμ΄ μ™ ν•„μ”ν• κΉμ”? μ°μ£Όμ„ μ„ μƒμ„±ν•  λ• `id`λ¥Ό λ¨λ¥΄κΈ° λ•λ¬Έμ…λ‹λ‹¤. `id`λ” μ„λ²„κ°€ ν• λ‹Ήν•΄μ•Ό ν•©λ‹λ‹¤.

**μ΄ λ¨λΈμ„ `main.py`μ— μ¶”κ°€ν•μ„Έμ”:**
```python
# main.py
from pydantic import BaseModel, Field

class SpaceshipCreate(BaseModel):
    """μƒλ΅μ΄ μ°μ£Όμ„  μƒμ„±μ„ μ„ν• λ¨λΈ (ID μ—†μ)."""
    name: str = Field(..., min_length=3, max_length=50)
    type: str
    launch_year: int = Field(..., gt=1950)
    status: str
```
μ΄ λ¨λΈμ€ `Spaceship` λ¨λΈκ³Ό κ±°μ λ™μΌν•μ§€λ§, **λ“¤μ–΄μ¤λ” λ°μ΄ν„°μ μ ν¨μ„± κ²€μ‚¬**μ— μ‚¬μ©λ  κ²ƒμ…λ‹λ‹¤.

**λ‹¨κ³„ 2: `POST /spaceships` μ—”λ“ν¬μΈνΈ κµ¬ν„**
```python
# main.py
import random # νμΌ μƒλ‹¨μ— μ΄ μ„ν¬νΈλ¥Ό μ¶”κ°€ν•μ„Έμ”

# ... λ‚λ¨Έμ§€ μ½”λ“ ...

@app.post("/spaceships", response_model=Spaceship, status_code=201)
def create_spaceship(ship: SpaceshipCreate):
    """
    λ μ§€μ¤νΈλ¦¬μ— μƒλ΅μ΄ μ°μ£Όμ„ μ„ μ¶”κ°€ν•©λ‹λ‹¤.
    """
    # μ°μ£Όμ„ μ„ μ„ν• μƒλ΅­κ³  κ³ μ ν• IDλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    new_id = max(db_spaceships.keys() or [0]) + 1

    # μ „μ²΄ Spaceship λ¨λΈμ— ν•΄λ‹Ήν•λ” μ°μ£Όμ„  κ°μ²΄λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    new_ship = Spaceship(id=new_id, **ship.dict())

    # μ°λ¦¬μ "λ°μ΄ν„°λ² μ΄μ¤"μ— μ €μ¥ν•©λ‹λ‹¤.
    db_spaceships[new_id] = new_ship.dict()

    return new_ship
```
**μ„¤λ…:**

- `@app.post(...)`: `POST` μ”μ²­μ„ μ„ν• λ°μ½”λ μ΄ν„°λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.
- `status_code=201`: μ„±κ³µμ μΌλ΅ μƒμ„±λ  κ²½μ° `201 Created` μƒνƒλ¥Ό λ°ν™ν•λ„λ΅ μ§€μ •ν•©λ‹λ‹¤.
- `ship: SpaceshipCreate`: μ—¬κΈ°μ— λ§λ²•μ΄ μμµλ‹λ‹¤! FastAPIλ” μ”μ²­ λ³Έλ¬Έ(JSON)μ„ μλ™μΌλ΅ κ°€μ Έμ™€ `SpaceshipCreate` λ¨λΈμ— λ”°λΌ μ ν¨μ„±μ„ κ²€μ‚¬ν• λ‹¤μ, `ship` κ°μ²΄λ΅ ν•¨μμ— μ „λ‹¬ν•©λ‹λ‹¤.
- `new_id = ...`: μƒλ΅μ΄ IDλ¥Ό μƒμ„±ν•κΈ° μ„ν• κ°„λ‹¨ν• λ΅μ§μ…λ‹λ‹¤.
- `**ship.dict()`: μμ‹ λ `ship` λ¨λΈμ λ°μ΄ν„°λ¥Ό μ „μ²΄ λ¨λΈλ΅ "μ–Έν©"ν•©λ‹λ‹¤.
- `response_model=Spaceship`: μ‘λ‹µμ€ `id`λ¥Ό ν¬ν•¨ν•μ—¬ μ „μ²΄ λ¨λΈμ— λ”°λ¥Ό κ²ƒμ…λ‹λ‹¤.

---

#### **3. Update: μ½”μ¤ μμ • (PUT)**
κΈ°μ΅΄ λ¦¬μ†μ¤λ¥Ό μ™„μ „ν μ—…λ°μ΄νΈν•λ ¤λ©΄ `PUT` λ©”μ„λ“κ°€ μ‚¬μ©λ©λ‹λ‹¤.

**`PUT /spaceships/{ship_id}` μ—”λ“ν¬μΈνΈ κµ¬ν„:**
```python
# main.py
from fastapi import FastAPI, HTTPException # μ„ν¬νΈλ¥Ό μ—…λ°μ΄νΈν•μ„Έμ”

# ... λ‚λ¨Έμ§€ μ½”λ“ ...

@app.put("/spaceships/{ship_id}", response_model=Spaceship)
def update_spaceship(ship_id: int, ship_update: SpaceshipCreate):
    """
    μ°μ£Όμ„  λ°μ΄ν„°λ¥Ό μ™„μ „ν μ—…λ°μ΄νΈν•©λ‹λ‹¤.
    """
    if ship_id not in db_spaceships:
        raise HTTPException(status_code=404, detail="μ°μ£Όμ„ μ΄ λ°κ²¬λμ§€ μ•μ•μµλ‹λ‹¤.")

    updated_ship = Spaceship(id=ship_id, **ship_update.dict())
    db_spaceships[ship_id] = updated_ship.dict()

    return updated_ship
```

- `ship_update: SpaceshipCreate`: λ“¤μ–΄μ¤λ” λ°μ΄ν„°μ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ„ν•΄ λ‹¤μ‹ μ΄ λ¨λΈμ„ μ‚¬μ©ν•©λ‹λ‹¤.
- `HTTPException`: ν•΄λ‹Ή `id`λ¥Ό κ°€μ§„ μ°μ£Όμ„ μ΄ λ°κ²¬λμ§€ μ•μΌλ©΄, FastAPIμ ν‘μ¤€ μμ™Έλ¥Ό "λμ Έ" μ•„λ¦„λ‹¤μ΄ `404` μ½”λ“μ JSON μ‘λ‹µμΌλ΅ λ³€ν™λ©λ‹λ‹¤.

---

#### **4. Delete: κ¶¤λ„ μ΄νƒ (DELETE)**
λ¦¬μ†μ¤λ¥Ό μ‚­μ ν•λ ¤λ©΄ `DELETE` λ©”μ„λ“κ°€ μ‚¬μ©λ©λ‹λ‹¤. μΌλ°μ μΌλ΅ μ΄λ¬ν• μ—”λ“ν¬μΈνΈλ” μ‘λ‹µ λ³Έλ¬Έμ„ λ°ν™ν•μ§€ μ•μµλ‹λ‹¤.

**`DELETE /spaceships/{ship_id}` μ—”λ“ν¬μΈνΈ κµ¬ν„:**
```python
# main.py
from fastapi import FastAPI, HTTPException, Response, status # μ„ν¬νΈλ¥Ό μ—…λ°μ΄νΈν•μ„Έμ”

# ... λ‚λ¨Έμ§€ μ½”λ“ ...

@app.delete("/spaceships/{ship_id}", status_code=status.HTTP_204_NO_CONTENT)
def delete_spaceship(ship_id: int):
    """
    λ μ§€μ¤νΈλ¦¬μ—μ„ μ°μ£Όμ„ μ„ μ‚­μ ν•©λ‹λ‹¤.
    """
    if ship_id not in db_spaceships:
        raise HTTPException(status_code=404, detail="μ°μ£Όμ„ μ΄ λ°κ²¬λμ§€ μ•μ•μµλ‹λ‹¤.")

    del db_spaceships[ship_id]

    # 204 μƒνƒλ΅ λΉ μ‘λ‹µμ„ λ°ν™ν•©λ‹λ‹¤.
    return Response(status_code=status.HTTP_204_NO_CONTENT)
```

- `status_code=status.HTTP_204_NO_CONTENT`: λ…μ‹μ μΌλ΅ `204 No Content` μƒνƒλ¥Ό μ§€μ •ν•©λ‹λ‹¤.
- `del db_spaceships[ship_id]`: μ‚¬μ „μ—μ„ ν•­λ©μ„ μ‚­μ ν•©λ‹λ‹¤.
- `return Response(...)`: μ‚­μ λ κ°μ²΄μ— λ€ν• λ°μ΄ν„°κ°€ ν΄λΌμ΄μ–ΈνΈμ— ν•„μ” μ—†μΌλ―€λ΅ λΉ μ‘λ‹µμ„ λ°ν™ν•©λ‹λ‹¤.

---

#### **5. `/docs`μ—μ„ μ „μ²΄ μ£ΌκΈ° ν…μ¤νΈ**
`uvicorn`μ΄ μ¬μ‹μ‘λμ—μ„ κ²ƒμ…λ‹λ‹¤.

1.  **`http://127.0.0.1:8000/docs`λ¥Ό μ—½λ‹λ‹¤**. μ΄μ  μ™„μ „ν• CRUD μ‘μ—… μ„ΈνΈλ¥Ό κ°–κ² λμ—μµλ‹λ‹¤!
2.  **POST:** `POST /spaceships` μ—”λ“ν¬μΈνΈλ¥Ό ν™•μ¥ν•κ³  "Try it out"μ„ ν΄λ¦­ν• λ‹¤μ, JSON λ³Έλ¬Έμ„ μ‘μ„±ν•κ³  (μ: "μ μ„μ¤ μ›Ή μ°μ£Ό λ§μ›κ²½" μƒμ„±) "Execute"λ¥Ό ν΄λ¦­ν•©λ‹λ‹¤. μƒλ΅μ΄ λ§μ›κ²½ λ°μ΄ν„°μ™€ ν•¨κ» `201` μ‘λ‹µμ„ λ°›μ•„μ•Ό ν•©λ‹λ‹¤.
3.  **GET:** μ΄μ  `GET /spaceships`λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤. λ©λ΅μ— μƒλ΅μ΄ λ§μ›κ²½μ΄ λ‚νƒ€λ‚μ•Ό ν•©λ‹λ‹¤.
4.  **PUT:** μƒλ΅μ΄ λ§μ›κ²½μ IDλ¥Ό μ‚¬μ©ν•μ—¬ `PUT /spaceships/{ship_id}`λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μƒνƒλ¥Ό λ³€κ²½ν•©λ‹λ‹¤.
5.  **DELETE:** λ™μΌν• IDλ¥Ό μ‚¬μ©ν•μ—¬ `DELETE /spaceships/{ship_id}`λ¥Ό ν†µν•΄ λ§μ›κ²½μ„ μ‚­μ ν•©λ‹λ‹¤. `204` μƒνƒμ λΉ μ‘λ‹µμ„ λ°›μ•„μ•Ό ν•©λ‹λ‹¤.
6.  **ν™•μΈ:** λ§μ›κ²½μ΄ λ©λ΅μ—μ„ μ‚­μ λμ—λ”μ§€ ν™•μΈν•λ ¤λ©΄ `GET /spaceships`λ¥Ό λ‹¤μ‹ μ‹¤ν–‰ν•©λ‹λ‹¤.

---

#### **λ³µμµ ν€΄μ¦**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. μƒλ΅μ΄ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•λ” λ° μ‚¬μ©λλ” HTTP λ©”μ„λ“λ” λ¬΄μ—‡μ…λ‹κΉ?</p>
      <label><input type="radio" name="q1" value="a"> a) GET</label>
      <label><input type="radio" name="q1" value="b"> b) PUT</label>
      <label><input type="radio" name="q1" value="c"> c) POST</label>
    </div>
    <div class="question">
      <p>2. `DELETE` μ‘μ—…μ— λ€ν• ν‘μ¤€ μ„±κ³µ μƒνƒ μ½”λ“λ”?</p>
      <label><input type="radio" name="q2" value="a"> a) 200 OK</label>
      <label><input type="radio" name="q2" value="b"> b) 204 No Content</label>
      <label><input type="radio" name="q2" value="c"> c) 404 Not Found</label>
    </div>
    <div class="question">
      <p>3. FastAPIλ” POST μ”μ²­ λ³Έλ¬Έμ—μ„ λ°μ΄ν„°λ¥Ό μ–΄λ–»κ² λ°›μµλ‹κΉ?</p>
      <label><input type="radio" name="q3" value="a"> a) μ „μ—­ λ³€μ `$_POST`λ¥Ό ν†µν•΄</label>
      <label><input type="radio" name="q3" value="b"> b) ν•¨μ μΈμμ— Pydantic λ¨λΈμ΄ μ§€μ •λ κ²½μ° μλ™μΌλ΅</label>
      <label><input type="radio" name="q3" value="c"> c) `request.body` μ¤νΈλ¦Όμ„ μλ™μΌλ΅ μ½μ–΄μ•Ό ν•©λ‹λ‹¤</label>
    </div>
    <div class="question">
      <p>4. `raise HTTPException(status_code=404)`λ” λ‹¤μμ„ μ„ν•΄ μ‚¬μ©λ©λ‹λ‹¤:</p>
      <label><input type="radio" name="q4" value="a"> a) μΉλ…μ μΈ μ„λ²„ μ¤λ¥ (500) μƒμ„±</label>
      <label><input type="radio" name="q4" value="b"> b) ν΄λΌμ΄μ–ΈνΈμ— μ¬λ°”λ¥Έ HTTP μ¤λ¥ μ‘λ‹µ λ°ν™</label>
      <label><input type="radio" name="q4" value="c"> c) μ¤λ¥λ¥Ό νμΌμ— λ΅κΉ…</label>
    </div>
    <div class="question">
      <p>5. λ¦¬μ†μ¤ μƒμ„±μ„ μ„ν•΄ (`POST`) λ³„λ„μ `SpaceshipCreate` λ¨λΈμ„ μƒμ„±ν• μ΄μ λ” λ¬΄μ—‡μ…λ‹κΉ?</p>
      <label><input type="radio" name="q5" value="a"> a) μƒμ„±λλ” κ°μ²΄μ— μ•„μ§ `id`κ°€ μ—†κΈ° λ•λ¬Έμ…λ‹λ‹¤</label>
      <label><input type="radio" name="q5" value="b"> b) FastAPIλ” κ° μ—”λ“ν¬μΈνΈμ— λ€ν•΄ λ‹¤λ¥Έ λ¨λΈ μ΄λ¦„μ΄ ν•„μ”ν•κΈ° λ•λ¬Έμ…λ‹λ‹¤</label>
      <label><input type="radio" name="q5" value="c"> c) μ ν¨μ„± κ²€μ‚¬ μ†λ„λ¥Ό λ†’μ΄κΈ° μ„ν•΄</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">ν™•μΈ</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'c', q2: 'b', q3: 'b', q4: 'b', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>κ²°κ³Ό:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;
```
if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>μ§λ¬Έ ${question.slice(1)}: <span style="color:green;">μ •λ‹µ!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>μ§λ¬Έ ${question.slice(1)}: <span style="color:red;">μ¤λ‹µ.</span> μ •λ‹µ: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>μ§λ¬Έ ${question.slice(1)}: <span style="color:orange;">λ‹µλ³€ μ—†μ.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>λ‹Ήμ‹ μ κ²°κ³Ό: ${score} / ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**π€ μ¥ μ”μ•½:**

λ‹Ήμ‹ μ€ μ™„μ „ν• **CRUD μ£ΌκΈ°**λ¥Ό κµ¬ν„ν•μ—¬ λ‹Ήμ‹ μ APIλ¥Ό λ‹¨μν• "μ •λ³΄ν"μ—μ„ μ™„μ „ν• **ν•¨λ€ μ μ–΄ μ„Όν„°**λ΅ νƒλ°”κΏμ‹μΌ°μµλ‹λ‹¤!

- β… **C**reate: `POST /spaceships` μƒλ΅μ΄ κΈ°μ²΄ μ¶μ‹μ©.
- β… **R**ead: `GET /spaceships` λ° `GET /spaceships/{id}` λ°μ΄ν„° νλ“μ©.
- β… **U**pdate: `PUT /spaceships/{id}` μ„λ¬΄ μ—…λ°μ΄νΈμ©.
- β… **D**elete: `DELETE /spaceships/{id}` κΈ°μ²΄ νκΈ°μ©.

**λ‹Ήμ‹ μ ν•¨λ€λ” μ™„λ²½ν•κ² ν†µμ λ©λ‹λ‹¤!** λ‹¤μ μ¥μ—μ„λ” FastAPIκ°€ μ°λ¦¬λ¥Ό μ„ν•΄ μƒμ„Έν• "μ‘λ™ μ§€μΉ¨μ„" β€” λ€ν™”ν• Swagger λ¬Έμ„λ¥Ό μλ™μΌλ΅ μƒμ„±ν•λ” λ°©λ²•μ„ μ‚΄ν΄λ³΄κ² μµλ‹λ‹¤.

> **π“ ν™•μΈ:**

> - 5κ°μ λ¨λ“  μ—”λ“ν¬μΈνΈ(GET (2), POST, PUT, DELETE)κ°€ `/docs`μ—μ„ λ³΄μ΄κ³  μ‘λ™ν•©λ‹λ‹¤.
> - λ¦¬μ†μ¤λ¥Ό μ„±κ³µμ μΌλ΅ μƒμ„±, μ½κΈ°, μ—…λ°μ΄νΈ λ° μ‚­μ ν•  μ μμµλ‹λ‹¤.
> - μ΅΄μ¬ν•μ§€ μ•λ” IDλ¥Ό μ”μ²­ν•λ©΄ `404` μ¤λ¥κ°€ λ°ν™λ©λ‹λ‹¤.

> **β οΈ μ¤λ¥κ°€ λ°μƒν•λ©΄:**

> - `NameError`: `HTTPException`, `Response`, `status`λ¥Ό μ„ν¬νΈν–λ”μ§€ ν™•μΈν•μ„Έμ”.
> - `KeyError`: μ•„λ§λ„ μ΄λ―Έ μ‚­μ λ IDμ— μ ‘κ·Όν•λ ¤κ³  μ‹λ„ μ¤‘μΌ μ μμµλ‹λ‹¤.
> - `PUT` λλ” `POST` μ‘μ—…μ΄ μλ»λ κ²½μ°: ν•¨μ μΈμμ— μ¬λ°”λ¥Έ Pydantic λ¨λΈ(`SpaceshipCreate`)μ„ μ‚¬μ©ν•κ³  μλ”μ§€ ν™•μΈν•μ„Έμ”.