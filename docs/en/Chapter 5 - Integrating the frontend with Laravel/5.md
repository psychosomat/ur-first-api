# **Chapter 5.5: Routing for Web Pages**
**Study time:** 40 minutes

---

### **1. `routes/web.php` vs `routes/api.php`: Two Different Control Panels**

It is important to reinforce the fundamental difference once again:

| Characteristic          | `routes/web.php` (Web Panel)                               | `routes/api.php` (API Panel)                                  |
| ----------------------- | ---------------------------------------------------------- | ------------------------------------------------------------- |
| **Main Task**     | Displaying HTML pages, handling forms                   | Providing data in JSON format for other applications     |
| **State**   | **Stateful** — uses sessions and cookies | **Stateless** — each request is independent        |
| **Default Middleware** | `web` (includes sessions, CSRF protection, cookie encryption) | `api` (includes "throttling" — request rate limiting) |
| **URL Prefix**         | None (the root of your site)                                  | `/api/` (configured in `RouteServiceProvider`)              |
| **Authentication**      | Usually via sessions (Login/Password)                       | Usually via tokens (Sanctum, Passport)                        |

We are working with `routes/web.php` to build an interface for a live person.

---

### **2. Resource Routes for the Web**

Similar to `Route::apiResource`, there is `Route::resource` for the web. It creates routes for the full CRUD cycle, including pages for displaying creation and editing forms.

Let's create a full set of routes for managing our planets through the web interface.

**Step 1: Create a route in `routes/web.php`**

Comment out or delete the old routes for `/planets` and replace them with a single line:

```php
use App\Http\Controllers\Web\PlanetPageController;

// Route::get('/planets', [PlanetPageController::class, 'index']);
// Route::get('/planets/{planet}', [PlanetPageController::class, 'show']);

Route::resource('planets', PlanetPageController::class);
```

**Step 2: See what was created**
Execute the command `php artisan route:list --except-vendor` in the terminal:

```
+--------+-----------+------------------------+------------------+-------------------------------------------------+------------+
| Method | URI       | Name                   | Action           | Middleware                                      |
+--------+-----------+------------------------+------------------+-------------------------------------------------+------------+
| GET|HEAD | planets                | planets.index          | ...\PlanetPageController@index                    | web        |
| POST   | planets                | planets.store          | ...\PlanetPageController@store                    | web        |
| GET|HEAD | planets/create         | planets.create         | ...\PlanetPageController@create                   | web        |
| GET|HEAD | planets/{planet}       | planets.show           | ...\PlanetPageController@show                     | web        |
| PUT|PATCH | planets/{planet}       | planets.update         | ...\PlanetPageController@update                   | web        |
| DELETE | planets/{planet}       | planets.destroy        | ...\PlanetPageController@destroy                  | web        |
| GET|HEAD | planets/{planet}/edit  | planets.edit           | ...\PlanetPageController@edit                     | web        |
+--------+-----------+------------------------+------------------+-------------------------------------------------+------------+
```

`Route::resource` created 7 routes for us, including:

-   `planets.create` (GET `/planets/create`): page with a creation form.
-   `planets.store` (POST `/planets`): processing this form.
-   `planets.edit` (GET `/planets/{planet}/edit`): page with an editing form.
-   `planets.update` (PUT/PATCH `/planets/{planet}`): processing the editing form.
-   `planets.destroy` (DELETE `/planets/{planet}`): deleting a resource.

---

### **3. Named Routes: Convenient "Space Coordinates"**
Pay attention to the `Name` column. Laravel has automatically assigned a unique name to each route (e.g., `planets.index`). Using names instead of hard-coded URLs is a **best practice**.

**Why?** If you decide to change the URL from `/planets` to `/worlds`, you won't have to search and change all the links in your templates. You just change it in one place — in the routes file, and the names remain the same.

**Example of use in Blade:**

We used to write this:

```blade
<a href="/planets/{{ $planet->id }}">Learn more &rarr;</a>
```

Now we will write this, using the `route()` helper:
```blade
<a href="{{ route('planets.show', ['planet' => $planet->id]) }}">Learn more &rarr;</a>
```

-   `route('planets.show', ...)` — generates a URL for the route named `planets.show`.
-   `['planet' => $planet->id]` — passes the necessary parameters to the URL. Laravel will substitute the ID into `{planet}` itself. You can even pass the entire model: `['planet' => $planet]`.

---

### **4. Implementing the Missing Methods in the Controller**
`Route::resource` created the routes, but we need to create the corresponding methods in `PlanetPageController` ourselves.

Open `app/Http/Controllers/Web/PlanetPageController.php` and add them.

```php
<?php
use Illuminate\Http\Request; // <-- Add

class PlanetPageController extends Controller
{
    // We already have index() and show()

    /**
     * Shows the form for creating a new planet.
     */
    public function create()
    {
        return view('planets.create'); // Just return the view with the form
    }

    /**
     * Stores a new planet in the database.
     */
    public function store(Request $request)
    {
        // Validate the data from the form
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:planets',
            'solar_system' => 'required|string|max:100',
            // ... other rules
        ]);

        Planet::create($validated);

        // Redirect the user to the list page with a success message
        return redirect()->route('planets.index')->with('success', 'Planet successfully created!');
    }

    /**
     * Shows the form for editing a planet.
     */
    public function edit(Planet $planet)
    {
        return view('planets.edit', ['planet' => $planet]);
    }

    /**
     * Updates the planet's data in the database.
     */
    public function update(Request $request, Planet $planet)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:planets,name,' . $planet->id,
            'solar_system' => 'required|string|max:100',
        ]);

        $planet->update($validated);

        return redirect()->route('planets.show', $planet)->with('success', 'Planet data updated!');
    }

    /**
     * Deletes a planet.
     */
    public function destroy(Planet $planet)
    {
        $planet->delete();

        return redirect()->route('planets.index')->with('success', 'Planet decommissioned.');
    }
}
```

-   `redirect()->route(...)` — redirects the user to another named route.
-   `->with('success', '...')` — adds a "flash message" to the session, which will be available on the next page exactly once. We can display it in our Blade template.

---

### **5. Grouping Routes**
If you have many routes with common characteristics (e.g., they are all for the admin panel and should have the `/admin` prefix and special middleware), you can group them.

```php
<?php
Route::middleware(['auth', 'admin'])->prefix('admin')->name('admin.')->group(function () {
    // All routes within this group will have:
    // 1. 'auth' and 'admin' middleware
    // 2. The '/admin' URL prefix (e.g., /admin/planets)
    // 3. The 'admin.' name prefix (e.g., admin.planets.index)

    Route::resource('planets', PlanetPageController::class);
    // Route::get('/dashboard', ...)->name('dashboard'); // -> admin.dashboard
});
```

---

### **Quiz to Reinforce**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Which command in `routes/web.php` will create a full set of CRUD routes for a web interface?</p>
      <label><input type="radio" name="q1" value="a"> a) Route::crud('planets', Controller::class)</label>
      <label><input type="radio" name="q1" value="b"> b) Route::apiResource('planets', Controller::class)</label>
      <label><input type="radio" name="q1" value="c"> c) Route::resource('planets', Controller::class)</label>
    </div>
    <div class="question">
      <p>2. What is the main advantage of using named routes?</p>
      <label><input type="radio" name="q2" value="a"> a) They work faster than direct URLs</label>
      <label><input type="radio" name="q2" value="b"> b) They allow you to easily change URLs in the routes file without breaking links in templates</label>
      <label><input type="radio" name="q2" value="c"> c) They are automatically CSRF protected</label>
    </div>
    <div class="question">
      <p>3. Which route will be generated for the `create()` method in `Route::resource('articles', ...)`?</p>
      <label><input type="radio" name="q3" value="a"> a) GET `/articles/new`</label>
      <label><input type="radio" name="q3" value="b"> b) GET `/articles/create`</label>
      <label><input type="radio" name="q3" value="c"> c) POST `/articles/create`</label>
    </div>
    <div class="question">
      <p>4. What does the code `redirect()->route('home')->with('status', 'OK')` do?</p>
      <label><input type="radio" name="q4" value="a"> a) Returns JSON with 'status' => 'OK' to the `/home` URL</label>
      <label><input type="radio" name="q4" value="b"> b) Redirects to the named route `home` and adds a one-time 'status' message to the session</label>
      <label><input type="radio" name="q4" value="c"> c) Displays the `home.blade.php` view with the `$status` variable</label>
    </div>
    <div class="question">
      <p>5. What is `Route::prefix('dashboard')` used for?</p>
      <label><input type="radio" name="q5" value="a"> a) To add a prefix to all URLs within a group</label>
      <label><input type="radio" name="q5" value="b"> b) To add a prefix to all route names within a group</label>
      <label><input type="radio" name="q5" value="c"> c) To apply the `dashboard` middleware</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Check</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'c', q2: 'b', q3: 'b', q4: 'b', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Results:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Correct answer: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">No answer.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Your score: ${score} out of ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**🚀 Chapter Summary:**

You have mastered a structured and professional approach to organizing web routes in Laravel. You can now:

-   Distinguish between `web` and `api` routes and their purposes.
-   Use `Route::resource` to quickly generate standard CRUD routes.
-   Apply named routes to create flexible and maintainable code.
-   Create full CRUD operations in a controller with validation and redirects.
-   Group routes to apply common rules.

**The navigation system of your "ship" is now fault-tolerant and ready for expansion.** In the final chapter of this section, we will combine all the knowledge we have gained and display the planet data, obtained via Fetch, on our Blade page.