# **Chapter 2.1: Preparing the Laravel Environment**
**Study time:** 1-2 hours
---

#### **1. Why do you need a local environment?**
Imagine you are building a space probe. Before launching it into space, you **test all systems on Earth**. A local environment is your "control laboratory" for code:

- Safe experiments without affecting the production server
- Fast deployment of dependencies
- Easy switching between software versions

> 💡 **Space analogy:**
> Herd = Mobile launch complex
> Docker = Space station simulator
> XAMPP = Stationary test stand

---

#### **2. Installing Herd**
**Herd** is a modern tool for managing a PHP environment (similar to Laravel Valet).

**Installation steps:**

1. Download the installer: [herd.laravel.com](https://herd.laravel.com)
2. Run `Herd Installer.exe` → Next → Install
3. After installation:
   	- Open Herd from the Start menu. The application icon will appear in the system tray (next to the clock).
   	- Click on the Herd icon: make sure that Nginx and the required version of PHP (e.g., 8.3) are running (marked with a green dot).
   	- Go to Herd Paths and add the folder where your projects will be stored (e.g., C:\Users\YourUser\Code). Herd will automatically create a nice domain like `folder-name.test` for each subdirectory in this folder.

> ⚠️ **Important!** During installation:
> - Allow network access (if requested by the firewall)
> - Check the path in PATH: `C:\Program Files\Herd\bin`

**Checking the work:**

1. Click on the Herd icon in the system tray.
2. Make sure that the Nginx and PHP services are active (green indicators).
3. In your projects folder (e.g., C:\Users\YourUser\Code), create a `test` folder, and inside it, an `index.php` file with the content ```<?php phpinfo(); ?>```.
4. In Herd, via the `sites` tab, specify the path to the `test` folder and click "Add site".
5. Open http://test.test in your browser. You should see a page with PHP information.

---

#### **3. Alternative methods (briefly)**
| Tool | For whom | Pros | Cons |
|---|---|---|---|
| **Laravel Sail (Docker)** | For all levels | Complete isolation, environment reproducibility, official Laravel support | Requires Docker installation, consumes more resources |
| **XAMPP** | Beginners | All-in-One installer | Cumbersome, harder to manage software versions, clutters the system |
| **Laragon** | Windows developers | Fast, easy to switch versions, automatic host configuration | Requires manual web server restart when adding a new project |

> **Example with Docker (Laravel Sail):**
> ```dockerfile
> # After installing Docker
> ./vendor/bin/sail up
> ```

---

#### **4. Installing PHP and Composer**
**If you are not using Herd:**

1. PHP:
   	- Download [PHP 8.3 for Windows](https://windows.php.net/download/)
   	- Unpack to `C:\PHP`
   	- Add to PATH:
     ```powershell
	 # It is recommended to run in PowerShell as an administrator
     [Environment]::SetEnvironmentVariable("Path", "$env:Path;C:\PHP", "User")
     ```
2. Composer:
   	- Run [Composer-Setup.exe](https://getcomposer.org/download/)
   	- Check:
     ```cmd
     php -v
     composer --version
     ```

---

#### **5. Installing PostgreSQL**
**For working with databases:**

1. Download [PostgreSQL 15](https://www.postgresql.org/download/windows/)
2. Run the installer:
   - Password for the superuser: `admin` (or your own)
   - Port: `5432` (standard)
3. After installation:
   - Open **pgAdmin 4** (graphical client)
   > You can use any other client to work with the database, for example, DBeaver, DataGrip, or even the command line.
   > I prefer DBeaver - but it's a matter of taste
   - Create a database for the project: `space_api`

---

#### **6. Installing Laravel**
1. Via Composer:
```bash
composer create-project laravel/laravel space-api
cd space-api
```

2. Initialize Git (optional):
```bash
git init
git add .
git commit -m "Start of the space project"
```

3. Starting and checking the server:
>If you are using Herd:
Make sure your `space-api` project is in the folder you added to Herd.
Open in your browser: http://space-api.test
You should see the Laravel start page. The server is already running thanks to Herd!

If you are NOT using Herd (manual installation):
```bash
php artisan serve
```
Open in your browser: [http://localhost:8000](http://localhost:8000) → The Laravel start page should appear!

### When creating a project in Herd:

Just follow the on-screen instructions. For convenience, the project name will be `space-api`. Any starter kit will do, but I prefer React.

##### Be sure to turn on phpunit - we will need it later

---

#### **7. Project setup**
**Important files:**

- `.env` — environment settings (keys, databases)
- `config/database.php` — DBMS configuration
- `composer.json` — PHP dependencies

**Connecting the database to the project:**

Add to `.env`:

```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=space_api
DB_USERNAME=postgres # Login for postgres
DB_PASSWORD=admin # Password for postgres
```

**First Artisan commands:**
```bash
php artisan key:generate  # Generate application key
php artisan migrate:fresh # Database migration (When switching to postgres)
```

---

#### **Quiz to consolidate**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. Herd is...</p>
      <label><input type="radio" name="q1" value="a"> a) A tool for managing a PHP environment</label>
      <label><input type="radio" name="q1" value="b"> b) A code editor</label>
      <label><input type="radio" name="q1" value="c"> c) An operating system</label>
    </div>
    <div class="question">
      <p>2. What tool does Laravel use to manage PHP dependencies?</p>
      <label><input type="radio" name="q2" value="a"> a) npm</label>
      <label><input type="radio" name="q2" value="b"> b) Composer</label>
      <label><input type="radio" name="q2" value="c"> c) Artisan</label>
    </div>
    <div class="question">
      <p>3. The standard port for PostgreSQL is:</p>
      <label><input type="radio" name="q3" value="a"> a) 3306</label>
      <label><input type="radio" name="q3" value="b"> b) 5432</label>
      <label><input type="radio" name="q3" value="c"> c) 8000</label>
    </div>
    <div class="question">
      <p>4. The command to create a Laravel project via Composer is:</p>
      <label><input type="radio" name="q4" value="a"> a) composer create-laravel</label>
      <label><input type="radio" name="q4" value="b"> b) laravel new</label>
      <label><input type="radio" name="q4" value="c"> c) composer create-project laravel/laravel</label>
    </div>
    <div class="question">
      <p>5. The file with environment settings is?</p>
      <label><input type="radio" name="q5" value="a"> a) .env</label>
      <label><input type="radio" name="q5" value="b"> b) config.php</label>
      <label><input type="radio" name="q5" value="c"> c) settings.ini</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Check</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'b', q3: 'b', q4: 'c', q5: 'a' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Results:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> Correct answer: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">No answer.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Your score: ${score} out of ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

### **🚀 Chapter summary**
> You have deployed a "launch pad" for the space API! Now you have:

> - 🛠️ A local environment (Herd or manual installation) with PHP and Nginx
> - 🐘 An installed PostgreSQL database server
> - 🚀 A `space-api` Laravel project
> - 🔌 A configured database connection
>
> **📌 Check:**

> - **If you are using Herd:** Make sure the site opens at `http://space-api.test`.
> - **If you are not using Herd:** Make sure the `php artisan serve` command works and the site opens at `http://localhost:8000`.
> - In any case, check that the created `space_api` database is visible in `pgAdmin 4`.
