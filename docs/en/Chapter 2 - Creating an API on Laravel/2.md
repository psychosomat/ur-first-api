# **Chapter 2.2: Creating the Planet Model**
**Time to learn:** 45 minutes

---

#### **1. The Model in Laravel: A Blueprint for a Celestial Object**
In the MVC (Model-View-Controller) architecture, the **model** is:

- ðŸ“¦ A container for data (planet parameters)
- ðŸ”Œ An interface for working with the database
- ðŸ›¡ï¸ The center of the application's business logic

> ðŸ’¡ **Space Analogy:**
> The `Planet` model = A planet's blueprint in the Mission Control Center's computer. With it, you can:

> - Create a new planet in the catalog (`INSERT`)
> - Get data about Mars (`SELECT`)
> - Update information about the atmosphere (`UPDATE`)

---

#### **2. Creating a Model and Migration**
Laravel uses the Artisan CLIâ€”your project's "control panel."

**Step 1: Generating the model with a migration**
```bash
php artisan make:model Planet -m
```

**What was created:**
```
app/
  â””â”€â”€ Models/
      â””â”€â”€ Planet.php    â† Model
database/
  â””â”€â”€ migrations/
      â””â”€â”€ 2025_08_04_000000_create_planets_table.php  â† Migration
```

**Artisan Flags:**

- `-m` â†’ Create a migration
- `-c` â†’ Create a controller
- `-r` â†’ Resource controller

> ðŸ’¡ **Pro Tip:** These flags can be combined for maximum efficiency. The command `php artisan make:model Planet -mcr` will create a model, a migration, and a resource controller to manage that model all at once. This saves a lot of time.

---

#### **3. Configuring the Planet Model**
Open `app/Models/Planet.php`:
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Planet extends Model
{
    // Table name (default: 'planets')
	// Laravel automatically assumes the table name is the plural, snake_case version of the model name (Planet -> planets).
    // Therefore, this property isn't strictly necessary here, but it's useful for clarity.
    protected $table = 'planets';

    // The attributes that are mass assignable.
    protected $fillable = [
        'name',
        'description',
        'size_km',
        'solar_system',
        'image_url'
    ];

    // The attributes that should be cast.
    protected $casts = [
        'size_km' => 'integer'
    ];
}
```

**Property Explanation:**

| Property         | Meaning                         | Example Data              |
|------------------|----------------------------------|----------------------------|
| `$table`         | Table name in the DB                 | `planets`                  |
| `$fillable`      | Fields for mass assignment    | `name`, `size_km`          |
| `$casts`         | Automatic type casting | `size_km: integer`       |

---

#### **4. Designing the Planets Table**
Before editing the migration, let's define the "planet" structure:

| Field             | Data Type       | Description                     | Example Value       |
|------------------|------------------|------------------------------|-----------------------|
| `id`             | BIGINT (PK)      | Unique ID                | 1                     |
| `name`           | VARCHAR(255)     | Planet's name             | "Mars"                |
| `description`    | TEXT             | Description                     | "The Red Planet..."  |
| `size_km`        | INTEGER          | Diameter in km                 | 6779                  |
| `solar_system`   | VARCHAR(100)     | Solar system            | "Solar System"   |
| `image_url`      | VARCHAR(2048)    | Photo URL (can be null)   | "https://..."         |
| `created_at`     | TIMESTAMP        | Creation date                | 2025-08-04 12:00:00   |
| `updated_at`     | TIMESTAMP        | Update date              | 2025-08-05 09:30:00   |

---

#### **5. Editing the Migration**
Open the migration file in `database/migrations/..._create_planets_table.php`:

```php
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreatePlanetsTable extends Migration
{
    public function up()
    {
        Schema::create('planets', function (Blueprint $table) {
            $table->id(); // BIGINT auto-increment

            $table->string('name')->unique();
            $table->text('description');
            $table->integer('size_km');
            $table->string('solar_system', 100);
            $table->string('image_url', 2048)->nullable();

            $table->timestamps(); // created_at + updated_at
        });
    }

    public function down()
    {
        Schema::dropIfExists('planets');
    }
}
```

**Key Points:**

- `->unique()` â†’ Ensures names are unique
- `->nullable()` â†’ The field can be empty
- `timestamps()` â†’ Automatic date management

---

#### **6. Running the Migration (Preview)**
Although we'll run this in Chapter 2.3, let's see what it looks like:
```bash
php artisan migrate
```

**Expected Output:**
```
Migrating: 2025_08_04_000000_create_planets_table
Migrated:  2025_08_04_000000_create_planets_table (32.15ms)
```

**Checking in pgAdmin 4:**

1. Open the `space_api` database â†’ Schemas â†’ Tables
2. The `planets` table should appear with your fields

---

#### **7. Alternative Approach: Code Generators**
To speed up development, you can use packages:

- **Laravel Blueprint** - creates models/migrations from a YAML definition
- **InfyOm Laravel Generator** - a generator based on a DB schema

**Blueprint Example:**
```yaml
models:
  Planet:
    name: string:255
    description: text
    size_km: integer
    solar_system: string:100
    image_url: string:2048? # The '?' character means the field is nullable
```

---

#### **Review Quiz**

<style>
    #quiz-container {
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
        margin-bottom: 15px;
    }
    .question p {
        font-weight: bold;
        margin-bottom: 10px;
    }
    #quiz-container label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
    }
    #quiz-container button {
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
    }
    #quiz-container button:hover {
    }
    #quiz-results {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<div id="quiz-container">
  <form id="quiz-form">
    <div class="question">
      <p>1. The Artisan command to create a model and its associated migration is:</p>
      <label><input type="radio" name="q1" value="a"> a) php artisan make:model Planet -m</label>
      <label><input type="radio" name="q1" value="b"> b) php artisan create:model Planet</label>
      <label><input type="radio" name="q1" value="c"> c) php artisan model:new Planet --m</label>
    </div>
    <div class="question">
      <p>2. The `$fillable` property in a model is used for:</p>
      <label><input type="radio" name="q2" value="a"> a) Protection against mass assignment</label>
      <label><input type="radio" name="q2" value="b"> b) Automatic data encryption</label>
      <label><input type="radio" name="q2" value="c"> c) Describing foreign keys</label>
    </div>
    <div class="question">
      <p>3. `nullable()` in a migration means:</p>
      <label><input type="radio" name="q3" value="a"> a) The field is required</label>
      <label><input type="radio" name="q3" value="b"> b) The field can be empty</label>
      <label><input type="radio" name="q3" value="c"> c) The field will be deleted</label>
    </div>
    <div class="question">
      <p>4. The field type for a long planet description is:</p>
      <label><input type="radio" name="q4" value="a"> a) string</label>
      <label><input type="radio" name="q4" value="b"> b) text</label>
      <label><input type="radio" name="q4" value="c"> c) varchar</label>
    </div>
    <div class="question">
      <p>5. The `timestamps()` method creates:</p>
      <label><input type="radio" name="q5" value="a"> a) Only created_at</label>
      <label><input type="radio" name="q5" value="b"> b) created_at and updated_at</label>
      <label><input type="radio" name="q5" value="c"> c) id, created_at, updated_at</label>
    </div>
    <button type="button" onclick="checkQuizAnswers()">Check</button>
  </form>
  <div id="quiz-results" style="display:none;"></div>
</div>

<script>
  function checkQuizAnswers() {
    const correctAnswers = { q1: 'a', q2: 'a', q3: 'b', q4: 'b', q5: 'b' };
    const form = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('quiz-results');
    let score = 0;
    let resultsHTML = '<h4>Results:</h4><ul>';

    for (const [question, correctAnswer] of Object.entries(correctAnswers)) {
      const questionDiv = form.querySelector(`input[name="${question}"]`).closest('.question');
      const labels = questionDiv.querySelectorAll('label');
      labels.forEach(l => {
          l.style.color = 'inherit';
          l.style.fontWeight = 'normal';
          l.style.border = 'none';
      });

      const userAnswer = form.elements[question] ? form.elements[question].value : undefined;

      if (userAnswer) {
        const selectedLabel = form.querySelector(`input[name="${question}"][value="${userAnswer}"]`).parentElement;
        if (userAnswer === correctAnswer) {
          score++;
          selectedLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:green;">Correct!</span></li>`;
        } else {
          selectedLabel.style.fontWeight = 'bold';
          const correctLabel = form.querySelector(`input[name="${question}"][value="${correctAnswer}"]`).parentElement;
          correctLabel.style.fontWeight = 'bold';
          resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:red;">Incorrect.</span> The correct answer is: <b>${correctAnswer.toUpperCase()}</b></li>`;
        }
      } else {
        resultsHTML += `<li>Question ${question.slice(1)}: <span style="color:orange;">No answer.</span></li>`;
      }
    }

    resultsHTML += `</ul><p><b>Your score: ${score} out of ${Object.keys(correctAnswers).length}</b></p>`;
    resultsContainer.innerHTML = resultsHTML;
    resultsContainer.style.display = 'block';
  }
</script>

---

**ðŸš€ Chapter Summary:**
You've created a "digital twin" of a planet! Your project now has:

- ðŸª A `Planet` model with business logic
- ðŸ“Š A migration for the `planets` table in PostgreSQL
- ðŸ› ï¸ Configured model properties (`fillable`, `casts`)

**Get the database ready!** In the next chapter, we will run the migration and populate the universe with its first planets.

> **ðŸ“Œ Checkpoint:**

> Make sure the `Planet.php` and `..._create_planets_table.php` files are created in the correct directories.

> **âš ï¸ If Artisan gives an error:**

> - Check that you are in the project folder
> - Make sure dependencies are installed (`composer install`)
> - For Windows: add PHP and Composer to your PATH